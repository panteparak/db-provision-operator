{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"DB Provision Operator","text":"<p>Kubernetes operator for declarative database provisioning across PostgreSQL, MySQL, and MariaDB.</p>"},{"location":"#overview","title":"Overview","text":"<p>DB Provision Operator is a Kubernetes operator that provides a unified, declarative interface for managing database resources. Instead of manually creating databases, users, and permissions, you define them as Kubernetes Custom Resources and the operator handles the rest.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Unified API - Single CRD-based interface for PostgreSQL, MySQL, and MariaDB</li> <li>Declarative Management - GitOps-friendly database provisioning</li> <li>Automatic Credentials - Secure password generation and Kubernetes Secret management</li> <li>Fine-grained Access Control - Users, roles, and grants management</li> <li>Backup Automation - Scheduled backups with configurable retention policies</li> <li>Health Monitoring - Configurable health checks with status reporting</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"Helm (Recommended)Kustomize <pre><code># Add the Helm repository\nhelm repo add db-provision https://panteparak.github.io/db-provision-operator/charts\nhelm repo update\n\n# Install the operator\nhelm install db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system \\\n  --create-namespace\n</code></pre> <pre><code>kubectl apply -f https://github.com/panteparak/db-provision-operator/releases/latest/download/install.yaml\n</code></pre>"},{"location":"#custom-resource-definitions","title":"Custom Resource Definitions","text":"CRD Description Short Name <code>DatabaseInstance</code> Database server connection configuration <code>dbi</code> <code>Database</code> Logical database within an instance <code>db</code> <code>DatabaseUser</code> Database user with credentials <code>dbu</code> <code>DatabaseRole</code> Group role for permission management <code>dbr</code> <code>DatabaseGrant</code> Fine-grained permission grants <code>dbg</code> <code>DatabaseBackup</code> One-time backup operation <code>dbbak</code> <code>DatabaseBackupSchedule</code> Scheduled backup configuration <code>dbbaksch</code> <code>DatabaseRestore</code> Restore from backup <code>dbrest</code>"},{"location":"#example-create-a-postgresql-database","title":"Example: Create a PostgreSQL Database","text":"<pre><code># 1. Define credentials secret\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin-credentials\ntype: Opaque\nstringData:\n  username: postgres\n  password: your-secure-password\n---\n# 2. Create DatabaseInstance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-admin-credentials\n---\n# 3. Create Database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n---\n# 4. Create User with auto-generated password\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li> <p> Installation</p> <p>Detailed installation instructions for Helm, Kustomize, and from source.</p> </li> <li> <p> Quick Start</p> <p>Step-by-step tutorial to get your first database running.</p> </li> <li> <p> User Guide</p> <p>Comprehensive guide for all CRDs and features.</p> </li> <li> <p> Engine Guides</p> <p>Engine-specific features for PostgreSQL, MySQL, and MariaDB.</p> </li> </ul>"},{"location":"#support","title":"Support","text":"<ul> <li>GitHub Issues: Report bugs or request features</li> <li>Documentation: You're here!</li> </ul>"},{"location":"#license","title":"License","text":"<p>DB Provision Operator is licensed under the Apache License 2.0.</p>"},{"location":"api/","title":"API Reference","text":"<p>Complete API reference for all DB Provision Operator Custom Resource Definitions.</p>"},{"location":"api/#api-group","title":"API Group","text":"<p>All resources belong to the <code>dbops.dbprovision.io</code> API group.</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\n</code></pre>"},{"location":"api/#resources-overview","title":"Resources Overview","text":"Kind Description Scope <code>DatabaseInstance</code> Database server connection Namespaced <code>Database</code> Logical database Namespaced <code>DatabaseUser</code> Database user Namespaced <code>DatabaseRole</code> Permission group Namespaced <code>DatabaseGrant</code> Fine-grained permissions Namespaced <code>DatabaseBackup</code> One-time backup Namespaced <code>DatabaseBackupSchedule</code> Scheduled backups Namespaced <code>DatabaseRestore</code> Restore operation Namespaced"},{"location":"api/#databaseinstance","title":"DatabaseInstance","text":"<p>Represents a connection to a database server.</p>"},{"location":"api/#spec","title":"Spec","text":"Field Type Required Description <code>engine</code> string Yes Database engine: <code>postgres</code>, <code>mysql</code>, <code>mariadb</code> <code>connection</code> object Yes Connection configuration <code>healthCheck</code> object No Health check configuration"},{"location":"api/#connection","title":"connection","text":"Field Type Required Description <code>host</code> string Yes Database host <code>port</code> int No Database port (default: engine-specific) <code>database</code> string No Database name for connection <code>sslMode</code> string No PostgreSQL SSL mode <code>secretRef</code> object Yes Reference to credentials Secret <code>tls</code> object No TLS configuration"},{"location":"api/#healthcheck","title":"healthCheck","text":"Field Type Default Description <code>enabled</code> bool true Enable health checks <code>intervalSeconds</code> int 30 Check interval <code>timeoutSeconds</code> int 5 Check timeout <code>failureThreshold</code> int 3 Failures before unhealthy"},{"location":"api/#status","title":"Status","text":"Field Type Description <code>phase</code> string Current phase: <code>Pending</code>, <code>Ready</code>, <code>Failed</code> <code>conditions</code> array Detailed conditions <code>observedGeneration</code> int Last observed generation <code>version</code> string Detected database version"},{"location":"api/#database","title":"Database","text":"<p>Represents a logical database within a DatabaseInstance.</p>"},{"location":"api/#spec_1","title":"Spec","text":"Field Type Required Description <code>instanceRef</code> object Yes Reference to DatabaseInstance <code>name</code> string No Database name (default: metadata.name) <code>deletionPolicy</code> string No <code>Retain</code>, <code>Delete</code>, <code>Snapshot</code> <code>deletionProtection</code> bool No Prevent deletion <code>postgres</code> object No PostgreSQL-specific options <code>mysql</code> object No MySQL/MariaDB-specific options"},{"location":"api/#postgres","title":"postgres","text":"Field Type Description <code>encoding</code> string Character encoding (default: UTF8) <code>lcCollate</code> string Collation order <code>lcCtype</code> string Character classification <code>tablespace</code> string Default tablespace <code>template</code> string Template database <code>connectionLimit</code> int Max connections <code>extensions</code> array Extensions to install <code>schemas</code> array Schemas to create"},{"location":"api/#mysql","title":"mysql","text":"Field Type Description <code>charset</code> string Default charset <code>collation</code> string Default collation <code>defaultStorageEngine</code> string Default storage engine"},{"location":"api/#status_1","title":"Status","text":"Field Type Description <code>phase</code> string Current phase <code>conditions</code> array Detailed conditions <code>observedGeneration</code> int Last observed generation"},{"location":"api/#databaseuser","title":"DatabaseUser","text":"<p>Represents a database user with credential management.</p>"},{"location":"api/#spec_2","title":"Spec","text":"Field Type Required Description <code>instanceRef</code> object Yes Reference to DatabaseInstance <code>username</code> string Yes Username in database <code>passwordSecret</code> object No Password generation config <code>existingPasswordSecret</code> object No Use existing password <code>postgres</code> object No PostgreSQL-specific options <code>mysql</code> object No MySQL/MariaDB-specific options"},{"location":"api/#passwordsecret","title":"passwordSecret","text":"Field Type Description <code>generate</code> bool Auto-generate password <code>length</code> int Password length (default: 24) <code>includeSpecialChars</code> bool Include special chars <code>excludeChars</code> string Characters to exclude <code>secretName</code> string Generated Secret name <code>secretTemplate</code> object Custom Secret template"},{"location":"api/#postgres-user","title":"postgres (user)","text":"Field Type Description <code>login</code> bool Can login (default: true) <code>inherit</code> bool Inherit privileges <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>connectionLimit</code> int Max connections <code>inRoles</code> array Roles to inherit <code>configParameters</code> map Session parameters"},{"location":"api/#mysql-user","title":"mysql (user)","text":"Field Type Description <code>maxQueriesPerHour</code> int Query limit <code>maxUpdatesPerHour</code> int Update limit <code>maxConnectionsPerHour</code> int Connection limit per hour <code>maxUserConnections</code> int Max concurrent connections <code>authPlugin</code> string Authentication plugin <code>requireSSL</code> bool Require SSL <code>allowedHosts</code> array Allowed connection hosts <code>accountLocked</code> bool Lock account"},{"location":"api/#status_2","title":"Status","text":"Field Type Description <code>phase</code> string Current phase <code>conditions</code> array Detailed conditions <code>credentialsSecretRef</code> object Reference to credentials Secret"},{"location":"api/#databaserole","title":"DatabaseRole","text":"<p>Represents a permission group (primarily PostgreSQL).</p>"},{"location":"api/#spec_3","title":"Spec","text":"Field Type Required Description <code>instanceRef</code> object Yes Reference to DatabaseInstance <code>roleName</code> string Yes Role name in database <code>postgres</code> object No PostgreSQL-specific options <code>mysql</code> object No MySQL-specific options (8.0+)"},{"location":"api/#postgres-role","title":"postgres (role)","text":"Field Type Description <code>login</code> bool Can login (default: false for roles) <code>inherit</code> bool Inherit privileges <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>connectionLimit</code> int Max connections <code>inRoles</code> array Roles to inherit <code>grants</code> array Permission grants"},{"location":"api/#status_3","title":"Status","text":"Field Type Description <code>phase</code> string Current phase <code>conditions</code> array Detailed conditions"},{"location":"api/#databasegrant","title":"DatabaseGrant","text":"<p>Represents fine-grained permissions for users or roles.</p>"},{"location":"api/#spec_4","title":"Spec","text":"Field Type Required Description <code>userRef</code> object Conditional Reference to DatabaseUser <code>roleRef</code> object Conditional Reference to DatabaseRole <code>databaseRef</code> object No Reference to Database <code>postgres</code> object No PostgreSQL grants <code>mysql</code> object No MySQL grants <p>userRef or roleRef</p> <p>Either <code>userRef</code> or <code>roleRef</code> is required, but not both.</p>"},{"location":"api/#postgres-grants","title":"postgres (grants)","text":"Field Type Description <code>roles</code> array Roles to assign <code>grants</code> array Direct permission grants <code>defaultPrivileges</code> array Default privileges for future objects"},{"location":"api/#mysql-grants","title":"mysql (grants)","text":"Field Type Description <code>roles</code> array Roles to assign (MySQL 8.0+) <code>grants</code> array Permission grants"},{"location":"api/#status_4","title":"Status","text":"Field Type Description <code>phase</code> string Current phase <code>conditions</code> array Detailed conditions"},{"location":"api/#databasebackup","title":"DatabaseBackup","text":"<p>Represents a one-time backup operation.</p>"},{"location":"api/#spec_5","title":"Spec","text":"Field Type Required Description <code>databaseRef</code> object Yes Reference to Database <code>storage</code> object Yes Storage configuration <code>compression</code> object No Compression settings <code>encryption</code> object No Encryption settings <code>ttl</code> string No Time-to-live (e.g., \"168h\") <code>postgres</code> object No PostgreSQL backup options <code>mysql</code> object No MySQL backup options"},{"location":"api/#storage","title":"storage","text":"Field Type Description <code>type</code> string <code>s3</code>, <code>gcs</code>, <code>azure</code>, <code>pvc</code> <code>s3</code> object S3/MinIO configuration <code>gcs</code> object Google Cloud Storage config <code>azure</code> object Azure Blob Storage config <code>pvc</code> object PersistentVolumeClaim config"},{"location":"api/#status_5","title":"Status","text":"Field Type Description <code>phase</code> string <code>Pending</code>, <code>Running</code>, <code>Completed</code>, <code>Failed</code> <code>startTime</code> string Backup start time <code>completionTime</code> string Backup completion time <code>backupSize</code> string Size of backup <code>backupPath</code> string Path to backup file"},{"location":"api/#databasebackupschedule","title":"DatabaseBackupSchedule","text":"<p>Represents scheduled backup operations with retention.</p>"},{"location":"api/#spec_6","title":"Spec","text":"Field Type Required Description <code>databaseRef</code> object Yes Reference to Database <code>schedule</code> string Yes Cron expression <code>timezone</code> string No Timezone (default: UTC) <code>retention</code> object No Retention policy <code>concurrencyPolicy</code> string No <code>Allow</code>, <code>Forbid</code>, <code>Replace</code> <code>backupTemplate</code> object Yes Backup configuration"},{"location":"api/#retention","title":"retention","text":"Field Type Description <code>keepLast</code> int Keep last N backups <code>keepDaily</code> int Keep daily backups for N days <code>keepWeekly</code> int Keep weekly backups for N weeks <code>keepMonthly</code> int Keep monthly backups for N months"},{"location":"api/#status_6","title":"Status","text":"Field Type Description <code>lastBackupTime</code> string Last backup time <code>lastBackupName</code> string Last backup resource name <code>nextBackupTime</code> string Next scheduled backup <code>activeBackups</code> int Number of retained backups"},{"location":"api/#databaserestore","title":"DatabaseRestore","text":"<p>Represents a restore operation from a backup.</p>"},{"location":"api/#spec_7","title":"Spec","text":"Field Type Required Description <code>backupRef</code> object Yes Reference to DatabaseBackup <code>targetDatabaseRef</code> object Yes Target Database reference <code>createTarget</code> bool No Create database if not exists <code>postgres</code> object No PostgreSQL restore options <code>mysql</code> object No MySQL restore options"},{"location":"api/#status_7","title":"Status","text":"Field Type Description <code>phase</code> string <code>Pending</code>, <code>Running</code>, <code>Completed</code>, <code>Failed</code> <code>startTime</code> string Restore start time <code>completionTime</code> string Restore completion time"},{"location":"api/#common-types","title":"Common Types","text":""},{"location":"api/#objectreference","title":"ObjectReference","text":"<p>Used for referencing other resources.</p> Field Type Required Description <code>name</code> string Yes Resource name <code>namespace</code> string No Namespace (default: same as referencing resource)"},{"location":"api/#secretkeyselector","title":"SecretKeySelector","text":"<p>Used for referencing Secret keys.</p> Field Type Required Description <code>name</code> string Yes Secret name <code>key</code> string Yes Key within Secret"},{"location":"api/#condition","title":"Condition","text":"<p>Standard Kubernetes condition.</p> Field Type Description <code>type</code> string Condition type <code>status</code> string <code>True</code>, <code>False</code>, <code>Unknown</code> <code>reason</code> string Machine-readable reason <code>message</code> string Human-readable message <code>lastTransitionTime</code> string Last transition time"},{"location":"api/#phases","title":"Phases","text":"<p>All resources use consistent phase values:</p> Phase Description <code>Pending</code> Resource is being processed <code>Ready</code> Resource is ready for use <code>Failed</code> Resource encountered an error <code>Deleting</code> Resource is being deleted <p>For backup/restore operations:</p> Phase Description <code>Pending</code> Operation not started <code>Running</code> Operation in progress <code>Completed</code> Operation successful <code>Failed</code> Operation failed"},{"location":"architecture/","title":"Architecture","text":"<p>Overview of DB Provision Operator's architecture and design.</p>"},{"location":"architecture/#overview","title":"Overview","text":"<p>DB Provision Operator follows the Kubernetes Operator pattern, using Custom Resource Definitions (CRDs) to extend the Kubernetes API with database-specific resources.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     Kubernetes Cluster                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                    Control Plane                          \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502  \u2502\n\u2502  \u2502  \u2502 API Server  \u2502  \u2502    etcd     \u2502  \u2502  Controller     \u2502   \u2502  \u2502\n\u2502  \u2502  \u2502             \u2502  \u2502             \u2502  \u2502  Manager        \u2502   \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502  \u2502\n\u2502  \u2502         \u2502                                    \u2502            \u2502  \u2502\n\u2502  \u2502         \u2502    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502  \u2502\n\u2502  \u2502         \u2502    \u2502     DB Provision Operator    \u2502        \u2502   \u2502  \u2502\n\u2502  \u2502         \u2502    \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502   \u2502  \u2502\n\u2502  \u2502         \u251c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2524       Reconciler Loop           \u2502  \u2502   \u2502  \u2502\n\u2502  \u2502         \u2502    \u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502   \u2502  \u2502\n\u2502  \u2502         \u2502    \u2502  \u2502  \u2502Instance\u2502 \u2502Database\u2502 \u2502 User \u2502 \u2502  \u2502   \u2502  \u2502\n\u2502  \u2502         \u2502    \u2502  \u2502  \u2502  Ctrl  \u2502 \u2502  Ctrl  \u2502 \u2502 Ctrl \u2502 \u2502  \u2502   \u2502  \u2502\n\u2502  \u2502         \u2502    \u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502   \u2502  \u2502\n\u2502  \u2502         \u2502    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502   \u2502  \u2502\n\u2502  \u2502         \u2502    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502            \u2502                                                    \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                      Data Plane                          \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502  \u2502\n\u2502  \u2502  \u2502  PostgreSQL  \u2502  \u2502    MySQL     \u2502  \u2502   MariaDB    \u2502   \u2502  \u2502\n\u2502  \u2502  \u2502   Instance   \u2502  \u2502   Instance   \u2502  \u2502   Instance   \u2502   \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#core-components","title":"Core Components","text":""},{"location":"architecture/#controllers","title":"Controllers","text":"<p>Each CRD has a dedicated controller:</p> Controller Responsibility DatabaseInstance Connection management, health checks Database Database lifecycle, extensions, schemas DatabaseUser User management, credential generation DatabaseRole Role management, permission grouping DatabaseGrant Permission management DatabaseBackup Backup execution DatabaseBackupSchedule Scheduled backup management DatabaseRestore Restore execution"},{"location":"architecture/#reconciliation-loop","title":"Reconciliation Loop","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Reconciliation Loop                       \u2502\n\u2502                                                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  Watch  \u2502\u2500\u2500\u2500\u25b6\u2502 Compare \u2502\u2500\u2500\u2500\u25b6\u2502 Execute \u2502\u2500\u2500\u2500\u25b6\u2502 Update  \u2502  \u2502\n\u2502  \u2502  Event  \u2502    \u2502  State  \u2502    \u2502 Actions \u2502    \u2502 Status  \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502       \u2502                                            \u2502        \u2502\n\u2502       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518        \u2502\n\u2502                        (Requeue)                            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#resource-hierarchy","title":"Resource Hierarchy","text":"<pre><code>DatabaseInstance\n\u251c\u2500\u2500 Database\n\u2502   \u251c\u2500\u2500 DatabaseBackup\n\u2502   \u2514\u2500\u2500 DatabaseBackupSchedule\n\u251c\u2500\u2500 DatabaseUser\n\u2502   \u2514\u2500\u2500 DatabaseGrant\n\u2514\u2500\u2500 DatabaseRole\n    \u2514\u2500\u2500 DatabaseGrant\n</code></pre>"},{"location":"architecture/#dependencies","title":"Dependencies","text":"Resource Depends On Database DatabaseInstance DatabaseUser DatabaseInstance DatabaseRole DatabaseInstance DatabaseGrant DatabaseUser OR DatabaseRole DatabaseBackup Database DatabaseBackupSchedule Database DatabaseRestore DatabaseBackup, Database"},{"location":"architecture/#design-principles","title":"Design Principles","text":""},{"location":"architecture/#1-declarative-management","title":"1. Declarative Management","text":"<p>Resources are declared in YAML; the operator reconciles actual state to match desired state.</p>"},{"location":"architecture/#2-idempotency","title":"2. Idempotency","text":"<p>Reconciliation can run multiple times safely without side effects.</p>"},{"location":"architecture/#3-eventually-consistent","title":"3. Eventually Consistent","text":"<p>The operator continuously reconciles until desired state is achieved.</p>"},{"location":"architecture/#4-fail-safe","title":"4. Fail-Safe","text":"<p>Errors are logged and retried; resources maintain last known good state.</p>"},{"location":"architecture/#5-secure-by-default","title":"5. Secure by Default","text":"<ul> <li>Credentials are stored in Kubernetes Secrets</li> <li>TLS connections supported</li> <li>Minimum required permissions</li> </ul>"},{"location":"architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Design Decisions - Detailed design rationale</li> <li>Security - Security architecture</li> </ul>"},{"location":"architecture/design/","title":"Design Decisions","text":"<p>Key architectural decisions and rationale.</p>"},{"location":"architecture/design/#crd-design","title":"CRD Design","text":""},{"location":"architecture/design/#unified-api","title":"Unified API","text":"<p>Decision: Single API group (<code>dbops.dbprovision.io</code>) for all database engines.</p> <p>Rationale: - Consistent user experience across engines - Easier learning curve - Simplified RBAC policies - Engine-specific options in dedicated spec fields</p> <p>Alternative considered: Per-engine CRDs (PostgresDatabase, MySQLDatabase) - Rejected due to API fragmentation and maintenance burden</p>"},{"location":"architecture/design/#immutable-fields","title":"Immutable Fields","text":"<p>Decision: Certain fields (e.g., <code>username</code>, <code>name</code>) are immutable after creation.</p> <p>Rationale: - Prevents accidental data loss - Simplifies reconciliation logic - Aligns with database behavior (renaming is risky)</p> <p>Immutable fields: - <code>DatabaseInstance.spec.engine</code> - <code>Database.spec.name</code> - <code>DatabaseUser.spec.username</code> - <code>DatabaseRole.spec.roleName</code></p>"},{"location":"architecture/design/#resource-references","title":"Resource References","text":"<p>Decision: Use cross-resource references (<code>instanceRef</code>, <code>databaseRef</code>).</p> <p>Rationale: - Enables resource reuse - Supports cross-namespace scenarios - Clear ownership model</p>"},{"location":"architecture/design/#credential-management","title":"Credential Management","text":""},{"location":"architecture/design/#generated-secrets","title":"Generated Secrets","text":"<p>Decision: Auto-generate passwords and store in Kubernetes Secrets.</p> <p>Rationale: - Secure credential storage - Integration with Secret management tools - Automatic rotation support</p>"},{"location":"architecture/design/#secret-templates","title":"Secret Templates","text":"<p>Decision: Support custom Secret templates with variables.</p> <p>Rationale: - Application-specific formats (DATABASE_URL, JDBC_URL) - Reduces manual Secret creation - Single source of truth</p> <p>Template variables: <pre><code>{{ .Username }}\n{{ .Password }}\n{{ .Host }}\n{{ .Port }}\n{{ .Database }}\n{{ .SSLMode }}\n</code></pre></p>"},{"location":"architecture/design/#reconciliation-strategy","title":"Reconciliation Strategy","text":""},{"location":"architecture/design/#controller-architecture","title":"Controller Architecture","text":"<p>Decision: One controller per CRD type.</p> <p>Rationale: - Clear separation of concerns - Independent scaling - Simpler testing</p>"},{"location":"architecture/design/#requeue-strategy","title":"Requeue Strategy","text":"<p>Decision: Exponential backoff with configurable limits.</p> <p>Rationale: - Prevents API overload - Handles transient failures - Configurable for different environments</p> <pre><code>// Default requeue intervals\nconst (\n    defaultRequeueAfter = 30 * time.Second\n    maxRequeueAfter     = 5 * time.Minute\n)\n</code></pre>"},{"location":"architecture/design/#dependency-resolution","title":"Dependency Resolution","text":"<p>Decision: Wait for dependencies before proceeding.</p> <p>Rationale: - Ensures prerequisites exist - Clear error messages - Predictable behavior</p> <p>Example: Database waits for DatabaseInstance to be Ready.</p>"},{"location":"architecture/design/#health-checks","title":"Health Checks","text":""},{"location":"architecture/design/#connection-verification","title":"Connection Verification","text":"<p>Decision: Periodic health checks for DatabaseInstance.</p> <p>Rationale: - Detect connection issues early - Update status for monitoring - Enable alerting</p> <p>Implementation: <pre><code>healthCheck:\n  enabled: true\n  intervalSeconds: 30\n  timeoutSeconds: 5\n  failureThreshold: 3\n</code></pre></p>"},{"location":"architecture/design/#deletion-policies","title":"Deletion Policies","text":""},{"location":"architecture/design/#retain-by-default","title":"Retain by Default","text":"<p>Decision: Default deletion policy is <code>Retain</code>.</p> <p>Rationale: - Prevent accidental data loss - Explicit deletion requires <code>Delete</code> policy - Safe default for production</p>"},{"location":"architecture/design/#deletion-protection","title":"Deletion Protection","text":"<p>Decision: Optional <code>deletionProtection</code> field.</p> <p>Rationale: - Additional safety layer - Requires explicit removal before deletion - Production-grade protection</p>"},{"location":"architecture/design/#multi-engine-support","title":"Multi-Engine Support","text":""},{"location":"architecture/design/#engine-abstraction","title":"Engine Abstraction","text":"<p>Decision: Abstract database operations behind interfaces.</p> <pre><code>type DatabaseEngine interface {\n    CreateDatabase(ctx context.Context, db *Database) error\n    DeleteDatabase(ctx context.Context, db *Database) error\n    GetDatabase(ctx context.Context, name string) (*DatabaseInfo, error)\n}\n</code></pre> <p>Rationale: - Consistent internal API - Easy to add new engines - Testable with mocks</p>"},{"location":"architecture/design/#engine-detection","title":"Engine Detection","text":"<p>Decision: Explicit engine specification in DatabaseInstance.</p> <p>Rationale: - No ambiguity - Clear user intent - Avoid auto-detection errors</p>"},{"location":"architecture/design/#status-management","title":"Status Management","text":""},{"location":"architecture/design/#conditions","title":"Conditions","text":"<p>Decision: Use Kubernetes-style conditions.</p> <pre><code>status:\n  conditions:\n    - type: Ready\n      status: \"True\"\n      reason: DatabaseCreated\n      message: Database myapp created successfully\n      lastTransitionTime: \"2024-01-01T00:00:00Z\"\n</code></pre> <p>Rationale: - Standard Kubernetes pattern - Machine-readable status - Detailed history</p>"},{"location":"architecture/design/#phases","title":"Phases","text":"<p>Decision: Simple phase enum for quick status check.</p> <p>Rationale: - Human-readable summary - Easy filtering/sorting - Dashboard-friendly</p>"},{"location":"architecture/design/#backup-design","title":"Backup Design","text":""},{"location":"architecture/design/#backup-job-execution","title":"Backup Job Execution","text":"<p>Decision: Execute backups as Kubernetes Jobs.</p> <p>Rationale: - Native Kubernetes scheduling - Resource limits/requests - Automatic retry on failure - Clean separation from operator</p>"},{"location":"architecture/design/#storage-abstraction","title":"Storage Abstraction","text":"<p>Decision: Support multiple storage backends.</p> <pre><code>storage:\n  type: s3|gcs|azure|pvc\n</code></pre> <p>Rationale: - Cloud-agnostic - On-premises support (PVC) - Consistent interface</p>"},{"location":"architecture/design/#security-decisions","title":"Security Decisions","text":""},{"location":"architecture/design/#rbac-scope","title":"RBAC Scope","text":"<p>Decision: Minimum required permissions per resource type.</p> <p>Rationale: - Principle of least privilege - Namespace isolation - Audit-friendly</p>"},{"location":"architecture/design/#cross-namespace-references","title":"Cross-Namespace References","text":"<p>Decision: Allow cross-namespace references with RBAC checks.</p> <p>Rationale: - Shared database instances - Team isolation - Controlled access</p> <p>See Security for detailed security architecture.</p>"},{"location":"architecture/design/#performance-considerations","title":"Performance Considerations","text":""},{"location":"architecture/design/#concurrent-reconciliation","title":"Concurrent Reconciliation","text":"<p>Decision: Configurable concurrent reconciles per controller.</p> <pre><code>ctrl.Options{\n    MaxConcurrentReconciles: 10,\n}\n</code></pre> <p>Rationale: - Scale to large clusters - Configurable per deployment - Prevent resource exhaustion</p>"},{"location":"architecture/design/#caching","title":"Caching","text":"<p>Decision: Use controller-runtime's built-in caching.</p> <p>Rationale: - Reduced API server load - Faster reconciliation - Memory-efficient</p>"},{"location":"architecture/design/#connection-pooling","title":"Connection Pooling","text":"<p>Decision: Pool database connections per instance.</p> <p>Rationale: - Reduce connection overhead - Respect database limits - Efficient resource use</p>"},{"location":"architecture/design/#future-considerations","title":"Future Considerations","text":""},{"location":"architecture/design/#webhook-validation","title":"Webhook Validation","text":"<p>Planned: Admission webhooks for: - Immutable field enforcement - Cross-reference validation - Quota enforcement</p>"},{"location":"architecture/design/#metrics","title":"Metrics","text":"<p>Current: Basic reconciliation metrics Planned: Per-resource and per-engine metrics</p>"},{"location":"architecture/design/#api-versioning","title":"API Versioning","text":"<p>Current: <code>v1alpha1</code> Path to GA: <code>v1alpha1</code> \u2192 <code>v1beta1</code> \u2192 <code>v1</code></p> <p>Conversion webhooks will handle version migrations.</p>"},{"location":"architecture/overview/","title":"System Overview","text":""},{"location":"architecture/overview/#introduction","title":"Introduction","text":"<p>The db-provision-operator is a Kubernetes operator designed to provide unified database management across multiple database engines. It enables declarative management of database servers, databases, users, and access controls through Kubernetes Custom Resource Definitions (CRDs).</p>"},{"location":"architecture/overview/#project-goals","title":"Project Goals","text":"<ol> <li>Unified Database Management: Provide a consistent API for managing databases across different engines (PostgreSQL, MySQL, and future engines)</li> <li>Kubernetes-Native: Leverage Kubernetes patterns (controllers, CRDs, finalizers) for lifecycle management</li> <li>Security-First: Secure credential management with automatic password generation and secret templating</li> <li>Production-Ready: Support for TLS/mTLS, health checks, deletion protection, and graceful cleanup</li> <li>Extensibility: Adapter-based architecture for easy addition of new database engines</li> </ol>"},{"location":"architecture/overview/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                          Kubernetes Cluster                              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502                    db-provision-operator                            \u2502 \u2502\n\u2502  \u2502                                                                      \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502 \u2502\n\u2502  \u2502  \u2502 DatabaseInstance \u2502 \u2502    Database      \u2502 \u2502  DatabaseUser    \u2502   \u2502 \u2502\n\u2502  \u2502  \u2502   Controller     \u2502 \u2502   Controller     \u2502 \u2502   Controller     \u2502   \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502 \u2502\n\u2502  \u2502           \u2502                    \u2502                    \u2502              \u2502 \u2502\n\u2502  \u2502           \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502 \u2502\n\u2502  \u2502                              \u2502                                      \u2502 \u2502\n\u2502  \u2502                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                           \u2502 \u2502\n\u2502  \u2502                    \u2502   Adapter Layer   \u2502                           \u2502 \u2502\n\u2502  \u2502                    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524                           \u2502 \u2502\n\u2502  \u2502                    \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502                           \u2502 \u2502\n\u2502  \u2502                    \u2502 \u2502   PostgreSQL  \u2502 \u2502                           \u2502 \u2502\n\u2502  \u2502                    \u2502 \u2502    Adapter    \u2502 \u2502                           \u2502 \u2502\n\u2502  \u2502                    \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502                           \u2502 \u2502\n\u2502  \u2502                    \u2502 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502                           \u2502 \u2502\n\u2502  \u2502                    \u2502 \u2502     MySQL     \u2502 \u2502                           \u2502 \u2502\n\u2502  \u2502                    \u2502 \u2502    Adapter    \u2502 \u2502                           \u2502 \u2502\n\u2502  \u2502                    \u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502                           \u2502 \u2502\n\u2502  \u2502                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                           \u2502 \u2502\n\u2502  \u2502                              \u2502                                      \u2502 \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510      \u2502      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510          \u2502 \u2502\n\u2502  \u2502  \u2502  Secret Manager   \u2502\u25c4\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u25ba\u2502   Utility Layer   \u2502          \u2502 \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502 \u2502\n\u2502  \u2502                                                                      \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2502                                                                          \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510             \u2502\n\u2502  \u2502DatabaseInst. \u2502    \u2502   Database   \u2502    \u2502DatabaseUser  \u2502             \u2502\n\u2502  \u2502    CRD       \u2502    \u2502     CRD      \u2502    \u2502    CRD       \u2502             \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518             \u2502\n\u2502                                                                          \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                                    \u2502\n                                    \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502     External Databases        \u2502\n                    \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n                    \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n                    \u2502  \u2502PostgreSQL\u2502   \u2502  MySQL  \u2502  \u2502\n                    \u2502  \u2502 Server   \u2502   \u2502 Server  \u2502  \u2502\n                    \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/overview/#technology-stack","title":"Technology Stack","text":"Component Technology Version Operator Framework Operator SDK v1.42.0 Kubernetes Client controller-runtime Latest PostgreSQL Driver pgx/v5 v5.x MySQL Driver go-sql-driver/mysql v1.x Go Version Go 1.21+"},{"location":"architecture/overview/#custom-resource-definitions-crds","title":"Custom Resource Definitions (CRDs)","text":""},{"location":"architecture/overview/#primary-resources","title":"Primary Resources","text":"CRD API Group Description <code>DatabaseInstance</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a database server connection <code>Database</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a database within an instance <code>DatabaseUser</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a database user/role <code>DatabaseRole</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a permission group <code>DatabaseGrant</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents fine-grained access control <code>DatabaseBackup</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a backup operation <code>DatabaseBackupSchedule</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents scheduled backups <code>DatabaseRestore</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a restore operation"},{"location":"architecture/overview/#resource-hierarchy","title":"Resource Hierarchy","text":"<pre><code>DatabaseInstance (server connection)\n\u251c\u2500\u2500 Database (logical database)\n\u2502   \u2514\u2500\u2500 DatabaseUser (user with access to database)\n\u2514\u2500\u2500 DatabaseUser (instance-level user/role)\n</code></pre>"},{"location":"architecture/overview/#component-architecture","title":"Component Architecture","text":""},{"location":"architecture/overview/#controllers-layer","title":"Controllers Layer","text":"<p>Controllers implement the reconciliation loop pattern, watching CRD resources and ensuring the actual state matches the desired state.</p>"},{"location":"architecture/overview/#databaseinstance-controller","title":"DatabaseInstance Controller","text":"<pre><code>Responsibilities:\n\u251c\u2500\u2500 Validate database server connectivity\n\u251c\u2500\u2500 Perform periodic health checks\n\u251c\u2500\u2500 Maintain connection status in status field\n\u2514\u2500\u2500 Handle graceful deletion (finalizer cleanup)\n</code></pre>"},{"location":"architecture/overview/#database-controller","title":"Database Controller","text":"<pre><code>Responsibilities:\n\u251c\u2500\u2500 Create databases on target instance\n\u251c\u2500\u2500 Configure database settings (encoding, collation, extensions)\n\u251c\u2500\u2500 Manage database lifecycle\n\u2514\u2500\u2500 Drop database on deletion (if policy allows)\n</code></pre>"},{"location":"architecture/overview/#databaseuser-controller","title":"DatabaseUser Controller","text":"<pre><code>Responsibilities:\n\u251c\u2500\u2500 Create database users/roles\n\u251c\u2500\u2500 Manage passwords (generate or use existing)\n\u251c\u2500\u2500 Create credentials secrets\n\u251c\u2500\u2500 Configure user attributes and grants\n\u2514\u2500\u2500 Drop user on deletion (if policy allows)\n</code></pre>"},{"location":"architecture/overview/#adapter-layer","title":"Adapter Layer","text":"<p>The adapter layer provides a unified interface for database operations across different engines.</p>"},{"location":"architecture/overview/#interface-hierarchy","title":"Interface Hierarchy","text":"<pre><code>DatabaseAdapter (main interface)\n\u251c\u2500\u2500 Connect(ctx) error\n\u251c\u2500\u2500 Close() error\n\u251c\u2500\u2500 Ping(ctx) error\n\u251c\u2500\u2500 GetVersion(ctx) (string, error)\n\u2502\n\u251c\u2500\u2500 DatabaseOperations\n\u2502   \u251c\u2500\u2500 CreateDatabase(ctx, opts) error\n\u2502   \u251c\u2500\u2500 DropDatabase(ctx, name, opts) error\n\u2502   \u251c\u2500\u2500 UpdateDatabase(ctx, name, opts) error\n\u2502   \u251c\u2500\u2500 DatabaseExists(ctx, name) (bool, error)\n\u2502   \u2514\u2500\u2500 GetDatabaseInfo(ctx, name) (*DatabaseInfo, error)\n\u2502\n\u251c\u2500\u2500 UserOperations\n\u2502   \u251c\u2500\u2500 CreateUser(ctx, opts) error\n\u2502   \u251c\u2500\u2500 DropUser(ctx, name, opts) error\n\u2502   \u251c\u2500\u2500 UpdateUser(ctx, name, opts) error\n\u2502   \u251c\u2500\u2500 UserExists(ctx, name) (bool, error)\n\u2502   \u2514\u2500\u2500 GetUserInfo(ctx, name) (*UserInfo, error)\n\u2502\n\u251c\u2500\u2500 GrantOperations\n\u2502   \u251c\u2500\u2500 Grant(ctx, opts) error\n\u2502   \u251c\u2500\u2500 Revoke(ctx, opts) error\n\u2502   \u2514\u2500\u2500 GetGrants(ctx, user, db) ([]GrantInfo, error)\n\u2502\n\u251c\u2500\u2500 BackupOperations\n\u2502   \u251c\u2500\u2500 Backup(ctx, opts) (*BackupResult, error)\n\u2502   \u251c\u2500\u2500 GetBackupProgress(ctx, id) (int, error)\n\u2502   \u2514\u2500\u2500 CancelBackup(ctx, id) error\n\u2502\n\u251c\u2500\u2500 RestoreOperations\n\u2502   \u251c\u2500\u2500 Restore(ctx, opts) (*RestoreResult, error)\n\u2502   \u251c\u2500\u2500 GetRestoreProgress(ctx, id) (int, error)\n\u2502   \u2514\u2500\u2500 CancelRestore(ctx, id) error\n\u2502\n\u2514\u2500\u2500 SchemaOperations (PostgreSQL only)\n    \u251c\u2500\u2500 CreateSchema(ctx, opts) error\n    \u251c\u2500\u2500 DropSchema(ctx, name, opts) error\n    \u2514\u2500\u2500 SchemaExists(ctx, name) (bool, error)\n</code></pre>"},{"location":"architecture/overview/#secret-manager","title":"Secret Manager","text":"<pre><code>Package: internal/secret\n\nResponsibilities:\n\u251c\u2500\u2500 Retrieve credentials from Kubernetes Secrets\n\u251c\u2500\u2500 Retrieve TLS certificates from Secrets\n\u251c\u2500\u2500 Generate cryptographically secure passwords\n\u251c\u2500\u2500 Create/update/delete Secrets with owner references\n\u251c\u2500\u2500 Render secret templates with database connection info\n\u2514\u2500\u2500 Support configurable key names for credentials\n</code></pre>"},{"location":"architecture/overview/#data-flow","title":"Data Flow","text":""},{"location":"architecture/overview/#resource-creation-flow","title":"Resource Creation Flow","text":"<pre><code>User Creates CRD\n       \u2502\n       \u25bc\nController Receives Event\n       \u2502\n       \u25bc\nFetch Resource from API Server\n       \u2502\n       \u25bc\nAdd Finalizer (if missing)\n       \u2502\n       \u25bc\nGet Referenced Resources\n       \u2502\n       \u25bc\nGet Credentials from Secret\n       \u2502\n       \u25bc\nCreate Database Adapter\n       \u2502\n       \u25bc\nConnect to Database Server\n       \u2502\n       \u25bc\nExecute Database Operations\n       \u2502\n       \u25bc\nCreate Credentials Secret (if needed)\n       \u2502\n       \u25bc\nUpdate Resource Status\n       \u2502\n       \u25bc\nRequeue for Periodic Reconciliation\n</code></pre>"},{"location":"architecture/overview/#resource-deletion-flow","title":"Resource Deletion Flow","text":"<pre><code>User Deletes CRD\n       \u2502\n       \u25bc\nController Receives Delete Event\n       \u2502\n       \u25bc\nCheck Deletion Protection\n       \u2502\n       \u251c\u2500\u2500 Protected + No Force Delete\n       \u2502   \u2514\u2500\u2500 Return Error, Keep Resource\n       \u2502\n       \u2514\u2500\u2500 Not Protected or Force Delete\n           \u2502\n           \u25bc\n    Check Deletion Policy\n           \u2502\n           \u251c\u2500\u2500 Retain\n           \u2502   \u2514\u2500\u2500 Remove Finalizer Only\n           \u2502\n           \u2514\u2500\u2500 Delete\n               \u2502\n               \u25bc\n        Connect to Database\n               \u2502\n               \u25bc\n        Drop Resource (DB/User)\n               \u2502\n               \u25bc\n        Delete Credentials Secret\n               \u2502\n               \u25bc\n        Remove Finalizer\n               \u2502\n               \u25bc\n        Resource Removed from Cluster\n</code></pre>"},{"location":"architecture/overview/#project-structure","title":"Project Structure","text":"<pre><code>db-provision-operator/\n\u251c\u2500\u2500 api/v1alpha1/           # CRD type definitions\n\u251c\u2500\u2500 cmd/main.go             # Operator entrypoint\n\u251c\u2500\u2500 config/                 # Kubernetes manifests\n\u2502   \u251c\u2500\u2500 crd/               # Generated CRD manifests\n\u2502   \u251c\u2500\u2500 rbac/              # RBAC configuration\n\u2502   \u2514\u2500\u2500 samples/           # Example resources\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 adapter/           # Database adapters\n\u2502   \u2502   \u251c\u2500\u2500 postgres/      # PostgreSQL implementation\n\u2502   \u2502   \u251c\u2500\u2500 mysql/         # MySQL implementation\n\u2502   \u2502   \u2514\u2500\u2500 types/         # Shared adapter types\n\u2502   \u251c\u2500\u2500 controller/        # Kubernetes controllers\n\u2502   \u251c\u2500\u2500 secret/            # Secret management\n\u2502   \u2514\u2500\u2500 util/              # Utility functions\n\u2514\u2500\u2500 docs/                  # Project documentation\n</code></pre>"},{"location":"architecture/overview/#supported-database-engines","title":"Supported Database Engines","text":""},{"location":"architecture/overview/#postgresql","title":"PostgreSQL","text":"<ul> <li>Full support for database operations (create, drop, update)</li> <li>User/role management with all PostgreSQL attributes</li> <li>Schema-level and default privileges</li> <li>Extensions management</li> <li>Backup/restore using pg_dump and pg_restore</li> </ul>"},{"location":"architecture/overview/#mysql","title":"MySQL","text":"<ul> <li>Database operations with charset/collation support</li> <li>User management with resource limits and authentication plugins</li> <li>Grant management at multiple levels (global, database, table, column, routine)</li> <li>Backup/restore using mysqldump</li> </ul>"},{"location":"architecture/security/","title":"Security","text":"<p>Security architecture and best practices.</p>"},{"location":"architecture/security/#overview","title":"Overview","text":"<p>DB Provision Operator implements multiple security layers:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Security Layers                           \u2502\n\u2502                                                              \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502\n\u2502  \u2502 1. Kubernetes RBAC - API Access Control                 \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 2. Namespace Isolation - Resource Boundaries            \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 3. Secret Management - Credential Storage               \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 4. TLS Encryption - Transport Security                  \u2502 \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524 \u2502\n\u2502  \u2502 5. Database Security - Engine-Level Controls            \u2502 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/security/#kubernetes-rbac","title":"Kubernetes RBAC","text":""},{"location":"architecture/security/#operator-service-account","title":"Operator Service Account","text":"<p>The operator runs with minimal permissions:</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: db-provision-operator\nrules:\n  # CRD management\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"*\"]\n    verbs: [\"*\"]\n  # Secret read/write for credentials\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\", \"delete\"]\n  # Events for status reporting\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"create\", \"patch\"]\n  # Jobs for backup/restore\n  - apiGroups: [\"batch\"]\n    resources: [\"jobs\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n</code></pre>"},{"location":"architecture/security/#user-rbac","title":"User RBAC","text":"<p>Grant users access to specific resources:</p> <pre><code># Developer role - manage own databases\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: database-developer\n  namespace: app-namespace\nrules:\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"databases\", \"databaseusers\", \"databasegrants\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"list\"]\n    resourceNames: [\"*-credentials\"]  # Only credential secrets\n</code></pre> <pre><code># Admin role - manage instances\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: database-admin\n  namespace: database-namespace\nrules:\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"*\"]\n    verbs: [\"*\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"*\"]\n</code></pre>"},{"location":"architecture/security/#namespace-isolation","title":"Namespace Isolation","text":""},{"location":"architecture/security/#single-namespace-mode","title":"Single-Namespace Mode","text":"<p>Resources only access same-namespace DatabaseInstances:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp\n  namespace: app-team-a\nspec:\n  instanceRef:\n    name: postgres-primary\n    # No namespace = same namespace (app-team-a)\n</code></pre>"},{"location":"architecture/security/#cross-namespace-mode","title":"Cross-Namespace Mode","text":"<p>Reference instances in other namespaces:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp\n  namespace: app-team-a\nspec:\n  instanceRef:\n    name: shared-postgres\n    namespace: database  # Different namespace\n</code></pre> <p>Required RBAC for cross-namespace:</p> <pre><code># In database namespace\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: instance-reader\n  namespace: database\nrules:\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"databaseinstances\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n---\n# Bind to app-team-a service account\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: app-team-a-instance-reader\n  namespace: database\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: instance-reader\nsubjects:\n  - kind: ServiceAccount\n    name: default\n    namespace: app-team-a\n</code></pre>"},{"location":"architecture/security/#secret-management","title":"Secret Management","text":""},{"location":"architecture/security/#credential-storage","title":"Credential Storage","text":"<p>All database credentials are stored in Kubernetes Secrets:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: myapp-user-credentials\n  ownerReferences:\n    - apiVersion: dbops.dbprovision.io/v1alpha1\n      kind: DatabaseUser\n      name: myapp-user\ntype: Opaque\ndata:\n  username: &lt;base64&gt;\n  password: &lt;base64&gt;\n</code></pre>"},{"location":"architecture/security/#secret-best-practices","title":"Secret Best Practices","text":"<ol> <li> <p>Enable encryption at rest: <pre><code># kube-apiserver configuration\n--encryption-provider-config=/etc/kubernetes/enc/enc.yaml\n</code></pre></p> </li> <li> <p>Use external secret management:</p> </li> <li>HashiCorp Vault with External Secrets Operator</li> <li>AWS Secrets Manager</li> <li> <p>Azure Key Vault</p> </li> <li> <p>Limit Secret access: <pre><code># Only allow specific secret access\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    resourceNames: [\"postgres-admin-credentials\"]\n    verbs: [\"get\"]\n</code></pre></p> </li> </ol>"},{"location":"architecture/security/#password-generation","title":"Password Generation","text":"<p>Secure password generation:</p> <pre><code>passwordSecret:\n  generate: true\n  length: 32\n  includeSpecialChars: true\n  excludeChars: \"\\\"'\\\\`\"  # Exclude problematic characters\n</code></pre>"},{"location":"architecture/security/#tls-encryption","title":"TLS Encryption","text":""},{"location":"architecture/security/#postgresql-tls","title":"PostgreSQL TLS","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-tls\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    sslMode: verify-full\n    secretRef:\n      name: postgres-admin-credentials\n    tls:\n      secretRef:\n        name: postgres-tls-certs\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"architecture/security/#mysql-tls","title":"MySQL TLS","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-tls\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    secretRef:\n      name: mysql-admin-credentials\n    tls:\n      enabled: true\n      secretRef:\n        name: mysql-tls-certs\n</code></pre>"},{"location":"architecture/security/#certificate-management","title":"Certificate Management","text":"<p>Use cert-manager for automated certificate management:</p> <pre><code>apiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: postgres-client-cert\nspec:\n  secretName: postgres-tls-certs\n  issuerRef:\n    name: database-ca\n    kind: ClusterIssuer\n  commonName: postgres-client\n  usages:\n    - client auth\n</code></pre>"},{"location":"architecture/security/#database-security","title":"Database Security","text":""},{"location":"architecture/security/#postgresql-security","title":"PostgreSQL Security","text":"<pre><code># User with minimum privileges\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: app-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: app_user\n  postgres:\n    login: true\n    inherit: true\n    createDB: false\n    createRole: false\n    superuser: false\n    replication: false\n    bypassRLS: false\n    connectionLimit: 20\n</code></pre>"},{"location":"architecture/security/#mysql-security","title":"MySQL Security","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: app-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: app_user\n  mysql:\n    maxUserConnections: 20\n    authPlugin: caching_sha2_password\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.%\"  # Only internal network\n</code></pre>"},{"location":"architecture/security/#backup-security","title":"Backup Security","text":""},{"location":"architecture/security/#encrypted-backups","title":"Encrypted Backups","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: secure-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: secure-backups\n      secretRef:\n        name: s3-credentials\n  encryption:\n    enabled: true\n    algorithm: aes-256-gcm\n    secretRef:\n      name: backup-encryption-key\n      key: encryption-key\n</code></pre>"},{"location":"architecture/security/#s3-security","title":"S3 Security","text":"<pre><code># S3 bucket policy for backup storage\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\"AWS\": \"arn:aws:iam::ACCOUNT:role/backup-role\"},\n      \"Action\": [\"s3:PutObject\", \"s3:GetObject\", \"s3:DeleteObject\"],\n      \"Resource\": \"arn:aws:s3:::secure-backups/*\"\n    }\n  ]\n}\n</code></pre>"},{"location":"architecture/security/#network-security","title":"Network Security","text":""},{"location":"architecture/security/#network-policies","title":"Network Policies","text":"<p>Restrict operator network access:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: db-provision-operator\n  namespace: db-provision-operator-system\nspec:\n  podSelector:\n    matchLabels:\n      app: db-provision-operator\n  policyTypes:\n    - Egress\n  egress:\n    # Allow DNS\n    - to:\n        - namespaceSelector: {}\n      ports:\n        - protocol: UDP\n          port: 53\n    # Allow database connections\n    - to:\n        - namespaceSelector:\n            matchLabels:\n              name: database\n      ports:\n        - protocol: TCP\n          port: 5432\n        - protocol: TCP\n          port: 3306\n    # Allow Kubernetes API\n    - to:\n        - ipBlock:\n            cidr: 10.0.0.1/32  # API server IP\n      ports:\n        - protocol: TCP\n          port: 443\n</code></pre>"},{"location":"architecture/security/#security-checklist","title":"Security Checklist","text":""},{"location":"architecture/security/#deployment","title":"Deployment","text":"<ul> <li> Operator runs with minimal RBAC permissions</li> <li> Pod security context configured (non-root)</li> <li> Resource limits set</li> <li> Network policies in place</li> </ul>"},{"location":"architecture/security/#secrets","title":"Secrets","text":"<ul> <li> Encryption at rest enabled</li> <li> Secret access restricted by RBAC</li> <li> Password generation uses strong defaults</li> <li> No secrets in container environment variables</li> </ul>"},{"location":"architecture/security/#connections","title":"Connections","text":"<ul> <li> TLS enabled for database connections</li> <li> SSL mode set to <code>verify-full</code> (PostgreSQL)</li> <li> Client certificates used where possible</li> </ul>"},{"location":"architecture/security/#database","title":"Database","text":"<ul> <li> Users have minimum required privileges</li> <li> Connection limits configured</li> <li> Host restrictions set (MySQL)</li> <li> Deletion protection enabled for production</li> </ul>"},{"location":"architecture/security/#backups","title":"Backups","text":"<ul> <li> Backup encryption enabled</li> <li> Storage credentials secured</li> <li> Backup retention policies configured</li> <li> Regular restore testing performed</li> </ul>"},{"location":"development/","title":"Development","text":"<p>Guides for contributing to and developing DB Provision Operator.</p>"},{"location":"development/#overview","title":"Overview","text":"<ul> <li>Contributing - How to contribute</li> <li>Testing - Testing strategies</li> <li>CI/CD - Continuous integration and deployment</li> </ul>"},{"location":"development/#quick-start","title":"Quick Start","text":""},{"location":"development/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.21+</li> <li>Docker</li> <li>kubectl</li> <li>kind or minikube</li> <li>Make</li> </ul>"},{"location":"development/#clone-and-build","title":"Clone and Build","text":"<pre><code># Clone repository\ngit clone https://github.com/panteparak/db-provision-operator.git\ncd db-provision-operator\n\n# Install dependencies\nmake install-tools\n\n# Build\nmake build\n\n# Run tests\nmake test\n</code></pre>"},{"location":"development/#local-development","title":"Local Development","text":"<pre><code># Start local cluster\nmake kind-create\n\n# Install CRDs\nmake install\n\n# Run operator locally\nmake run\n</code></pre>"},{"location":"development/#development-workflow","title":"Development Workflow","text":"<ol> <li>Create feature branch</li> <li>Make changes</li> <li>Write/update tests</li> <li>Run tests locally</li> <li>Submit pull request</li> </ol>"},{"location":"development/#project-structure","title":"Project Structure","text":"<pre><code>db-provision-operator/\n\u251c\u2500\u2500 api/                    # CRD API definitions\n\u2502   \u2514\u2500\u2500 v1alpha1/          # API version\n\u251c\u2500\u2500 cmd/                    # Main entrypoints\n\u2502   \u2514\u2500\u2500 main.go            # Operator entrypoint\n\u251c\u2500\u2500 config/                 # Kubernetes manifests\n\u2502   \u251c\u2500\u2500 crd/               # CRD definitions\n\u2502   \u251c\u2500\u2500 manager/           # Operator deployment\n\u2502   \u251c\u2500\u2500 rbac/              # RBAC rules\n\u2502   \u2514\u2500\u2500 samples/           # Sample resources\n\u251c\u2500\u2500 internal/               # Internal packages\n\u2502   \u251c\u2500\u2500 controller/        # Controllers\n\u2502   \u251c\u2500\u2500 database/          # Database adapters\n\u2502   \u2514\u2500\u2500 utils/             # Utilities\n\u251c\u2500\u2500 test/                   # Tests\n\u2502   \u251c\u2500\u2500 e2e/               # End-to-end tests\n\u2502   \u2514\u2500\u2500 fixtures/          # Test fixtures\n\u251c\u2500\u2500 charts/                 # Helm charts\n\u2502   \u2514\u2500\u2500 db-provision-operator/\n\u251c\u2500\u2500 docs/                   # Documentation\n\u251c\u2500\u2500 DOCS/                   # Additional docs and examples\n\u251c\u2500\u2500 Dockerfile             # Container image\n\u251c\u2500\u2500 Makefile               # Build automation\n\u2514\u2500\u2500 go.mod                 # Go modules\n</code></pre>"},{"location":"development/#key-technologies","title":"Key Technologies","text":"Technology Purpose Kubebuilder Operator framework controller-runtime Controller library Ginkgo Testing framework Gomega Assertion library envtest Integration testing"},{"location":"development/#makefile-targets","title":"Makefile Targets","text":"<pre><code># Development\nmake build          # Build binary\nmake run            # Run locally\nmake install        # Install CRDs\nmake uninstall      # Uninstall CRDs\n\n# Testing\nmake test           # Unit tests\nmake test-e2e       # E2E tests\nmake lint           # Run linters\n\n# Docker\nmake docker-build   # Build image\nmake docker-push    # Push image\n\n# Cluster\nmake kind-create    # Create kind cluster\nmake kind-delete    # Delete kind cluster\nmake deploy         # Deploy to cluster\n\n# Documentation\nmake docs-serve     # Serve docs locally\nmake docs-build     # Build docs\n</code></pre>"},{"location":"development/#code-generation","title":"Code Generation","text":"<p>After modifying API types:</p> <pre><code># Regenerate manifests and code\nmake generate\nmake manifests\n</code></pre>"},{"location":"development/#debugging","title":"Debugging","text":""},{"location":"development/#vs-code-launch-config","title":"VS Code Launch Config","text":"<pre><code>{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Debug Operator\",\n      \"type\": \"go\",\n      \"request\": \"launch\",\n      \"mode\": \"auto\",\n      \"program\": \"${workspaceFolder}/cmd/main.go\",\n      \"env\": {\n        \"KUBECONFIG\": \"${env:HOME}/.kube/config\"\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"development/#golandintellij","title":"GoLand/IntelliJ","text":"<ol> <li>Run &gt; Edit Configurations</li> <li>Add Go Build</li> <li>Package path: <code>./cmd</code></li> <li>Environment: <code>KUBECONFIG=$HOME/.kube/config</code></li> </ol>"},{"location":"development/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing - Contribution guidelines</li> <li>Testing - Write and run tests</li> <li>CI/CD - Understanding the pipeline</li> </ul>"},{"location":"development/ci-cd/","title":"CI/CD","text":"<p>Continuous integration and deployment pipeline documentation.</p>"},{"location":"development/ci-cd/#overview","title":"Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        CI/CD Pipeline                           \u2502\n\u2502                                                                 \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  Push   \u2502\u2500\u2500\u2500\u25b6\u2502  Test   \u2502\u2500\u2500\u2500\u25b6\u2502  Build  \u2502\u2500\u2500\u2500\u25b6\u2502   Deploy    \u2502  \u2502\n\u2502  \u2502         \u2502    \u2502  &amp; Lint \u2502    \u2502  Image  \u2502    \u2502   (Release) \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502       \u2502              \u2502              \u2502               \u2502           \u2502\n\u2502       \u2502              \u2502              \u2502               \u2502           \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510   \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502  PR     \u2502    \u2502  Unit   \u2502   \u2502  Docker \u2502    \u2502  GitHub     \u2502  \u2502\n\u2502  \u2502  Main   \u2502    \u2502  E2E    \u2502   \u2502  Multi- \u2502    \u2502  Release    \u2502  \u2502\n\u2502  \u2502  Tags   \u2502    \u2502  Lint   \u2502   \u2502  arch   \u2502    \u2502  Helm Chart \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502  Docs       \u2502  \u2502\n\u2502                                              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"development/ci-cd/#workflows","title":"Workflows","text":""},{"location":"development/ci-cd/#ci-workflow-githubworkflowsciyml","title":"CI Workflow (<code>.github/workflows/ci.yml</code>)","text":"<p>Runs on: - Pull requests to main - Push to main</p> <pre><code>name: CI\n\non:\n  push:\n    branches: [main]\n  pull_request:\n    branches: [main]\n\njobs:\n  test:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - uses: actions/setup-go@v5\n        with:\n          go-version: '1.21'\n\n      - name: Run tests\n        run: make test\n\n      - name: Upload coverage\n        uses: codecov/codecov-action@v3\n\n  lint:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - uses: golangci/golangci-lint-action@v3\n        with:\n          version: latest\n\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Build\n        run: make build\n\n      - name: Build Docker image\n        run: make docker-build\n\n  e2e:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - name: Create kind cluster\n        uses: helm/kind-action@v1\n\n      - name: Run E2E tests\n        run: make test-e2e\n</code></pre>"},{"location":"development/ci-cd/#release-workflow-githubworkflowsreleaseyml","title":"Release Workflow (<code>.github/workflows/release.yml</code>)","text":"<p>Runs on: - Git tags matching <code>v*</code></p> <pre><code>name: Release\n\non:\n  push:\n    tags:\n      - 'v*'\n\njobs:\n  release:\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n      packages: write\n\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - uses: actions/setup-go@v5\n        with:\n          go-version: '1.21'\n\n      - name: Run tests\n        run: make test\n\n      - name: Login to GHCR\n        uses: docker/login-action@v3\n        with:\n          registry: ghcr.io\n          username: ${{ github.actor }}\n          password: ${{ secrets.GITHUB_TOKEN }}\n\n      - name: Build and push image\n        run: |\n          make docker-build docker-push \\\n            IMG=ghcr.io/${{ github.repository }}:${{ github.ref_name }}\n\n      - name: Create GitHub Release\n        uses: softprops/action-gh-release@v1\n        with:\n          generate_release_notes: true\n          files: |\n            dist/*.yaml\n\n  helm-release:\n    needs: [release]\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - name: Configure Git\n        run: |\n          git config user.name \"github-actions[bot]\"\n          git config user.email \"github-actions[bot]@users.noreply.github.com\"\n\n      - name: Package Helm chart\n        run: |\n          helm package charts/db-provision-operator \\\n            --version ${{ github.ref_name }} \\\n            --app-version ${{ github.ref_name }}\n\n      - name: Update Helm repo\n        run: |\n          git checkout gh-pages\n          mv *.tgz charts/\n          helm repo index charts/ --url https://panteparak.github.io/db-provision-operator/charts\n          git add charts/\n          git commit -m \"Release Helm chart ${{ github.ref_name }}\"\n          git push\n\n  docs:\n    needs: [release]\n    runs-on: ubuntu-latest\n    permissions:\n      contents: write\n\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - uses: actions/setup-python@v5\n        with:\n          python-version: '3.11'\n\n      - name: Install dependencies\n        run: pip install -r docs/requirements.txt\n\n      - name: Deploy docs\n        run: mkdocs gh-deploy --force\n</code></pre>"},{"location":"development/ci-cd/#documentation-workflow-githubworkflowsdocsyml","title":"Documentation Workflow (<code>.github/workflows/docs.yml</code>)","text":"<p>Runs on: - Push to main (docs changes) - Pull requests (docs changes)</p> <pre><code>name: Documentation\n\non:\n  push:\n    branches: [main]\n    paths:\n      - 'docs/**'\n      - 'mkdocs.yml'\n  pull_request:\n    paths:\n      - 'docs/**'\n      - 'mkdocs.yml'\n\njobs:\n  build:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v4\n\n      - uses: actions/setup-python@v5\n        with:\n          python-version: '3.11'\n\n      - run: pip install -r docs/requirements.txt\n\n      - name: Build docs\n        run: mkdocs build --strict\n\n  deploy:\n    needs: [build]\n    runs-on: ubuntu-latest\n    if: github.event_name == 'push' &amp;&amp; github.ref == 'refs/heads/main'\n    permissions:\n      contents: write\n\n    steps:\n      - uses: actions/checkout@v4\n        with:\n          fetch-depth: 0\n\n      - uses: actions/setup-python@v5\n        with:\n          python-version: '3.11'\n\n      - run: pip install -r docs/requirements.txt\n\n      - name: Deploy\n        run: mkdocs gh-deploy --force\n</code></pre>"},{"location":"development/ci-cd/#build-artifacts","title":"Build Artifacts","text":""},{"location":"development/ci-cd/#container-images","title":"Container Images","text":"Tag Description <code>v1.2.3</code> Release version <code>latest</code> Latest release <code>main</code> Latest main branch <code>sha-abc123</code> Specific commit"},{"location":"development/ci-cd/#helm-charts","title":"Helm Charts","text":"<p>Published to: <code>https://panteparak.github.io/db-provision-operator/charts</code></p>"},{"location":"development/ci-cd/#release-assets","title":"Release Assets","text":"<p>Each release includes: - <code>install.yaml</code> - Full installation manifest - <code>crds.yaml</code> - CRD definitions only - <code>db-provision-operator-*.tgz</code> - Helm chart package</p>"},{"location":"development/ci-cd/#environment-configuration","title":"Environment Configuration","text":""},{"location":"development/ci-cd/#secrets","title":"Secrets","text":"Secret Purpose <code>GITHUB_TOKEN</code> Auto-provided, GitHub API access <code>CODECOV_TOKEN</code> Code coverage reporting"},{"location":"development/ci-cd/#variables","title":"Variables","text":"Variable Default Description <code>GO_VERSION</code> <code>1.21</code> Go version for builds <code>REGISTRY</code> <code>ghcr.io</code> Container registry"},{"location":"development/ci-cd/#local-ci-simulation","title":"Local CI Simulation","text":""},{"location":"development/ci-cd/#run-ci-locally","title":"Run CI Locally","text":"<pre><code># Lint\nmake lint\n\n# Test\nmake test\n\n# Build\nmake build\n\n# Docker build\nmake docker-build\n\n# E2E (requires cluster)\nmake test-e2e\n</code></pre>"},{"location":"development/ci-cd/#act-github-actions-locally","title":"Act (GitHub Actions Locally)","text":"<pre><code># Install act\nbrew install act\n\n# Run CI workflow\nact -j test\n\n# Run with secrets\nact -j release --secret-file .secrets\n</code></pre>"},{"location":"development/ci-cd/#pipeline-stages","title":"Pipeline Stages","text":""},{"location":"development/ci-cd/#test-stage","title":"Test Stage","text":"<ol> <li>Unit tests - Fast, isolated tests</li> <li>Integration tests - Tests with envtest</li> <li>E2E tests - Full cluster tests</li> <li>Lint - Code quality checks</li> </ol>"},{"location":"development/ci-cd/#build-stage","title":"Build Stage","text":"<ol> <li>Go build - Compile binary</li> <li>Docker build - Create image</li> <li>Multi-arch - AMD64 and ARM64</li> </ol>"},{"location":"development/ci-cd/#release-stage","title":"Release Stage","text":"<ol> <li>Tag validation - Verify semver</li> <li>Image push - Push to registry</li> <li>GitHub release - Create release</li> <li>Helm publish - Update chart repo</li> <li>Docs deploy - Update documentation</li> </ol>"},{"location":"development/ci-cd/#quality-gates","title":"Quality Gates","text":""},{"location":"development/ci-cd/#required-checks","title":"Required Checks","text":"<ul> <li>All tests pass</li> <li>Lint passes</li> <li>Build succeeds</li> <li>Coverage meets threshold</li> </ul>"},{"location":"development/ci-cd/#branch-protection","title":"Branch Protection","text":"<pre><code># .github/settings.yml\nbranches:\n  - name: main\n    protection:\n      required_status_checks:\n        strict: true\n        contexts:\n          - test\n          - lint\n          - build\n      required_pull_request_reviews:\n        required_approving_review_count: 1\n</code></pre>"},{"location":"development/ci-cd/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/ci-cd/#failed-tests","title":"Failed Tests","text":"<pre><code># View test logs in Actions\n# Click on failed job &gt; View raw logs\n\n# Reproduce locally\nmake test\n</code></pre>"},{"location":"development/ci-cd/#failed-docker-build","title":"Failed Docker Build","text":"<pre><code># Check Dockerfile syntax\ndocker build --no-cache .\n\n# Check multi-arch\ndocker buildx build --platform linux/amd64,linux/arm64 .\n</code></pre>"},{"location":"development/ci-cd/#failed-release","title":"Failed Release","text":"<pre><code># Verify tag format\ngit tag -l 'v*'\n\n# Ensure tag is pushed\ngit push origin v1.2.3\n</code></pre>"},{"location":"development/ci-cd/#metrics","title":"Metrics","text":""},{"location":"development/ci-cd/#pipeline-duration","title":"Pipeline Duration","text":"<p>Target times: - CI: &lt; 10 minutes - Release: &lt; 15 minutes - Docs: &lt; 5 minutes</p>"},{"location":"development/ci-cd/#success-rate","title":"Success Rate","text":"<p>Monitor in GitHub Actions insights: - Workflow runs - Success/failure rate - Duration trends</p>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Guidelines for contributing to DB Provision Operator.</p>"},{"location":"development/contributing/#getting-started","title":"Getting Started","text":""},{"location":"development/contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.21+</li> <li>Docker</li> <li>kubectl</li> <li>kind or minikube</li> <li>Make</li> </ul>"},{"location":"development/contributing/#setup","title":"Setup","text":"<pre><code># Fork and clone\ngit clone https://github.com/YOUR_USERNAME/db-provision-operator.git\ncd db-provision-operator\n\n# Add upstream remote\ngit remote add upstream https://github.com/panteparak/db-provision-operator.git\n\n# Install tools\nmake install-tools\n\n# Verify setup\nmake test\n</code></pre>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#1-create-branch","title":"1. Create Branch","text":"<pre><code># Update main\ngit checkout main\ngit pull upstream main\n\n# Create feature branch\ngit checkout -b feature/my-feature\n</code></pre>"},{"location":"development/contributing/#2-make-changes","title":"2. Make Changes","text":"<p>Follow these guidelines:</p> <ul> <li>Code style: Follow Go conventions</li> <li>Comments: Document exported functions</li> <li>Tests: Add tests for new code</li> <li>Commits: Use conventional commits</li> </ul>"},{"location":"development/contributing/#3-test-changes","title":"3. Test Changes","text":"<pre><code># Run all tests\nmake test\n\n# Run linters\nmake lint\n\n# Run E2E tests (requires cluster)\nmake test-e2e\n</code></pre>"},{"location":"development/contributing/#4-submit-pr","title":"4. Submit PR","text":"<pre><code># Push branch\ngit push origin feature/my-feature\n</code></pre> <p>Open PR against <code>main</code> branch.</p>"},{"location":"development/contributing/#code-style","title":"Code Style","text":""},{"location":"development/contributing/#go-guidelines","title":"Go Guidelines","text":"<ul> <li>Follow Effective Go</li> <li>Run <code>gofmt</code> and <code>goimports</code></li> <li>Use meaningful variable names</li> <li>Keep functions focused and small</li> </ul>"},{"location":"development/contributing/#naming-conventions","title":"Naming Conventions","text":"Type Convention Example Files <code>snake_case.go</code> <code>database_controller.go</code> Packages <code>lowercase</code> <code>database</code> Types <code>PascalCase</code> <code>DatabaseInstance</code> Functions <code>PascalCase</code> (exported) <code>CreateDatabase</code> Variables <code>camelCase</code> <code>dbInstance</code> Constants <code>PascalCase</code> or <code>UPPER_SNAKE</code> <code>DefaultPort</code>"},{"location":"development/contributing/#error-handling","title":"Error Handling","text":"<pre><code>// Good\nif err != nil {\n    return fmt.Errorf(\"failed to create database: %w\", err)\n}\n\n// Bad\nif err != nil {\n    return err  // No context\n}\n</code></pre>"},{"location":"development/contributing/#logging","title":"Logging","text":"<pre><code>// Use structured logging\nlog.Info(\"Reconciling database\",\n    \"namespace\", db.Namespace,\n    \"name\", db.Name)\n\n// Error logging\nlog.Error(err, \"Failed to create database\",\n    \"namespace\", db.Namespace,\n    \"name\", db.Name)\n</code></pre>"},{"location":"development/contributing/#commit-messages","title":"Commit Messages","text":"<p>Use Conventional Commits:</p> <pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;description&gt;\n\n[optional body]\n\n[optional footer]\n</code></pre>"},{"location":"development/contributing/#types","title":"Types","text":"Type Description <code>feat</code> New feature <code>fix</code> Bug fix <code>docs</code> Documentation <code>style</code> Formatting (no code change) <code>refactor</code> Code refactoring <code>test</code> Tests <code>chore</code> Maintenance"},{"location":"development/contributing/#examples","title":"Examples","text":"<pre><code>feat(database): add support for PostgreSQL extensions\n\nfix(user): handle special characters in password generation\n\ndocs: update installation guide\n\ntest(e2e): add backup/restore tests\n</code></pre>"},{"location":"development/contributing/#pull-requests","title":"Pull Requests","text":""},{"location":"development/contributing/#pr-title","title":"PR Title","text":"<p>Follow conventional commit format: <pre><code>feat(database): add support for schemas\n</code></pre></p>"},{"location":"development/contributing/#pr-description","title":"PR Description","text":"<p>Use the template:</p> <pre><code>## Description\nBrief description of changes.\n\n## Type of Change\n- [ ] Bug fix\n- [ ] New feature\n- [ ] Breaking change\n- [ ] Documentation update\n\n## Testing\n- [ ] Unit tests added/updated\n- [ ] E2E tests added/updated\n- [ ] Manual testing performed\n\n## Checklist\n- [ ] Code follows style guidelines\n- [ ] Self-review completed\n- [ ] Documentation updated\n- [ ] Tests pass\n</code></pre>"},{"location":"development/contributing/#review-process","title":"Review Process","text":"<ol> <li>Automated checks must pass</li> <li>At least one maintainer approval</li> <li>All conversations resolved</li> <li>Squash and merge</li> </ol>"},{"location":"development/contributing/#adding-new-features","title":"Adding New Features","text":""},{"location":"development/contributing/#adding-a-new-crd","title":"Adding a New CRD","text":"<ol> <li> <p>Define API in <code>api/v1alpha1/</code>:    <pre><code>kubebuilder create api --group dbops --version v1alpha1 --kind NewResource\n</code></pre></p> </li> <li> <p>Implement types in <code>*_types.go</code></p> </li> <li> <p>Generate manifests:    <pre><code>make generate\nmake manifests\n</code></pre></p> </li> <li> <p>Implement controller in <code>internal/controller/</code></p> </li> <li> <p>Add tests</p> </li> <li> <p>Update documentation</p> </li> </ol>"},{"location":"development/contributing/#adding-database-engine-support","title":"Adding Database Engine Support","text":"<ol> <li> <p>Implement <code>DatabaseEngine</code> interface in <code>internal/database/</code></p> </li> <li> <p>Add engine-specific options to API types</p> </li> <li> <p>Register engine in factory</p> </li> <li> <p>Add tests for new engine</p> </li> <li> <p>Add documentation</p> </li> </ol>"},{"location":"development/contributing/#testing-guidelines","title":"Testing Guidelines","text":""},{"location":"development/contributing/#unit-tests","title":"Unit Tests","text":"<pre><code>func TestCreateDatabase(t *testing.T) {\n    // Setup\n    db := &amp;Database{...}\n\n    // Execute\n    err := createDatabase(db)\n\n    // Assert\n    assert.NoError(t, err)\n}\n</code></pre>"},{"location":"development/contributing/#integration-tests","title":"Integration Tests","text":"<pre><code>var _ = Describe(\"Database Controller\", func() {\n    Context(\"When creating Database\", func() {\n        It(\"Should create database in instance\", func() {\n            // Test code\n        })\n    })\n})\n</code></pre>"},{"location":"development/contributing/#e2e-tests","title":"E2E Tests","text":"<pre><code>var _ = Describe(\"Database E2E\", func() {\n    It(\"Should create and delete database\", func() {\n        // Create instance\n        // Create database\n        // Verify database exists\n        // Delete database\n        // Verify database removed\n    })\n})\n</code></pre>"},{"location":"development/contributing/#documentation","title":"Documentation","text":""},{"location":"development/contributing/#code-documentation","title":"Code Documentation","text":"<pre><code>// CreateDatabase creates a new database in the instance.\n// It returns an error if the database already exists or\n// if the connection to the instance fails.\nfunc CreateDatabase(ctx context.Context, db *Database) error {\n    // ...\n}\n</code></pre>"},{"location":"development/contributing/#user-documentation","title":"User Documentation","text":"<p>Update docs in <code>docs/</code> directory when: - Adding new features - Changing API - Adding new CRDs - Changing behavior</p>"},{"location":"development/contributing/#release-process","title":"Release Process","text":"<p>Releases are automated via GitHub Actions:</p> <ol> <li>Create tag: <code>git tag v1.2.3</code></li> <li>Push tag: <code>git push origin v1.2.3</code></li> <li>GitHub Actions builds and releases</li> </ol>"},{"location":"development/contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Questions: Open a GitHub Discussion</li> <li>Bugs: Open a GitHub Issue</li> <li>Security: Email security@example.com</li> </ul>"},{"location":"development/contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>Be respectful and inclusive. See CODE_OF_CONDUCT.md.</p>"},{"location":"development/rbac/","title":"Cross-Namespace RBAC","text":"<p>This document explains how the db-provision-operator supports cross-namespace Secret references and the RBAC configuration that enables this feature.</p>"},{"location":"development/rbac/#overview","title":"Overview","text":"<p>The db-provision-operator uses ClusterRole and ClusterRoleBinding (not namespace-scoped Role/RoleBinding) to enable cross-namespace access to Secrets. This allows:</p> <ul> <li>A <code>DatabaseInstance</code> in namespace A to reference a Secret in namespace B</li> <li>Centralized credential management in a dedicated namespace</li> <li>Separation of concerns between application teams and database administrators</li> </ul>"},{"location":"development/rbac/#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                         Kubernetes Cluster                           \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510         \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502   Namespace: app    \u2502         \u2502   Namespace: db-secrets     \u2502    \u2502\n\u2502  \u2502                     \u2502         \u2502                              \u2502    \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502         \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502    \u2502\n\u2502  \u2502  \u2502DatabaseInstance\u2502  \u2502 \u2500\u2500\u2500\u2500\u2500\u25b6 \u2502  \u2502 Secret: pg-credentials \u2502 \u2502    \u2502\n\u2502  \u2502  \u2502 name: prod-db \u2502  \u2502 refs   \u2502  \u2502  username: admin       \u2502 \u2502    \u2502\n\u2502  \u2502  \u2502 secretRef:    \u2502  \u2502         \u2502  \u2502  password: ****        \u2502 \u2502    \u2502\n\u2502  \u2502  \u2502   name: pg-*  \u2502  \u2502         \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502    \u2502\n\u2502  \u2502  \u2502   namespace:  \u2502  \u2502         \u2502                              \u2502    \u2502\n\u2502  \u2502  \u2502   db-secrets  \u2502  \u2502         \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502    \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502         \u2502  \u2502 Secret: mysql-creds    \u2502 \u2502    \u2502\n\u2502  \u2502                     \u2502         \u2502  \u2502  username: root        \u2502 \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502  \u2502  password: ****        \u2502 \u2502    \u2502\n\u2502                                   \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502    \u2502\n\u2502                                   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                                       \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510   \u2502\n\u2502  \u2502                db-provision-operator-system                     \u2502   \u2502\n\u2502  \u2502                                                                  \u2502   \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502   \u2502\n\u2502  \u2502  \u2502 controller-manager Pod \u2502\u2500\u2500\u2500\u25b6\u2502 ServiceAccount              \u2502 \u2502   \u2502\n\u2502  \u2502  \u2502                        \u2502    \u2502 + ClusterRoleBinding        \u2502 \u2502   \u2502\n\u2502  \u2502  \u2502 - Watches all namespaces\u2502   \u2502 + ClusterRole (secrets: *)  \u2502 \u2502   \u2502\n\u2502  \u2502  \u2502 - Reads secrets globally\u2502   \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2502   \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                     \u2502   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518   \u2502\n\u2502                                                                       \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"development/rbac/#rbac-configuration","title":"RBAC Configuration","text":""},{"location":"development/rbac/#clusterrole","title":"ClusterRole","text":"<p>The operator's ClusterRole (<code>config/rbac/role.yaml</code>) includes permissions to access Secrets across all namespaces:</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: manager-role\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - secrets\n    verbs:\n      - get\n      - list\n      - watch\n      - create\n      - update\n      - patch\n      - delete\n</code></pre>"},{"location":"development/rbac/#clusterrolebinding","title":"ClusterRoleBinding","text":"<p>The ClusterRoleBinding (<code>config/rbac/role_binding.yaml</code>) binds the ClusterRole to the operator's ServiceAccount:</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: manager-rolebinding\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: manager-role\nsubjects:\n  - kind: ServiceAccount\n    name: controller-manager\n    namespace: db-provision-operator-system\n</code></pre> <p>Key Point: Using <code>ClusterRoleBinding</code> (not <code>RoleBinding</code>) grants the operator cluster-wide permissions, enabling cross-namespace Secret access.</p>"},{"location":"development/rbac/#usage-examples","title":"Usage Examples","text":""},{"location":"development/rbac/#example-1-databaseinstance-with-cross-namespace-secret","title":"Example 1: DatabaseInstance with Cross-Namespace Secret","text":"<pre><code># Secret in dedicated credentials namespace\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: db-credentials\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin\n  namespace: db-credentials\ntype: Opaque\nstringData:\n  username: postgres\n  password: supersecretpassword\n\n---\n# DatabaseInstance in application namespace referencing cross-namespace Secret\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: production-postgres\n  namespace: my-app  # Different from Secret namespace\nspec:\n  engine: postgresql\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: postgres-admin\n      namespace: db-credentials  # Cross-namespace reference\n  healthCheck:\n    enabled: true\n    interval: 30s\n</code></pre>"},{"location":"development/rbac/#example-2-centralized-credential-management","title":"Example 2: Centralized Credential Management","text":"<pre><code># Central secrets namespace with all database credentials\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: database-secrets\n  labels:\n    purpose: credential-storage\n---\n# PostgreSQL credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: prod-postgresql\n  namespace: database-secrets\ntype: Opaque\nstringData:\n  username: admin\n  password: pg-secret-123\n---\n# MySQL credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: prod-mysql\n  namespace: database-secrets\ntype: Opaque\nstringData:\n  username: root\n  password: mysql-secret-456\n\n---\n# Team A's PostgreSQL instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: team-a-postgres\n  namespace: team-a\nspec:\n  engine: postgresql\n  connection:\n    host: postgres.prod.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: prod-postgresql\n      namespace: database-secrets  # Points to central namespace\n\n---\n# Team B's MySQL instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: team-b-mysql\n  namespace: team-b\nspec:\n  engine: mysql\n  connection:\n    host: mysql.prod.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: prod-mysql\n      namespace: database-secrets  # Points to central namespace\n</code></pre>"},{"location":"development/rbac/#security-considerations","title":"Security Considerations","text":""},{"location":"development/rbac/#principle-of-least-privilege","title":"Principle of Least Privilege","text":"<p>While the operator has cluster-wide Secret access, you should:</p> <ol> <li>Limit Secret creation - Use Kubernetes RBAC to control who can create Secrets in credential namespaces</li> <li>Audit Secret access - Enable Kubernetes audit logging to track Secret access</li> <li>Use dedicated namespaces - Create dedicated namespaces for database credentials with restricted access</li> </ol>"},{"location":"development/rbac/#restricting-secret-access-optional","title":"Restricting Secret Access (Optional)","text":"<p>If you want to restrict which namespaces the operator can access Secrets from, you can use multiple RoleBindings instead of ClusterRoleBinding:</p> <pre><code># Create Role in each namespace where secrets should be accessible\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: secret-reader\n  namespace: db-credentials\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: operator-secret-access\n  namespace: db-credentials\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: secret-reader\nsubjects:\n  - kind: ServiceAccount\n    name: controller-manager\n    namespace: db-provision-operator-system\n</code></pre> <p>Trade-off: This approach requires creating RoleBindings in each namespace where Secrets should be accessible, but provides finer-grained access control.</p>"},{"location":"development/rbac/#verifying-rbac-configuration","title":"Verifying RBAC Configuration","text":""},{"location":"development/rbac/#check-clusterrolebinding","title":"Check ClusterRoleBinding","text":"<pre><code>kubectl get clusterrolebinding manager-rolebinding -o yaml\n</code></pre> <p>Expected output should show: - <code>kind: ClusterRoleBinding</code> (not RoleBinding) - <code>roleRef.kind: ClusterRole</code> - ServiceAccount reference to the operator</p>"},{"location":"development/rbac/#test-cross-namespace-access","title":"Test Cross-Namespace Access","text":"<pre><code># Create a test secret in a separate namespace\nkubectl create namespace test-secrets\nkubectl create secret generic test-creds \\\n  --from-literal=username=testuser \\\n  --from-literal=password=testpass \\\n  -n test-secrets\n\n# Create a DatabaseInstance referencing the cross-namespace secret\ncat &lt;&lt;EOF | kubectl apply -f -\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: test-cross-ns\n  namespace: default\nspec:\n  engine: postgresql\n  connection:\n    host: postgres.postgres.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: test-creds\n      namespace: test-secrets  # Different namespace\nEOF\n\n# Check if the DatabaseInstance becomes Ready\nkubectl get databaseinstance test-cross-ns -o jsonpath='{.status.phase}'\n# Expected: \"Ready\" (if database is accessible)\n\n# Cleanup\nkubectl delete databaseinstance test-cross-ns\nkubectl delete namespace test-secrets\n</code></pre>"},{"location":"development/rbac/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/rbac/#error-secrets-is-forbidden","title":"Error: \"secrets is forbidden\"","text":"<p>Symptom: Operator logs show <code>secrets \"xxx\" is forbidden: User \"system:serviceaccount:...\" cannot get resource \"secrets\" in API group \"\" in the namespace \"yyy\"</code></p> <p>Solution: 1. Verify ClusterRoleBinding exists:    <pre><code>kubectl get clusterrolebinding manager-rolebinding\n</code></pre> 2. Check the binding references the correct ServiceAccount:    <pre><code>kubectl get clusterrolebinding manager-rolebinding -o yaml\n</code></pre> 3. Reinstall RBAC:    <pre><code>make install\nmake deploy IMG=&lt;your-image&gt;\n</code></pre></p>"},{"location":"development/rbac/#databaseinstance-stuck-in-pending","title":"DatabaseInstance stuck in Pending","text":"<p>Symptom: DatabaseInstance never becomes Ready when using cross-namespace Secret</p> <p>Solution: 1. Check operator logs for errors 2. Verify the Secret exists in the referenced namespace 3. Verify the Secret has the required keys (<code>username</code>, <code>password</code>) 4. Test direct Secret access:    <pre><code>kubectl auth can-i get secrets --as=system:serviceaccount:db-provision-operator-system:controller-manager -n &lt;secret-namespace&gt;\n</code></pre></p>"},{"location":"development/roadmap/","title":"Development Roadmap","text":"<p>This document provides the development roadmap and context for the db-provision-operator.</p>"},{"location":"development/roadmap/#current-state-summary","title":"Current State Summary","text":""},{"location":"development/roadmap/#completed-phases","title":"Completed Phases","text":"Phase Component Status Notes Phase 1 DatabaseInstance CRD Complete Connection management, health checks Database CRD Complete CRUD operations, extensions, schemas DatabaseUser CRD Complete User management, password generation PostgreSQL Adapter Complete Full CRUD, grants, backup/restore MySQL Adapter Complete Full CRUD, grants, backup/restore Secret Manager Complete Credentials, TLS, templates Controllers Complete Reconciliation, finalizers, status Phase 2 DatabaseRole CRD Complete Role management for PostgreSQL/MySQL DatabaseGrant CRD Complete Fine-grained grant management DatabaseBackup CRD Complete Backup lifecycle management DatabaseRestore CRD Complete Restore from backup or path DatabaseBackupSchedule CRD Complete Cron scheduling, retention policies Retry Utility Complete Exponential backoff with jitter Phase 2.5 S3 Storage Backend Complete AWS S3 compatible with custom endpoints GCS Storage Backend Complete Google Cloud Storage Azure Blob Backend Complete Azure Blob Storage PVC Storage Backend Complete Kubernetes PVC storage Compression Complete gzip, lz4, zstd algorithms Encryption Complete AES-256-GCM encryption Prometheus Metrics Complete 25 metrics, 100% coverage ServiceMonitor Complete Auto-discovery for Prometheus PrometheusRules Complete 10+ alerting rules"},{"location":"development/roadmap/#phase-3-planned-work","title":"Phase 3 Planned Work","text":""},{"location":"development/roadmap/#31-multi-cluster-support","title":"3.1 Multi-Cluster Support","text":"<p>Concept: Manage databases across multiple clusters</p> <p>Approach Options: 1. Remote cluster kubeconfig references 2. Submariner/Skupper for cross-cluster networking 3. Hub-spoke model with agent per cluster</p>"},{"location":"development/roadmap/#32-database-migration-crd","title":"3.2 Database Migration CRD","text":"<p>Purpose: Manage database schema migrations</p> <p>Proposed Integration: - Flyway integration - Liquibase integration - Or simple SQL migration files</p>"},{"location":"development/roadmap/#33-audit-logging","title":"3.3 Audit Logging","text":"<p>Requirements: - Log all database operations - Include user, operation, timestamp - Support external audit sinks (Elasticsearch, Loki)</p>"},{"location":"development/roadmap/#34-policy-enforcement","title":"3.4 Policy Enforcement","text":"<p>Concept: OPA/Gatekeeper integration for policies</p> <p>Example Policies: - Password complexity requirements - Naming conventions - Required labels/annotations - Deletion protection rules</p>"},{"location":"development/roadmap/#development-guidelines","title":"Development Guidelines","text":""},{"location":"development/roadmap/#adding-a-new-database-engine","title":"Adding a New Database Engine","text":"<ol> <li>Create new package: <code>internal/adapter/&lt;engine&gt;/</code></li> <li>Implement <code>DatabaseAdapter</code> interface from <code>internal/adapter/types/</code></li> <li>Add engine type to <code>EngineType</code> enum in <code>api/v1alpha1/common_types.go</code></li> <li>Add engine-specific config types in <code>api/v1alpha1/&lt;engine&gt;_types.go</code></li> <li>Update <code>NewAdapter()</code> factory in <code>internal/adapter/adapter.go</code></li> <li>Add engine-specific option handling in controllers</li> </ol>"},{"location":"development/roadmap/#adding-a-new-crd","title":"Adding a New CRD","text":"<ol> <li>Create type file: <code>api/v1alpha1/&lt;resource&gt;_types.go</code></li> <li>Run <code>make generate</code> to generate DeepCopy methods</li> <li>Run <code>make manifests</code> to generate CRD YAML</li> <li>Create controller: <code>internal/controller/&lt;resource&gt;_controller.go</code></li> <li>Register controller in <code>cmd/main.go</code></li> <li>Add RBAC markers to controller</li> <li>Run <code>make manifests</code> again to update RBAC</li> </ol>"},{"location":"development/roadmap/#code-style","title":"Code Style","text":"<ul> <li>Follow standard Go conventions</li> <li>Use <code>logf.FromContext(ctx)</code> for logging</li> <li>Set status conditions for all outcomes</li> <li>Always handle errors and update status</li> <li>Use finalizers for cleanup operations</li> <li>Add kubebuilder markers for RBAC and validation</li> </ul>"},{"location":"development/roadmap/#file-locations-reference","title":"File Locations Reference","text":"<pre><code>db-provision-operator/\n\u251c\u2500\u2500 api/v1alpha1/\n\u2502   \u251c\u2500\u2500 common_types.go          # Shared types (EngineType, Phase, etc.)\n\u2502   \u251c\u2500\u2500 databaseinstance_types.go # DatabaseInstance CRD\n\u2502   \u251c\u2500\u2500 database_types.go         # Database CRD\n\u2502   \u251c\u2500\u2500 databaseuser_types.go     # DatabaseUser CRD\n\u2502   \u251c\u2500\u2500 postgres_types.go         # PostgreSQL-specific types\n\u2502   \u251c\u2500\u2500 mysql_types.go            # MySQL-specific types\n\u2502   \u2514\u2500\u2500 groupversion_info.go      # API group registration\n\u2502\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 adapter/\n\u2502   \u2502   \u251c\u2500\u2500 types/types.go        # Adapter interfaces and option types\n\u2502   \u2502   \u251c\u2500\u2500 adapter.go            # Factory and helpers\n\u2502   \u2502   \u251c\u2500\u2500 postgres/             # PostgreSQL implementation\n\u2502   \u2502   \u2514\u2500\u2500 mysql/                # MySQL implementation\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 controller/\n\u2502   \u2502   \u251c\u2500\u2500 databaseinstance_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 database_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databaseuser_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databaserole_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databasegrant_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databasebackup_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databaserestore_controller.go\n\u2502   \u2502   \u2514\u2500\u2500 databasebackupschedule_controller.go\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 metrics/\n\u2502   \u2502   \u251c\u2500\u2500 metrics.go            # Prometheus metrics definitions\n\u2502   \u2502   \u2514\u2500\u2500 metrics_test.go       # Metrics tests\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 storage/\n\u2502   \u2502   \u251c\u2500\u2500 storage.go            # Storage interface\n\u2502   \u2502   \u251c\u2500\u2500 s3.go                 # AWS S3 backend\n\u2502   \u2502   \u251c\u2500\u2500 gcs.go                # Google Cloud Storage backend\n\u2502   \u2502   \u251c\u2500\u2500 azure.go              # Azure Blob Storage backend\n\u2502   \u2502   \u251c\u2500\u2500 pvc.go                # PVC storage backend\n\u2502   \u2502   \u251c\u2500\u2500 compression.go        # gzip, lz4, zstd compression\n\u2502   \u2502   \u2514\u2500\u2500 encryption.go         # AES-256-GCM encryption\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 secret/\n\u2502   \u2502   \u2514\u2500\u2500 manager.go            # Secret management\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 util/\n\u2502       \u251c\u2500\u2500 conditions.go         # Status condition helpers\n\u2502       \u251c\u2500\u2500 finalizers.go         # Finalizer constants\n\u2502       \u251c\u2500\u2500 annotations.go        # Annotation helpers\n\u2502       \u2514\u2500\u2500 retry.go              # Exponential backoff retry\n\u2502\n\u251c\u2500\u2500 config/\n\u2502   \u251c\u2500\u2500 crd/bases/                # Generated CRD manifests\n\u2502   \u251c\u2500\u2500 rbac/                     # Generated RBAC manifests\n\u2502   \u251c\u2500\u2500 prometheus/               # Prometheus monitoring\n\u2502   \u2514\u2500\u2500 samples/                  # Example resources\n\u2502\n\u251c\u2500\u2500 cmd/\n\u2502   \u2514\u2500\u2500 main.go                   # Operator entrypoint\n\u2502\n\u2514\u2500\u2500 docs/                         # Project documentation\n</code></pre>"},{"location":"development/roadmap/#quick-commands","title":"Quick Commands","text":"<pre><code># Development cycle\nmake generate           # Generate DeepCopy, etc.\nmake manifests          # Generate CRDs, RBAC\nmake build              # Build binary\nmake run                # Run locally\n\n# Testing\nmake test               # Run tests (needs envtest)\ngo build ./...          # Verify compilation\ngo vet ./...            # Static analysis\n\n# Deployment\nmake install            # Install CRDs to cluster\nmake deploy IMG=&lt;img&gt;   # Deploy operator\nmake undeploy           # Remove operator\n\n# Cleanup\nmake uninstall          # Remove CRDs\n</code></pre>"},{"location":"development/roadmap/#handoff-checklist","title":"Handoff Checklist","text":"<p>Before starting next phase:</p> <ul> <li> Review architecture documentation</li> <li> Run <code>go build ./...</code> to verify clean build</li> <li> Run <code>make generate &amp;&amp; make manifests</code> to ensure generated files are current</li> <li> Review open issues/TODOs in code</li> <li> Set up test database instances (PostgreSQL, MySQL)</li> <li> Understand the adapter interface pattern</li> <li> Review secret manager for credential handling</li> </ul>"},{"location":"development/testing/","title":"Testing","text":"<p>Testing strategies and guides for DB Provision Operator.</p>"},{"location":"development/testing/#test-types","title":"Test Types","text":"Type Purpose Tools Location Unit Test individual functions Go testing <code>*_test.go</code> Integration Test with K8s API envtest <code>internal/controller/*_test.go</code> E2E Full system tests Ginkgo, real cluster <code>test/e2e/</code>"},{"location":"development/testing/#running-tests","title":"Running Tests","text":""},{"location":"development/testing/#all-tests","title":"All Tests","text":"<pre><code># Unit and integration tests\nmake test\n\n# With coverage\nmake test-coverage\n</code></pre>"},{"location":"development/testing/#unit-tests-only","title":"Unit Tests Only","text":"<pre><code>go test ./internal/... -short\n</code></pre>"},{"location":"development/testing/#integration-tests","title":"Integration Tests","text":"<pre><code># Requires envtest binaries\nmake envtest\ngo test ./internal/controller/...\n</code></pre>"},{"location":"development/testing/#e2e-tests","title":"E2E Tests","text":"<pre><code># Create test cluster\nmake kind-create\n\n# Deploy operator\nmake deploy\n\n# Run E2E tests\nmake test-e2e\n\n# Cleanup\nmake kind-delete\n</code></pre>"},{"location":"development/testing/#writing-tests","title":"Writing Tests","text":""},{"location":"development/testing/#unit-tests","title":"Unit Tests","text":"<pre><code>package database\n\nimport (\n    \"testing\"\n    \"github.com/stretchr/testify/assert\"\n)\n\nfunc TestGeneratePassword(t *testing.T) {\n    tests := []struct {\n        name   string\n        length int\n        want   int\n    }{\n        {\"default length\", 24, 24},\n        {\"custom length\", 32, 32},\n        {\"minimum length\", 8, 8},\n    }\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            got := GeneratePassword(tt.length)\n            assert.Equal(t, tt.want, len(got))\n        })\n    }\n}\n</code></pre>"},{"location":"development/testing/#integration-tests-with-envtest","title":"Integration Tests with envtest","text":"<pre><code>package controller\n\nimport (\n    \"context\"\n    . \"github.com/onsi/ginkgo/v2\"\n    . \"github.com/onsi/gomega\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    \"k8s.io/apimachinery/pkg/types\"\n\n    dbopsv1alpha1 \"github.com/panteparak/db-provision-operator/api/v1alpha1\"\n)\n\nvar _ = Describe(\"Database Controller\", func() {\n    const (\n        timeout  = time.Second * 10\n        interval = time.Millisecond * 250\n    )\n\n    Context(\"When creating Database\", func() {\n        It(\"Should update status to Ready\", func() {\n            ctx := context.Background()\n\n            // Create Database\n            database := &amp;dbopsv1alpha1.Database{\n                ObjectMeta: metav1.ObjectMeta{\n                    Name:      \"test-database\",\n                    Namespace: \"default\",\n                },\n                Spec: dbopsv1alpha1.DatabaseSpec{\n                    InstanceRef: dbopsv1alpha1.ObjectReference{\n                        Name: \"test-instance\",\n                    },\n                    Name: \"testdb\",\n                },\n            }\n            Expect(k8sClient.Create(ctx, database)).Should(Succeed())\n\n            // Verify status\n            Eventually(func() string {\n                db := &amp;dbopsv1alpha1.Database{}\n                err := k8sClient.Get(ctx, types.NamespacedName{\n                    Name:      \"test-database\",\n                    Namespace: \"default\",\n                }, db)\n                if err != nil {\n                    return \"\"\n                }\n                return db.Status.Phase\n            }, timeout, interval).Should(Equal(\"Ready\"))\n        })\n    })\n})\n</code></pre>"},{"location":"development/testing/#e2e-tests_1","title":"E2E Tests","text":"<pre><code>package e2e\n\nimport (\n    \"context\"\n    \"time\"\n\n    . \"github.com/onsi/ginkgo/v2\"\n    . \"github.com/onsi/gomega\"\n    corev1 \"k8s.io/api/core/v1\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n)\n\nvar _ = Describe(\"PostgreSQL E2E\", func() {\n    var namespace string\n\n    BeforeEach(func() {\n        namespace = createTestNamespace()\n    })\n\n    AfterEach(func() {\n        deleteTestNamespace(namespace)\n    })\n\n    It(\"Should provision complete database stack\", func() {\n        ctx := context.Background()\n\n        // Create admin credentials\n        secret := &amp;corev1.Secret{\n            ObjectMeta: metav1.ObjectMeta{\n                Name:      \"postgres-admin\",\n                Namespace: namespace,\n            },\n            StringData: map[string]string{\n                \"username\": \"postgres\",\n                \"password\": \"testpassword\",\n            },\n        }\n        Expect(k8sClient.Create(ctx, secret)).Should(Succeed())\n\n        // Create DatabaseInstance\n        instance := createDatabaseInstance(namespace, \"postgres-test\")\n        Expect(k8sClient.Create(ctx, instance)).Should(Succeed())\n\n        // Wait for instance to be ready\n        Eventually(func() string {\n            return getInstancePhase(namespace, \"postgres-test\")\n        }, 2*time.Minute, 5*time.Second).Should(Equal(\"Ready\"))\n\n        // Create Database\n        database := createDatabase(namespace, \"test-db\", \"postgres-test\")\n        Expect(k8sClient.Create(ctx, database)).Should(Succeed())\n\n        // Wait for database to be ready\n        Eventually(func() string {\n            return getDatabasePhase(namespace, \"test-db\")\n        }, time.Minute, 5*time.Second).Should(Equal(\"Ready\"))\n\n        // Verify database exists in PostgreSQL\n        Expect(verifyDatabaseExists(\"testdb\")).Should(BeTrue())\n    })\n})\n</code></pre>"},{"location":"development/testing/#test-environment-setup","title":"Test Environment Setup","text":""},{"location":"development/testing/#envtest-suite-setup","title":"envtest Suite Setup","text":"<pre><code>// suite_test.go\npackage controller\n\nimport (\n    \"path/filepath\"\n    \"testing\"\n\n    . \"github.com/onsi/ginkgo/v2\"\n    . \"github.com/onsi/gomega\"\n    \"k8s.io/client-go/kubernetes/scheme\"\n    \"sigs.k8s.io/controller-runtime/pkg/client\"\n    \"sigs.k8s.io/controller-runtime/pkg/envtest\"\n\n    dbopsv1alpha1 \"github.com/panteparak/db-provision-operator/api/v1alpha1\"\n)\n\nvar (\n    k8sClient client.Client\n    testEnv   *envtest.Environment\n)\n\nfunc TestControllers(t *testing.T) {\n    RegisterFailHandler(Fail)\n    RunSpecs(t, \"Controller Suite\")\n}\n\nvar _ = BeforeSuite(func() {\n    testEnv = &amp;envtest.Environment{\n        CRDDirectoryPaths: []string{\n            filepath.Join(\"..\", \"..\", \"config\", \"crd\", \"bases\"),\n        },\n    }\n\n    cfg, err := testEnv.Start()\n    Expect(err).NotTo(HaveOccurred())\n\n    err = dbopsv1alpha1.AddToScheme(scheme.Scheme)\n    Expect(err).NotTo(HaveOccurred())\n\n    k8sClient, err = client.New(cfg, client.Options{Scheme: scheme.Scheme})\n    Expect(err).NotTo(HaveOccurred())\n})\n\nvar _ = AfterSuite(func() {\n    Expect(testEnv.Stop()).To(Succeed())\n})\n</code></pre>"},{"location":"development/testing/#e2e-suite-setup","title":"E2E Suite Setup","text":"<pre><code>// suite_test.go\npackage e2e\n\nimport (\n    \"os\"\n    \"testing\"\n\n    . \"github.com/onsi/ginkgo/v2\"\n    . \"github.com/onsi/gomega\"\n    \"k8s.io/client-go/kubernetes/scheme\"\n    \"sigs.k8s.io/controller-runtime/pkg/client\"\n    \"sigs.k8s.io/controller-runtime/pkg/client/config\"\n)\n\nvar k8sClient client.Client\n\nfunc TestE2E(t *testing.T) {\n    RegisterFailHandler(Fail)\n    RunSpecs(t, \"E2E Suite\")\n}\n\nvar _ = BeforeSuite(func() {\n    cfg, err := config.GetConfig()\n    Expect(err).NotTo(HaveOccurred())\n\n    k8sClient, err = client.New(cfg, client.Options{Scheme: scheme.Scheme})\n    Expect(err).NotTo(HaveOccurred())\n})\n</code></pre>"},{"location":"development/testing/#test-fixtures","title":"Test Fixtures","text":""},{"location":"development/testing/#sample-resources","title":"Sample Resources","text":"<pre><code># test/e2e/fixtures/postgres-instance.yaml\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: test-postgres\nspec:\n  engine: postgres\n  connection:\n    host: postgres.test.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-admin\n</code></pre>"},{"location":"development/testing/#test-databases","title":"Test Databases","text":"<p>Deploy test databases with:</p> <pre><code># PostgreSQL\nkubectl apply -f test/e2e/fixtures/postgres-deployment.yaml\n\n# MySQL\nkubectl apply -f test/e2e/fixtures/mysql-deployment.yaml\n</code></pre>"},{"location":"development/testing/#mocking","title":"Mocking","text":""},{"location":"development/testing/#mock-database-engine","title":"Mock Database Engine","text":"<pre><code>type MockDatabaseEngine struct {\n    CreateDatabaseFunc func(ctx context.Context, db *Database) error\n    // ...\n}\n\nfunc (m *MockDatabaseEngine) CreateDatabase(ctx context.Context, db *Database) error {\n    if m.CreateDatabaseFunc != nil {\n        return m.CreateDatabaseFunc(ctx, db)\n    }\n    return nil\n}\n</code></pre>"},{"location":"development/testing/#using-mocks-in-tests","title":"Using Mocks in Tests","text":"<pre><code>func TestDatabaseController(t *testing.T) {\n    mock := &amp;MockDatabaseEngine{\n        CreateDatabaseFunc: func(ctx context.Context, db *Database) error {\n            return nil\n        },\n    }\n\n    controller := &amp;DatabaseReconciler{\n        Engine: mock,\n    }\n\n    // Test controller with mock\n}\n</code></pre>"},{"location":"development/testing/#coverage","title":"Coverage","text":""},{"location":"development/testing/#generate-coverage-report","title":"Generate Coverage Report","text":"<pre><code># Run tests with coverage\ngo test ./... -coverprofile=coverage.out\n\n# View coverage\ngo tool cover -html=coverage.out -o coverage.html\n</code></pre>"},{"location":"development/testing/#coverage-requirements","title":"Coverage Requirements","text":"<ul> <li>Minimum 70% coverage for new code</li> <li>Critical paths should have 90%+ coverage</li> </ul>"},{"location":"development/testing/#ci-integration","title":"CI Integration","text":"<p>Tests run automatically on:</p> <ul> <li>Pull requests</li> <li>Push to main</li> <li>Release tags</li> </ul> <p>See CI/CD for pipeline details.</p>"},{"location":"development/testing/#debugging-tests","title":"Debugging Tests","text":""},{"location":"development/testing/#verbose-output","title":"Verbose Output","text":"<pre><code>go test -v ./internal/controller/...\n</code></pre>"},{"location":"development/testing/#single-test","title":"Single Test","text":"<pre><code>go test -v ./internal/controller/... -run TestDatabaseController\n</code></pre>"},{"location":"development/testing/#ginkgo-focus","title":"Ginkgo Focus","text":"<pre><code>FDescribe(\"Database Controller\", func() {\n    // Only this describe block runs\n})\n\nFIt(\"Should create database\", func() {\n    // Only this test runs\n})\n</code></pre>"},{"location":"development/testing/#debug-e2e-in-cluster","title":"Debug E2E in Cluster","text":"<pre><code># Keep cluster after test failure\nSKIP_CLEANUP=true make test-e2e\n\n# Inspect cluster\nkubectl get all -A\nkubectl logs deployment/db-provision-operator -n db-provision-operator-system\n</code></pre>"},{"location":"development/testing/#best-practices","title":"Best Practices","text":"<ol> <li>Test in isolation - Each test should be independent</li> <li>Clean up resources - Use AfterEach to clean up</li> <li>Use meaningful names - Describe what's being tested</li> <li>Test edge cases - Include error conditions</li> <li>Keep tests fast - Mock external dependencies</li> <li>Test at appropriate level - Unit for logic, E2E for integration</li> </ol>"},{"location":"engines/","title":"Engine Guides","text":"<p>DB Provision Operator supports multiple database engines with a unified API.</p>"},{"location":"engines/#supported-engines","title":"Supported Engines","text":"Engine Status Versions PostgreSQL \u2705 Stable 12, 13, 14, 15, 16 MySQL \u2705 Stable 5.7, 8.0, 8.4 MariaDB \u2705 Stable 10.5, 10.6, 10.11, 11.x"},{"location":"engines/#engine-comparison","title":"Engine Comparison","text":"Feature PostgreSQL MySQL MariaDB Roles \u2705 Native \u2705 8.0+ \u2705 10.0.5+ Row-Level Security \u2705 \u274c \u274c Extensions \u2705 \u274c \u274c Schemas \u2705 \u274c \u274c Default Privileges \u2705 \u274c \u274c Backup pg_dump mysqldump mariadb-dump"},{"location":"engines/#choosing-an-engine","title":"Choosing an Engine","text":""},{"location":"engines/#postgresql","title":"PostgreSQL","text":"<p>Best for:</p> <ul> <li>Complex queries and analytics</li> <li>JSON/JSONB document storage</li> <li>Full-text search</li> <li>Geographic data (PostGIS)</li> <li>Strict data integrity requirements</li> </ul>"},{"location":"engines/#mysql","title":"MySQL","text":"<p>Best for:</p> <ul> <li>Web applications</li> <li>High-volume OLTP</li> <li>Wide ecosystem support</li> <li>Replication simplicity</li> </ul>"},{"location":"engines/#mariadb","title":"MariaDB","text":"<p>Best for:</p> <ul> <li>MySQL compatibility with enhancements</li> <li>Open-source focus</li> <li>Additional storage engines</li> <li>Galera cluster support</li> </ul>"},{"location":"engines/#engine-specific-features","title":"Engine-Specific Features","text":""},{"location":"engines/#postgresql-only","title":"PostgreSQL Only","text":"<pre><code>spec:\n  postgres:\n    extensions:\n      - name: uuid-ossp\n      - name: pg_stat_statements\n    schemas:\n      - name: app\n        owner: myapp_admin\n    defaultPrivileges:\n      - objectType: tables\n        privileges: [SELECT]\n</code></pre>"},{"location":"engines/#mysqlmariadb","title":"MySQL/MariaDB","text":"<pre><code>spec:\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n    authPlugin: caching_sha2_password\n    allowedHosts:\n      - \"10.0.0.%\"\n</code></pre>"},{"location":"engines/#connection-configuration","title":"Connection Configuration","text":"<p>All engines use the same <code>DatabaseInstance</code> structure:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: my-database\nspec:\n  engine: postgres  # or mysql, mariadb\n  connection:\n    host: database.example.com\n    port: 5432  # 3306 for MySQL/MariaDB\n    database: postgres  # mysql for MySQL/MariaDB\n    secretRef:\n      name: admin-credentials\n</code></pre>"},{"location":"engines/#next-steps","title":"Next Steps","text":"<ul> <li>PostgreSQL Guide - PostgreSQL-specific features</li> <li>MySQL Guide - MySQL-specific features</li> <li>MariaDB Guide - MariaDB-specific features</li> </ul>"},{"location":"engines/mariadb/","title":"MariaDB","text":"<p>Complete guide for using DB Provision Operator with MariaDB.</p>"},{"location":"engines/mariadb/#supported-versions","title":"Supported Versions","text":"<ul> <li>MariaDB 10.5.x</li> <li>MariaDB 10.6.x (LTS)</li> <li>MariaDB 10.11.x (LTS)</li> <li>MariaDB 11.x</li> </ul>"},{"location":"engines/mariadb/#admin-account-requirements","title":"Admin Account Requirements","text":"<p>The operator requires a privileged database account to manage databases, users, and grants. For production security, create a dedicated least-privilege admin account instead of using <code>root</code>.</p> <p>Required privileges:</p> Privilege Purpose <code>CREATE, DROP, ALTER ON *.*</code> Database operations <code>CREATE USER ON *.*</code> User management <code>WITH GRANT OPTION</code> Delegate privileges <code>SELECT ON mysql.*</code> Query user metadata <code>RELOAD ON *.*</code> FLUSH PRIVILEGES <code>CONNECTION ADMIN ON *.*</code> Kill connections (MariaDB 10.5.2+) <p>Quick setup:</p> <pre><code>CREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password';\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%' WITH GRANT OPTION;\nGRANT SELECT ON mysql.* TO 'dbprovision_admin'@'%';\nGRANT RELOAD, CONNECTION ADMIN ON *.* TO 'dbprovision_admin'@'%';\nFLUSH PRIVILEGES;\n</code></pre> <p>MariaDB vs MySQL Differences</p> <p>MariaDB uses <code>CONNECTION ADMIN</code> (with a space) instead of MySQL's <code>CONNECTION_ADMIN</code>. Roles in MariaDB are implemented as users, not a separate <code>CREATE ROLE</code> statement like MySQL 8.0+.</p> <p>Complete Setup Guide</p> <p>See Admin Account Setup for complete SQL scripts, verification steps, and security recommendations.</p>"},{"location":"engines/mariadb/#mariadb-vs-mysql","title":"MariaDB vs MySQL","text":"<p>MariaDB is a MySQL-compatible fork with additional features:</p> Feature MariaDB MySQL Storage Engines More options (Aria, ColumnStore) InnoDB, MyISAM Replication Galera Cluster built-in Group Replication JSON JSON type (10.2+) Native JSON Window Functions 10.2+ 8.0+ Roles 10.0.5+ 8.0+"},{"location":"engines/mariadb/#databaseinstance","title":"DatabaseInstance","text":""},{"location":"engines/mariadb/#basic-configuration","title":"Basic Configuration","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mariadb-primary\nspec:\n  engine: mariadb\n  connection:\n    host: mariadb.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mariadb-admin-credentials\n</code></pre>"},{"location":"engines/mariadb/#tls-configuration","title":"TLS Configuration","text":"<pre><code>spec:\n  connection:\n    tls:\n      enabled: true\n      secretRef:\n        name: mariadb-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"engines/mariadb/#database","title":"Database","text":""},{"location":"engines/mariadb/#basic-database","title":"Basic Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mariadb-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre> <p>MySQL Configuration Block</p> <p>MariaDB uses the <code>mysql</code> configuration block due to its MySQL compatibility.</p>"},{"location":"engines/mariadb/#character-sets","title":"Character Sets","text":"Charset Description Recommended For <code>utf8mb4</code> Full Unicode Most applications <code>utf8mb3</code> 3-byte Unicode Legacy compatibility <code>latin1</code> Western European Legacy systems"},{"location":"engines/mariadb/#databaseuser","title":"DatabaseUser","text":""},{"location":"engines/mariadb/#basic-user","title":"Basic User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mariadb-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"engines/mariadb/#user-with-options","title":"User with Options","text":"<pre><code>spec:\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n  mysql:\n    maxUserConnections: 50\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.%\"\n      - \"192.168.1.%\"\n</code></pre>"},{"location":"engines/mariadb/#authentication-plugins","title":"Authentication Plugins","text":"<p>MariaDB supports multiple authentication plugins:</p> Plugin Description <code>mysql_native_password</code> Traditional (default) <code>ed25519</code> EdDSA (more secure) <code>gssapi</code> Kerberos/GSSAPI <code>pam</code> PAM authentication"},{"location":"engines/mariadb/#databaserole","title":"DatabaseRole","text":"<p>MariaDB supports roles since version 10.0.5.</p>"},{"location":"engines/mariadb/#create-role","title":"Create Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: mariadb-primary\n  roleName: readonly\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT]\n</code></pre>"},{"location":"engines/mariadb/#role-with-multiple-privileges","title":"Role with Multiple Privileges","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: developer-role\nspec:\n  instanceRef:\n    name: mariadb-primary\n  roleName: developer\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE, CREATE, ALTER, INDEX]\n</code></pre>"},{"location":"engines/mariadb/#databasegrant","title":"DatabaseGrant","text":""},{"location":"engines/mariadb/#database-level-grant","title":"Database-Level Grant","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mariadb/#table-level-grant","title":"Table-Level Grant","text":"<pre><code>spec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: table\n        database: myapp\n        table: users\n        privileges: [SELECT, INSERT, UPDATE]\n</code></pre>"},{"location":"engines/mariadb/#assign-roles","title":"Assign Roles","text":"<pre><code>spec:\n  userRef:\n    name: myapp-user\n  mysql:\n    roles:\n      - readonly\n      - developer\n</code></pre>"},{"location":"engines/mariadb/#backup-and-restore","title":"Backup and Restore","text":""},{"location":"engines/mariadb/#mariadb-dump-backup","title":"mariadb-dump Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      secretRef:\n        name: s3-credentials\n  mysql:\n    method: mysqldump  # Uses mariadb-dump internally\n    singleTransaction: true\n    routines: true\n    triggers: true\n</code></pre>"},{"location":"engines/mariadb/#complete-example","title":"Complete Example","text":""},{"location":"engines/mariadb/#application-setup","title":"Application Setup","text":"<pre><code># Admin credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mariadb-admin-credentials\ntype: Opaque\nstringData:\n  username: root\n  password: your-root-password\n---\n# Database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mariadb-primary\nspec:\n  engine: mariadb\n  connection:\n    host: mariadb.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mariadb-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n---\n# Application database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mariadb-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n---\n# Application user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mariadb-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"mysql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp\"\n---\n# User grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mariadb/#galera-cluster","title":"Galera Cluster","text":"<p>When using MariaDB Galera Cluster:</p>"},{"location":"engines/mariadb/#considerations","title":"Considerations","text":"<ol> <li>Use any node for the connection - writes are synchronous</li> <li>Configure <code>wsrep_sync_wait</code> for read-after-write consistency</li> <li>Monitor cluster status before operations</li> </ol>"},{"location":"engines/mariadb/#cluster-aware-configuration","title":"Cluster-Aware Configuration","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mariadb-galera\nspec:\n  engine: mariadb\n  connection:\n    host: mariadb-galera.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mariadb-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 15  # More frequent for cluster\n</code></pre>"},{"location":"engines/mariadb/#best-practices","title":"Best Practices","text":""},{"location":"engines/mariadb/#security","title":"Security","text":"<ol> <li>Use ed25519 authentication for better security</li> <li>Restrict host access to known IP ranges</li> <li>Enable TLS for remote connections</li> <li>Use roles for permission management</li> </ol>"},{"location":"engines/mariadb/#performance","title":"Performance","text":"<ol> <li>Use InnoDB for transactional workloads</li> <li>Configure connection pools</li> <li>Use utf8mb4 consistently</li> </ol>"},{"location":"engines/mariadb/#maintenance","title":"Maintenance","text":"<ol> <li>Use singleTransaction for backups</li> <li>Monitor Galera cluster health</li> <li>Test failover procedures</li> </ol>"},{"location":"engines/mariadb/#troubleshooting","title":"Troubleshooting","text":""},{"location":"engines/mariadb/#connection-issues","title":"Connection Issues","text":"<pre><code># Test connectivity\nkubectl run mariadb-test --rm -it --image=mariadb:10.11 -- \\\n  mariadb -h host -u user -p -e \"SELECT 1\"\n</code></pre>"},{"location":"engines/mariadb/#galera-issues","title":"Galera Issues","text":"<pre><code>-- Check cluster status\nSHOW STATUS LIKE 'wsrep_%';\n\n-- Check if node is synced\nSHOW STATUS LIKE 'wsrep_local_state_comment';\n-- Should return 'Synced'\n</code></pre>"},{"location":"engines/mariadb/#access-denied","title":"Access Denied","text":"<ul> <li>Check user exists: <code>SELECT user, host FROM mysql.user</code></li> <li>Verify host restrictions</li> <li>Check grants: <code>SHOW GRANTS FOR 'user'@'host'</code></li> </ul>"},{"location":"engines/mysql/","title":"MySQL","text":"<p>Complete guide for using DB Provision Operator with MySQL.</p>"},{"location":"engines/mysql/#supported-versions","title":"Supported Versions","text":"<ul> <li>MySQL 5.7.x</li> <li>MySQL 8.0.x</li> <li>MySQL 8.4.x</li> </ul>"},{"location":"engines/mysql/#admin-account-requirements","title":"Admin Account Requirements","text":"<p>The operator requires a privileged database account to manage databases, users, and grants. For production security, create a dedicated least-privilege admin account instead of using <code>root</code>.</p> <p>Required privileges:</p> Privilege Purpose <code>CREATE, DROP, ALTER ON *.*</code> Database operations <code>CREATE USER ON *.*</code> User management <code>GRANT OPTION ON *.*</code> Delegate privileges <code>SELECT ON mysql.*</code> Query user metadata <code>RELOAD ON *.*</code> FLUSH PRIVILEGES <code>CONNECTION_ADMIN ON *.*</code> Kill connections (force-drop) <code>ROLE_ADMIN ON *.*</code> Role management (MySQL 8.0+) <p>Quick setup:</p> <pre><code>CREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password';\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%';\nGRANT GRANT OPTION ON *.* TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.* TO 'dbprovision_admin'@'%';\nGRANT RELOAD, CONNECTION_ADMIN, ROLE_ADMIN ON *.* TO 'dbprovision_admin'@'%';\nFLUSH PRIVILEGES;\n</code></pre> <p>Complete Setup Guide</p> <p>See Admin Account Setup for complete SQL scripts, verification steps, and security recommendations.</p>"},{"location":"engines/mysql/#databaseinstance","title":"DatabaseInstance","text":""},{"location":"engines/mysql/#basic-configuration","title":"Basic Configuration","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin-credentials\n</code></pre>"},{"location":"engines/mysql/#tls-configuration","title":"TLS Configuration","text":"<pre><code>spec:\n  connection:\n    tls:\n      enabled: true\n      secretRef:\n        name: mysql-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"engines/mysql/#database","title":"Database","text":""},{"location":"engines/mysql/#basic-database","title":"Basic Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre>"},{"location":"engines/mysql/#character-sets-and-collations","title":"Character Sets and Collations","text":"Charset Description Recommended Collation <code>utf8mb4</code> Full Unicode (recommended) <code>utf8mb4_unicode_ci</code> <code>utf8</code> Basic Unicode (3 bytes) <code>utf8_general_ci</code> <code>latin1</code> Western European <code>latin1_swedish_ci</code> <p>Use utf8mb4</p> <p>Always use <code>utf8mb4</code> for full Unicode support including emojis. The <code>utf8</code> charset only supports 3-byte characters.</p>"},{"location":"engines/mysql/#databaseuser","title":"DatabaseUser","text":""},{"location":"engines/mysql/#basic-user","title":"Basic User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"engines/mysql/#user-with-host-restrictions","title":"User with Host Restrictions","text":"<pre><code>spec:\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n  mysql:\n    maxUserConnections: 50\n    authPlugin: caching_sha2_password\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.%\"\n      - \"192.168.1.%\"\n      - \"localhost\"\n</code></pre>"},{"location":"engines/mysql/#mysql-user-options","title":"MySQL User Options","text":"Field Type Description <code>maxQueriesPerHour</code> int Query limit (0 = unlimited) <code>maxUpdatesPerHour</code> int Update limit <code>maxConnectionsPerHour</code> int Connection limit per hour <code>maxUserConnections</code> int Max concurrent connections <code>authPlugin</code> string Authentication plugin <code>requireSSL</code> bool Require SSL connections <code>allowedHosts</code> array Allowed connection hosts <code>accountLocked</code> bool Lock the account"},{"location":"engines/mysql/#authentication-plugins","title":"Authentication Plugins","text":"Plugin MySQL Version Description <code>mysql_native_password</code> 5.7+ Traditional password <code>caching_sha2_password</code> 8.0+ Default in 8.0 (recommended) <code>sha256_password</code> 5.7+ SHA-256"},{"location":"engines/mysql/#databaserole-mysql-80","title":"DatabaseRole (MySQL 8.0+)","text":"<p>MySQL 8.0 introduced native role support.</p>"},{"location":"engines/mysql/#create-role","title":"Create Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: mysql-primary\n  roleName: readonly\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT]\n</code></pre>"},{"location":"engines/mysql/#role-hierarchy","title":"Role Hierarchy","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readwrite-role\nspec:\n  instanceRef:\n    name: mysql-primary\n  roleName: readwrite\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mysql/#databasegrant","title":"DatabaseGrant","text":""},{"location":"engines/mysql/#database-level-grant","title":"Database-Level Grant","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mysql/#table-level-grant","title":"Table-Level Grant","text":"<pre><code>spec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: table\n        database: myapp\n        table: users\n        privileges: [SELECT, INSERT, UPDATE]\n      - level: table\n        database: myapp\n        table: audit_log\n        privileges: [SELECT]\n</code></pre>"},{"location":"engines/mysql/#global-grant","title":"Global Grant","text":"<pre><code>spec:\n  userRef:\n    name: admin-user\n  mysql:\n    grants:\n      - level: global\n        privileges: [PROCESS, REPLICATION CLIENT]\n</code></pre>"},{"location":"engines/mysql/#grant-levels","title":"Grant Levels","text":"Level Scope Example <code>global</code> All databases <code>PROCESS</code>, <code>REPLICATION CLIENT</code> <code>database</code> Single database <code>SELECT</code>, <code>INSERT</code> on <code>myapp.*</code> <code>table</code> Single table <code>SELECT</code> on <code>myapp.users</code>"},{"location":"engines/mysql/#common-privileges","title":"Common Privileges","text":"<p>Data Privileges:</p> Privilege Description <code>SELECT</code> Read data <code>INSERT</code> Insert data <code>UPDATE</code> Update data <code>DELETE</code> Delete data <p>Structure Privileges:</p> Privilege Description <code>CREATE</code> Create tables/databases <code>ALTER</code> Modify tables <code>DROP</code> Drop tables/databases <code>INDEX</code> Create/drop indexes <p>Administrative Privileges:</p> Privilege Description <code>PROCESS</code> View processes <code>RELOAD</code> Flush operations <code>REPLICATION CLIENT</code> View replication status <code>REPLICATION SLAVE</code> Read binary logs"},{"location":"engines/mysql/#backup-and-restore","title":"Backup and Restore","text":""},{"location":"engines/mysql/#mysqldump-backup","title":"mysqldump Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      secretRef:\n        name: s3-credentials\n  mysql:\n    method: mysqldump\n    singleTransaction: true\n    routines: true\n    triggers: true\n    events: false\n</code></pre>"},{"location":"engines/mysql/#backup-options","title":"Backup Options","text":"Option Description <code>singleTransaction</code> Consistent snapshot without locking <code>routines</code> Include stored procedures/functions <code>triggers</code> Include triggers <code>events</code> Include scheduled events"},{"location":"engines/mysql/#complete-example","title":"Complete Example","text":""},{"location":"engines/mysql/#application-database-setup","title":"Application Database Setup","text":"<pre><code># Admin credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-admin-credentials\ntype: Opaque\nstringData:\n  username: root\n  password: your-root-password\n---\n# Database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin-credentials\n---\n# Application database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n---\n# Application user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"mysql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp\"\n  mysql:\n    maxUserConnections: 100\n---\n# User grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mysql/#best-practices","title":"Best Practices","text":""},{"location":"engines/mysql/#security","title":"Security","text":"<ol> <li>Use caching_sha2_password for MySQL 8.0+</li> <li>Restrict allowed hosts to known IP ranges</li> <li>Enable SSL for remote connections</li> <li>Use separate users per application</li> <li>Avoid global privileges unless necessary</li> </ol>"},{"location":"engines/mysql/#performance","title":"Performance","text":"<ol> <li>Set appropriate connection limits</li> <li>Use connection pooling</li> <li>Use utf8mb4 consistently</li> </ol>"},{"location":"engines/mysql/#maintenance","title":"Maintenance","text":"<ol> <li>Use singleTransaction for consistent backups</li> <li>Include routines and triggers in backups</li> <li>Test restores regularly</li> </ol>"},{"location":"engines/mysql/#troubleshooting","title":"Troubleshooting","text":""},{"location":"engines/mysql/#connection-issues","title":"Connection Issues","text":"<pre><code># Test connectivity\nkubectl run mysql-test --rm -it --image=mysql:8.0 -- \\\n  mysql -h host -u user -p -e \"SELECT 1\"\n</code></pre>"},{"location":"engines/mysql/#access-denied","title":"Access Denied","text":"<ul> <li>Check user exists: <code>SELECT user, host FROM mysql.user</code></li> <li>Verify host restrictions match client IP</li> <li>Check grants: <code>SHOW GRANTS FOR 'user'@'host'</code></li> </ul>"},{"location":"engines/mysql/#authentication-plugin-mismatch","title":"Authentication Plugin Mismatch","text":"<pre><code>-- Update user authentication plugin\nALTER USER 'user'@'host' IDENTIFIED WITH caching_sha2_password BY 'password';\n</code></pre>"},{"location":"engines/postgresql/","title":"PostgreSQL","text":"<p>Complete guide for using DB Provision Operator with PostgreSQL.</p>"},{"location":"engines/postgresql/#supported-versions","title":"Supported Versions","text":"<ul> <li>PostgreSQL 12.x</li> <li>PostgreSQL 13.x</li> <li>PostgreSQL 14.x</li> <li>PostgreSQL 15.x</li> <li>PostgreSQL 16.x</li> </ul>"},{"location":"engines/postgresql/#admin-account-requirements","title":"Admin Account Requirements","text":"<p>The operator requires a privileged database account to manage databases, users, and roles. For production security, create a dedicated least-privilege admin account instead of using the <code>postgres</code> superuser.</p> <p>Required privileges:</p> Privilege/Attribute Purpose <code>LOGIN</code> Connect to the database <code>CREATEDB</code> Create and drop databases <code>CREATEROLE</code> Create and manage users/roles <code>pg_signal_backend</code> Terminate connections (for force-drop) <code>pg_read_all_data</code> (PG14+) Backup operations <p>Quick setup:</p> <pre><code>CREATE ROLE dbprovision_admin WITH\n    LOGIN CREATEDB CREATEROLE\n    PASSWORD 'your-secure-password';\nGRANT pg_signal_backend TO dbprovision_admin;\nGRANT pg_read_all_data TO dbprovision_admin;  -- PostgreSQL 14+\n</code></pre> <p>Complete Setup Guide</p> <p>See Admin Account Setup for complete SQL scripts, verification steps, and security recommendations.</p>"},{"location":"engines/postgresql/#databaseinstance","title":"DatabaseInstance","text":""},{"location":"engines/postgresql/#basic-configuration","title":"Basic Configuration","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: postgres-admin-credentials\n</code></pre>"},{"location":"engines/postgresql/#ssl-modes","title":"SSL Modes","text":"Mode Description <code>disable</code> No SSL <code>allow</code> Try SSL, allow non-SSL <code>prefer</code> Try SSL first (default) <code>require</code> Require SSL <code>verify-ca</code> Verify server certificate <code>verify-full</code> Verify server certificate and hostname"},{"location":"engines/postgresql/#tls-configuration","title":"TLS Configuration","text":"<pre><code>spec:\n  connection:\n    sslMode: verify-full\n    tls:\n      secretRef:\n        name: postgres-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"engines/postgresql/#database","title":"Database","text":""},{"location":"engines/postgresql/#extensions","title":"Extensions","text":"<p>PostgreSQL supports extensions for additional functionality:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  postgres:\n    encoding: UTF8\n    lcCollate: en_US.UTF-8\n    lcCtype: en_US.UTF-8\n    extensions:\n      - name: uuid-ossp\n        schema: public\n      - name: pgcrypto\n        schema: public\n      - name: pg_stat_statements\n        schema: public\n      - name: hstore\n        schema: extensions\n</code></pre>"},{"location":"engines/postgresql/#common-extensions","title":"Common Extensions","text":"Extension Purpose <code>uuid-ossp</code> UUID generation <code>pgcrypto</code> Cryptographic functions <code>pg_stat_statements</code> Query statistics <code>hstore</code> Key-value storage <code>postgis</code> Geographic objects <code>pg_trgm</code> Trigram similarity <code>btree_gin</code> GIN index for B-tree types"},{"location":"engines/postgresql/#schemas","title":"Schemas","text":"<p>Organize objects with schemas:</p> <pre><code>spec:\n  postgres:\n    schemas:\n      - name: app\n        owner: myapp_admin\n      - name: audit\n        owner: myapp_admin\n      - name: analytics\n        owner: analytics_role\n</code></pre>"},{"location":"engines/postgresql/#databaseuser","title":"DatabaseUser","text":""},{"location":"engines/postgresql/#basic-user","title":"Basic User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"engines/postgresql/#user-with-role-membership","title":"User with Role Membership","text":"<pre><code>spec:\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n  postgres:\n    connectionLimit: 20\n    inherit: true\n    inRoles:\n      - readonly_role\n      - analytics_role\n    configParameters:\n      search_path: \"app,public\"\n      statement_timeout: \"30000\"\n</code></pre>"},{"location":"engines/postgresql/#postgresql-user-options","title":"PostgreSQL User Options","text":"Field Type Description <code>login</code> bool Can login (default: true) <code>inherit</code> bool Inherit role privileges (default: true) <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>connectionLimit</code> int Max connections (-1 = unlimited) <code>inRoles</code> array Roles to inherit from <code>configParameters</code> map Session parameters"},{"location":"engines/postgresql/#databaserole","title":"DatabaseRole","text":""},{"location":"engines/postgresql/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: readonly\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"engines/postgresql/#role-hierarchy","title":"Role Hierarchy","text":"<pre><code># Base reader role\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: base-reader\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: base_reader\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n---\n# Writer role inherits from reader\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: base-writer\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: base_writer\n  postgres:\n    login: false\n    inRoles: [base_reader]\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/postgresql/#databasegrant","title":"DatabaseGrant","text":""},{"location":"engines/postgresql/#direct-table-grants","title":"Direct Table Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    grants:\n      - database: myapp\n        schema: public\n        tables: [users, orders, products]\n        privileges: [SELECT, INSERT, UPDATE]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"engines/postgresql/#default-privileges","title":"Default Privileges","text":"<p>Apply privileges to future objects:</p> <pre><code>spec:\n  userRef:\n    name: myapp-user\n  postgres:\n    defaultPrivileges:\n      - database: myapp\n        schema: public\n        grantedBy: myapp_admin\n        objectType: tables\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n      - database: myapp\n        schema: public\n        grantedBy: myapp_admin\n        objectType: sequences\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"engines/postgresql/#privileges-reference","title":"Privileges Reference","text":"<p>Table Privileges:</p> Privilege Description <code>SELECT</code> Read rows <code>INSERT</code> Insert rows <code>UPDATE</code> Update rows <code>DELETE</code> Delete rows <code>TRUNCATE</code> Truncate table <code>REFERENCES</code> Create foreign keys <code>TRIGGER</code> Create triggers <p>Sequence Privileges:</p> Privilege Description <code>USAGE</code> Use currval/nextval <code>SELECT</code> Use currval <code>UPDATE</code> Use setval <p>Function Privileges:</p> Privilege Description <code>EXECUTE</code> Execute function"},{"location":"engines/postgresql/#backup-and-restore","title":"Backup and Restore","text":""},{"location":"engines/postgresql/#pg_dump-backup","title":"pg_dump Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      secretRef:\n        name: s3-credentials\n  postgres:\n    method: pg_dump\n    format: custom\n    jobs: 4\n    blobs: true\n    noOwner: false\n    noPrivileges: false\n</code></pre>"},{"location":"engines/postgresql/#backup-formats","title":"Backup Formats","text":"Format Description Parallel Restore <code>plain</code> SQL script No <code>custom</code> Compressed archive Yes <code>directory</code> Directory with files Yes <code>tar</code> Tar archive No"},{"location":"engines/postgresql/#restore-options","title":"Restore Options","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: myapp-restore\nspec:\n  backupRef:\n    name: myapp-backup\n  targetDatabaseRef:\n    name: myapp-database-restored\n  postgres:\n    dropExisting: false\n    dataOnly: false\n    schemaOnly: false\n    noOwner: true\n    jobs: 4\n    disableTriggers: true\n    analyze: true\n</code></pre>"},{"location":"engines/postgresql/#best-practices","title":"Best Practices","text":""},{"location":"engines/postgresql/#security","title":"Security","text":"<ol> <li>Use verify-full SSL mode in production</li> <li>Limit connection privileges with <code>connectionLimit</code></li> <li>Use roles for permission grouping</li> <li>Enable row-level security where appropriate</li> <li>Use separate users for different applications</li> </ol>"},{"location":"engines/postgresql/#performance","title":"Performance","text":"<ol> <li>Install pg_stat_statements for query analysis</li> <li>Set appropriate connection limits</li> <li>Use connection pooling (PgBouncer)</li> <li>Configure statement_timeout to prevent runaway queries</li> </ol>"},{"location":"engines/postgresql/#maintenance","title":"Maintenance","text":"<ol> <li>Schedule regular backups with retention</li> <li>Use ANALYZE after restores</li> <li>Monitor with pg_stat_statements</li> <li>Plan for extension upgrades</li> </ol>"},{"location":"engines/postgresql/#troubleshooting","title":"Troubleshooting","text":""},{"location":"engines/postgresql/#connection-issues","title":"Connection Issues","text":"<pre><code># Test connectivity\nkubectl run psql-test --rm -it --image=postgres:15 -- \\\n  psql \"postgresql://user:pass@host:5432/dbname?sslmode=require\"\n</code></pre>"},{"location":"engines/postgresql/#permission-denied","title":"Permission Denied","text":"<ul> <li>Verify role membership with <code>\\du</code> in psql</li> <li>Check grants with <code>\\dp tablename</code></li> <li>Ensure schema USAGE granted</li> </ul>"},{"location":"engines/postgresql/#extension-installation-failed","title":"Extension Installation Failed","text":"<ul> <li>Check PostgreSQL has the extension installed</li> <li>Verify user has CREATE EXTENSION privilege</li> <li>Some extensions require superuser</li> </ul>"},{"location":"examples/","title":"Examples","text":"<p>Ready-to-use examples for common scenarios.</p>"},{"location":"examples/#quick-links","title":"Quick Links","text":"<ul> <li>PostgreSQL Examples - Complete PostgreSQL setup</li> <li>MySQL Examples - Complete MySQL setup</li> <li>Advanced Examples - Cross-namespace, TLS, cloud backups</li> </ul>"},{"location":"examples/#sample-manifests","title":"Sample Manifests","text":"<p>All sample manifests are available in the repository:</p> <pre><code># Clone the repository\ngit clone https://github.com/panteparak/db-provision-operator.git\n\n# Navigate to examples\ncd db-provision-operator/DOCS/examples/\n</code></pre>"},{"location":"examples/#directory-structure","title":"Directory Structure","text":"<pre><code>DOCS/examples/\n\u251c\u2500\u2500 postgresql/\n\u2502   \u251c\u2500\u2500 01-credentials.yaml\n\u2502   \u251c\u2500\u2500 02-instance.yaml\n\u2502   \u251c\u2500\u2500 03-database.yaml\n\u2502   \u251c\u2500\u2500 04-user.yaml\n\u2502   \u251c\u2500\u2500 05-role.yaml\n\u2502   \u251c\u2500\u2500 06-grant.yaml\n\u2502   \u2514\u2500\u2500 07-backup.yaml\n\u251c\u2500\u2500 mysql/\n\u2502   \u251c\u2500\u2500 01-credentials.yaml\n\u2502   \u251c\u2500\u2500 02-instance.yaml\n\u2502   \u251c\u2500\u2500 03-database.yaml\n\u2502   \u251c\u2500\u2500 04-user.yaml\n\u2502   \u2514\u2500\u2500 05-grant.yaml\n\u251c\u2500\u2500 mariadb/\n\u2502   \u251c\u2500\u2500 01-credentials.yaml\n\u2502   \u251c\u2500\u2500 02-instance.yaml\n\u2502   \u2514\u2500\u2500 03-database.yaml\n\u2514\u2500\u2500 advanced/\n    \u251c\u2500\u2500 cross-namespace.yaml\n    \u251c\u2500\u2500 tls-connection.yaml\n    \u2514\u2500\u2500 backup-to-s3.yaml\n</code></pre>"},{"location":"examples/#common-patterns","title":"Common Patterns","text":""},{"location":"examples/#minimal-setup","title":"Minimal Setup","text":"<p>The simplest setup requires:</p> <ol> <li>Admin credentials Secret</li> <li>DatabaseInstance</li> <li>Database</li> <li>DatabaseUser</li> </ol> <pre><code># 1. Credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: db-admin\ntype: Opaque\nstringData:\n  username: admin\n  password: secretpassword\n---\n# 2. Instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: my-db\nspec:\n  engine: postgres\n  connection:\n    host: postgres.default.svc\n    port: 5432\n    secretRef:\n      name: db-admin\n---\n# 3. Database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp\nspec:\n  instanceRef:\n    name: my-db\n---\n# 4. User\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: my-db\n  username: myapp\n  passwordSecret:\n    generate: true\n    secretName: myapp-credentials\n</code></pre>"},{"location":"examples/#production-setup","title":"Production Setup","text":"<p>Production deployments should include:</p> <ol> <li>TLS connections</li> <li>Role-based permissions</li> <li>Connection limits</li> <li>Backup schedules</li> <li>Deletion protection</li> </ol> <p>See Advanced Examples for production patterns.</p>"},{"location":"examples/#using-examples","title":"Using Examples","text":""},{"location":"examples/#apply-all-postgresql-examples","title":"Apply All PostgreSQL Examples","text":"<pre><code># Apply in order\nkubectl apply -f DOCS/examples/postgresql/01-credentials.yaml\nkubectl apply -f DOCS/examples/postgresql/02-instance.yaml\nkubectl apply -f DOCS/examples/postgresql/03-database.yaml\nkubectl apply -f DOCS/examples/postgresql/04-user.yaml\nkubectl apply -f DOCS/examples/postgresql/05-role.yaml\nkubectl apply -f DOCS/examples/postgresql/06-grant.yaml\n</code></pre>"},{"location":"examples/#verify-resources","title":"Verify Resources","text":"<pre><code># Check all resources\nkubectl get databaseinstances,databases,databaseusers,databaseroles,databasegrants\n\n# Check specific resource\nkubectl describe databaseinstance postgres-primary\n\n# Get generated credentials\nkubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d\n</code></pre>"},{"location":"examples/#clean-up","title":"Clean Up","text":"<pre><code># Delete in reverse order\nkubectl delete -f DOCS/examples/postgresql/06-grant.yaml\nkubectl delete -f DOCS/examples/postgresql/05-role.yaml\nkubectl delete -f DOCS/examples/postgresql/04-user.yaml\nkubectl delete -f DOCS/examples/postgresql/03-database.yaml\nkubectl delete -f DOCS/examples/postgresql/02-instance.yaml\nkubectl delete -f DOCS/examples/postgresql/01-credentials.yaml\n</code></pre>"},{"location":"examples/#next-steps","title":"Next Steps","text":"<ul> <li>PostgreSQL Examples - Detailed PostgreSQL setup</li> <li>MySQL Examples - Detailed MySQL setup</li> <li>Advanced Examples - Production patterns</li> </ul>"},{"location":"examples/advanced/","title":"Advanced Examples","text":"<p>Production patterns and advanced configurations.</p>"},{"location":"examples/advanced/#cross-namespace-access","title":"Cross-Namespace Access","text":""},{"location":"examples/advanced/#scenario","title":"Scenario","text":"<p>Database instance in <code>database</code> namespace, applications in <code>app-team-a</code> and <code>app-team-b</code> namespaces.</p>"},{"location":"examples/advanced/#database-namespace-setup","title":"Database Namespace Setup","text":"<pre><code># database/postgres-instance.yaml\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: shared-postgres\n  namespace: database\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: postgres-admin-credentials\n</code></pre>"},{"location":"examples/advanced/#application-namespace-resources","title":"Application Namespace Resources","text":"<pre><code># app-team-a/database.yaml\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: team-a-db\n  namespace: app-team-a\nspec:\n  instanceRef:\n    name: shared-postgres\n    namespace: database  # Cross-namespace reference\n  name: team_a\n  postgres:\n    encoding: UTF8\n---\n# app-team-a/user.yaml\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: team-a-user\n  namespace: app-team-a\nspec:\n  instanceRef:\n    name: shared-postgres\n    namespace: database\n  username: team_a_user\n  passwordSecret:\n    generate: true\n    secretName: team-a-db-credentials\n</code></pre>"},{"location":"examples/advanced/#rbac-configuration","title":"RBAC Configuration","text":"<pre><code># Allow app-team-a to reference database namespace resources\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: database-reader\n  namespace: database\nrules:\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"databaseinstances\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: app-team-a-database-reader\n  namespace: database\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: database-reader\nsubjects:\n  - kind: ServiceAccount\n    name: default\n    namespace: app-team-a\n</code></pre>"},{"location":"examples/advanced/#tls-connections","title":"TLS Connections","text":""},{"location":"examples/advanced/#postgresql-with-tls","title":"PostgreSQL with TLS","text":"<pre><code># TLS certificates\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-tls\ntype: kubernetes.io/tls\ndata:\n  ca.crt: &lt;base64-encoded-ca-cert&gt;\n  tls.crt: &lt;base64-encoded-client-cert&gt;\n  tls.key: &lt;base64-encoded-client-key&gt;\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-tls\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: verify-full\n    secretRef:\n      name: postgres-admin-credentials\n    tls:\n      secretRef:\n        name: postgres-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"examples/advanced/#mysql-with-tls","title":"MySQL with TLS","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-tls\ntype: kubernetes.io/tls\ndata:\n  ca.crt: &lt;base64-encoded-ca-cert&gt;\n  tls.crt: &lt;base64-encoded-client-cert&gt;\n  tls.key: &lt;base64-encoded-client-key&gt;\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-tls\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin-credentials\n    tls:\n      enabled: true\n      secretRef:\n        name: mysql-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"examples/advanced/#cloud-backups","title":"Cloud Backups","text":""},{"location":"examples/advanced/#aws-s3","title":"AWS S3","text":"<pre><code># S3 credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: s3-credentials\ntype: Opaque\nstringData:\n  AWS_ACCESS_KEY_ID: AKIAIOSFODNN7EXAMPLE\n  AWS_SECRET_ACCESS_KEY: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: production-backup\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"0 */6 * * *\"  # Every 6 hours\n  timezone: \"UTC\"\n  retention:\n    keepLast: 10\n    keepDaily: 7\n    keepWeekly: 4\n    keepMonthly: 6\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-company-db-backups\n        region: us-east-1\n        prefix: production/postgres\n        secretRef:\n          name: s3-credentials\n    compression:\n      enabled: true\n      algorithm: zstd\n    encryption:\n      enabled: true\n      algorithm: aes-256-gcm\n      secretRef:\n        name: backup-encryption-key\n</code></pre>"},{"location":"examples/advanced/#google-cloud-storage","title":"Google Cloud Storage","text":"<pre><code># GCS credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: gcs-credentials\ntype: Opaque\nstringData:\n  credentials.json: |\n    {\n      \"type\": \"service_account\",\n      \"project_id\": \"my-project\",\n      ...\n    }\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: production-backup-gcs\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"0 2 * * *\"\n  retention:\n    keepLast: 7\n  backupTemplate:\n    storage:\n      type: gcs\n      gcs:\n        bucket: my-company-db-backups\n        prefix: production/postgres\n        secretRef:\n          name: gcs-credentials\n          key: credentials.json\n    compression:\n      enabled: true\n</code></pre>"},{"location":"examples/advanced/#azure-blob-storage","title":"Azure Blob Storage","text":"<pre><code># Azure credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: azure-credentials\ntype: Opaque\nstringData:\n  AZURE_STORAGE_ACCOUNT: mystorageaccount\n  AZURE_STORAGE_KEY: &lt;storage-account-key&gt;\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: production-backup-azure\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"0 2 * * *\"\n  retention:\n    keepLast: 7\n  backupTemplate:\n    storage:\n      type: azure\n      azure:\n        container: db-backups\n        prefix: production/postgres\n        secretRef:\n          name: azure-credentials\n          keys:\n            accountName: AZURE_STORAGE_ACCOUNT\n            accountKey: AZURE_STORAGE_KEY\n    compression:\n      enabled: true\n</code></pre>"},{"location":"examples/advanced/#multi-tenant-setup","title":"Multi-Tenant Setup","text":""},{"location":"examples/advanced/#tenant-isolation-pattern","title":"Tenant Isolation Pattern","text":"<pre><code># Shared database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: multi-tenant-postgres\n  namespace: database\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-admin\n---\n# Per-tenant database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: tenant-acme\n  namespace: database\nspec:\n  instanceRef:\n    name: multi-tenant-postgres\n  name: tenant_acme\n  deletionProtection: true\n  postgres:\n    encoding: UTF8\n    schemas:\n      - name: app\n---\n# Per-tenant user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: tenant-acme-user\n  namespace: database\nspec:\n  instanceRef:\n    name: multi-tenant-postgres\n  username: tenant_acme_user\n  passwordSecret:\n    generate: true\n    secretName: tenant-acme-credentials\n  postgres:\n    connectionLimit: 20\n---\n# Per-tenant grants (isolated to their database)\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: tenant-acme-grants\n  namespace: database\nspec:\n  userRef:\n    name: tenant-acme-user\n  postgres:\n    grants:\n      - database: tenant_acme\n        schema: app\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n      - database: tenant_acme\n        schema: app\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT, UPDATE]\n</code></pre>"},{"location":"examples/advanced/#high-availability","title":"High Availability","text":""},{"location":"examples/advanced/#read-replica-configuration","title":"Read Replica Configuration","text":"<pre><code># Primary instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres-primary.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-primary-credentials\n---\n# Read replica instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-replica\nspec:\n  engine: postgres\n  connection:\n    host: postgres-replica.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-replica-credentials\n---\n# Read-only user on replica\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: reporting-user\nspec:\n  instanceRef:\n    name: postgres-replica  # Points to replica\n  username: reporting\n  passwordSecret:\n    generate: true\n    secretName: reporting-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp?sslmode=require\"\n</code></pre>"},{"location":"examples/advanced/#disaster-recovery","title":"Disaster Recovery","text":""},{"location":"examples/advanced/#point-in-time-recovery-setup","title":"Point-in-Time Recovery Setup","text":"<pre><code># Frequent backups for minimal data loss\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: pitr-backup\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"*/15 * * * *\"  # Every 15 minutes\n  retention:\n    keepLast: 96  # 24 hours of 15-minute backups\n    keepDaily: 7\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: pitr-backups\n        prefix: production\n        secretRef:\n          name: s3-credentials\n    postgres:\n      format: custom\n      jobs: 4\n---\n# Daily full backups\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: daily-full-backup\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"0 0 * * *\"  # Midnight\n  retention:\n    keepLast: 30\n    keepMonthly: 12\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: full-backups\n        prefix: production\n        secretRef:\n          name: s3-credentials\n    compression:\n      enabled: true\n      algorithm: zstd\n    encryption:\n      enabled: true\n      secretRef:\n        name: backup-encryption-key\n</code></pre>"},{"location":"examples/advanced/#migration-patterns","title":"Migration Patterns","text":""},{"location":"examples/advanced/#database-migration-from-external-source","title":"Database Migration from External Source","text":"<pre><code># Step 1: Create instance pointing to external database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: external-postgres\nspec:\n  engine: postgres\n  connection:\n    host: external-db.example.com\n    port: 5432\n    secretRef:\n      name: external-db-credentials\n---\n# Step 2: Backup from external\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: migration-backup\nspec:\n  databaseRef:\n    name: external-database  # References external\n  storage:\n    type: s3\n    s3:\n      bucket: migration-backups\n      secretRef:\n        name: s3-credentials\n---\n# Step 3: Restore to internal\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: migration-restore\nspec:\n  backupRef:\n    name: migration-backup\n  targetDatabaseRef:\n    name: internal-database  # New internal database\n  createTarget: true\n  postgres:\n    noOwner: true\n    analyze: true\n</code></pre>"},{"location":"examples/advanced/#monitoring-integration","title":"Monitoring Integration","text":""},{"location":"examples/advanced/#prometheus-servicemonitor","title":"Prometheus ServiceMonitor","text":"<pre><code># Enable metrics in operator deployment\n# Then create ServiceMonitor\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: db-provision-operator\n  labels:\n    app: db-provision-operator\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: db-provision-operator\n  endpoints:\n    - port: metrics\n      interval: 30s\n</code></pre>"},{"location":"examples/advanced/#custom-metrics-user","title":"Custom Metrics User","text":"<pre><code># User for Prometheus postgres_exporter\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: prometheus-exporter\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: prometheus\n  passwordSecret:\n    generate: true\n    secretName: prometheus-exporter-credentials\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: prometheus-grants\nspec:\n  userRef:\n    name: prometheus-exporter\n  postgres:\n    grants:\n      - database: postgres\n        schema: pg_catalog\n        functions: [pg_stat_statements]\n        privileges: [EXECUTE]\n</code></pre>"},{"location":"examples/mysql/","title":"MySQL Examples","text":"<p>Complete examples for MySQL database provisioning.</p>"},{"location":"examples/mysql/#basic-setup","title":"Basic Setup","text":""},{"location":"examples/mysql/#step-1-admin-credentials","title":"Step 1: Admin Credentials","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-admin-credentials\ntype: Opaque\nstringData:\n  username: root\n  password: your-admin-password\n</code></pre>"},{"location":"examples/mysql/#step-2-database-instance","title":"Step 2: Database Instance","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n    timeoutSeconds: 5\n</code></pre>"},{"location":"examples/mysql/#step-3-database","title":"Step 3: Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  deletionPolicy: Retain\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre>"},{"location":"examples/mysql/#step-4-application-user","title":"Step 4: Application User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n    secretTemplate:\n      labels:\n        app: myapp\n      data:\n        DATABASE_URL: \"mysql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp\"\n        JDBC_URL: \"jdbc:mysql://{{ .Host }}:{{ .Port }}/myapp?user={{ .Username }}&amp;password={{ .Password }}\"\n</code></pre>"},{"location":"examples/mysql/#step-5-user-grants","title":"Step 5: User Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"examples/mysql/#role-based-access-mysql-80","title":"Role-Based Access (MySQL 8.0+)","text":""},{"location":"examples/mysql/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readonly\nspec:\n  instanceRef:\n    name: mysql-primary\n  roleName: myapp_readonly\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT]\n</code></pre>"},{"location":"examples/mysql/#read-write-role","title":"Read-Write Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readwrite\nspec:\n  instanceRef:\n    name: mysql-primary\n  roleName: myapp_readwrite\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"examples/mysql/#assign-role-to-user","title":"Assign Role to User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-roles\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    roles:\n      - myapp_readwrite\n</code></pre>"},{"location":"examples/mysql/#host-restricted-users","title":"Host-Restricted Users","text":""},{"location":"examples/mysql/#application-user-with-host-restrictions","title":"Application User with Host Restrictions","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: app-user-restricted\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: app_user\n  passwordSecret:\n    generate: true\n    secretName: app-user-credentials\n  mysql:\n    maxUserConnections: 100\n    authPlugin: caching_sha2_password\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.%\"      # Internal network\n      - \"192.168.1.%\"   # Secondary network\n</code></pre>"},{"location":"examples/mysql/#admin-user-for-specific-host","title":"Admin User for Specific Host","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: admin-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: admin\n  passwordSecret:\n    generate: true\n    length: 48\n    secretName: admin-credentials\n  mysql:\n    authPlugin: caching_sha2_password\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.1\"  # Only from specific admin host\n</code></pre>"},{"location":"examples/mysql/#table-level-permissions","title":"Table-Level Permissions","text":""},{"location":"examples/mysql/#granular-table-access","title":"Granular Table Access","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: reporting-user-grants\nspec:\n  userRef:\n    name: reporting-user\n  mysql:\n    grants:\n      # Full read access to specific tables\n      - level: table\n        database: myapp\n        table: orders\n        privileges: [SELECT]\n      - level: table\n        database: myapp\n        table: customers\n        privileges: [SELECT]\n      - level: table\n        database: myapp\n        table: products\n        privileges: [SELECT]\n      # No access to sensitive tables (users, payments, etc.)\n</code></pre>"},{"location":"examples/mysql/#service-account-with-limited-write","title":"Service Account with Limited Write","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: order-service-grants\nspec:\n  userRef:\n    name: order-service\n  mysql:\n    grants:\n      # Read from reference tables\n      - level: table\n        database: myapp\n        table: products\n        privileges: [SELECT]\n      - level: table\n        database: myapp\n        table: customers\n        privileges: [SELECT]\n      # Full access to orders\n      - level: table\n        database: myapp\n        table: orders\n        privileges: [SELECT, INSERT, UPDATE]\n      # Insert only to audit\n      - level: table\n        database: myapp\n        table: order_audit\n        privileges: [INSERT]\n</code></pre>"},{"location":"examples/mysql/#backup-configuration","title":"Backup Configuration","text":""},{"location":"examples/mysql/#one-time-backup","title":"One-Time Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-manual-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-database-backups\n      region: us-east-1\n      prefix: mysql/myapp\n      secretRef:\n        name: s3-backup-credentials\n  compression:\n    enabled: true\n    algorithm: gzip\n  mysql:\n    method: mysqldump\n    singleTransaction: true\n    routines: true\n    triggers: true\n  ttl: \"720h\"\n</code></pre>"},{"location":"examples/mysql/#scheduled-backups","title":"Scheduled Backups","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: myapp-daily-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  schedule: \"0 3 * * *\"  # Daily at 3 AM\n  timezone: \"UTC\"\n  retention:\n    keepLast: 7\n    keepDaily: 7\n    keepWeekly: 4\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-database-backups\n        region: us-east-1\n        prefix: mysql/myapp/scheduled\n        secretRef:\n          name: s3-backup-credentials\n    compression:\n      enabled: true\n      algorithm: gzip\n    mysql:\n      method: mysqldump\n      singleTransaction: true\n      routines: true\n      triggers: true\n</code></pre>"},{"location":"examples/mysql/#complete-application-stack","title":"Complete Application Stack","text":""},{"location":"examples/mysql/#full-example","title":"Full Example","text":"<pre><code>---\n# Admin credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-admin\ntype: Opaque\nstringData:\n  username: root\n  password: super-secret-admin-password\n---\n# Database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n---\n# Application database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-db\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  deletionPolicy: Retain\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n---\n# Application user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"mysql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp\"\n  mysql:\n    maxUserConnections: 100\n    authPlugin: caching_sha2_password\n    allowedHosts:\n      - \"10.0.0.%\"\n---\n# User grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grant\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n---\n# Read-only user for reporting\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: reporting-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: reporting\n  passwordSecret:\n    generate: true\n    secretName: reporting-credentials\n  mysql:\n    maxUserConnections: 10\n---\n# Reporting grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: reporting-grant\nspec:\n  userRef:\n    name: reporting-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT]\n</code></pre>"},{"location":"examples/mysql/#verify-setup","title":"Verify Setup","text":"<pre><code># Check instance status\nkubectl get databaseinstance mysql-primary\n\n# Check all resources\nkubectl get databases,databaseusers,databasegrants\n\n# Get connection info\nkubectl get secret myapp-credentials -o jsonpath='{.data.DATABASE_URL}' | base64 -d\n\n# Test connection\nkubectl run mysql-test --rm -it --image=mysql:8.0 -- \\\n  mysql -h mysql.database.svc.cluster.local -u myapp_user -p myapp\n</code></pre>"},{"location":"examples/mysql/#mariadb-compatibility","title":"MariaDB Compatibility","text":"<p>These examples work with MariaDB by changing the engine:</p> <pre><code>spec:\n  engine: mariadb  # Instead of mysql\n</code></pre> <p>All MySQL configuration options are compatible with MariaDB.</p>"},{"location":"examples/postgresql/","title":"PostgreSQL Examples","text":"<p>Complete examples for PostgreSQL database provisioning.</p>"},{"location":"examples/postgresql/#basic-setup","title":"Basic Setup","text":""},{"location":"examples/postgresql/#step-1-admin-credentials","title":"Step 1: Admin Credentials","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin-credentials\ntype: Opaque\nstringData:\n  username: postgres\n  password: your-admin-password\n</code></pre>"},{"location":"examples/postgresql/#step-2-database-instance","title":"Step 2: Database Instance","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: prefer\n    secretRef:\n      name: postgres-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n    timeoutSeconds: 5\n</code></pre>"},{"location":"examples/postgresql/#step-3-database","title":"Step 3: Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  deletionPolicy: Retain\n  postgres:\n    encoding: UTF8\n    extensions:\n      - name: uuid-ossp\n        schema: public\n      - name: pgcrypto\n        schema: public\n</code></pre>"},{"location":"examples/postgresql/#step-4-application-user","title":"Step 4: Application User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n    secretTemplate:\n      labels:\n        app: myapp\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp?sslmode=prefer\"\n</code></pre>"},{"location":"examples/postgresql/#role-based-access","title":"Role-Based Access","text":""},{"location":"examples/postgresql/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readonly\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: myapp_readonly\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"examples/postgresql/#read-write-role","title":"Read-Write Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readwrite\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: myapp_readwrite\n  postgres:\n    login: false\n    inRoles: [myapp_readonly]\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [UPDATE]\n</code></pre>"},{"location":"examples/postgresql/#assign-role-to-user","title":"Assign Role to User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-roles\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    roles:\n      - myapp_readwrite\n</code></pre>"},{"location":"examples/postgresql/#multi-schema-setup","title":"Multi-Schema Setup","text":""},{"location":"examples/postgresql/#database-with-multiple-schemas","title":"Database with Multiple Schemas","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: enterprise-app\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: enterprise\n  postgres:\n    encoding: UTF8\n    extensions:\n      - name: uuid-ossp\n      - name: pg_stat_statements\n    schemas:\n      - name: core\n        owner: enterprise_admin\n      - name: billing\n        owner: enterprise_admin\n      - name: analytics\n        owner: analytics_admin\n      - name: audit\n        owner: enterprise_admin\n</code></pre>"},{"location":"examples/postgresql/#schema-specific-grants","title":"Schema-Specific Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: billing-service-grants\nspec:\n  userRef:\n    name: billing-service\n  postgres:\n    grants:\n      # Full access to billing schema\n      - database: enterprise\n        schema: billing\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n      # Read-only on core schema\n      - database: enterprise\n        schema: core\n        tables: [\"*\"]\n        privileges: [SELECT]\n      # Write to audit\n      - database: enterprise\n        schema: audit\n        tables: [billing_audit]\n        privileges: [INSERT]\n</code></pre>"},{"location":"examples/postgresql/#backup-configuration","title":"Backup Configuration","text":""},{"location":"examples/postgresql/#one-time-backup-to-s3","title":"One-Time Backup to S3","text":"<pre><code># S3 credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: s3-backup-credentials\ntype: Opaque\nstringData:\n  AWS_ACCESS_KEY_ID: your-access-key\n  AWS_SECRET_ACCESS_KEY: your-secret-key\n---\n# Backup\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-manual-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-database-backups\n      region: us-east-1\n      prefix: postgres/myapp\n      secretRef:\n        name: s3-backup-credentials\n  compression:\n    enabled: true\n    algorithm: gzip\n  postgres:\n    format: custom\n    jobs: 4\n  ttl: \"720h\"  # 30 days\n</code></pre>"},{"location":"examples/postgresql/#scheduled-backups","title":"Scheduled Backups","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: myapp-daily-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  schedule: \"0 2 * * *\"  # Daily at 2 AM\n  timezone: \"UTC\"\n  retention:\n    keepLast: 7\n    keepDaily: 7\n    keepWeekly: 4\n    keepMonthly: 3\n  concurrencyPolicy: Forbid\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-database-backups\n        region: us-east-1\n        prefix: postgres/myapp/scheduled\n        secretRef:\n          name: s3-backup-credentials\n    compression:\n      enabled: true\n      algorithm: gzip\n    postgres:\n      format: custom\n      jobs: 4\n</code></pre>"},{"location":"examples/postgresql/#restore-from-backup","title":"Restore from Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: myapp-restore\nspec:\n  backupRef:\n    name: myapp-manual-backup\n  targetDatabaseRef:\n    name: myapp-database-restored\n  createTarget: true\n  postgres:\n    noOwner: true\n    jobs: 4\n    analyze: true\n</code></pre>"},{"location":"examples/postgresql/#complete-application-stack","title":"Complete Application Stack","text":""},{"location":"examples/postgresql/#full-example","title":"Full Example","text":"<pre><code>---\n# Admin credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin\ntype: Opaque\nstringData:\n  username: postgres\n  password: super-secret-admin-password\n---\n# Database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: postgres-admin\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n---\n# Application database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-db\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  deletionPolicy: Retain\n  deletionProtection: true\n  postgres:\n    encoding: UTF8\n    extensions:\n      - name: uuid-ossp\n      - name: pgcrypto\n    schemas:\n      - name: app\n---\n# Read-only role\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readonly\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: myapp_readonly\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: app\n        tables: [\"*\"]\n        privileges: [SELECT]\n---\n# Read-write role\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readwrite\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: myapp_readwrite\n  postgres:\n    login: false\n    inRoles: [myapp_readonly]\n    grants:\n      - database: myapp\n        schema: app\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n---\n# Application user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp?sslmode=require\"\n  postgres:\n    connectionLimit: 50\n---\n# Assign role to user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grant\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    roles:\n      - myapp_readwrite\n    defaultPrivileges:\n      - database: myapp\n        schema: app\n        grantedBy: postgres\n        objectType: tables\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"examples/postgresql/#verify-setup","title":"Verify Setup","text":"<pre><code># Check instance status\nkubectl get databaseinstance postgres-primary\n\n# Check all resources\nkubectl get databases,databaseusers,databaseroles,databasegrants\n\n# Get connection string\nkubectl get secret myapp-credentials -o jsonpath='{.data.DATABASE_URL}' | base64 -d\n\n# Test connection\nkubectl run psql --rm -it --image=postgres:15 -- \\\n  psql \"$(kubectl get secret myapp-credentials -o jsonpath='{.data.DATABASE_URL}' | base64 -d)\"\n</code></pre>"},{"location":"getting-started/","title":"Getting Started","text":"<p>Welcome to DB Provision Operator! This section will help you get up and running quickly.</p>"},{"location":"getting-started/#what-is-db-provision-operator","title":"What is DB Provision Operator?","text":"<p>DB Provision Operator is a Kubernetes operator that enables declarative management of database resources. It supports:</p> <ul> <li>PostgreSQL - Full support including extensions, schemas, and roles</li> <li>MySQL - Including authentication plugins and charset configuration</li> <li>MariaDB - MySQL-compatible with MariaDB-specific features</li> </ul>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before installing DB Provision Operator, ensure you have:</p> <ul> <li>Kubernetes cluster version 1.26 or higher</li> <li>kubectl configured to communicate with your cluster</li> <li>Helm 3.x (if using Helm installation)</li> <li>Database server accessible from the cluster (PostgreSQL, MySQL, or MariaDB)</li> </ul>"},{"location":"getting-started/#installation-methods","title":"Installation Methods","text":"<p>Choose your preferred installation method:</p> Method Best For Customization Helm Production deployments Full control via values.yaml Kustomize GitOps workflows Patch-based customization"},{"location":"getting-started/#quick-links","title":"Quick Links","text":"<ul> <li>Installation Guide - Detailed installation instructions</li> <li>Quick Start Tutorial - Create your first database in 5 minutes</li> <li>Examples - Ready-to-use YAML examples</li> </ul>"},{"location":"getting-started/#architecture-overview","title":"Architecture Overview","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                   Kubernetes Cluster                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502              DB Provision Operator                 \u2502  \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u2502  \u2502\n\u2502  \u2502  \u2502Instance \u2502 \u2502Database \u2502 \u2502  User   \u2502 \u2502 Backup  \u2502 \u2502  \u2502\n\u2502  \u2502  \u2502Controller\u2502 \u2502Controller\u2502 \u2502Controller\u2502 \u2502Controller\u2502 \u2502  \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2518 \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502          \u2502           \u2502           \u2502           \u2502          \u2502\n\u2502          \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                            \u2502                             \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502                  Database Adapters                 \u2502  \u2502\n\u2502  \u2502   PostgreSQL        MySQL         MariaDB          \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                             \u2502\n                             \u25bc\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502    External Databases    \u2502\n              \u2502  PostgreSQL \u2502 MySQL \u2502 ...\u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ol> <li>Install the operator in your cluster</li> <li>Follow the quick start to create your first database</li> <li>Explore the user guide for advanced features</li> </ol>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>This guide covers all installation methods for DB Provision Operator.</p>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes 1.26+</li> <li>kubectl configured</li> <li>Helm 3.x (for Helm installation)</li> <li>cluster-admin privileges (for CRD installation)</li> </ul>"},{"location":"getting-started/installation/#helm-installation","title":"Helm Installation","text":"<p>Helm is the recommended installation method for production deployments.</p>"},{"location":"getting-started/installation/#add-the-helm-repository","title":"Add the Helm Repository","text":"<pre><code>helm repo add db-provision https://panteparak.github.io/db-provision-operator/charts\nhelm repo update\n</code></pre>"},{"location":"getting-started/installation/#install-with-default-values","title":"Install with Default Values","text":"<pre><code>helm install db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system \\\n  --create-namespace\n</code></pre>"},{"location":"getting-started/installation/#install-with-custom-values","title":"Install with Custom Values","text":"<p>Create a <code>values.yaml</code> file:</p> <pre><code># values.yaml\nreplicaCount: 2\n\nresources:\n  limits:\n    cpu: 500m\n    memory: 256Mi\n  requests:\n    cpu: 100m\n    memory: 128Mi\n\nmetrics:\n  enabled: true\n\nserviceMonitor:\n  enabled: true\n</code></pre> <p>Then install:</p> <pre><code>helm install db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system \\\n  --create-namespace \\\n  -f values.yaml\n</code></pre>"},{"location":"getting-started/installation/#upgrade-an-existing-installation","title":"Upgrade an Existing Installation","text":"<pre><code>helm repo update\nhelm upgrade db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system\n</code></pre>"},{"location":"getting-started/installation/#uninstall","title":"Uninstall","text":"<pre><code>helm uninstall db-provision-operator --namespace db-provision-operator-system\n</code></pre> <p>CRDs are not removed</p> <p>Helm does not remove CRDs on uninstall to prevent data loss. To remove CRDs manually: <pre><code>kubectl delete crds -l app.kubernetes.io/name=db-provision-operator\n</code></pre></p>"},{"location":"getting-started/installation/#kustomize-installation","title":"Kustomize Installation","text":"<p>Kustomize is ideal for GitOps workflows.</p>"},{"location":"getting-started/installation/#install-latest-release","title":"Install Latest Release","text":"<pre><code>kubectl apply -f https://github.com/panteparak/db-provision-operator/releases/latest/download/install.yaml\n</code></pre>"},{"location":"getting-started/installation/#install-specific-version","title":"Install Specific Version","text":"<pre><code>VERSION=v0.1.0\nkubectl apply -f https://github.com/panteparak/db-provision-operator/releases/download/${VERSION}/db-provision-operator-${VERSION}.yaml\n</code></pre>"},{"location":"getting-started/installation/#customize-with-kustomize-overlay","title":"Customize with Kustomize Overlay","text":"<p>Create a <code>kustomization.yaml</code>:</p> <pre><code>apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nresources:\n  - https://github.com/panteparak/db-provision-operator/config/default?ref=main\n\nnamespace: db-provision-operator-system\n\npatches:\n  - patch: |-\n      - op: replace\n        path: /spec/template/spec/containers/0/resources/limits/memory\n        value: 256Mi\n    target:\n      kind: Deployment\n      name: db-provision-operator-controller-manager\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -k .\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":""},{"location":"getting-started/installation/#check-the-deployment","title":"Check the Deployment","text":"<pre><code>kubectl get pods -n db-provision-operator-system\n</code></pre> <p>Expected output:</p> <pre><code>NAME                                                     READY   STATUS    RESTARTS   AGE\ndb-provision-operator-controller-manager-xxxxx-xxxxx     1/1     Running   0          1m\n</code></pre>"},{"location":"getting-started/installation/#check-crds","title":"Check CRDs","text":"<pre><code>kubectl get crds | grep dbops\n</code></pre> <p>Expected output:</p> <pre><code>databasebackups.dbops.dbprovision.io          2024-01-01T00:00:00Z\ndatabasebackupschedules.dbops.dbprovision.io  2024-01-01T00:00:00Z\ndatabasegrants.dbops.dbprovision.io           2024-01-01T00:00:00Z\ndatabaseinstances.dbops.dbprovision.io        2024-01-01T00:00:00Z\ndatabaserestores.dbops.dbprovision.io         2024-01-01T00:00:00Z\ndatabaseroles.dbops.dbprovision.io            2024-01-01T00:00:00Z\ndatabases.dbops.dbprovision.io                2024-01-01T00:00:00Z\ndatabaseusers.dbops.dbprovision.io            2024-01-01T00:00:00Z\n</code></pre>"},{"location":"getting-started/installation/#check-logs","title":"Check Logs","text":"<pre><code>kubectl logs -n db-provision-operator-system deployment/db-provision-operator-controller-manager\n</code></pre>"},{"location":"getting-started/installation/#configuration-options","title":"Configuration Options","text":""},{"location":"getting-started/installation/#helm-values-reference","title":"Helm Values Reference","text":"Parameter Description Default <code>replicaCount</code> Number of operator replicas <code>1</code> <code>image.repository</code> Container image repository <code>ghcr.io/panteparak/db-provision-operator</code> <code>image.tag</code> Container image tag Chart appVersion <code>resources.limits.cpu</code> CPU limit <code>500m</code> <code>resources.limits.memory</code> Memory limit <code>128Mi</code> <code>resources.requests.cpu</code> CPU request <code>10m</code> <code>resources.requests.memory</code> Memory request <code>64Mi</code> <code>metrics.enabled</code> Enable metrics endpoint <code>false</code> <code>serviceMonitor.enabled</code> Create ServiceMonitor <code>false</code> <code>grafanaDashboards.enabled</code> Install Grafana dashboards <code>false</code> <code>leaderElection.enabled</code> Enable leader election <code>true</code> <p>For the complete list of values, see the Helm chart values.yaml.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Tutorial - Create your first database</li> <li>User Guide - Learn about all CRDs</li> <li>Examples - Ready-to-use configurations</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This tutorial walks you through creating a PostgreSQL database with a user in 5 minutes.</p>"},{"location":"getting-started/quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>DB Provision Operator installed in your cluster</li> <li>A PostgreSQL server accessible from your cluster</li> </ul> <p>No PostgreSQL server?</p> <p>You can deploy a test PostgreSQL server: <pre><code>kubectl apply -f https://raw.githubusercontent.com/panteparak/db-provision-operator/main/test/e2e/fixtures/testdata/postgresql.yaml\n</code></pre></p>"},{"location":"getting-started/quickstart/#step-1-create-admin-credentials","title":"Step 1: Create Admin Credentials","text":"<p>First, create a Secret with the credentials to connect to your PostgreSQL server:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin-credentials\n  namespace: default\ntype: Opaque\nstringData:\n  username: postgres\n  password: your-admin-password\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin-credentials\n  namespace: default\ntype: Opaque\nstringData:\n  username: postgres\n  password: postgres\nEOF\n</code></pre>"},{"location":"getting-started/quickstart/#step-2-create-a-databaseinstance","title":"Step 2: Create a DatabaseInstance","text":"<p>A <code>DatabaseInstance</code> represents the connection to your database server:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\n  namespace: default\nspec:\n  engine: postgres\n  connection:\n    host: postgresql.default.svc.cluster.local  # Adjust to your server\n    port: 5432\n    database: postgres\n    secretRef:\n      name: postgres-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f instance.yaml\n\n# Check status\nkubectl get databaseinstance postgres-primary\n</code></pre> <p>Wait for the instance to become <code>Ready</code>:</p> <pre><code>NAME               ENGINE     PHASE   HOST                                      PORT   AGE\npostgres-primary   postgres   Ready   postgresql.default.svc.cluster.local      5432   30s\n</code></pre>"},{"location":"getting-started/quickstart/#step-3-create-a-database","title":"Step 3: Create a Database","text":"<p>Now create a database within the instance:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\n  namespace: default\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  deletionPolicy: Retain\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f database.yaml\n\n# Verify\nkubectl get database myapp-database\n</code></pre>"},{"location":"getting-started/quickstart/#step-4-create-a-user","title":"Step 4: Create a User","text":"<p>Create a user with an auto-generated password:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\n  namespace: default\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 24\n    secretName: myapp-user-credentials\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f user.yaml\n\n# Check the generated credentials\nkubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d\n</code></pre>"},{"location":"getting-started/quickstart/#step-5-grant-permissions","title":"Step 5: Grant Permissions","text":"<p>Grant the user access to the database:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\n  namespace: default\nspec:\n  userRef:\n    name: myapp-user\n  databaseRef:\n    name: myapp-database\n  postgres:\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f grant.yaml\n</code></pre>"},{"location":"getting-started/quickstart/#verify-everything","title":"Verify Everything","text":"<p>Check all resources:</p> <pre><code>kubectl get databaseinstance,database,databaseuser,databasegrant\n</code></pre> <p>Expected output:</p> <pre><code>NAME                                               ENGINE     PHASE   AGE\ndatabaseinstance.dbops.dbprovision.io/postgres-primary   postgres   Ready   5m\n\nNAME                                        ENGINE     PHASE   DATABASE   AGE\ndatabase.dbops.dbprovision.io/myapp-database   postgres   Ready   myapp      4m\n\nNAME                                         ENGINE     PHASE   USERNAME     AGE\ndatabaseuser.dbops.dbprovision.io/myapp-user   postgres   Ready   myapp_user   3m\n\nNAME                                               PHASE   AGE\ndatabasegrant.dbops.dbprovision.io/myapp-user-grants   Ready   2m\n</code></pre>"},{"location":"getting-started/quickstart/#connect-to-the-database","title":"Connect to the Database","text":"<p>Use the generated credentials to connect:</p> <pre><code># Get credentials\nexport PGHOST=postgresql.default.svc.cluster.local\nexport PGPORT=5432\nexport PGDATABASE=myapp\nexport PGUSER=myapp_user\nexport PGPASSWORD=$(kubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d)\n\n# Connect (from a pod with psql)\nkubectl run -it --rm psql --image=postgres:16 --restart=Never -- psql\n</code></pre>"},{"location":"getting-started/quickstart/#clean-up","title":"Clean Up","text":"<p>To remove all resources:</p> <pre><code>kubectl delete databasegrant myapp-user-grants\nkubectl delete databaseuser myapp-user\nkubectl delete database myapp-database\nkubectl delete databaseinstance postgres-primary\nkubectl delete secret postgres-admin-credentials myapp-user-credentials\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>User Guide - Deep dive into each CRD</li> <li>Examples - More complex scenarios</li> <li>Engine Guides - PostgreSQL, MySQL, MariaDB specifics</li> </ul>"},{"location":"operations/","title":"Operations","text":"<p>Operational guides for running DB Provision Operator in production.</p>"},{"location":"operations/#overview","title":"Overview","text":"<p>This section covers:</p> <ul> <li>Admin Account Setup - Set up least-privilege database admin accounts</li> <li>Monitoring - Prometheus metrics, Grafana dashboards, alerting</li> <li>Troubleshooting - Common issues and solutions</li> </ul>"},{"location":"operations/#operational-tasks","title":"Operational Tasks","text":""},{"location":"operations/#checking-status","title":"Checking Status","text":"<pre><code># All resources across namespaces\nkubectl get databaseinstances,databases,databaseusers,databaseroles,databasegrants -A\n\n# Specific namespace\nkubectl get all -l app.kubernetes.io/managed-by=db-provision-operator -n myapp\n\n# Detailed status\nkubectl describe databaseinstance postgres-primary\n</code></pre>"},{"location":"operations/#health-verification","title":"Health Verification","text":"<pre><code># Check operator health\nkubectl get pods -n db-provision-operator-system\n\n# Check operator logs\nkubectl logs -n db-provision-operator-system deployment/db-provision-operator -f\n\n# Check specific resource events\nkubectl get events --field-selector involvedObject.name=myapp-database\n</code></pre>"},{"location":"operations/#credential-management","title":"Credential Management","text":"<pre><code># Get generated credentials\nkubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d\n\n# Rotate password (delete secret, operator regenerates)\nkubectl delete secret myapp-user-credentials\n\n# Or use annotation\nkubectl annotate databaseuser myapp-user dbops.dbprovision.io/rotate-password=true\n</code></pre>"},{"location":"operations/#backup-operations","title":"Backup Operations","text":"<pre><code># List backups\nkubectl get databasebackups\n\n# Check backup status\nkubectl describe databasebackup myapp-backup\n\n# Trigger manual backup from schedule\nkubectl create job --from=cronjob/myapp-backup-schedule manual-backup-$(date +%s)\n\n# List scheduled backups\nkubectl get databasebackupschedules\n</code></pre>"},{"location":"operations/#restore-operations","title":"Restore Operations","text":"<pre><code># Create restore\nkubectl apply -f restore.yaml\n\n# Monitor restore progress\nkubectl get databaserestore myapp-restore -w\n\n# Check restore logs\nkubectl logs job/myapp-restore-job\n</code></pre>"},{"location":"operations/#resource-lifecycle","title":"Resource Lifecycle","text":""},{"location":"operations/#creation-order","title":"Creation Order","text":"<p>For new deployments, create resources in this order:</p> <ol> <li>Secrets (admin credentials)</li> <li>DatabaseInstance</li> <li>Database</li> <li>DatabaseRole (optional)</li> <li>DatabaseUser</li> <li>DatabaseGrant</li> <li>DatabaseBackupSchedule (optional)</li> </ol>"},{"location":"operations/#deletion-order","title":"Deletion Order","text":"<p>For cleanup, delete in reverse order:</p> <ol> <li>DatabaseBackupSchedule</li> <li>DatabaseGrant</li> <li>DatabaseUser</li> <li>DatabaseRole</li> <li>Database</li> <li>DatabaseInstance</li> <li>Secrets</li> </ol>"},{"location":"operations/#finalizers","title":"Finalizers","text":"<p>Resources use finalizers to ensure cleanup:</p> <pre><code># Check finalizers\nkubectl get database myapp -o jsonpath='{.metadata.finalizers}'\n\n# Force delete (use with caution!)\nkubectl patch database myapp -p '{\"metadata\":{\"finalizers\":null}}' --type=merge\n</code></pre>"},{"location":"operations/#scaling","title":"Scaling","text":""},{"location":"operations/#operator-scaling","title":"Operator Scaling","text":"<pre><code># Increase replicas for HA\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: db-provision-operator\nspec:\n  replicas: 3\n</code></pre>"},{"location":"operations/#concurrent-reconciliation","title":"Concurrent Reconciliation","text":"<p>Configure via Helm values:</p> <pre><code>controller:\n  maxConcurrentReconciles: 20\n</code></pre>"},{"location":"operations/#upgrades","title":"Upgrades","text":""},{"location":"operations/#operator-upgrade","title":"Operator Upgrade","text":"<pre><code># Helm upgrade\nhelm upgrade db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system \\\n  --version X.Y.Z\n\n# Verify upgrade\nkubectl rollout status deployment/db-provision-operator -n db-provision-operator-system\n</code></pre>"},{"location":"operations/#crd-upgrade","title":"CRD Upgrade","text":"<p>CRDs are upgraded automatically with Helm. For manual upgrade:</p> <pre><code>kubectl apply -f https://github.com/panteparak/db-provision-operator/releases/latest/download/crds.yaml\n</code></pre>"},{"location":"operations/#maintenance-windows","title":"Maintenance Windows","text":""},{"location":"operations/#planned-maintenance","title":"Planned Maintenance","text":"<ol> <li> <p>Scale down operator:    <pre><code>kubectl scale deployment/db-provision-operator --replicas=0 -n db-provision-operator-system\n</code></pre></p> </li> <li> <p>Perform maintenance</p> </li> <li> <p>Scale up operator:    <pre><code>kubectl scale deployment/db-provision-operator --replicas=1 -n db-provision-operator-system\n</code></pre></p> </li> </ol>"},{"location":"operations/#emergency-procedures","title":"Emergency Procedures","text":"<p>Pause all reconciliation: <pre><code>kubectl scale deployment/db-provision-operator --replicas=0 -n db-provision-operator-system\n</code></pre></p> <p>Resume: <pre><code>kubectl scale deployment/db-provision-operator --replicas=1 -n db-provision-operator-system\n</code></pre></p>"},{"location":"operations/#disaster-recovery","title":"Disaster Recovery","text":""},{"location":"operations/#backup-strategy","title":"Backup Strategy","text":"<ol> <li>Database backups - Managed by DatabaseBackupSchedule</li> <li>Kubernetes resources - Export CRDs for recovery</li> <li>Secrets - Backup encryption keys separately</li> </ol>"},{"location":"operations/#export-resources","title":"Export Resources","text":"<pre><code># Export all DB Provision resources\nkubectl get databaseinstances,databases,databaseusers,databaseroles,databasegrants,databasebackups,databasebackupschedules \\\n  -A -o yaml &gt; db-provision-backup.yaml\n</code></pre>"},{"location":"operations/#recovery-steps","title":"Recovery Steps","text":"<ol> <li>Deploy operator</li> <li>Apply Secrets</li> <li>Apply DatabaseInstance (wait for Ready)</li> <li>Apply remaining resources</li> <li>Restore from DatabaseBackup if needed</li> </ol>"},{"location":"operations/#next-steps","title":"Next Steps","text":"<ul> <li>Monitoring - Set up monitoring and alerting</li> <li>Troubleshooting - Solve common problems</li> </ul>"},{"location":"operations/admin-account-setup/","title":"Admin Account Setup","text":"<p>This guide explains how to create a dedicated least-privilege admin account for the DB Provision Operator. Using a least-privilege account instead of superuser/root is a security best practice for production environments.</p>"},{"location":"operations/admin-account-setup/#overview","title":"Overview","text":"<p>The operator needs an admin account with sufficient privileges to:</p> <ul> <li>Create and drop databases</li> <li>Create and manage users/roles</li> <li>Grant and revoke privileges</li> <li>Terminate connections (for force-drop operations)</li> <li>Perform backup operations (SELECT access)</li> </ul> <p>Each database engine has a different privilege model. This guide provides complete SQL scripts for PostgreSQL, MySQL, and MariaDB.</p> <p>Do Not Use Superuser/Root</p> <p>While superuser accounts work, they pose unnecessary security risks. A compromised operator could affect all databases on the server. Always use a dedicated least-privilege account.</p>"},{"location":"operations/admin-account-setup/#postgresql","title":"PostgreSQL","text":""},{"location":"operations/admin-account-setup/#required-privileges","title":"Required Privileges","text":"Privilege/Attribute Purpose <code>LOGIN</code> Connect to the database <code>CREATEDB</code> Create and drop databases <code>CREATEROLE</code> Create and manage users/roles <code>pg_signal_backend</code> Terminate connections (force-drop) <code>pg_read_all_data</code> (PG14+) Backup operations <code>CONNECT ON template1</code> Create databases from template"},{"location":"operations/admin-account-setup/#sql-script","title":"SQL Script","text":"<p>Connect as a PostgreSQL superuser (e.g., <code>postgres</code>) and execute:</p> <pre><code>-- ============================================\n-- PostgreSQL Admin Account for DB Provision Operator\n-- ============================================\n\n-- Step 1: Create the operator admin role\nCREATE ROLE dbprovision_admin WITH\n    LOGIN\n    CREATEDB\n    CREATEROLE\n    PASSWORD 'your-secure-password-here';\n\n-- Step 2: Grant connection termination capability\n-- Required for force-dropping databases with active connections\nGRANT pg_signal_backend TO dbprovision_admin;\n\n-- Step 3: Grant read access for backup operations (PostgreSQL 14+)\n-- For PostgreSQL 12/13, grant SELECT on specific databases instead\nGRANT pg_read_all_data TO dbprovision_admin;\n\n-- Step 4: Grant template1 access for database creation\nGRANT CONNECT ON DATABASE template1 TO dbprovision_admin;\n\n-- Step 5: (Optional) Allow creating extensions in new databases\n-- Note: Some extensions require superuser; pre-install them if needed\n-- GRANT CREATE ON DATABASE template1 TO dbprovision_admin;\n\n-- Verify the setup\n\\du dbprovision_admin\n</code></pre>"},{"location":"operations/admin-account-setup/#postgresql-1213-without-pg_read_all_data","title":"PostgreSQL 12/13 (Without pg_read_all_data)","text":"<p>For older PostgreSQL versions, grant SELECT explicitly:</p> <pre><code>-- After creating each database managed by the operator:\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO dbprovision_admin;\nGRANT SELECT ON ALL SEQUENCES IN SCHEMA public TO dbprovision_admin;\n\n-- For future tables (run as database owner):\nALTER DEFAULT PRIVILEGES IN SCHEMA public\n    GRANT SELECT ON TABLES TO dbprovision_admin;\nALTER DEFAULT PRIVILEGES IN SCHEMA public\n    GRANT SELECT ON SEQUENCES TO dbprovision_admin;\n</code></pre>"},{"location":"operations/admin-account-setup/#extension-considerations","title":"Extension Considerations","text":"<p>Some PostgreSQL extensions require superuser to install:</p> Extension Requires Superuser Solution <code>pg_stat_statements</code> Yes Pre-install by DBA <code>uuid-ossp</code> Yes Pre-install by DBA <code>pgcrypto</code> No Operator can install <code>hstore</code> No Operator can install <code>pg_trgm</code> No Operator can install <p>For extensions requiring superuser, pre-install them in <code>template1</code>:</p> <pre><code>-- Run as superuser in template1\n\\c template1\nCREATE EXTENSION IF NOT EXISTS pg_stat_statements;\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n</code></pre>"},{"location":"operations/admin-account-setup/#verification","title":"Verification","text":"<pre><code>-- Check role attributes\nSELECT rolname, rolsuper, rolcreaterole, rolcreatedb, rolcanlogin\nFROM pg_roles\nWHERE rolname = 'dbprovision_admin';\n\n-- Expected output:\n--      rolname       | rolsuper | rolcreaterole | rolcreatedb | rolcanlogin\n-- -------------------+----------+---------------+-------------+-------------\n--  dbprovision_admin | f        | t             | t           | t\n\n-- Check role memberships\nSELECT r.rolname AS role, m.rolname AS member\nFROM pg_auth_members am\nJOIN pg_roles r ON am.roleid = r.oid\nJOIN pg_roles m ON am.member = m.oid\nWHERE m.rolname = 'dbprovision_admin';\n\n-- Expected: pg_signal_backend, pg_read_all_data\n</code></pre>"},{"location":"operations/admin-account-setup/#mysql","title":"MySQL","text":""},{"location":"operations/admin-account-setup/#required-privileges_1","title":"Required Privileges","text":"Privilege Purpose <code>CREATE, DROP, ALTER ON *.*</code> Database operations <code>CREATE USER ON *.*</code> User management <code>GRANT OPTION ON *.*</code> Delegate privileges to users <code>SELECT ON mysql.*</code> Query user/grant metadata <code>RELOAD ON *.*</code> FLUSH PRIVILEGES <code>CONNECTION_ADMIN ON *.*</code> Kill connections (force-drop) <code>ROLE_ADMIN ON *.*</code> Role management (MySQL 8.0+) <code>SELECT, SHOW VIEW, TRIGGER, LOCK TABLES ON *.*</code> Backup operations"},{"location":"operations/admin-account-setup/#sql-script_1","title":"SQL Script","text":"<p>Connect as MySQL root and execute:</p> <pre><code>-- ============================================\n-- MySQL Admin Account for DB Provision Operator\n-- ============================================\n\n-- Step 1: Create the operator admin user\nCREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password-here';\n\n-- Step 2: Grant database operations\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 3: Grant user management\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%';\nGRANT GRANT OPTION ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 4: Grant system table access for metadata queries\nGRANT SELECT ON mysql.user TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.db TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.tables_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.columns_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.procs_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.global_grants TO 'dbprovision_admin'@'%';\n\n-- Step 5: Grant administrative operations\nGRANT RELOAD ON *.* TO 'dbprovision_admin'@'%';\nGRANT CONNECTION_ADMIN ON *.* TO 'dbprovision_admin'@'%';\nGRANT PROCESS ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 6: Grant role management (MySQL 8.0+)\nGRANT ROLE_ADMIN ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 7: Grant data operations for managed databases and backup operations\n-- INSERT, UPDATE, DELETE are needed to grant these privileges to application users\nGRANT SELECT, INSERT, UPDATE, DELETE, SHOW VIEW, TRIGGER, LOCK TABLES ON *.* TO 'dbprovision_admin'@'%';\n-- Note: information_schema access is automatic based on privileges on actual database objects\n\n-- Step 8: Apply changes\nFLUSH PRIVILEGES;\n\n-- Verify the setup\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n</code></pre>"},{"location":"operations/admin-account-setup/#restricted-network-access-recommended","title":"Restricted Network Access (Recommended)","text":"<p>For production, restrict the admin account to specific hosts:</p> <pre><code>-- Create user accessible only from Kubernetes pod network\nCREATE USER 'dbprovision_admin'@'10.0.0.0/255.0.0.0'\n    IDENTIFIED BY 'your-secure-password-here';\n\n-- Or specific namespace CIDR\nCREATE USER 'dbprovision_admin'@'10.244.%.%'\n    IDENTIFIED BY 'your-secure-password-here';\n\n-- Grant same privileges as above to this restricted user\n</code></pre>"},{"location":"operations/admin-account-setup/#verification_1","title":"Verification","text":"<pre><code>-- Check user exists\nSELECT User, Host FROM mysql.user WHERE User = 'dbprovision_admin';\n\n-- Check grants (should NOT show ALL PRIVILEGES or SUPER)\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n\n-- Expected grants (partial list):\n-- GRANT SELECT, RELOAD, CREATE USER, PROCESS,\n--       CREATE, DROP, ALTER, LOCK TABLES, SHOW VIEW, TRIGGER,\n--       CONNECTION_ADMIN, ROLE_ADMIN\n-- ON *.* TO 'dbprovision_admin'@'%' WITH GRANT OPTION\n</code></pre>"},{"location":"operations/admin-account-setup/#mariadb","title":"MariaDB","text":"<p>MariaDB is MySQL-compatible but has some differences in privilege handling.</p>"},{"location":"operations/admin-account-setup/#differences-from-mysql","title":"Differences from MySQL","text":"Feature MySQL 8.0 MariaDB Role system <code>CREATE ROLE</code> statement Roles are users (same as older MySQL) Role admin <code>ROLE_ADMIN</code> privilege <code>CREATE USER</code> + <code>WITH GRANT OPTION</code> Default auth <code>caching_sha2_password</code> <code>mysql_native_password</code> Global grants table <code>mysql.global_grants</code> Not available"},{"location":"operations/admin-account-setup/#sql-script_2","title":"SQL Script","text":"<p>Connect as MariaDB root and execute:</p> <pre><code>-- ============================================\n-- MariaDB Admin Account for DB Provision Operator\n-- ============================================\n\n-- Step 1: Create the operator admin user\nCREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password-here';\n\n-- Step 2: Grant database operations\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 3: Grant user management with grant option for role delegation\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%' WITH GRANT OPTION;\n\n-- Step 4: Grant system table access for metadata queries\nGRANT SELECT ON mysql.user TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.db TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.tables_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.columns_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.procs_priv TO 'dbprovision_admin'@'%';\n\n-- Step 5: Grant administrative operations\nGRANT RELOAD ON *.* TO 'dbprovision_admin'@'%';\nGRANT PROCESS ON *.* TO 'dbprovision_admin'@'%';\n\n-- Note: MariaDB uses SUPER or CONNECTION ADMIN for killing connections\n-- CONNECTION ADMIN was added in MariaDB 10.5.2\nGRANT CONNECTION ADMIN ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 6: Grant data operations for managed databases and backup operations\n-- INSERT, UPDATE, DELETE are needed to grant these privileges to application users\nGRANT SELECT, INSERT, UPDATE, DELETE, SHOW VIEW, TRIGGER, LOCK TABLES ON *.* TO 'dbprovision_admin'@'%';\n-- Note: information_schema access is automatic based on privileges on actual database objects\n\n-- Step 7: Apply changes\nFLUSH PRIVILEGES;\n\n-- Verify the setup\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n</code></pre>"},{"location":"operations/admin-account-setup/#mariadb-104-and-earlier","title":"MariaDB 10.4 and Earlier","text":"<p>For older MariaDB versions without <code>CONNECTION ADMIN</code>:</p> <pre><code>-- Use SUPER for connection termination (less ideal but necessary)\n-- WARNING: SUPER is a very broad privilege\n-- Consider upgrading to MariaDB 10.5+ instead\nGRANT SUPER ON *.* TO 'dbprovision_admin'@'%';\n</code></pre>"},{"location":"operations/admin-account-setup/#verification_2","title":"Verification","text":"<pre><code>-- Check user exists\nSELECT User, Host FROM mysql.user WHERE User = 'dbprovision_admin';\n\n-- Check grants\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n\n-- Verify role capabilities (create a test role)\nCREATE ROLE IF NOT EXISTS test_role_check;\nDROP ROLE IF EXISTS test_role_check;\n</code></pre>"},{"location":"operations/admin-account-setup/#kubernetes-secret","title":"Kubernetes Secret","text":"<p>After creating the admin account, create a Kubernetes Secret:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: db-admin-credentials\n  namespace: db-provision-operator-system\ntype: Opaque\nstringData:\n  username: dbprovision_admin\n  password: your-secure-password-here\n</code></pre> <p>Or create it with kubectl:</p> <pre><code>kubectl create secret generic db-admin-credentials \\\n  --namespace=db-provision-operator-system \\\n  --from-literal=username=dbprovision_admin \\\n  --from-literal=password='your-secure-password-here'\n</code></pre>"},{"location":"operations/admin-account-setup/#password-generation","title":"Password Generation","text":"<p>Generate a secure random password:</p> <pre><code># Using openssl (recommended)\nopenssl rand -base64 32\n\n# Using /dev/urandom\nhead -c 32 /dev/urandom | base64\n\n# Using pwgen\npwgen -s 32 1\n</code></pre>"},{"location":"operations/admin-account-setup/#databaseinstance-configuration","title":"DatabaseInstance Configuration","text":"<p>Reference the admin credentials in your DatabaseInstance:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: db-admin-credentials\n</code></pre>"},{"location":"operations/admin-account-setup/#security-recommendations","title":"Security Recommendations","text":""},{"location":"operations/admin-account-setup/#1-password-rotation","title":"1. Password Rotation","text":"<p>Regularly rotate the admin account password:</p> <pre><code># 1. Generate new password\nNEW_PASSWORD=$(openssl rand -base64 32)\n\n# 2. Update in database (run appropriate SQL)\n# PostgreSQL: ALTER ROLE dbprovision_admin WITH PASSWORD 'new-password';\n# MySQL/MariaDB: ALTER USER 'dbprovision_admin'@'%' IDENTIFIED BY 'new-password';\n\n# 3. Update Kubernetes secret\nkubectl create secret generic db-admin-credentials \\\n  --namespace=db-provision-operator-system \\\n  --from-literal=username=dbprovision_admin \\\n  --from-literal=password=\"$NEW_PASSWORD\" \\\n  --dry-run=client -o yaml | kubectl apply -f -\n\n# 4. Restart operator to pick up new credentials\nkubectl rollout restart deployment/db-provision-operator-controller-manager \\\n  -n db-provision-operator-system\n</code></pre>"},{"location":"operations/admin-account-setup/#2-network-restrictions","title":"2. Network Restrictions","text":"<ul> <li>Use Kubernetes NetworkPolicies to restrict operator-to-database traffic</li> <li>Configure database firewall rules (pg_hba.conf for PostgreSQL)</li> <li>Use host restrictions in MySQL/MariaDB user definitions</li> </ul>"},{"location":"operations/admin-account-setup/#3-tls-encryption","title":"3. TLS Encryption","text":"<p>Always enable TLS for production:</p> <pre><code>spec:\n  connection:\n    sslMode: verify-full\n    tls:\n      secretRef:\n        name: db-tls-certs\n</code></pre>"},{"location":"operations/admin-account-setup/#4-audit-logging","title":"4. Audit Logging","text":"<p>Enable database audit logging for the admin account:</p> <p>PostgreSQL (pgaudit): <pre><code>ALTER ROLE dbprovision_admin SET pgaudit.log = 'ddl,role';\n</code></pre></p> <p>MySQL: <pre><code>SET GLOBAL audit_log_include_accounts = 'dbprovision_admin@%';\n</code></pre></p>"},{"location":"operations/admin-account-setup/#5-least-privilege-verification","title":"5. Least Privilege Verification","text":"<p>Periodically verify the account doesn't have superuser:</p> <pre><code># PostgreSQL\npsql -U dbprovision_admin -c \"SELECT rolsuper FROM pg_roles WHERE rolname = current_user;\"\n# Should return: f (false)\n\n# MySQL\nmysql -u dbprovision_admin -e \"SELECT SUPER_PRIV FROM mysql.user WHERE User = 'dbprovision_admin';\"\n# Should return: N (No)\n</code></pre>"},{"location":"operations/admin-account-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"operations/admin-account-setup/#permission-denied-errors","title":"Permission Denied Errors","text":"<p>If the operator logs show permission errors:</p> <ol> <li>Check the admin account has all required privileges</li> <li>Verify the secret contains correct credentials</li> <li>Test connectivity manually:</li> </ol> <pre><code># PostgreSQL\nkubectl run psql-test --rm -it --image=postgres:16 -- \\\n  psql \"postgresql://dbprovision_admin:password@host:5432/postgres?sslmode=require\"\n\n# MySQL/MariaDB\nkubectl run mysql-test --rm -it --image=mysql:8 -- \\\n  mysql -h host -u dbprovision_admin -ppassword -e \"SHOW GRANTS;\"\n</code></pre>"},{"location":"operations/admin-account-setup/#cannot-create-database","title":"Cannot Create Database","text":"<p>PostgreSQL: <pre><code>-- Check CREATEDB attribute\nSELECT rolcreatedb FROM pg_roles WHERE rolname = 'dbprovision_admin';\n-- If false, grant it:\nALTER ROLE dbprovision_admin WITH CREATEDB;\n</code></pre></p> <p>MySQL/MariaDB: <pre><code>-- Check CREATE privilege\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n-- If missing, grant it:\nGRANT CREATE ON *.* TO 'dbprovision_admin'@'%';\n</code></pre></p>"},{"location":"operations/admin-account-setup/#cannot-terminate-connections","title":"Cannot Terminate Connections","text":"<p>PostgreSQL: <pre><code>-- Check pg_signal_backend membership\nSELECT pg_has_role('dbprovision_admin', 'pg_signal_backend', 'MEMBER');\n-- If false:\nGRANT pg_signal_backend TO dbprovision_admin;\n</code></pre></p> <p>MySQL/MariaDB: <pre><code>-- Check CONNECTION_ADMIN or SUPER\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n-- If missing:\nGRANT CONNECTION_ADMIN ON *.* TO 'dbprovision_admin'@'%';\n</code></pre></p>"},{"location":"operations/admin-account-setup/#next-steps","title":"Next Steps","text":"<ul> <li>PostgreSQL Guide - PostgreSQL-specific features</li> <li>MySQL Guide - MySQL-specific features</li> <li>MariaDB Guide - MariaDB-specific features</li> <li>Monitoring - Set up monitoring and alerting</li> </ul>"},{"location":"operations/monitoring/","title":"Monitoring","text":"<p>Set up monitoring, metrics, and alerting for DB Provision Operator.</p>"},{"location":"operations/monitoring/#prometheus-metrics","title":"Prometheus Metrics","text":""},{"location":"operations/monitoring/#enable-metrics","title":"Enable Metrics","text":"<p>Metrics are enabled by default. Configure via Helm:</p> <pre><code># values.yaml\nmetrics:\n  enabled: true\n  port: 8080\n  serviceMonitor:\n    enabled: true\n    interval: 30s\n</code></pre>"},{"location":"operations/monitoring/#available-metrics","title":"Available Metrics","text":"Metric Type Description <code>db_provision_reconcile_total</code> Counter Total reconciliations <code>db_provision_reconcile_errors_total</code> Counter Failed reconciliations <code>db_provision_reconcile_duration_seconds</code> Histogram Reconciliation duration <code>db_provision_resource_status</code> Gauge Resource status (1=Ready, 0=NotReady) <code>db_provision_database_connection_status</code> Gauge Instance connection status <code>db_provision_backup_last_success_timestamp</code> Gauge Last successful backup time <code>db_provision_backup_size_bytes</code> Gauge Backup size"},{"location":"operations/monitoring/#servicemonitor","title":"ServiceMonitor","text":"<pre><code>apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: db-provision-operator\n  namespace: db-provision-operator-system\n  labels:\n    app: db-provision-operator\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: db-provision-operator\n  endpoints:\n    - port: metrics\n      interval: 30s\n      path: /metrics\n</code></pre>"},{"location":"operations/monitoring/#grafana-dashboards","title":"Grafana Dashboards","text":""},{"location":"operations/monitoring/#import-dashboard","title":"Import Dashboard","text":"<p>Import the provided dashboard JSON:</p> <pre><code># Download dashboard\ncurl -o db-provision-dashboard.json \\\n  https://raw.githubusercontent.com/panteparak/db-provision-operator/main/dashboards/db-provision-operator.json\n\n# Import via Grafana API\ncurl -X POST http://admin:admin@localhost:3000/api/dashboards/db/import \\\n  -H \"Content-Type: application/json\" \\\n  -d @db-provision-dashboard.json\n</code></pre>"},{"location":"operations/monitoring/#dashboard-panels","title":"Dashboard Panels","text":"<p>The dashboard includes:</p> <ol> <li>Overview</li> <li>Total resources by type</li> <li>Resource status distribution</li> <li> <p>Reconciliation rate</p> </li> <li> <p>Instance Health</p> </li> <li>Connection status per instance</li> <li>Health check results</li> <li> <p>Connection latency</p> </li> <li> <p>Reconciliation</p> </li> <li>Reconciliation rate</li> <li>Error rate</li> <li> <p>Duration percentiles</p> </li> <li> <p>Backups</p> </li> <li>Backup success/failure rate</li> <li>Backup sizes over time</li> <li>Next scheduled backups</li> </ol>"},{"location":"operations/monitoring/#custom-queries","title":"Custom Queries","text":"<p>Resources by status: <pre><code>sum by (kind, status) (db_provision_resource_status)\n</code></pre></p> <p>Reconciliation error rate: <pre><code>rate(db_provision_reconcile_errors_total[5m])\n/ rate(db_provision_reconcile_total[5m])\n</code></pre></p> <p>Backup age: <pre><code>time() - db_provision_backup_last_success_timestamp\n</code></pre></p>"},{"location":"operations/monitoring/#alerting","title":"Alerting","text":""},{"location":"operations/monitoring/#prometheusrule","title":"PrometheusRule","text":"<pre><code>apiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: db-provision-alerts\n  namespace: db-provision-operator-system\nspec:\n  groups:\n    - name: db-provision-operator\n      rules:\n        # Instance connectivity\n        - alert: DatabaseInstanceUnhealthy\n          expr: db_provision_database_connection_status == 0\n          for: 5m\n          labels:\n            severity: critical\n          annotations:\n            summary: \"Database instance {{ $labels.name }} is unhealthy\"\n            description: \"Instance has been unhealthy for more than 5 minutes\"\n\n        # Reconciliation errors\n        - alert: HighReconcileErrorRate\n          expr: |\n            rate(db_provision_reconcile_errors_total[5m])\n            / rate(db_provision_reconcile_total[5m]) &gt; 0.1\n          for: 10m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"High reconciliation error rate\"\n            description: \"More than 10% of reconciliations are failing\"\n\n        # Backup alerts\n        - alert: BackupFailed\n          expr: |\n            db_provision_backup_status{phase=\"Failed\"} == 1\n          for: 1m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Backup {{ $labels.name }} failed\"\n            description: \"Database backup has failed\"\n\n        - alert: BackupOverdue\n          expr: |\n            time() - db_provision_backup_last_success_timestamp &gt; 86400\n          for: 1h\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Backup overdue for {{ $labels.database }}\"\n            description: \"No successful backup in the last 24 hours\"\n\n        # Resource stuck\n        - alert: ResourceStuckPending\n          expr: |\n            db_provision_resource_status{phase=\"Pending\"} == 1\n          for: 30m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Resource {{ $labels.kind }}/{{ $labels.name }} stuck in Pending\"\n            description: \"Resource has been Pending for more than 30 minutes\"\n</code></pre>"},{"location":"operations/monitoring/#alert-severity-guidelines","title":"Alert Severity Guidelines","text":"Severity Response Examples <code>critical</code> Immediate Instance unhealthy, operator down <code>warning</code> Within hours Backup failed, high error rate <code>info</code> Next business day Resource stuck, minor issues"},{"location":"operations/monitoring/#logging","title":"Logging","text":""},{"location":"operations/monitoring/#log-levels","title":"Log Levels","text":"<p>Configure log level via Helm:</p> <pre><code>logging:\n  level: info  # debug, info, warn, error\n  format: json  # json, text\n</code></pre>"},{"location":"operations/monitoring/#log-format","title":"Log Format","text":"<p>JSON logs for aggregation:</p> <pre><code>{\n  \"level\": \"info\",\n  \"ts\": \"2024-01-01T00:00:00.000Z\",\n  \"logger\": \"controller.database\",\n  \"msg\": \"Reconciling Database\",\n  \"namespace\": \"default\",\n  \"name\": \"myapp-database\",\n  \"generation\": 1\n}\n</code></pre>"},{"location":"operations/monitoring/#log-queries","title":"Log Queries","text":"<p>Loki/Grafana: <pre><code>{namespace=\"db-provision-operator-system\"} |= \"error\"\n</code></pre></p> <p>Elasticsearch: <pre><code>{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\"match\": {\"kubernetes.namespace\": \"db-provision-operator-system\"}},\n        {\"match\": {\"level\": \"error\"}}\n      ]\n    }\n  }\n}\n</code></pre></p>"},{"location":"operations/monitoring/#health-endpoints","title":"Health Endpoints","text":""},{"location":"operations/monitoring/#operator-health","title":"Operator Health","text":"<pre><code># Readiness probe\ncurl http://operator:8081/readyz\n\n# Liveness probe\ncurl http://operator:8081/healthz\n\n# Metrics endpoint\ncurl http://operator:8080/metrics\n</code></pre>"},{"location":"operations/monitoring/#database-instance-health","title":"Database Instance Health","text":"<p>Check via status:</p> <pre><code>kubectl get databaseinstance postgres-primary -o jsonpath='{.status.conditions[?(@.type==\"Healthy\")].status}'\n</code></pre>"},{"location":"operations/monitoring/#tracing-optional","title":"Tracing (Optional)","text":"<p>Enable OpenTelemetry tracing:</p> <pre><code># values.yaml\ntracing:\n  enabled: true\n  endpoint: \"http://jaeger-collector:14268/api/traces\"\n  samplingRate: 0.1\n</code></pre>"},{"location":"operations/monitoring/#resource-monitoring","title":"Resource Monitoring","text":""},{"location":"operations/monitoring/#watch-resource-changes","title":"Watch Resource Changes","text":"<pre><code># Watch all DB Provision resources\nkubectl get databaseinstances,databases,databaseusers -A -w\n</code></pre>"},{"location":"operations/monitoring/#status-summary-script","title":"Status Summary Script","text":"<pre><code>#!/bin/bash\necho \"=== DB Provision Operator Status ===\"\necho \"\"\necho \"Instances:\"\nkubectl get databaseinstances -A -o custom-columns=\\\n'NAMESPACE:.metadata.namespace,NAME:.metadata.name,ENGINE:.spec.engine,PHASE:.status.phase'\necho \"\"\necho \"Databases:\"\nkubectl get databases -A -o custom-columns=\\\n'NAMESPACE:.metadata.namespace,NAME:.metadata.name,INSTANCE:.spec.instanceRef.name,PHASE:.status.phase'\necho \"\"\necho \"Users:\"\nkubectl get databaseusers -A -o custom-columns=\\\n'NAMESPACE:.metadata.namespace,NAME:.metadata.name,USERNAME:.spec.username,PHASE:.status.phase'\necho \"\"\necho \"Backups:\"\nkubectl get databasebackups -A -o custom-columns=\\\n'NAMESPACE:.metadata.namespace,NAME:.metadata.name,PHASE:.status.phase,SIZE:.status.backupSize'\n</code></pre>"},{"location":"operations/monitoring/#best-practices","title":"Best Practices","text":"<ol> <li>Set up alerts before going to production</li> <li>Monitor backup success - set up alerts for backup failures</li> <li>Track reconciliation errors - investigate spikes in error rate</li> <li>Dashboard review - regularly review dashboards for anomalies</li> <li>Log retention - keep logs for debugging production issues</li> </ol>"},{"location":"operations/troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and solutions for DB Provision Operator.</p>"},{"location":"operations/troubleshooting/#diagnostic-commands","title":"Diagnostic Commands","text":""},{"location":"operations/troubleshooting/#quick-health-check","title":"Quick Health Check","text":"<pre><code># Operator status\nkubectl get pods -n db-provision-operator-system\n\n# Resource status\nkubectl get databaseinstances,databases,databaseusers -A\n\n# Recent events\nkubectl get events -n db-provision-operator-system --sort-by='.lastTimestamp' | tail -20\n</code></pre>"},{"location":"operations/troubleshooting/#detailed-debugging","title":"Detailed Debugging","text":"<pre><code># Operator logs\nkubectl logs -n db-provision-operator-system deployment/db-provision-operator -f\n\n# Specific resource details\nkubectl describe databaseinstance postgres-primary\n\n# Resource YAML\nkubectl get databaseinstance postgres-primary -o yaml\n</code></pre>"},{"location":"operations/troubleshooting/#common-issues","title":"Common Issues","text":""},{"location":"operations/troubleshooting/#databaseinstance-issues","title":"DatabaseInstance Issues","text":""},{"location":"operations/troubleshooting/#instance-stuck-in-pending","title":"Instance Stuck in Pending","text":"<p>Symptoms: <pre><code>NAME              ENGINE    PHASE\npostgres-primary  postgres  Pending\n</code></pre></p> <p>Causes and Solutions:</p> <ol> <li> <p>Cannot connect to database: <pre><code># Check connectivity\nkubectl run psql-test --rm -it --image=postgres:15 -- \\\n  psql \"postgresql://user:pass@host:5432/postgres?sslmode=disable\" -c \"SELECT 1\"\n</code></pre></p> </li> <li> <p>Invalid credentials: <pre><code># Verify secret exists and has correct keys\nkubectl get secret postgres-admin-credentials -o yaml\n</code></pre></p> </li> <li> <p>DNS resolution: <pre><code># Test DNS from within cluster\nkubectl run dns-test --rm -it --image=busybox -- nslookup postgres.database.svc.cluster.local\n</code></pre></p> </li> </ol>"},{"location":"operations/troubleshooting/#instance-shows-failed","title":"Instance Shows Failed","text":"<p>Check events: <pre><code>kubectl describe databaseinstance postgres-primary | grep -A10 \"Events:\"\n</code></pre></p> <p>Common errors:</p> Error Solution <code>connection refused</code> Check database is running, correct port <code>authentication failed</code> Verify credentials in Secret <code>SSL required</code> Add <code>sslMode: require</code> to spec <code>unknown host</code> Check hostname and DNS"},{"location":"operations/troubleshooting/#database-issues","title":"Database Issues","text":""},{"location":"operations/troubleshooting/#database-not-created","title":"Database Not Created","text":"<p>Check dependencies: <pre><code># Instance must be Ready\nkubectl get databaseinstance postgres-primary -o jsonpath='{.status.phase}'\n</code></pre></p> <p>Check logs: <pre><code>kubectl logs -n db-provision-operator-system deployment/db-provision-operator | grep \"myapp-database\"\n</code></pre></p>"},{"location":"operations/troubleshooting/#extension-installation-failed","title":"Extension Installation Failed","text":"<p>Common causes:</p> <ol> <li> <p>Extension not available:    <pre><code>-- Check available extensions in database\nSELECT * FROM pg_available_extensions;\n</code></pre></p> </li> <li> <p>Insufficient permissions:    <pre><code>-- Admin user needs CREATE permission\nGRANT CREATE ON DATABASE myapp TO admin_user;\n</code></pre></p> </li> </ol>"},{"location":"operations/troubleshooting/#user-issues","title":"User Issues","text":""},{"location":"operations/troubleshooting/#user-not-created","title":"User Not Created","text":"<p>Check instance status: <pre><code>kubectl get databaseinstance -o jsonpath='{.status.phase}'\n# Must be \"Ready\"\n</code></pre></p> <p>Verify username is valid: - PostgreSQL: alphanumeric and underscores - MySQL: max 32 characters</p>"},{"location":"operations/troubleshooting/#password-not-generated","title":"Password Not Generated","text":"<p>Check secret: <pre><code>kubectl get secret myapp-user-credentials\n</code></pre></p> <p>If missing: 1. Verify <code>passwordSecret.generate: true</code> in spec 2. Check <code>passwordSecret.secretName</code> is specified 3. Look for errors in operator logs</p>"},{"location":"operations/troubleshooting/#cannot-connect-with-generated-password","title":"Cannot Connect with Generated Password","text":"<p>Verify credentials: <pre><code># Get password\nkubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d\n\n# Test connection\nkubectl run psql-test --rm -it --image=postgres:15 -- \\\n  psql \"postgresql://myapp_user:PASSWORD@postgres:5432/myapp\"\n</code></pre></p>"},{"location":"operations/troubleshooting/#grant-issues","title":"Grant Issues","text":""},{"location":"operations/troubleshooting/#grants-not-applied","title":"Grants Not Applied","text":"<p>Prerequisites: 1. User/Role must exist and be Ready 2. Database must exist 3. Tables/schemas must exist</p> <p>Check user status: <pre><code>kubectl get databaseuser myapp-user -o jsonpath='{.status.phase}'\n</code></pre></p> <p>Verify grants in database: <pre><code>-- PostgreSQL\n\\dp tablename\n-- or\nSELECT * FROM information_schema.table_privileges WHERE grantee = 'myapp_user';\n</code></pre></p>"},{"location":"operations/troubleshooting/#backup-issues","title":"Backup Issues","text":""},{"location":"operations/troubleshooting/#backup-stuck-in-running","title":"Backup Stuck in Running","text":"<p>Check backup job: <pre><code>kubectl get jobs -l backup-name=myapp-backup\nkubectl logs job/myapp-backup-job\n</code></pre></p> <p>Common causes: - Large database taking long time - Network issues to storage - Insufficient resources</p>"},{"location":"operations/troubleshooting/#backup-failed","title":"Backup Failed","text":"<p>Check job logs: <pre><code>kubectl logs job/myapp-backup-job\n</code></pre></p> <p>Storage issues: <pre><code># Verify storage credentials\nkubectl get secret s3-credentials -o yaml\n\n# Test S3 connectivity\nkubectl run aws-cli --rm -it --image=amazon/aws-cli -- s3 ls s3://my-bucket/\n</code></pre></p>"},{"location":"operations/troubleshooting/#schedule-not-triggering","title":"Schedule Not Triggering","text":"<p>Verify schedule: <pre><code>kubectl get databasebackupschedule myapp-backup -o yaml | grep schedule\n</code></pre></p> <p>Check timezone: <pre><code># Schedule uses UTC by default\nkubectl get databasebackupschedule myapp-backup -o jsonpath='{.spec.timezone}'\n</code></pre></p>"},{"location":"operations/troubleshooting/#restore-issues","title":"Restore Issues","text":""},{"location":"operations/troubleshooting/#restore-failed","title":"Restore Failed","text":"<p>Check restore job: <pre><code>kubectl logs job/myapp-restore-job\n</code></pre></p> <p>Common errors:</p> Error Solution <code>database exists</code> Set <code>dropExisting: true</code> or delete database <code>backup not found</code> Verify backup exists and path is correct <code>permission denied</code> Check storage credentials"},{"location":"operations/troubleshooting/#operator-issues","title":"Operator Issues","text":""},{"location":"operations/troubleshooting/#operator-not-starting","title":"Operator Not Starting","text":"<p>Check pod status: <pre><code>kubectl describe pod -n db-provision-operator-system -l app=db-provision-operator\n</code></pre></p> <p>Common issues:</p> <ol> <li> <p>Image pull error: <pre><code>kubectl get events -n db-provision-operator-system | grep \"Failed\"\n</code></pre></p> </li> <li> <p>RBAC issues: <pre><code>kubectl auth can-i --as=system:serviceaccount:db-provision-operator-system:db-provision-operator \\\n  create secrets -n default\n</code></pre></p> </li> </ol>"},{"location":"operations/troubleshooting/#high-memory-usage","title":"High Memory Usage","text":"<p>Check resource usage: <pre><code>kubectl top pod -n db-provision-operator-system\n</code></pre></p> <p>Solutions: 1. Increase memory limits 2. Reduce concurrent reconciles 3. Check for resource leaks in logs</p>"},{"location":"operations/troubleshooting/#reconciliation-loops","title":"Reconciliation Loops","text":"<p>Symptoms: Constant reconciliation, high CPU</p> <p>Debug: <pre><code># Watch reconciliation\nkubectl logs -n db-provision-operator-system deployment/db-provision-operator -f | grep \"Reconciling\"\n</code></pre></p> <p>Causes: - Status updates triggering reconciles - External changes to managed resources - Conflicting controllers</p>"},{"location":"operations/troubleshooting/#recovery-procedures","title":"Recovery Procedures","text":""},{"location":"operations/troubleshooting/#force-delete-stuck-resource","title":"Force Delete Stuck Resource","text":"<pre><code># Remove finalizers (use with caution!)\nkubectl patch database myapp-database -p '{\"metadata\":{\"finalizers\":null}}' --type=merge\nkubectl delete database myapp-database\n</code></pre>"},{"location":"operations/troubleshooting/#reset-resource-state","title":"Reset Resource State","text":"<pre><code># Delete and recreate\nkubectl delete database myapp-database\nkubectl apply -f database.yaml\n</code></pre>"},{"location":"operations/troubleshooting/#operator-recovery","title":"Operator Recovery","text":"<pre><code># Restart operator\nkubectl rollout restart deployment/db-provision-operator -n db-provision-operator-system\n\n# Watch rollout\nkubectl rollout status deployment/db-provision-operator -n db-provision-operator-system\n</code></pre>"},{"location":"operations/troubleshooting/#debug-mode","title":"Debug Mode","text":""},{"location":"operations/troubleshooting/#enable-debug-logging","title":"Enable Debug Logging","text":"<pre><code># Helm values\nlogging:\n  level: debug\n</code></pre> <p>Or patch deployment: <pre><code>kubectl set env deployment/db-provision-operator LOG_LEVEL=debug -n db-provision-operator-system\n</code></pre></p>"},{"location":"operations/troubleshooting/#trace-specific-resource","title":"Trace Specific Resource","text":"<pre><code>kubectl logs -n db-provision-operator-system deployment/db-provision-operator | \\\n  grep \"myapp-database\"\n</code></pre>"},{"location":"operations/troubleshooting/#getting-help","title":"Getting Help","text":""},{"location":"operations/troubleshooting/#collect-debug-information","title":"Collect Debug Information","text":"<pre><code>#!/bin/bash\n# debug-bundle.sh\n\necho \"=== Operator Pods ===\" &gt; debug.txt\nkubectl get pods -n db-provision-operator-system -o wide &gt;&gt; debug.txt\n\necho \"=== Operator Logs ===\" &gt;&gt; debug.txt\nkubectl logs -n db-provision-operator-system deployment/db-provision-operator --tail=500 &gt;&gt; debug.txt\n\necho \"=== All Resources ===\" &gt;&gt; debug.txt\nkubectl get databaseinstances,databases,databaseusers,databaseroles,databasegrants,databasebackups -A &gt;&gt; debug.txt\n\necho \"=== Events ===\" &gt;&gt; debug.txt\nkubectl get events -n db-provision-operator-system &gt;&gt; debug.txt\n\necho \"Debug bundle saved to debug.txt\"\n</code></pre>"},{"location":"operations/troubleshooting/#report-issues","title":"Report Issues","text":"<p>Open an issue at: https://github.com/panteparak/db-provision-operator/issues</p> <p>Include: 1. Operator version 2. Kubernetes version 3. Database engine and version 4. Resource YAML (redact secrets) 5. Operator logs 6. Steps to reproduce</p>"},{"location":"user-guide/","title":"User Guide","text":"<p>This guide covers all Custom Resource Definitions (CRDs) provided by DB Provision Operator.</p>"},{"location":"user-guide/#resource-hierarchy","title":"Resource Hierarchy","text":"<pre><code>graph TD\n    DI[DatabaseInstance] --&gt; DB[Database]\n    DI --&gt; DU[DatabaseUser]\n    DI --&gt; DR[DatabaseRole]\n    DB --&gt; DBB[DatabaseBackup]\n    DB --&gt; DBS[DatabaseBackupSchedule]\n    DBB --&gt; DBR[DatabaseRestore]\n    DU --&gt; DG[DatabaseGrant]\n    DR --&gt; DG</code></pre>"},{"location":"user-guide/#crd-overview","title":"CRD Overview","text":"CRD Description Depends On DatabaseInstance Connection to a database server - Database Logical database DatabaseInstance DatabaseUser Database user with credentials DatabaseInstance DatabaseRole Group role for permissions DatabaseInstance DatabaseGrant Permission assignments DatabaseUser, DatabaseRole DatabaseBackup One-time backup Database DatabaseBackupSchedule Scheduled backups Database DatabaseRestore Restore from backup DatabaseBackup"},{"location":"user-guide/#common-patterns","title":"Common Patterns","text":""},{"location":"user-guide/#resource-naming","title":"Resource Naming","text":"<p>All resources support a <code>name</code> field in the spec that defines the actual database object name (e.g., database name, username). If not specified, the Kubernetes resource name is used.</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: my-k8s-resource-name  # Kubernetes resource name\nspec:\n  name: actual_database_name  # Database name (optional, defaults to metadata.name)\n</code></pre>"},{"location":"user-guide/#instance-references","title":"Instance References","text":"<p>Child resources reference their parent <code>DatabaseInstance</code>:</p> <pre><code>spec:\n  instanceRef:\n    name: postgres-primary\n    namespace: default  # Optional, defaults to same namespace\n</code></pre>"},{"location":"user-guide/#deletion-policies","title":"Deletion Policies","text":"<p>Resources that create external database objects support deletion policies:</p> Policy Behavior <code>Retain</code> Keep the database object when CR is deleted <code>Delete</code> Delete the database object when CR is deleted <code>Snapshot</code> Create a backup before deletion (backup-capable resources)"},{"location":"user-guide/#deletion-protection","title":"Deletion Protection","text":"<p>Enable deletion protection to prevent accidental deletion:</p> <pre><code>spec:\n  deletionProtection: true\n</code></pre>"},{"location":"user-guide/#skip-reconcile","title":"Skip Reconcile","text":"<p>Temporarily pause reconciliation:</p> <pre><code>metadata:\n  annotations:\n    dbops.dbprovision.io/skip-reconcile: \"true\"\n</code></pre>"},{"location":"user-guide/#status-phases","title":"Status Phases","text":"<p>All resources report their status through a <code>phase</code> field:</p> Phase Description <code>Pending</code> Waiting for dependencies (e.g., instance not ready) <code>Creating</code> Resource is being created <code>Ready</code> Resource is successfully created and healthy <code>Updating</code> Resource is being updated <code>Deleting</code> Resource is being deleted <code>Failed</code> An error occurred"},{"location":"user-guide/#conditions","title":"Conditions","text":"<p>Resources also expose detailed conditions:</p> <pre><code>status:\n  conditions:\n    - type: Ready\n      status: \"True\"\n      reason: ReconcileSuccess\n      message: \"Database created successfully\"\n      lastTransitionTime: \"2024-01-01T00:00:00Z\"\n</code></pre>"},{"location":"user-guide/#next-steps","title":"Next Steps","text":"<ul> <li>DatabaseInstance - Start by connecting to your database server</li> <li>Database - Create databases</li> <li>DatabaseUser - Manage users</li> <li>Examples - Ready-to-use configurations</li> </ul>"},{"location":"user-guide/backups/","title":"Backups and Restores","text":"<p>DB Provision Operator supports automated backups with multiple storage backends.</p>"},{"location":"user-guide/backups/#resources","title":"Resources","text":"Resource Description <code>DatabaseBackup</code> One-time backup operation <code>DatabaseBackupSchedule</code> Scheduled backups with retention <code>DatabaseRestore</code> Restore from a backup"},{"location":"user-guide/backups/#databasebackup","title":"DatabaseBackup","text":""},{"location":"user-guide/backups/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      region: us-east-1\n      secretRef:\n        name: s3-credentials\n</code></pre>"},{"location":"user-guide/backups/#storage-types","title":"Storage Types","text":""},{"location":"user-guide/backups/#s3-awsminio","title":"S3 (AWS/MinIO)","text":"<pre><code>storage:\n  type: s3\n  s3:\n    bucket: my-backups\n    region: us-east-1\n    prefix: db-backups/postgres\n    endpoint: \"\"  # Optional: for MinIO\n    secretRef:\n      name: s3-credentials\n      keys:\n        accessKey: AWS_ACCESS_KEY_ID\n        secretKey: AWS_SECRET_ACCESS_KEY\n</code></pre>"},{"location":"user-guide/backups/#google-cloud-storage-gcs","title":"Google Cloud Storage (GCS)","text":"<pre><code>storage:\n  type: gcs\n  gcs:\n    bucket: my-backups\n    prefix: db-backups/postgres\n    secretRef:\n      name: gcs-credentials\n      key: credentials.json\n</code></pre>"},{"location":"user-guide/backups/#azure-blob-storage","title":"Azure Blob Storage","text":"<pre><code>storage:\n  type: azure\n  azure:\n    container: my-backups\n    prefix: db-backups/postgres\n    secretRef:\n      name: azure-credentials\n      keys:\n        accountName: AZURE_STORAGE_ACCOUNT\n        accountKey: AZURE_STORAGE_KEY\n</code></pre>"},{"location":"user-guide/backups/#persistentvolumeclaim-pvc","title":"PersistentVolumeClaim (PVC)","text":"<pre><code>storage:\n  type: pvc\n  pvc:\n    claimName: backup-storage\n    subPath: postgres-backups\n</code></pre>"},{"location":"user-guide/backups/#compression","title":"Compression","text":"<pre><code>compression:\n  enabled: true\n  algorithm: gzip  # gzip, lz4, zstd\n  level: 6         # 1-9 for gzip\n</code></pre>"},{"location":"user-guide/backups/#encryption","title":"Encryption","text":"<pre><code>encryption:\n  enabled: true\n  algorithm: aes-256-gcm\n  secretRef:\n    name: backup-encryption-key\n    key: encryption-key\n</code></pre>"},{"location":"user-guide/backups/#postgresql-options","title":"PostgreSQL Options","text":"<pre><code>postgres:\n  method: pg_dump\n  format: custom  # plain, custom, directory, tar\n  jobs: 4         # Parallel jobs (directory format)\n  blobs: true     # Include large objects\n  noOwner: false\n  noPrivileges: false\n  schemas: []     # Specific schemas (empty = all)\n  excludeSchemas: [pg_catalog, information_schema]\n</code></pre>"},{"location":"user-guide/backups/#mysql-options","title":"MySQL Options","text":"<pre><code>mysql:\n  method: mysqldump\n  singleTransaction: true\n  routines: true\n  triggers: true\n  events: false\n</code></pre>"},{"location":"user-guide/backups/#databasebackupschedule","title":"DatabaseBackupSchedule","text":""},{"location":"user-guide/backups/#overview_1","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: daily-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  schedule: \"0 2 * * *\"  # Daily at 2 AM\n  retention:\n    keepLast: 7\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-backups\n        secretRef:\n          name: s3-credentials\n</code></pre>"},{"location":"user-guide/backups/#schedule-format","title":"Schedule Format","text":"<p>Standard cron format: <code>minute hour day-of-month month day-of-week</code></p> Example Description <code>0 2 * * *</code> Daily at 2:00 AM <code>0 */6 * * *</code> Every 6 hours <code>0 2 * * 0</code> Weekly on Sunday at 2:00 AM <code>0 2 1 * *</code> Monthly on the 1<sup>st</sup> at 2:00 AM"},{"location":"user-guide/backups/#retention-policy","title":"Retention Policy","text":"<pre><code>retention:\n  keepLast: 7        # Keep last 7 backups\n  keepDaily: 7       # Keep daily backups for 7 days\n  keepWeekly: 4      # Keep weekly backups for 4 weeks\n  keepMonthly: 3     # Keep monthly backups for 3 months\n</code></pre>"},{"location":"user-guide/backups/#concurrency-policy","title":"Concurrency Policy","text":"<pre><code>concurrencyPolicy: Forbid  # Allow, Forbid, Replace\n</code></pre> Policy Description <code>Allow</code> Run concurrent backups <code>Forbid</code> Skip if previous backup is running <code>Replace</code> Cancel running backup and start new"},{"location":"user-guide/backups/#databaserestore","title":"DatabaseRestore","text":""},{"location":"user-guide/backups/#overview_2","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: myapp-restore\nspec:\n  backupRef:\n    name: myapp-backup\n  targetDatabaseRef:\n    name: myapp-database-restored\n</code></pre>"},{"location":"user-guide/backups/#restore-options","title":"Restore Options","text":"<pre><code>spec:\n  backupRef:\n    name: myapp-backup\n  targetDatabaseRef:\n    name: myapp-database-restored\n  createTarget: true  # Create database if not exists\n  postgres:\n    dropExisting: false\n    dataOnly: false\n    schemaOnly: false\n    noOwner: true\n    jobs: 4\n    disableTriggers: true\n    analyze: true  # Run ANALYZE after restore\n</code></pre>"},{"location":"user-guide/backups/#complete-example","title":"Complete Example","text":""},{"location":"user-guide/backups/#daily-backup-to-s3-with-encryption","title":"Daily Backup to S3 with Encryption","text":"<pre><code># Storage credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: s3-backup-credentials\ntype: Opaque\nstringData:\n  AWS_ACCESS_KEY_ID: your-access-key\n  AWS_SECRET_ACCESS_KEY: your-secret-key\n---\n# Encryption key\napiVersion: v1\nkind: Secret\nmetadata:\n  name: backup-encryption-key\ntype: Opaque\nstringData:\n  encryption-key: your-32-character-encryption-key\n---\n# Backup schedule\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: myapp-daily-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  schedule: \"0 2 * * *\"\n  timezone: \"UTC\"\n  retention:\n    keepLast: 7\n    keepDaily: 7\n    keepWeekly: 4\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-backups\n        region: us-east-1\n        prefix: myapp/postgres\n        secretRef:\n          name: s3-backup-credentials\n    compression:\n      enabled: true\n      algorithm: gzip\n    encryption:\n      enabled: true\n      secretRef:\n        name: backup-encryption-key\n    postgres:\n      format: custom\n      jobs: 4\n</code></pre>"},{"location":"user-guide/backups/#manual-backup-and-restore","title":"Manual Backup and Restore","text":"<pre><code># Create manual backup\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-manual-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      secretRef:\n        name: s3-credentials\n  ttl: \"168h\"  # 7 days\n---\n# Restore to new database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: myapp-restore\nspec:\n  backupRef:\n    name: myapp-manual-backup\n  targetDatabaseRef:\n    name: myapp-database-copy\n  createTarget: true\n</code></pre>"},{"location":"user-guide/backups/#status-monitoring","title":"Status Monitoring","text":""},{"location":"user-guide/backups/#backup-status","title":"Backup Status","text":"<pre><code>kubectl get databasebackup myapp-backup -o yaml\n</code></pre> <pre><code>status:\n  phase: Completed\n  startTime: \"2024-01-01T02:00:00Z\"\n  completionTime: \"2024-01-01T02:05:00Z\"\n  backupSize: \"1.2GB\"\n  backupPath: \"s3://my-backups/myapp/postgres/myapp-backup-20240101020000.dump\"\n</code></pre>"},{"location":"user-guide/backups/#schedule-status","title":"Schedule Status","text":"<pre><code>kubectl get databasebackupschedule daily-backup -o yaml\n</code></pre> <pre><code>status:\n  lastBackupTime: \"2024-01-01T02:00:00Z\"\n  lastBackupName: \"daily-backup-20240101020000\"\n  nextBackupTime: \"2024-01-02T02:00:00Z\"\n  activeBackups: 7\n</code></pre>"},{"location":"user-guide/backups/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/backups/#backup-failed","title":"Backup failed","text":"<ul> <li>Check storage credentials are correct</li> <li>Verify bucket/container exists and is accessible</li> <li>Review backup pod logs</li> <li>Check database connectivity</li> </ul>"},{"location":"user-guide/backups/#restore-failed","title":"Restore failed","text":"<ul> <li>Verify backup exists and is accessible</li> <li>Check target database doesn't exist (or <code>dropExisting: true</code>)</li> <li>Review restore pod logs</li> <li>Ensure sufficient disk space</li> </ul>"},{"location":"user-guide/database-instances/","title":"DatabaseInstance","text":"<p>A <code>DatabaseInstance</code> represents a connection to a database server. It's the foundational resource that all other resources depend on.</p>"},{"location":"user-guide/database-instances/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: postgres-admin-credentials\n</code></pre>"},{"location":"user-guide/database-instances/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/database-instances/#engine-required","title":"engine (required)","text":"<p>The database engine type. Immutable after creation.</p> Value Description <code>postgres</code> PostgreSQL database <code>mysql</code> MySQL or MariaDB database"},{"location":"user-guide/database-instances/#connection-required","title":"connection (required)","text":"<p>Connection configuration for the database server.</p> Field Type Required Description <code>host</code> string Yes Database server hostname or IP <code>port</code> int Yes Database server port <code>database</code> string No Initial database to connect to <code>secretRef</code> object Yes Reference to credentials Secret"},{"location":"user-guide/database-instances/#secretref","title":"secretRef","text":"Field Type Required Description <code>name</code> string Yes Name of the Secret <code>namespace</code> string No Namespace of the Secret (default: same as resource) <code>keys.username</code> string No Key containing username (default: <code>username</code>) <code>keys.password</code> string No Key containing password (default: <code>password</code>)"},{"location":"user-guide/database-instances/#tls-optional","title":"tls (optional)","text":"<p>TLS configuration for secure connections.</p> Field Type Required Description <code>enabled</code> bool No Enable TLS (default: false) <code>mode</code> string No TLS mode (see below) <code>secretRef</code> object No Reference to TLS certificates Secret <p>TLS Modes:</p> Mode Description <code>disable</code> No TLS <code>require</code> TLS required, no certificate verification <code>verify-ca</code> Verify server certificate against CA <code>verify-full</code> Verify server certificate and hostname"},{"location":"user-guide/database-instances/#healthcheck-optional","title":"healthCheck (optional)","text":"<p>Health check configuration.</p> Field Type Required Description <code>enabled</code> bool No Enable health checks (default: true) <code>intervalSeconds</code> int No Check interval (default: 30) <code>timeoutSeconds</code> int No Check timeout (default: 5)"},{"location":"user-guide/database-instances/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific configuration.</p> Field Type Description <code>sslMode</code> string SSL mode (disable, require, verify-ca, verify-full) <code>connectTimeout</code> int Connection timeout in seconds <code>applicationName</code> string Application name for connection identification"},{"location":"user-guide/database-instances/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL-specific configuration.</p> Field Type Description <code>charset</code> string Default charset (e.g., utf8mb4) <code>collation</code> string Default collation <code>timeout</code> string Connection timeout (e.g., \"10s\") <code>tls</code> string TLS mode (disabled, preferred, required)"},{"location":"user-guide/database-instances/#status","title":"Status","text":"Field Description <code>phase</code> Current phase (Pending, Ready, Failed) <code>conditions</code> Detailed conditions <code>observedGeneration</code> Last observed generation <code>lastHealthCheck</code> Last health check timestamp"},{"location":"user-guide/database-instances/#examples","title":"Examples","text":""},{"location":"user-guide/database-instances/#basic-postgresql-instance","title":"Basic PostgreSQL Instance","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-admin-credentials\n</code></pre>"},{"location":"user-guide/database-instances/#postgresql-with-tls","title":"PostgreSQL with TLS","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-secure\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-admin-credentials\n  tls:\n    enabled: true\n    mode: verify-ca\n    secretRef:\n      name: postgres-tls-certs\n      keys:\n        ca: ca.crt\n        cert: tls.crt\n        key: tls.key\n  postgres:\n    sslMode: verify-ca\n</code></pre>"},{"location":"user-guide/database-instances/#mysql-instance","title":"MySQL Instance","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    secretRef:\n      name: mysql-admin-credentials\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre>"},{"location":"user-guide/database-instances/#cross-namespace-secret-reference","title":"Cross-Namespace Secret Reference","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-with-shared-creds\n  namespace: app-namespace\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: shared-postgres-credentials\n      namespace: secrets-namespace\n</code></pre> <p>RBAC for Cross-Namespace</p> <p>Cross-namespace secret access requires additional RBAC configuration. See Security - Cross-Namespace Mode.</p>"},{"location":"user-guide/database-instances/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/database-instances/#instance-stuck-in-pending","title":"Instance stuck in Pending","text":"<ul> <li>Verify the credentials Secret exists and has correct keys</li> <li>Check that the database server is reachable from the cluster</li> <li>Review operator logs for connection errors</li> </ul>"},{"location":"user-guide/database-instances/#connection-refused","title":"Connection refused","text":"<ul> <li>Verify the host and port are correct</li> <li>Check network policies allow traffic to the database</li> <li>Ensure the database server is accepting connections</li> </ul>"},{"location":"user-guide/database-instances/#authentication-failed","title":"Authentication failed","text":"<ul> <li>Verify the credentials in the Secret are correct</li> <li>Check the user has appropriate permissions</li> <li>For PostgreSQL, ensure <code>pg_hba.conf</code> allows the connection</li> </ul>"},{"location":"user-guide/databases/","title":"Database","text":"<p>A <code>Database</code> represents a logical database within a <code>DatabaseInstance</code>.</p>"},{"location":"user-guide/databases/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n</code></pre>"},{"location":"user-guide/databases/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/databases/#instanceref-required","title":"instanceRef (required)","text":"<p>Reference to the parent <code>DatabaseInstance</code>.</p> Field Type Required Description <code>name</code> string Yes Name of the DatabaseInstance <code>namespace</code> string No Namespace (default: same as resource)"},{"location":"user-guide/databases/#name-optional","title":"name (optional)","text":"<p>The actual database name in the database server. Immutable after creation.</p> <ul> <li>Default: Kubernetes resource name (<code>metadata.name</code>)</li> <li>Must follow database naming rules for the target engine</li> </ul>"},{"location":"user-guide/databases/#deletionpolicy-optional","title":"deletionPolicy (optional)","text":"<p>What happens to the database when the CR is deleted.</p> Value Description <code>Retain</code> Keep the database (default) <code>Delete</code> Delete the database <code>Snapshot</code> Create a backup before deletion"},{"location":"user-guide/databases/#deletionprotection-optional","title":"deletionProtection (optional)","text":"<p>Prevent accidental deletion. Default: <code>false</code></p>"},{"location":"user-guide/databases/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific configuration.</p> Field Type Description <code>encoding</code> string Character encoding (default: UTF8) <code>lcCollate</code> string Collation order <code>lcCtype</code> string Character classification <code>tablespace</code> string Default tablespace <code>template</code> string Template database (default: template0) <code>connectionLimit</code> int Max connections (-1 = unlimited) <code>extensions</code> array Extensions to install <code>schemas</code> array Schemas to create"},{"location":"user-guide/databases/#extensions","title":"extensions","text":"Field Type Description <code>name</code> string Extension name <code>schema</code> string Schema to install into"},{"location":"user-guide/databases/#schemas","title":"schemas","text":"Field Type Description <code>name</code> string Schema name <code>owner</code> string Schema owner"},{"location":"user-guide/databases/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL-specific configuration.</p> Field Type Description <code>charset</code> string Default charset (default: utf8mb4) <code>collation</code> string Default collation (default: utf8mb4_unicode_ci) <code>defaultStorageEngine</code> string Default storage engine"},{"location":"user-guide/databases/#status","title":"Status","text":"Field Description <code>phase</code> Current phase <code>conditions</code> Detailed conditions <code>observedGeneration</code> Last observed generation"},{"location":"user-guide/databases/#examples","title":"Examples","text":""},{"location":"user-guide/databases/#basic-database","title":"Basic Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp\nspec:\n  instanceRef:\n    name: postgres-primary\n</code></pre>"},{"location":"user-guide/databases/#postgresql-with-extensions","title":"PostgreSQL with Extensions","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  deletionPolicy: Retain\n  deletionProtection: true\n  postgres:\n    encoding: UTF8\n    lcCollate: en_US.UTF-8\n    lcCtype: en_US.UTF-8\n    connectionLimit: 100\n    extensions:\n      - name: uuid-ossp\n        schema: public\n      - name: pgcrypto\n        schema: public\n      - name: hstore\n        schema: extensions\n    schemas:\n      - name: app\n        owner: myapp_admin\n      - name: audit\n        owner: myapp_admin\n</code></pre>"},{"location":"user-guide/databases/#mysql-database","title":"MySQL Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-mysql\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre>"},{"location":"user-guide/databases/#database-with-delete-policy","title":"Database with Delete Policy","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: temp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: tempdb\n  deletionPolicy: Delete  # Database will be dropped when CR is deleted\n</code></pre>"},{"location":"user-guide/databases/#lifecycle","title":"Lifecycle","text":""},{"location":"user-guide/databases/#creation","title":"Creation","text":"<ol> <li>Operator validates the spec</li> <li>Checks if instance is Ready</li> <li>Creates the database in the server</li> <li>Installs extensions (PostgreSQL)</li> <li>Creates schemas (PostgreSQL)</li> <li>Updates status to Ready</li> </ol>"},{"location":"user-guide/databases/#deletion","title":"Deletion","text":"<p>Based on <code>deletionPolicy</code>:</p> <ul> <li>Retain: CR is deleted, database remains</li> <li>Delete: Database is dropped, then CR is deleted</li> <li>Snapshot: Backup is created, database is dropped, CR is deleted</li> </ul>"},{"location":"user-guide/databases/#updates","title":"Updates","text":"<p>Most fields are immutable after creation. Supported updates:</p> <ul> <li><code>deletionPolicy</code></li> <li><code>deletionProtection</code></li> <li><code>postgres.connectionLimit</code></li> <li>Adding new extensions/schemas</li> </ul>"},{"location":"user-guide/databases/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/databases/#database-stuck-in-pending","title":"Database stuck in Pending","text":"<ul> <li>Verify the DatabaseInstance is in Ready state</li> <li>Check operator logs for errors</li> </ul>"},{"location":"user-guide/databases/#extension-installation-failed","title":"Extension installation failed","text":"<ul> <li>Verify the extension is available in the PostgreSQL installation</li> <li>Check the user has CREATE EXTENSION permission</li> <li>Review operator logs for specific errors</li> </ul>"},{"location":"user-guide/databases/#cannot-delete-database","title":"Cannot delete database","text":"<ul> <li>Check if <code>deletionProtection</code> is enabled</li> <li>Verify no active connections to the database</li> <li>For PostgreSQL, ensure no other databases depend on it</li> </ul>"},{"location":"user-guide/grants/","title":"DatabaseGrant","text":"<p>A <code>DatabaseGrant</code> manages fine-grained permissions for users and roles.</p>"},{"location":"user-guide/grants/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  databaseRef:\n    name: myapp-database\n  postgres:\n    roles:\n      - readonly\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE]\n</code></pre>"},{"location":"user-guide/grants/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/grants/#userref-conditionally-required","title":"userRef (conditionally required)","text":"<p>Reference to a <code>DatabaseUser</code>. Required if <code>roleRef</code> is not specified.</p> Field Type Description <code>name</code> string DatabaseUser name <code>namespace</code> string Namespace (optional)"},{"location":"user-guide/grants/#roleref-conditionally-required","title":"roleRef (conditionally required)","text":"<p>Reference to a <code>DatabaseRole</code>. Required if <code>userRef</code> is not specified.</p> Field Type Description <code>name</code> string DatabaseRole name <code>namespace</code> string Namespace (optional)"},{"location":"user-guide/grants/#databaseref-optional","title":"databaseRef (optional)","text":"<p>Reference to a <code>Database</code> for context.</p> Field Type Description <code>name</code> string Database name <code>namespace</code> string Namespace (optional)"},{"location":"user-guide/grants/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific grant configuration.</p> Field Type Description <code>roles</code> array Roles to assign to the user <code>grants</code> array Direct permission grants <code>defaultPrivileges</code> array Default privileges for future objects"},{"location":"user-guide/grants/#grants","title":"grants","text":"Field Type Required Description <code>database</code> string Yes Target database <code>schema</code> string No Target schema <code>tables</code> array No Tables or <code>[\"*\"]</code> for all <code>sequences</code> array No Sequences or <code>[\"*\"]</code> for all <code>functions</code> array No Functions <code>privileges</code> array Yes Privileges to grant <code>withGrantOption</code> bool No Allow grantee to grant to others <p>Table privileges: <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>TRUNCATE</code>, <code>REFERENCES</code>, <code>TRIGGER</code></p> <p>Sequence privileges: <code>USAGE</code>, <code>SELECT</code>, <code>UPDATE</code></p> <p>Function privileges: <code>EXECUTE</code></p>"},{"location":"user-guide/grants/#defaultprivileges","title":"defaultPrivileges","text":"<p>Apply privileges automatically to future objects:</p> Field Type Description <code>database</code> string Target database <code>schema</code> string Target schema <code>grantedBy</code> string Role that creates objects <code>objectType</code> string <code>tables</code>, <code>sequences</code>, <code>functions</code> <code>privileges</code> array Privileges to grant"},{"location":"user-guide/grants/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL-specific grant configuration.</p> Field Type Description <code>roles</code> array MySQL 8.0+ roles to assign <code>grants</code> array Permission grants"},{"location":"user-guide/grants/#mysql-grants","title":"mysql grants","text":"Field Type Description <code>level</code> string <code>global</code>, <code>database</code>, <code>table</code> <code>database</code> string Database name (for database/table level) <code>table</code> string Table name (for table level) <code>privileges</code> array Privileges to grant <p>MySQL privileges: <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>CREATE</code>, <code>DROP</code>, <code>INDEX</code>, <code>ALTER</code>, <code>EXECUTE</code>, <code>CREATE VIEW</code>, <code>SHOW VIEW</code>, etc.</p>"},{"location":"user-guide/grants/#status","title":"Status","text":"Field Description <code>phase</code> Current phase <code>conditions</code> Detailed conditions"},{"location":"user-guide/grants/#examples","title":"Examples","text":""},{"location":"user-guide/grants/#assign-roles-to-user","title":"Assign Roles to User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-roles\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    roles:\n      - readonly\n      - analytics\n</code></pre>"},{"location":"user-guide/grants/#direct-table-grants","title":"Direct Table Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-table-grants\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    grants:\n      - database: myapp\n        schema: public\n        tables: [users, orders, products]\n        privileges: [SELECT, INSERT, UPDATE]\n      - database: myapp\n        schema: public\n        tables: [audit_log]\n        privileges: [SELECT]  # Read-only on audit\n</code></pre>"},{"location":"user-guide/grants/#grant-all-tables-in-schema","title":"Grant All Tables in Schema","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-all-tables\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    grants:\n      - database: myapp\n        schema: app\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"user-guide/grants/#default-privileges-for-future-tables","title":"Default Privileges for Future Tables","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-default-privileges\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    defaultPrivileges:\n      - database: myapp\n        schema: public\n        grantedBy: myapp_admin\n        objectType: tables\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n      - database: myapp\n        schema: public\n        grantedBy: myapp_admin\n        objectType: sequences\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"user-guide/grants/#combined-roles-and-grants","title":"Combined Roles and Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-full-access\nspec:\n  userRef:\n    name: myapp-user\n  databaseRef:\n    name: myapp-database\n  postgres:\n    roles:\n      - readonly_base  # Inherit basic read\n    grants:\n      - database: myapp\n        schema: app\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]  # Add write\n    defaultPrivileges:\n      - database: myapp\n        schema: app\n        grantedBy: app_admin\n        objectType: tables\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"user-guide/grants/#mysql-database-level-grant","title":"MySQL Database-Level Grant","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-mysql-grants\nspec:\n  userRef:\n    name: myapp-mysql-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"user-guide/grants/#mysql-table-level-grant","title":"MySQL Table-Level Grant","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-mysql-table-grants\nspec:\n  userRef:\n    name: myapp-mysql-user\n  mysql:\n    grants:\n      - level: table\n        database: myapp\n        table: users\n        privileges: [SELECT, INSERT]\n      - level: table\n        database: myapp\n        table: audit_log\n        privileges: [SELECT]\n</code></pre>"},{"location":"user-guide/grants/#grant-vs-role","title":"Grant vs Role","text":"Approach Pros Cons Roles Reusable, hierarchical, easier to maintain Additional indirection Direct Grants Simple, explicit Harder to maintain at scale <p>Recommendation: Use roles for common permission sets, direct grants for specific exceptions.</p>"},{"location":"user-guide/grants/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/grants/#grants-not-applied","title":"Grants not applied","text":"<ul> <li>Verify the user/role exists and is Ready</li> <li>Check the database, schema, and tables exist</li> <li>Ensure proper privileges are specified</li> <li>Review operator logs</li> </ul>"},{"location":"user-guide/grants/#default-privileges-not-working","title":"Default privileges not working","text":"<ul> <li>Verify <code>grantedBy</code> role exists and creates objects</li> <li>Check the schema exists</li> <li>Ensure the user has USAGE on the schema</li> </ul>"},{"location":"user-guide/roles/","title":"DatabaseRole","text":"<p>A <code>DatabaseRole</code> creates group roles for permission management. Roles are primarily used in PostgreSQL for grouping permissions that can be inherited by users.</p>"},{"location":"user-guide/roles/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: readonly\n  postgres:\n    login: false\n</code></pre>"},{"location":"user-guide/roles/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/roles/#instanceref-required","title":"instanceRef (required)","text":"<p>Reference to the parent <code>DatabaseInstance</code>.</p>"},{"location":"user-guide/roles/#rolename-required","title":"roleName (required)","text":"<p>The role name in the database. Immutable after creation.</p>"},{"location":"user-guide/roles/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific role configuration.</p> Field Type Description <code>login</code> bool Can login (default: false for roles) <code>inherit</code> bool Inherit privileges (default: true) <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>connectionLimit</code> int Max connections (-1 = unlimited) <code>inRoles</code> array Roles to inherit from <code>grants</code> array Permissions to grant"},{"location":"user-guide/roles/#grants","title":"grants","text":"Field Type Description <code>database</code> string Database name <code>schema</code> string Schema name <code>tables</code> array Table names or <code>[\"*\"]</code> for all <code>sequences</code> array Sequence names or <code>[\"*\"]</code> for all <code>functions</code> array Function names <code>privileges</code> array Privileges to grant <p>Available privileges:</p> <ul> <li>Tables: <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>TRUNCATE</code>, <code>REFERENCES</code>, <code>TRIGGER</code></li> <li>Sequences: <code>USAGE</code>, <code>SELECT</code>, <code>UPDATE</code></li> <li>Functions: <code>EXECUTE</code></li> </ul>"},{"location":"user-guide/roles/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL role configuration (MySQL 8.0+ only).</p> Field Type Description <code>grants</code> array Permissions to grant"},{"location":"user-guide/roles/#status","title":"Status","text":"Field Description <code>phase</code> Current phase <code>conditions</code> Detailed conditions"},{"location":"user-guide/roles/#examples","title":"Examples","text":""},{"location":"user-guide/roles/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: readonly\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"user-guide/roles/#read-write-role","title":"Read-Write Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readwrite-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: readwrite\n  postgres:\n    login: false\n    inRoles:\n      - readonly  # Inherit read permissions\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"user-guide/roles/#admin-role","title":"Admin Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: admin-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: app_admin\n  postgres:\n    login: false\n    createDB: false\n    createRole: true\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE, TRUNCATE]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT, UPDATE]\n</code></pre>"},{"location":"user-guide/roles/#role-hierarchy","title":"Role Hierarchy","text":"<p>Create a hierarchy of roles for complex permission models:</p> <pre><code># Level 1: Basic read access\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: l1-reader\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: l1_reader\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n---\n# Level 2: Read + Write\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: l2-writer\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: l2_writer\n  postgres:\n    login: false\n    inRoles: [l1_reader]\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE]\n---\n# Level 3: Full access\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: l3-admin\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: l3_admin\n  postgres:\n    login: false\n    inRoles: [l2_writer]\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [DELETE, TRUNCATE]\n</code></pre>"},{"location":"user-guide/roles/#best-practices","title":"Best Practices","text":"<ol> <li>Use roles for grouping - Create roles for permission sets, then assign roles to users</li> <li>Keep roles non-login - Roles should not have login capability; users should</li> <li>Use inheritance - Build role hierarchies with <code>inRoles</code> for maintainability</li> <li>Principle of least privilege - Grant only necessary permissions</li> </ol>"},{"location":"user-guide/roles/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/roles/#role-not-created","title":"Role not created","text":"<ul> <li>Verify the DatabaseInstance is Ready</li> <li>Check the admin user has CREATE ROLE permission</li> <li>Review operator logs for errors</li> </ul>"},{"location":"user-guide/roles/#grants-not-applied","title":"Grants not applied","text":"<ul> <li>Ensure the database and schema exist</li> <li>Verify the tables/sequences exist</li> <li>Check for syntax errors in privilege names</li> </ul>"},{"location":"user-guide/users/","title":"DatabaseUser","text":"<p>A <code>DatabaseUser</code> creates and manages database users with automatic credential management.</p>"},{"location":"user-guide/users/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"user-guide/users/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/users/#instanceref-required","title":"instanceRef (required)","text":"<p>Reference to the parent <code>DatabaseInstance</code>.</p>"},{"location":"user-guide/users/#username-required","title":"username (required)","text":"<p>The username in the database. Immutable after creation.</p>"},{"location":"user-guide/users/#passwordsecret-optional","title":"passwordSecret (optional)","text":"<p>Configuration for password management.</p> Field Type Description <code>generate</code> bool Auto-generate a secure password <code>length</code> int Password length (default: 24) <code>includeSpecialChars</code> bool Include special characters (default: true) <code>excludeChars</code> string Characters to exclude <code>secretName</code> string Name for the generated Secret <code>secretTemplate</code> object Custom Secret template"},{"location":"user-guide/users/#secrettemplate","title":"secretTemplate","text":"<p>Customize the generated Secret:</p> Field Type Description <code>labels</code> map Additional labels <code>annotations</code> map Additional annotations <code>data</code> map Additional data fields with templates <p>Template variables:</p> <ul> <li><code>{{ .Username }}</code> - The username</li> <li><code>{{ .Password }}</code> - The password</li> <li><code>{{ .Host }}</code> - Database host</li> <li><code>{{ .Port }}</code> - Database port</li> <li><code>{{ .Database }}</code> - Database name</li> <li><code>{{ .SSLMode }}</code> - SSL mode (PostgreSQL)</li> </ul>"},{"location":"user-guide/users/#existingpasswordsecret-optional","title":"existingPasswordSecret (optional)","text":"<p>Use an existing password instead of generating one.</p> Field Type Description <code>name</code> string Secret name <code>key</code> string Key containing the password"},{"location":"user-guide/users/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific user configuration.</p> Field Type Description <code>connectionLimit</code> int Max concurrent connections <code>inherit</code> bool Inherit role privileges (default: true) <code>login</code> bool Can login (default: true) <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>inRoles</code> array Roles to inherit from <code>configParameters</code> map Session parameters"},{"location":"user-guide/users/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL-specific user configuration.</p> Field Type Description <code>maxQueriesPerHour</code> int Query limit (0 = unlimited) <code>maxUpdatesPerHour</code> int Update limit <code>maxConnectionsPerHour</code> int Connection limit per hour <code>maxUserConnections</code> int Max concurrent connections <code>authPlugin</code> string Authentication plugin <code>requireSSL</code> bool Require SSL connections <code>allowedHosts</code> array Allowed connection hosts <code>accountLocked</code> bool Lock the account"},{"location":"user-guide/users/#status","title":"Status","text":"Field Description <code>phase</code> Current phase <code>conditions</code> Detailed conditions <code>credentialsSecretRef</code> Reference to the credentials Secret"},{"location":"user-guide/users/#examples","title":"Examples","text":""},{"location":"user-guide/users/#basic-user-with-generated-password","title":"Basic User with Generated Password","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"user-guide/users/#user-with-custom-secret-template","title":"User with Custom Secret Template","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n    secretTemplate:\n      labels:\n        app: myapp\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp?sslmode={{ .SSLMode }}\"\n        JDBC_URL: \"jdbc:postgresql://{{ .Host }}:{{ .Port }}/myapp?user={{ .Username }}&amp;password={{ .Password }}\"\n</code></pre>"},{"location":"user-guide/users/#user-with-existing-password","title":"User with Existing Password","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  existingPasswordSecret:\n    name: my-existing-password\n    key: password\n</code></pre>"},{"location":"user-guide/users/#postgresql-user-with-role-membership","title":"PostgreSQL User with Role Membership","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n  postgres:\n    connectionLimit: 20\n    inRoles:\n      - readonly_role\n      - analytics_role\n    configParameters:\n      search_path: \"app,public\"\n      statement_timeout: \"30000\"\n</code></pre>"},{"location":"user-guide/users/#mysql-user-with-host-restrictions","title":"MySQL User with Host Restrictions","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-mysql-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-mysql-credentials\n  mysql:\n    maxUserConnections: 50\n    authPlugin: caching_sha2_password\n    allowedHosts:\n      - \"10.0.0.%\"\n      - \"192.168.1.%\"\n</code></pre>"},{"location":"user-guide/users/#generated-secret-structure","title":"Generated Secret Structure","text":"<p>When <code>passwordSecret.generate: true</code>, the operator creates a Secret:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: myapp-user-credentials\n  ownerReferences:\n    - apiVersion: dbops.dbprovision.io/v1alpha1\n      kind: DatabaseUser\n      name: myapp-user\ntype: Opaque\ndata:\n  username: &lt;base64&gt;\n  password: &lt;base64&gt;\n  # Plus any custom fields from secretTemplate\n</code></pre>"},{"location":"user-guide/users/#password-rotation","title":"Password Rotation","text":"<p>To rotate a password:</p> <ol> <li>Delete the existing credentials Secret</li> <li>The operator will detect the missing Secret and regenerate</li> </ol> <p>Or use the annotation:</p> <pre><code>metadata:\n  annotations:\n    dbops.dbprovision.io/rotate-password: \"true\"\n</code></pre>"},{"location":"user-guide/users/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/users/#user-stuck-in-pending","title":"User stuck in Pending","text":"<ul> <li>Verify the DatabaseInstance is Ready</li> <li>Check the credentials Secret exists (if using existing)</li> </ul>"},{"location":"user-guide/users/#password-not-generated","title":"Password not generated","text":"<ul> <li>Check if <code>passwordSecret.generate: true</code> is set</li> <li>Verify <code>secretName</code> is specified</li> <li>Check for errors in operator logs</li> </ul>"},{"location":"user-guide/users/#cannot-connect-with-generated-password","title":"Cannot connect with generated password","text":"<ul> <li>Verify the Secret contains the correct password</li> <li>Check the user was created in the database</li> <li>For PostgreSQL, verify pg_hba.conf allows the connection</li> </ul>"}]}