{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"DB Provision Operator","text":"<p>Kubernetes operator for declarative database provisioning across PostgreSQL, MySQL, and MariaDB.</p>"},{"location":"#overview","title":"Overview","text":"<p>DB Provision Operator is a Kubernetes operator that provides a unified, declarative interface for managing database resources. Instead of manually creating databases, users, and permissions, you define them as Kubernetes Custom Resources and the operator handles the rest.</p>"},{"location":"#features","title":"Features","text":"<ul> <li>Unified API - Single CRD-based interface for PostgreSQL, MySQL, and MariaDB</li> <li>Declarative Management - GitOps-friendly database provisioning</li> <li>Automatic Credentials - Secure password generation and Kubernetes Secret management</li> <li>Fine-grained Access Control - Users, roles, and grants management</li> <li>Backup Automation - Scheduled backups with configurable retention policies</li> <li>Health Monitoring - Configurable health checks with status reporting</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":"Helm (Recommended)Kustomize <pre><code># Add the Helm repository\nhelm repo add db-provision https://panteparak.github.io/db-provision-operator/charts\nhelm repo update\n\n# Install the operator\nhelm install db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system \\\n  --create-namespace\n</code></pre> <pre><code>kubectl apply -f https://github.com/panteparak/db-provision-operator/releases/latest/download/install.yaml\n</code></pre>"},{"location":"#custom-resource-definitions","title":"Custom Resource Definitions","text":"CRD Description Short Name <code>DatabaseInstance</code> Database server connection configuration <code>dbi</code> <code>Database</code> Logical database within an instance <code>db</code> <code>DatabaseUser</code> Database user with credentials <code>dbu</code> <code>DatabaseRole</code> Group role for permission management <code>dbr</code> <code>DatabaseGrant</code> Fine-grained permission grants <code>dbg</code> <code>DatabaseBackup</code> One-time backup operation <code>dbbak</code> <code>DatabaseBackupSchedule</code> Scheduled backup configuration <code>dbbaksch</code> <code>DatabaseRestore</code> Restore from backup <code>dbrest</code>"},{"location":"#example-create-a-postgresql-database","title":"Example: Create a PostgreSQL Database","text":"<pre><code># 1. Define credentials secret\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin-credentials\ntype: Opaque\nstringData:\n  username: postgres\n  password: your-secure-password\n---\n# 2. Create DatabaseInstance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-admin-credentials\n---\n# 3. Create Database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n---\n# 4. Create User with auto-generated password\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li> <p> Installation</p> <p>Detailed installation instructions for Helm, Kustomize, and from source.</p> </li> <li> <p> Quick Start</p> <p>Step-by-step tutorial to get your first database running.</p> </li> <li> <p> User Guide</p> <p>Comprehensive guide for all CRDs and features.</p> </li> <li> <p> Engine Guides</p> <p>Engine-specific features for PostgreSQL, MySQL, and MariaDB.</p> </li> </ul>"},{"location":"#support","title":"Support","text":"<ul> <li>GitHub Issues: Report bugs or request features</li> <li>Documentation: You're here!</li> </ul>"},{"location":"#license","title":"License","text":"<p>DB Provision Operator is licensed under the Apache License 2.0.</p>"},{"location":"api/","title":"API Reference","text":"<p>Complete API reference for all DB Provision Operator Custom Resource Definitions.</p> <p>Auto-Generated Reference</p> <p>For the complete auto-generated API reference with all fields and validation rules, see API Reference (Full).</p>"},{"location":"api/#api-group","title":"API Group","text":"<p>All resources belong to the <code>dbops.dbprovision.io</code> API group.</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\n</code></pre>"},{"location":"api/#resources-overview","title":"Resources Overview","text":"Kind Description Scope <code>DatabaseInstance</code> Database server connection Namespaced <code>Database</code> Logical database Namespaced <code>DatabaseUser</code> Database user Namespaced <code>DatabaseRole</code> Permission group Namespaced <code>DatabaseGrant</code> Fine-grained permissions Namespaced <code>DatabaseBackup</code> One-time backup Namespaced <code>DatabaseBackupSchedule</code> Scheduled backups Namespaced <code>DatabaseRestore</code> Restore operation Namespaced"},{"location":"api/#databaseinstance","title":"DatabaseInstance","text":"<p>Represents a connection to a database server.</p>"},{"location":"api/#spec","title":"Spec","text":"Field Type Required Description <code>engine</code> string Yes Database engine: <code>postgres</code>, <code>mysql</code>, <code>mariadb</code>, <code>cockroachdb</code> <code>connection</code> object Yes Connection configuration <code>healthCheck</code> object No Health check configuration"},{"location":"api/#connection","title":"connection","text":"Field Type Required Description <code>host</code> string Yes Database host <code>port</code> int No Database port (default: engine-specific) <code>database</code> string No Database name for connection <code>sslMode</code> string No PostgreSQL SSL mode <code>secretRef</code> object Yes Reference to credentials Secret <code>tls</code> object No TLS configuration"},{"location":"api/#healthcheck","title":"healthCheck","text":"Field Type Default Description <code>enabled</code> bool true Enable health checks <code>intervalSeconds</code> int 30 Check interval <code>timeoutSeconds</code> int 5 Check timeout <code>failureThreshold</code> int 3 Failures before unhealthy"},{"location":"api/#status","title":"Status","text":"Field Type Description <code>phase</code> string Current phase: <code>Pending</code>, <code>Ready</code>, <code>Failed</code> <code>conditions</code> array Detailed conditions <code>observedGeneration</code> int Last observed generation <code>version</code> string Detected database version"},{"location":"api/#database","title":"Database","text":"<p>Represents a logical database within a DatabaseInstance.</p>"},{"location":"api/#spec_1","title":"Spec","text":"Field Type Required Description <code>instanceRef</code> object Yes Reference to DatabaseInstance <code>name</code> string No Database name (default: metadata.name) <code>deletionPolicy</code> string No <code>Retain</code>, <code>Delete</code>, <code>Snapshot</code> <code>deletionProtection</code> bool No Prevent deletion <code>postgres</code> object No PostgreSQL-specific options <code>mysql</code> object No MySQL/MariaDB-specific options"},{"location":"api/#postgres","title":"postgres","text":"Field Type Description <code>encoding</code> string Character encoding (default: UTF8) <code>lcCollate</code> string Collation order <code>lcCtype</code> string Character classification <code>tablespace</code> string Default tablespace <code>template</code> string Template database <code>connectionLimit</code> int Max connections <code>extensions</code> array Extensions to install <code>schemas</code> array Schemas to create"},{"location":"api/#mysql","title":"mysql","text":"Field Type Description <code>charset</code> string Default charset <code>collation</code> string Default collation <code>defaultStorageEngine</code> string Default storage engine"},{"location":"api/#status_1","title":"Status","text":"Field Type Description <code>phase</code> string Current phase <code>conditions</code> array Detailed conditions <code>observedGeneration</code> int Last observed generation"},{"location":"api/#databaseuser","title":"DatabaseUser","text":"<p>Represents a database user with credential management.</p>"},{"location":"api/#spec_2","title":"Spec","text":"Field Type Required Description <code>instanceRef</code> object Yes Reference to DatabaseInstance <code>username</code> string Yes Username in database <code>passwordSecret</code> object No Password generation config <code>existingPasswordSecret</code> object No Use existing password <code>postgres</code> object No PostgreSQL-specific options <code>mysql</code> object No MySQL/MariaDB-specific options"},{"location":"api/#passwordsecret","title":"passwordSecret","text":"Field Type Description <code>generate</code> bool Auto-generate password <code>length</code> int Password length (default: 24) <code>includeSpecialChars</code> bool Include special chars <code>excludeChars</code> string Characters to exclude <code>secretName</code> string Generated Secret name <code>secretTemplate</code> object Custom Secret template"},{"location":"api/#postgres-user","title":"postgres (user)","text":"Field Type Description <code>login</code> bool Can login (default: true) <code>inherit</code> bool Inherit privileges <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>connectionLimit</code> int Max connections <code>inRoles</code> array Roles to inherit <code>configParameters</code> map Session parameters"},{"location":"api/#mysql-user","title":"mysql (user)","text":"Field Type Description <code>maxQueriesPerHour</code> int Query limit <code>maxUpdatesPerHour</code> int Update limit <code>maxConnectionsPerHour</code> int Connection limit per hour <code>maxUserConnections</code> int Max concurrent connections <code>authPlugin</code> string Authentication plugin <code>requireSSL</code> bool Require SSL <code>allowedHosts</code> array Allowed connection hosts <code>accountLocked</code> bool Lock account"},{"location":"api/#status_2","title":"Status","text":"Field Type Description <code>phase</code> string Current phase <code>conditions</code> array Detailed conditions <code>credentialsSecretRef</code> object Reference to credentials Secret"},{"location":"api/#databaserole","title":"DatabaseRole","text":"<p>Represents a permission group (primarily PostgreSQL).</p>"},{"location":"api/#spec_3","title":"Spec","text":"Field Type Required Description <code>instanceRef</code> object Yes Reference to DatabaseInstance <code>roleName</code> string Yes Role name in database <code>postgres</code> object No PostgreSQL-specific options <code>mysql</code> object No MySQL-specific options (8.0+)"},{"location":"api/#postgres-role","title":"postgres (role)","text":"Field Type Description <code>login</code> bool Can login (default: false for roles) <code>inherit</code> bool Inherit privileges <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>connectionLimit</code> int Max connections <code>inRoles</code> array Roles to inherit <code>grants</code> array Permission grants"},{"location":"api/#status_3","title":"Status","text":"Field Type Description <code>phase</code> string Current phase <code>conditions</code> array Detailed conditions"},{"location":"api/#databasegrant","title":"DatabaseGrant","text":"<p>Represents fine-grained permissions for users or roles.</p>"},{"location":"api/#spec_4","title":"Spec","text":"Field Type Required Description <code>userRef</code> object Conditional Reference to DatabaseUser <code>roleRef</code> object Conditional Reference to DatabaseRole <code>databaseRef</code> object No Reference to Database <code>postgres</code> object No PostgreSQL grants <code>mysql</code> object No MySQL grants <p>userRef or roleRef</p> <p>Either <code>userRef</code> or <code>roleRef</code> is required, but not both.</p>"},{"location":"api/#postgres-grants","title":"postgres (grants)","text":"Field Type Description <code>roles</code> array Roles to assign <code>grants</code> array Direct permission grants <code>defaultPrivileges</code> array Default privileges for future objects"},{"location":"api/#mysql-grants","title":"mysql (grants)","text":"Field Type Description <code>roles</code> array Roles to assign (MySQL 8.0+) <code>grants</code> array Permission grants"},{"location":"api/#status_4","title":"Status","text":"Field Type Description <code>phase</code> string Current phase <code>conditions</code> array Detailed conditions"},{"location":"api/#databasebackup","title":"DatabaseBackup","text":"<p>Represents a one-time backup operation.</p>"},{"location":"api/#spec_5","title":"Spec","text":"Field Type Required Description <code>databaseRef</code> object Yes Reference to Database <code>storage</code> object Yes Storage configuration <code>compression</code> object No Compression settings <code>encryption</code> object No Encryption settings <code>ttl</code> string No Time-to-live (e.g., \"168h\") <code>postgres</code> object No PostgreSQL backup options <code>mysql</code> object No MySQL backup options"},{"location":"api/#storage","title":"storage","text":"Field Type Description <code>type</code> string <code>s3</code>, <code>gcs</code>, <code>azure</code>, <code>pvc</code> <code>s3</code> object S3/MinIO configuration <code>gcs</code> object Google Cloud Storage config <code>azure</code> object Azure Blob Storage config <code>pvc</code> object PersistentVolumeClaim config"},{"location":"api/#status_5","title":"Status","text":"Field Type Description <code>phase</code> string <code>Pending</code>, <code>Running</code>, <code>Completed</code>, <code>Failed</code> <code>startTime</code> string Backup start time <code>completionTime</code> string Backup completion time <code>backupSize</code> string Size of backup <code>backupPath</code> string Path to backup file"},{"location":"api/#databasebackupschedule","title":"DatabaseBackupSchedule","text":"<p>Represents scheduled backup operations with retention.</p>"},{"location":"api/#spec_6","title":"Spec","text":"Field Type Required Description <code>databaseRef</code> object Yes Reference to Database <code>schedule</code> string Yes Cron expression <code>timezone</code> string No Timezone (default: UTC) <code>retention</code> object No Retention policy <code>concurrencyPolicy</code> string No <code>Allow</code>, <code>Forbid</code>, <code>Replace</code> <code>backupTemplate</code> object Yes Backup configuration"},{"location":"api/#retention","title":"retention","text":"Field Type Description <code>keepLast</code> int Keep last N backups <code>keepDaily</code> int Keep daily backups for N days <code>keepWeekly</code> int Keep weekly backups for N weeks <code>keepMonthly</code> int Keep monthly backups for N months"},{"location":"api/#status_6","title":"Status","text":"Field Type Description <code>lastBackupTime</code> string Last backup time <code>lastBackupName</code> string Last backup resource name <code>nextBackupTime</code> string Next scheduled backup <code>activeBackups</code> int Number of retained backups"},{"location":"api/#databaserestore","title":"DatabaseRestore","text":"<p>Represents a restore operation from a backup.</p>"},{"location":"api/#spec_7","title":"Spec","text":"Field Type Required Description <code>backupRef</code> object Yes Reference to DatabaseBackup <code>targetDatabaseRef</code> object Yes Target Database reference <code>createTarget</code> bool No Create database if not exists <code>postgres</code> object No PostgreSQL restore options <code>mysql</code> object No MySQL restore options"},{"location":"api/#status_7","title":"Status","text":"Field Type Description <code>phase</code> string <code>Pending</code>, <code>Running</code>, <code>Completed</code>, <code>Failed</code> <code>startTime</code> string Restore start time <code>completionTime</code> string Restore completion time"},{"location":"api/#common-types","title":"Common Types","text":""},{"location":"api/#objectreference","title":"ObjectReference","text":"<p>Used for referencing other resources.</p> Field Type Required Description <code>name</code> string Yes Resource name <code>namespace</code> string No Namespace (default: same as referencing resource)"},{"location":"api/#secretkeyselector","title":"SecretKeySelector","text":"<p>Used for referencing Secret keys.</p> Field Type Required Description <code>name</code> string Yes Secret name <code>key</code> string Yes Key within Secret"},{"location":"api/#condition","title":"Condition","text":"<p>Standard Kubernetes condition.</p> Field Type Description <code>type</code> string Condition type <code>status</code> string <code>True</code>, <code>False</code>, <code>Unknown</code> <code>reason</code> string Machine-readable reason <code>message</code> string Human-readable message <code>lastTransitionTime</code> string Last transition time"},{"location":"api/#phases","title":"Phases","text":"<p>All resources use consistent phase values:</p> Phase Description <code>Pending</code> Resource is being processed <code>Ready</code> Resource is ready for use <code>Failed</code> Resource encountered an error <code>Deleting</code> Resource is being deleted <p>For backup/restore operations:</p> Phase Description <code>Pending</code> Operation not started <code>Running</code> Operation in progress <code>Completed</code> Operation successful <code>Failed</code> Operation failed"},{"location":"api/reference/","title":"API Reference","text":""},{"location":"api/reference/#packages","title":"Packages","text":"<ul> <li>dbops.dbprovision.io/v1alpha1</li> </ul>"},{"location":"api/reference/#dbopsdbprovisioniov1alpha1","title":"dbops.dbprovision.io/v1alpha1","text":"<p>Package v1alpha1 contains API Schema definitions for the dbops v1alpha1 API group.</p>"},{"location":"api/reference/#resource-types","title":"Resource Types","text":"<ul> <li>Database</li> <li>DatabaseBackup</li> <li>DatabaseBackupSchedule</li> <li>DatabaseGrant</li> <li>DatabaseInstance</li> <li>DatabaseRestore</li> <li>DatabaseRole</li> <li>DatabaseUser</li> </ul>"},{"location":"api/reference/#appliedgrantsinfo","title":"AppliedGrantsInfo","text":"<p>AppliedGrantsInfo contains information about applied grants</p> <p>Appears in: - DatabaseGrantStatus</p> Field Description Default Validation <code>roles</code> string array Roles lists assigned roles <code>directGrants</code> integer DirectGrants is the count of direct grants applied <code>defaultPrivileges</code> integer DefaultPrivileges is the count of default privileges applied"},{"location":"api/reference/#azurestorageconfig","title":"AzureStorageConfig","text":"<p>AzureStorageConfig defines Azure Blob Storage configuration</p> <p>Appears in: - StorageConfig</p> Field Description Default Validation <code>container</code> string Container name Required: {}  <code>storageAccount</code> string StorageAccount name Required: {}  <code>prefix</code> string Prefix (path prefix within the container) Optional: {}  <code>secretRef</code> SecretReference SecretRef references a secret containing Azure credentials Required: {}"},{"location":"api/reference/#backupinfo","title":"BackupInfo","text":"<p>BackupInfo contains backup file information</p> <p>Appears in: - DatabaseBackupStatus</p> Field Description Default Validation <code>path</code> string Path is the full path to the backup file <code>sizeBytes</code> integer SizeBytes is the backup size in bytes (uncompressed) <code>compressedSizeBytes</code> integer CompressedSizeBytes is the backup size in bytes (compressed) <code>checksum</code> string Checksum is the backup file checksum <code>format</code> string Format is the backup format (e.g., custom, plain, directory)"},{"location":"api/reference/#backupreference","title":"BackupReference","text":"<p>BackupReference references a DatabaseBackup</p> <p>Appears in: - DatabaseRestoreSpec</p> Field Description Default Validation <code>name</code> string Name of the DatabaseBackup resource Required: {}  <code>namespace</code> string Namespace of the DatabaseBackup (defaults to the resource namespace) Optional: {}"},{"location":"api/reference/#backupsourceinfo","title":"BackupSourceInfo","text":"<p>BackupSourceInfo contains information about the backup source</p> <p>Appears in: - DatabaseBackupStatus</p> Field Description Default Validation <code>instance</code> string Instance is the DatabaseInstance name <code>database</code> string Database is the database name <code>engine</code> string Engine is the database engine type <code>version</code> string Version is the database server version <code>timestamp</code> Time Timestamp is the point-in-time of the backup"},{"location":"api/reference/#backupstatistics","title":"BackupStatistics","text":"<p>BackupStatistics contains backup statistics</p> <p>Appears in: - DatabaseBackupScheduleStatus</p> Field Description Default Validation <code>totalBackups</code> integer TotalBackups is the total number of backups created <code>successfulBackups</code> integer SuccessfulBackups is the number of successful backups <code>failedBackups</code> integer FailedBackups is the number of failed backups <code>averageDurationSeconds</code> integer AverageDurationSeconds is the average backup duration <code>averageSizeBytes</code> integer AverageSizeBytes is the average backup size <code>totalStorageBytes</code> integer TotalStorageBytes is the total storage used by all backups"},{"location":"api/reference/#backuptemplatemeta","title":"BackupTemplateMeta","text":"<p>BackupTemplateMeta defines metadata for created backups</p> <p>Appears in: - BackupTemplateSpec</p> Field Description Default Validation <code>labels</code> object (keys:string, values:string) Labels to add to created backups Optional: {}  <code>annotations</code> object (keys:string, values:string) Annotations to add to created backups Optional: {}"},{"location":"api/reference/#backuptemplatespec","title":"BackupTemplateSpec","text":"<p>BackupTemplateSpec defines the template for created backups</p> <p>Appears in: - DatabaseBackupScheduleSpec</p> Field Description Default Validation <code>metadata</code> BackupTemplateMeta Refer to Kubernetes API documentation for fields of <code>metadata</code>. Optional: {}  <code>spec</code> DatabaseBackupSpec Spec for the created backup Required: {}"},{"location":"api/reference/#compressionalgorithm","title":"CompressionAlgorithm","text":"<p>Underlying type: string</p> <p>CompressionAlgorithm defines the compression algorithm</p> <p>Validation: - Enum: [gzip lz4 zstd none]</p> <p>Appears in: - CompressionConfig</p> Field Description <code>gzip</code> <code>lz4</code> <code>zstd</code> <code>none</code>"},{"location":"api/reference/#compressionconfig","title":"CompressionConfig","text":"<p>CompressionConfig defines backup compression settings</p> <p>Appears in: - DatabaseBackupSpec - RestoreFromPath</p> Field Description Default Validation <code>enabled</code> boolean Enabled enables compression true <code>algorithm</code> CompressionAlgorithm Algorithm specifies the compression algorithm gzip Enum: [gzip lz4 zstd]  <code>level</code> integer Level specifies the compression level (1-9) 6 Maximum: 9 Minimum: 1"},{"location":"api/reference/#concurrencypolicy","title":"ConcurrencyPolicy","text":"<p>Underlying type: string</p> <p>ConcurrencyPolicy defines how to handle concurrent backups</p> <p>Validation: - Enum: [Allow Forbid Replace]</p> <p>Appears in: - DatabaseBackupScheduleSpec</p> Field Description <code>Allow</code> <code>Forbid</code> <code>Replace</code>"},{"location":"api/reference/#connectionconfig","title":"ConnectionConfig","text":"<p>ConnectionConfig defines the database connection settings</p> <p>Appears in: - DatabaseInstanceSpec</p> Field Description Default Validation <code>host</code> string Host is the database server hostname or IP MinLength: 1 Required: {}  <code>port</code> integer Port is the database server port Maximum: 65535 Minimum: 1 Required: {}  <code>database</code> string Database is the admin database name for initial connection Required: {}  <code>secretRef</code> CredentialSecretRef SecretRef references a secret containing credentials (mutually exclusive with ExistingSecret) Optional: {}  <code>existingSecret</code> CredentialSecretRef ExistingSecret references an existing secret with custom keys (mutually exclusive with SecretRef) Optional: {}"},{"location":"api/reference/#credentialkeys","title":"CredentialKeys","text":"<p>CredentialKeys defines the key names within a credential secret</p> <p>Appears in: - CredentialSecretRef</p> Field Description Default Validation <code>username</code> string Username key in the secret (default: \"username\") username <code>password</code> string Password key in the secret (default: \"password\") password"},{"location":"api/reference/#credentialsecretref","title":"CredentialSecretRef","text":"<p>CredentialSecretRef references credentials in a secret</p> <p>Appears in: - ConnectionConfig</p> Field Description Default Validation <code>name</code> string Name of the secret containing credentials Required: {}  <code>namespace</code> string Namespace of the secret (defaults to the resource's namespace if not specified) Optional: {}  <code>keys</code> CredentialKeys Keys defines the key names for username and password Optional: {}"},{"location":"api/reference/#database","title":"Database","text":"<p>Database is the Schema for the databases API.</p> Field Description Default Validation <code>apiVersion</code> string <code>dbops.dbprovision.io/v1alpha1</code> <code>kind</code> string <code>Database</code> <code>metadata</code> ObjectMeta Refer to Kubernetes API documentation for fields of <code>metadata</code>. <code>spec</code> DatabaseSpec <code>status</code> DatabaseStatus"},{"location":"api/reference/#databasebackup","title":"DatabaseBackup","text":"<p>DatabaseBackup is the Schema for the databasebackups API.</p> Field Description Default Validation <code>apiVersion</code> string <code>dbops.dbprovision.io/v1alpha1</code> <code>kind</code> string <code>DatabaseBackup</code> <code>metadata</code> ObjectMeta Refer to Kubernetes API documentation for fields of <code>metadata</code>. <code>spec</code> DatabaseBackupSpec <code>status</code> DatabaseBackupStatus"},{"location":"api/reference/#databasebackupschedule","title":"DatabaseBackupSchedule","text":"<p>DatabaseBackupSchedule is the Schema for the databasebackupschedules API.</p> Field Description Default Validation <code>apiVersion</code> string <code>dbops.dbprovision.io/v1alpha1</code> <code>kind</code> string <code>DatabaseBackupSchedule</code> <code>metadata</code> ObjectMeta Refer to Kubernetes API documentation for fields of <code>metadata</code>. <code>spec</code> DatabaseBackupScheduleSpec <code>status</code> DatabaseBackupScheduleStatus"},{"location":"api/reference/#databasebackupschedulespec","title":"DatabaseBackupScheduleSpec","text":"<p>DatabaseBackupScheduleSpec defines the desired state of DatabaseBackupSchedule.</p> <p>Appears in: - DatabaseBackupSchedule</p> Field Description Default Validation <code>schedule</code> string Schedule is the cron expression for the backup schedule MinLength: 1 Required: {}  <code>timezone</code> string Timezone is the timezone for the schedule (e.g., \"Asia/Bangkok\") UTC <code>paused</code> boolean Paused suspends the schedule Optional: {}  <code>concurrencyPolicy</code> ConcurrencyPolicy ConcurrencyPolicy defines how to handle concurrent backups Forbid Enum: [Allow Forbid Replace]  <code>template</code> BackupTemplateSpec Template defines the DatabaseBackup to create Required: {}  <code>retention</code> RetentionPolicy Retention defines the backup retention policy Optional: {}  <code>successfulBackupsHistoryLimit</code> integer SuccessfulBackupsHistoryLimit is the number of successful backups to keep in status 5 Minimum: 0  <code>failedBackupsHistoryLimit</code> integer FailedBackupsHistoryLimit is the number of failed backups to keep in status 3 Minimum: 0  <code>deletionProtection</code> boolean DeletionProtection prevents accidental deletion Optional: {}"},{"location":"api/reference/#databasebackupschedulestatus","title":"DatabaseBackupScheduleStatus","text":"<p>DatabaseBackupScheduleStatus defines the observed state of DatabaseBackupSchedule.</p> <p>Appears in: - DatabaseBackupSchedule</p> Field Description Default Validation <code>phase</code> Phase Phase represents the current state Enum: [Active Paused]  <code>lastBackup</code> ScheduledBackupInfo LastBackup contains information about the last backup <code>nextBackupTime</code> Time NextBackupTime is the next scheduled backup time <code>statistics</code> BackupStatistics Statistics contains backup statistics <code>recentBackups</code> RecentBackupInfo array RecentBackups lists recent backup names and statuses <code>conditions</code> Condition array Conditions represent the latest available observations Optional: {}"},{"location":"api/reference/#databasebackupspec","title":"DatabaseBackupSpec","text":"<p>DatabaseBackupSpec defines the desired state of DatabaseBackup.</p> <p>Appears in: - BackupTemplateSpec - DatabaseBackup</p> Field Description Default Validation <code>databaseRef</code> DatabaseReference DatabaseRef references the Database to backup Required: {}  <code>storage</code> StorageConfig Storage defines where to store the backup Required: {}  <code>compression</code> CompressionConfig Compression configures backup compression Optional: {}  <code>encryption</code> EncryptionConfig Encryption configures backup encryption Optional: {}  <code>ttl</code> string TTL is the time-to-live for the backup (e.g., \"168h\" for 7 days) Optional: {}  <code>activeDeadlineSeconds</code> integer ActiveDeadlineSeconds is the timeout for the backup operation 3600 Minimum: 1  <code>postgres</code> PostgresBackupConfig PostgreSQL-specific backup configuration Optional: {}  <code>mysql</code> MySQLBackupConfig MySQL-specific backup configuration Optional: {}"},{"location":"api/reference/#databasebackupstatus","title":"DatabaseBackupStatus","text":"<p>DatabaseBackupStatus defines the observed state of DatabaseBackup.</p> <p>Appears in: - DatabaseBackup</p> Field Description Default Validation <code>phase</code> Phase Phase represents the current state Enum: [Pending Running Completed Failed]  <code>startedAt</code> Time StartedAt is the backup start time <code>completedAt</code> Time CompletedAt is the backup completion time <code>message</code> string Message provides additional information about the current state <code>backup</code> BackupInfo Backup contains backup-specific status information <code>source</code> BackupSourceInfo Source contains information about the backup source <code>expiresAt</code> Time ExpiresAt is when the backup will be deleted <code>conditions</code> Condition array Conditions represent the latest available observations Optional: {}"},{"location":"api/reference/#databasegrant","title":"DatabaseGrant","text":"<p>DatabaseGrant is the Schema for the databasegrants API.</p> Field Description Default Validation <code>apiVersion</code> string <code>dbops.dbprovision.io/v1alpha1</code> <code>kind</code> string <code>DatabaseGrant</code> <code>metadata</code> ObjectMeta Refer to Kubernetes API documentation for fields of <code>metadata</code>. <code>spec</code> DatabaseGrantSpec <code>status</code> DatabaseGrantStatus"},{"location":"api/reference/#databasegrantspec","title":"DatabaseGrantSpec","text":"<p>DatabaseGrantSpec defines the desired state of DatabaseGrant.</p> <p>Appears in: - DatabaseGrant</p> Field Description Default Validation <code>userRef</code> UserReference UserRef references the DatabaseUser to grant permissions to Required: {}  <code>databaseRef</code> DatabaseReference DatabaseRef references the Database for context (optional) Optional: {}  <code>postgres</code> PostgresGrantConfig PostgreSQL-specific grants Optional: {}  <code>mysql</code> MySQLGrantConfig MySQL-specific grants Optional: {}  <code>driftPolicy</code> DriftPolicy DriftPolicy overrides the instance-level drift policy for this grant.If not specified, the instance's drift policy is used. Optional: {}  <code>deletionProtection</code> boolean DeletionProtection prevents accidental deletion Optional: {}"},{"location":"api/reference/#databasegrantstatus","title":"DatabaseGrantStatus","text":"<p>DatabaseGrantStatus defines the observed state of DatabaseGrant.</p> <p>Appears in: - DatabaseGrant</p> Field Description Default Validation <code>phase</code> Phase Phase represents the current state Enum: [Pending Creating Ready Failed Deleting]  <code>observedGeneration</code> integer ObservedGeneration is the last observed generation of the resource <code>message</code> string Message provides additional information about the current state <code>appliedGrants</code> AppliedGrantsInfo AppliedGrants contains information about applied grants <code>drift</code> DriftStatus Drift contains drift detection status information Optional: {}  <code>conditions</code> Condition array Conditions represent the latest available observations Optional: {}"},{"location":"api/reference/#databaseinfo","title":"DatabaseInfo","text":"<p>DatabaseInfo contains general database information</p> <p>Appears in: - DatabaseStatus</p> Field Description Default Validation <code>name</code> string Name is the actual database name <code>owner</code> string Owner is the database owner <code>sizeBytes</code> integer SizeBytes is the database size in bytes <code>createdAt</code> Time CreatedAt is the creation timestamp"},{"location":"api/reference/#databaseinstance","title":"DatabaseInstance","text":"<p>DatabaseInstance is the Schema for the databaseinstances API.</p> Field Description Default Validation <code>apiVersion</code> string <code>dbops.dbprovision.io/v1alpha1</code> <code>kind</code> string <code>DatabaseInstance</code> <code>metadata</code> ObjectMeta Refer to Kubernetes API documentation for fields of <code>metadata</code>. <code>spec</code> DatabaseInstanceSpec <code>status</code> DatabaseInstanceStatus"},{"location":"api/reference/#databaseinstancespec","title":"DatabaseInstanceSpec","text":"<p>DatabaseInstanceSpec defines the desired state of DatabaseInstance.</p> <p>Appears in: - DatabaseInstance</p> Field Description Default Validation <code>engine</code> EngineType Engine type (required, immutable) Enum: [postgres mysql mariadb cockroachdb] Required: {}  <code>connection</code> ConnectionConfig Connection configuration Required: {}  <code>tls</code> TLSConfig TLS configuration Optional: {}  <code>healthCheck</code> HealthCheckConfig Health check configuration Optional: {}  <code>driftPolicy</code> DriftPolicy DriftPolicy defines the default drift detection policy for resources using this instance.Individual resources can override this policy. Optional: {}  <code>discovery</code> DiscoveryConfig Discovery enables scanning for database resources not managed by Kubernetes CRs.Discovered resources can be adopted via annotations. Optional: {}  <code>postgres</code> PostgresInstanceConfig PostgreSQL-specific options (only valid when engine is \"postgres\") Optional: {}  <code>mysql</code> MySQLInstanceConfig MySQL-specific options (only valid when engine is \"mysql\") Optional: {}  <code>deletionProtection</code> boolean DeletionProtection prevents accidental deletion Optional: {}"},{"location":"api/reference/#databaseinstancestatus","title":"DatabaseInstanceStatus","text":"<p>DatabaseInstanceStatus defines the observed state of DatabaseInstance.</p> <p>Appears in: - DatabaseInstance</p> Field Description Default Validation <code>phase</code> Phase Phase represents the current state of the instance Enum: [Pending Ready Failed]  <code>version</code> string Version is the detected database server version <code>message</code> string Message provides additional information about the current state <code>lastCheckedAt</code> Time LastCheckedAt is the timestamp of the last health check <code>observedGeneration</code> integer ObservedGeneration is the last observed generation of the resource <code>discoveredResources</code> DiscoveredResourcesStatus DiscoveredResources contains resources found in the database that are not managed by CRs.Only populated when discovery is enabled. Optional: {}  <code>conditions</code> Condition array Conditions represent the latest available observations Optional: {}"},{"location":"api/reference/#databasereference","title":"DatabaseReference","text":"<p>DatabaseReference references a Database</p> <p>Appears in: - DatabaseBackupSpec - DatabaseGrantSpec - RestoreTarget</p> Field Description Default Validation <code>name</code> string Name of the Database resource Required: {}  <code>namespace</code> string Namespace of the Database (defaults to the resource namespace) Optional: {}"},{"location":"api/reference/#databaserestore","title":"DatabaseRestore","text":"<p>DatabaseRestore is the Schema for the databaserestores API.</p> Field Description Default Validation <code>apiVersion</code> string <code>dbops.dbprovision.io/v1alpha1</code> <code>kind</code> string <code>DatabaseRestore</code> <code>metadata</code> ObjectMeta Refer to Kubernetes API documentation for fields of <code>metadata</code>. <code>spec</code> DatabaseRestoreSpec <code>status</code> DatabaseRestoreStatus"},{"location":"api/reference/#databaserestorespec","title":"DatabaseRestoreSpec","text":"<p>DatabaseRestoreSpec defines the desired state of DatabaseRestore.</p> <p>Appears in: - DatabaseRestore</p> Field Description Default Validation <code>backupRef</code> BackupReference BackupRef references the DatabaseBackup to restore from Optional: {}  <code>fromPath</code> RestoreFromPath FromPath allows restoring from a direct path instead of a backup reference Optional: {}  <code>target</code> RestoreTarget Target defines where to restore the backup Required: {}  <code>confirmation</code> RestoreConfirmation Confirmation contains safety confirmations for destructive operations Optional: {}  <code>activeDeadlineSeconds</code> integer ActiveDeadlineSeconds is the timeout for the restore operation 7200 Minimum: 1  <code>postgres</code> PostgresRestoreConfig PostgreSQL-specific restore configuration Optional: {}  <code>mysql</code> MySQLRestoreConfig MySQL-specific restore configuration Optional: {}"},{"location":"api/reference/#databaserestorestatus","title":"DatabaseRestoreStatus","text":"<p>DatabaseRestoreStatus defines the observed state of DatabaseRestore.</p> <p>Appears in: - DatabaseRestore</p> Field Description Default Validation <code>phase</code> Phase Phase represents the current state Enum: [Pending Running Completed Failed]  <code>startedAt</code> Time StartedAt is the restore start time <code>completedAt</code> Time CompletedAt is the restore completion time <code>message</code> string Message provides additional information about the current state <code>restore</code> RestoreInfo Restore contains restore-specific status information <code>progress</code> RestoreProgress Progress contains restore progress information <code>warnings</code> string array Warnings contains any warnings encountered during restore <code>conditions</code> Condition array Conditions represent the latest available observations Optional: {}"},{"location":"api/reference/#databaserole","title":"DatabaseRole","text":"<p>DatabaseRole is the Schema for the databaseroles API.</p> Field Description Default Validation <code>apiVersion</code> string <code>dbops.dbprovision.io/v1alpha1</code> <code>kind</code> string <code>DatabaseRole</code> <code>metadata</code> ObjectMeta Refer to Kubernetes API documentation for fields of <code>metadata</code>. <code>spec</code> DatabaseRoleSpec <code>status</code> DatabaseRoleStatus"},{"location":"api/reference/#databaserolespec","title":"DatabaseRoleSpec","text":"<p>DatabaseRoleSpec defines the desired state of DatabaseRole.</p> <p>Appears in: - DatabaseRole</p> Field Description Default Validation <code>instanceRef</code> InstanceReference InstanceRef references the DatabaseInstance to use Required: {}  <code>roleName</code> string RoleName is the role name in the database (immutable after creation) MaxLength: 63 MinLength: 1 Pattern: <code>^[a-zA-Z_][a-zA-Z0-9_]*$</code> Required: {}  <code>postgres</code> PostgresRoleConfig PostgreSQL-specific configuration Optional: {}  <code>mysql</code> MySQLRoleConfig MySQL-specific configuration Optional: {}  <code>driftPolicy</code> DriftPolicy DriftPolicy overrides the instance-level drift policy for this role.If not specified, the instance's drift policy is used. Optional: {}"},{"location":"api/reference/#databaserolestatus","title":"DatabaseRoleStatus","text":"<p>DatabaseRoleStatus defines the observed state of DatabaseRole.</p> <p>Appears in: - DatabaseRole</p> Field Description Default Validation <code>phase</code> Phase Phase represents the current state Enum: [Pending Creating Ready Failed Deleting]  <code>observedGeneration</code> integer ObservedGeneration is the last observed generation of the resource <code>message</code> string Message provides additional information about the current state <code>role</code> RoleInfo Role contains role-specific status information <code>drift</code> DriftStatus Drift contains drift detection status information Optional: {}  <code>conditions</code> Condition array Conditions represent the latest available observations Optional: {}"},{"location":"api/reference/#databasespec","title":"DatabaseSpec","text":"<p>DatabaseSpec defines the desired state of Database.</p> <p>Appears in: - Database</p> Field Description Default Validation <code>instanceRef</code> InstanceReference InstanceRef references the DatabaseInstance to use Required: {}  <code>name</code> string Name is the database name in the database server (immutable after creation) MaxLength: 63 MinLength: 1 Pattern: <code>^[a-zA-Z_][a-zA-Z0-9_]*$</code> Required: {}  <code>deletionPolicy</code> DeletionPolicy DeletionPolicy defines what happens on CR deletion Retain Enum: [Retain Delete Snapshot]  <code>deletionProtection</code> boolean DeletionProtection prevents accidental deletion true <code>driftPolicy</code> DriftPolicy DriftPolicy overrides the instance-level drift policy for this database.If not specified, the instance's drift policy is used. Optional: {}  <code>postgres</code> PostgresDatabaseConfig PostgreSQL-specific configuration (required when instance engine is \"postgres\") Optional: {}  <code>mysql</code> MySQLDatabaseConfig MySQL-specific configuration (required when instance engine is \"mysql\") Optional: {}"},{"location":"api/reference/#databasestatus","title":"DatabaseStatus","text":"<p>DatabaseStatus defines the observed state of Database.</p> <p>Appears in: - Database</p> Field Description Default Validation <code>phase</code> Phase Phase represents the current state of the database Enum: [Pending Creating Ready Failed Deleting]  <code>observedGeneration</code> integer ObservedGeneration is the last observed generation of the resource <code>message</code> string Message provides additional information about the current state <code>database</code> DatabaseInfo Database contains database-specific status information <code>postgres</code> PostgresDatabaseStatus Postgres contains PostgreSQL-specific status information Optional: {}  <code>mysql</code> MySQLDatabaseStatus MySQL contains MySQL-specific status information Optional: {}  <code>drift</code> DriftStatus Drift contains drift detection status information Optional: {}  <code>conditions</code> Condition array Conditions represent the latest available observations Optional: {}"},{"location":"api/reference/#databaseuser","title":"DatabaseUser","text":"<p>DatabaseUser is the Schema for the databaseusers API.</p> Field Description Default Validation <code>apiVersion</code> string <code>dbops.dbprovision.io/v1alpha1</code> <code>kind</code> string <code>DatabaseUser</code> <code>metadata</code> ObjectMeta Refer to Kubernetes API documentation for fields of <code>metadata</code>. <code>spec</code> DatabaseUserSpec <code>status</code> DatabaseUserStatus"},{"location":"api/reference/#databaseuserspec","title":"DatabaseUserSpec","text":"<p>DatabaseUserSpec defines the desired state of DatabaseUser.</p> <p>Appears in: - DatabaseUser</p> Field Description Default Validation <code>instanceRef</code> InstanceReference InstanceRef references the DatabaseInstance to use Required: {}  <code>username</code> string Username is the database username (immutable after creation) MaxLength: 63 MinLength: 1 Pattern: <code>^[a-zA-Z_][a-zA-Z0-9_]*$</code> Required: {}  <code>passwordSecret</code> PasswordConfig PasswordSecret configures password generation and secret output Optional: {}  <code>existingPasswordSecret</code> ExistingPasswordSecret ExistingPasswordSecret references an existing secret containing the password Optional: {}  <code>passwordRotation</code> PasswordRotationConfig PasswordRotation configures automatic password rotation Optional: {}  <code>postgres</code> PostgresUserConfig PostgreSQL-specific configuration Optional: {}  <code>mysql</code> MySQLUserConfig MySQL-specific configuration Optional: {}  <code>driftPolicy</code> DriftPolicy DriftPolicy overrides the instance-level drift policy for this user.If not specified, the instance's drift policy is used. Optional: {}"},{"location":"api/reference/#databaseuserstatus","title":"DatabaseUserStatus","text":"<p>DatabaseUserStatus defines the observed state of DatabaseUser.</p> <p>Appears in: - DatabaseUser</p> Field Description Default Validation <code>phase</code> Phase Phase represents the current state Enum: [Pending Creating Ready Failed Deleting]  <code>observedGeneration</code> integer ObservedGeneration is the last observed generation of the resource <code>message</code> string Message provides additional information about the current state <code>user</code> UserInfo User contains user-specific status information <code>secret</code> SecretInfo Secret contains generated secret information <code>drift</code> DriftStatus Drift contains drift detection status information Optional: {}  <code>conditions</code> Condition array Conditions represent the latest available observations Optional: {}"},{"location":"api/reference/#deletionpolicy","title":"DeletionPolicy","text":"<p>Underlying type: string</p> <p>DeletionPolicy defines what happens when a resource is deleted</p> <p>Validation: - Enum: [Retain Delete Snapshot]</p> <p>Appears in: - DatabaseSpec</p> Field Description <code>Retain</code> <code>Delete</code> <code>Snapshot</code>"},{"location":"api/reference/#discoveredresource","title":"DiscoveredResource","text":"<p>DiscoveredResource represents a resource found in the database that is not managed by a Kubernetes CR.</p> <p>Appears in: - DiscoveredResourcesStatus</p> Field Description Default Validation <code>name</code> string Name is the name of the discovered resource <code>discovered</code> Time Discovered is when this resource was first discovered <code>adopted</code> boolean Adopted indicates if this resource has been adopted via annotation"},{"location":"api/reference/#discoveredresourcesstatus","title":"DiscoveredResourcesStatus","text":"<p>DiscoveredResourcesStatus contains discovered unmanaged resources.</p> <p>Appears in: - DatabaseInstanceStatus</p> Field Description Default Validation <code>databases</code> DiscoveredResource array Databases contains discovered database resources Optional: {}  <code>users</code> DiscoveredResource array Users contains discovered user resources Optional: {}  <code>roles</code> DiscoveredResource array Roles contains discovered role resources Optional: {}  <code>lastScan</code> Time LastScan is when the last discovery scan was performed Optional: {}"},{"location":"api/reference/#discoveryconfig","title":"DiscoveryConfig","text":"<p>DiscoveryConfig defines configuration for resource discovery. When enabled, the operator will scan the database for resources that exist but are not managed by Kubernetes CRs.</p> <p>Appears in: - DatabaseInstanceSpec</p> Field Description Default Validation <code>enabled</code> boolean Enabled enables resource discovery false <code>interval</code> string Interval specifies how often to scan for unmanaged resources (Go duration string) 30m Optional: {}"},{"location":"api/reference/#driftdiff","title":"DriftDiff","text":"<p>DriftDiff represents a single difference between desired and actual state.</p> <p>Appears in: - DriftStatus</p> Field Description Default Validation <code>field</code> string Field is the name of the field that differs <code>expected</code> string Expected is the expected value from the CR spec <code>actual</code> string Actual is the actual value in the database <code>destructive</code> boolean Destructive indicates if correcting this drift would be destructive Optional: {}  <code>immutable</code> boolean Immutable indicates if this field cannot be changed after creation Optional: {}"},{"location":"api/reference/#driftmode","title":"DriftMode","text":"<p>Underlying type: string</p> <p>DriftMode defines how drift is handled</p> <p>Validation: - Enum: [ignore detect correct]</p> <p>Appears in: - DriftPolicy</p> Field Description <code>ignore</code> DriftModeIgnore disables drift detection entirely <code>detect</code> DriftModeDetect detects drift and reports in status/events but does not auto-correct <code>correct</code> DriftModeCorrect detects drift and automatically corrects it"},{"location":"api/reference/#driftpolicy","title":"DriftPolicy","text":"<p>DriftPolicy defines how drift detection and correction should be handled. This can be set at the instance level (default for all child resources) or overridden at the individual resource level.</p> <p>Appears in: - DatabaseGrantSpec - DatabaseInstanceSpec - DatabaseRoleSpec - DatabaseSpec - DatabaseUserSpec</p> Field Description Default Validation <code>mode</code> DriftMode Mode determines how drift is handled detect Enum: [ignore detect correct]  <code>interval</code> string Interval specifies how often to check for drift (Go duration string)This is only meaningful when mode is \"detect\" or \"correct\" 5m Optional: {}"},{"location":"api/reference/#driftstatus","title":"DriftStatus","text":"<p>DriftStatus represents the current drift detection status for a resource.</p> <p>Appears in: - DatabaseGrantStatus - DatabaseRoleStatus - DatabaseStatus - DatabaseUserStatus</p> Field Description Default Validation <code>detected</code> boolean Detected indicates if drift was detected <code>lastChecked</code> Time LastChecked is when drift was last checked Optional: {}  <code>diffs</code> DriftDiff array Diffs contains the specific differences found Optional: {}"},{"location":"api/reference/#encryptionalgorithm","title":"EncryptionAlgorithm","text":"<p>Underlying type: string</p> <p>EncryptionAlgorithm defines the encryption algorithm</p> <p>Validation: - Enum: [aes-256-gcm aes-256-cbc]</p> <p>Appears in: - EncryptionConfig</p> Field Description <code>aes-256-gcm</code> <code>aes-256-cbc</code>"},{"location":"api/reference/#encryptionconfig","title":"EncryptionConfig","text":"<p>EncryptionConfig defines backup encryption settings</p> <p>Appears in: - DatabaseBackupSpec - RestoreFromPath</p> Field Description Default Validation <code>enabled</code> boolean Enabled enables encryption Optional: {}  <code>algorithm</code> EncryptionAlgorithm Algorithm specifies the encryption algorithm aes-256-gcm Enum: [aes-256-gcm aes-256-cbc]  <code>secretRef</code> SecretKeySelector SecretRef references a secret containing the encryption key Optional: {}"},{"location":"api/reference/#enginetype","title":"EngineType","text":"<p>Underlying type: string</p> <p>EngineType defines the database engine type</p> <p>Validation: - Enum: [postgres mysql mariadb cockroachdb]</p> <p>Appears in: - DatabaseInstanceSpec</p> Field Description <code>postgres</code> <code>mysql</code> <code>mariadb</code> <code>cockroachdb</code>"},{"location":"api/reference/#existingpasswordsecret","title":"ExistingPasswordSecret","text":"<p>ExistingPasswordSecret references an existing secret containing a password</p> <p>Appears in: - DatabaseUserSpec</p> Field Description Default Validation <code>name</code> string Name of the secret Required: {}  <code>namespace</code> string Namespace of the secret (defaults to the resource namespace) Optional: {}  <code>key</code> string Key within the secret containing the password Required: {}"},{"location":"api/reference/#gcsstorageconfig","title":"GCSStorageConfig","text":"<p>GCSStorageConfig defines Google Cloud Storage configuration</p> <p>Appears in: - StorageConfig</p> Field Description Default Validation <code>bucket</code> string Bucket name Required: {}  <code>prefix</code> string Prefix (path prefix within the bucket) Optional: {}  <code>secretRef</code> SecretKeySelector SecretRef references a secret containing GCS credentials Required: {}"},{"location":"api/reference/#healthcheckconfig","title":"HealthCheckConfig","text":"<p>HealthCheckConfig defines health check settings</p> <p>Appears in: - DatabaseInstanceSpec</p> Field Description Default Validation <code>enabled</code> boolean Enabled enables periodic health checks true <code>intervalSeconds</code> integer IntervalSeconds defines how often to check (default: 30) 30 Minimum: 5  <code>timeoutSeconds</code> integer TimeoutSeconds defines the health check timeout (default: 5) 5 Minimum: 1"},{"location":"api/reference/#instancereference","title":"InstanceReference","text":"<p>InstanceReference references a DatabaseInstance</p> <p>Appears in: - DatabaseRoleSpec - DatabaseSpec - DatabaseUserSpec - RestoreTarget</p> Field Description Default Validation <code>name</code> string Name of the DatabaseInstance Required: {}  <code>namespace</code> string Namespace of the DatabaseInstance (defaults to the resource namespace) Optional: {}"},{"location":"api/reference/#mysqlauthplugin","title":"MySQLAuthPlugin","text":"<p>Underlying type: string</p> <p>MySQLAuthPlugin defines MySQL authentication plugins</p> <p>Validation: - Enum: [mysql_native_password caching_sha2_password sha256_password]</p> <p>Appears in: - MySQLUserConfig</p> Field Description <code>mysql_native_password</code> <code>caching_sha2_password</code> <code>sha256_password</code>"},{"location":"api/reference/#mysqlbackupconfig","title":"MySQLBackupConfig","text":"<p>MySQLBackupConfig defines MySQL-specific backup configuration</p> <p>Appears in: - DatabaseBackupSpec</p> Field Description Default Validation <code>method</code> MySQLBackupMethod Method specifies the backup method mysqldump Enum: [mysqldump xtrabackup mysqlpump]  <code>singleTransaction</code> boolean SingleTransaction uses a single transaction for InnoDB tables true <code>quick</code> boolean Quick retrieves rows one at a time instead of buffering true <code>lockTables</code> boolean LockTables locks all tables before backup Optional: {}  <code>routines</code> boolean Routines includes stored procedures and functions true <code>triggers</code> boolean Triggers includes triggers true <code>events</code> boolean Events includes events true <code>extendedInsert</code> boolean ExtendedInsert uses extended INSERT statements true <code>setGtidPurged</code> MySQLGtidPurged SetGtidPurged controls SET @@GLOBAL.GTID_PURGED AUTO Enum: [OFF ON AUTO]  <code>databases</code> string array Databases lists specific databases to backup (empty = all) Optional: {}  <code>tables</code> string array Tables lists specific tables to backup (empty = all) Optional: {}  <code>excludeTables</code> string array ExcludeTables lists tables to exclude Optional: {}"},{"location":"api/reference/#mysqlbackupmethod","title":"MySQLBackupMethod","text":"<p>Underlying type: string</p> <p>MySQLBackupMethod defines MySQL backup methods</p> <p>Validation: - Enum: [mysqldump xtrabackup mysqlpump]</p> <p>Appears in: - MySQLBackupConfig</p> Field Description <code>mysqldump</code> <code>xtrabackup</code> <code>mysqlpump</code>"},{"location":"api/reference/#mysqldatabaseconfig","title":"MySQLDatabaseConfig","text":"<p>MySQLDatabaseConfig defines MySQL-specific database configuration</p> <p>Appears in: - DatabaseSpec</p> Field Description Default Validation <code>charset</code> string Charset sets the database character set utf8mb4 <code>collation</code> string Collation sets the database collation utf8mb4_unicode_ci <code>sqlMode</code> string SQLMode sets the SQL mode for the database Optional: {}  <code>defaultStorageEngine</code> string DefaultStorageEngine sets the default storage engine InnoDB"},{"location":"api/reference/#mysqldatabasestatus","title":"MySQLDatabaseStatus","text":"<p>MySQLDatabaseStatus contains MySQL-specific database status</p> <p>Appears in: - DatabaseStatus</p> Field Description Default Validation <code>charset</code> string Charset is the database character set <code>collation</code> string Collation is the database collation"},{"location":"api/reference/#mysqlgrant","title":"MySQLGrant","text":"<p>MySQLGrant defines a MySQL privilege grant</p> <p>Appears in: - MySQLGrantConfig - MySQLRoleConfig</p> Field Description Default Validation <code>level</code> MySQLGrantLevel Level is the grant level Enum: [global database table column procedure function]  <code>database</code> string Database is the target database (for database/table/column/procedure/function levels) Optional: {}  <code>table</code> string Table is the target table (for table/column levels) Optional: {}  <code>columns</code> string array Columns lists target columns (for column level) Optional: {}  <code>procedure</code> string Procedure is the target procedure (for procedure level) Optional: {}  <code>function</code> string Function is the target function (for function level) Optional: {}  <code>privileges</code> string array Privileges to grant (SELECT, INSERT, UPDATE, DELETE, CREATE, DROP, REFERENCES, INDEX, ALTER, etc.) MinItems: 1  <code>withGrantOption</code> boolean WithGrantOption allows the grantee to grant these privileges to others Optional: {}"},{"location":"api/reference/#mysqlgrantconfig","title":"MySQLGrantConfig","text":"<p>MySQLGrantConfig defines MySQL-specific grant configuration</p> <p>Appears in: - DatabaseGrantSpec</p> Field Description Default Validation <code>roles</code> string array Roles to assign to the user (MySQL 8.0+) Optional: {}  <code>grants</code> MySQLGrant array Grants defines direct privilege grants Optional: {}"},{"location":"api/reference/#mysqlgrantlevel","title":"MySQLGrantLevel","text":"<p>Underlying type: string</p> <p>MySQLGrantLevel defines the level of a MySQL grant</p> <p>Validation: - Enum: [global database table column procedure function]</p> <p>Appears in: - MySQLGrant</p> Field Description <code>global</code> <code>database</code> <code>table</code> <code>column</code> <code>procedure</code> <code>function</code>"},{"location":"api/reference/#mysqlgtidpurged","title":"MySQLGtidPurged","text":"<p>Underlying type: string</p> <p>MySQLGtidPurged defines GTID_PURGED setting</p> <p>Validation: - Enum: [OFF ON AUTO]</p> <p>Appears in: - MySQLBackupConfig</p> Field Description <code>OFF</code> <code>ON</code> <code>AUTO</code>"},{"location":"api/reference/#mysqlinstanceconfig","title":"MySQLInstanceConfig","text":"<p>MySQLInstanceConfig defines MySQL-specific instance configuration</p> <p>Appears in: - DatabaseInstanceSpec</p> Field Description Default Validation <code>charset</code> string Charset sets the default character set utf8mb4 <code>collation</code> string Collation sets the default collation utf8mb4_unicode_ci <code>parseTime</code> boolean ParseTime enables parsing of DATE and DATETIME to time.Time true <code>timeout</code> string Timeout is the connection timeout (e.g., \"10s\") 10s <code>readTimeout</code> string ReadTimeout is the read timeout (e.g., \"30s\") 30s <code>writeTimeout</code> string WriteTimeout is the write timeout (e.g., \"30s\") 30s <code>tls</code> MySQLTLSMode TLS specifies the TLS mode preferred Enum: [disabled preferred required skip-verify]"},{"location":"api/reference/#mysqlrestoreconfig","title":"MySQLRestoreConfig","text":"<p>MySQLRestoreConfig defines MySQL-specific restore configuration</p> <p>Appears in: - DatabaseRestoreSpec</p> Field Description Default Validation <code>dropExisting</code> boolean DropExisting drops existing database before restore Optional: {}  <code>createDatabase</code> boolean CreateDatabase creates the database if it doesn't exist true <code>routines</code> boolean Routines restores stored procedures and functions true <code>triggers</code> boolean Triggers restores triggers true <code>events</code> boolean Events restores events true <code>disableForeignKeyChecks</code> boolean DisableForeignKeyChecks disables foreign key checks during restore true <code>disableBinlog</code> boolean DisableBinlog disables binary logging during restore true"},{"location":"api/reference/#mysqlroleconfig","title":"MySQLRoleConfig","text":"<p>MySQLRoleConfig defines MySQL-specific role configuration</p> <p>Appears in: - DatabaseRoleSpec</p> Field Description Default Validation <code>useNativeRoles</code> boolean UseNativeRoles enables MySQL 8.0+ native roles true <code>grants</code> MySQLGrant array Grants defines the permissions this role grants Optional: {}"},{"location":"api/reference/#mysqltlsmode","title":"MySQLTLSMode","text":"<p>Underlying type: string</p> <p>MySQLTLSMode defines MySQL TLS modes</p> <p>Validation: - Enum: [disabled preferred required skip-verify]</p> <p>Appears in: - MySQLInstanceConfig</p> Field Description <code>disabled</code> <code>preferred</code> <code>required</code> <code>skip-verify</code>"},{"location":"api/reference/#mysqluserconfig","title":"MySQLUserConfig","text":"<p>MySQLUserConfig defines MySQL-specific user configuration</p> <p>Appears in: - DatabaseUserSpec</p> Field Description Default Validation <code>maxQueriesPerHour</code> integer MaxQueriesPerHour limits queries per hour (0 = unlimited) 0 Minimum: 0  <code>maxUpdatesPerHour</code> integer MaxUpdatesPerHour limits updates per hour (0 = unlimited) 0 Minimum: 0  <code>maxConnectionsPerHour</code> integer MaxConnectionsPerHour limits connections per hour (0 = unlimited) 0 Minimum: 0  <code>maxUserConnections</code> integer MaxUserConnections limits concurrent connections (0 = unlimited) 0 Minimum: 0  <code>authPlugin</code> MySQLAuthPlugin AuthPlugin specifies the authentication plugin caching_sha2_password Enum: [mysql_native_password caching_sha2_password sha256_password]  <code>requireSSL</code> boolean RequireSSL requires SSL for connections Optional: {}  <code>requireX509</code> boolean RequireX509 requires X509 certificate for connections Optional: {}  <code>allowedHosts</code> string array AllowedHosts lists allowed host patterns for the user (e.g., \"%\", \"localhost\", \"192.168.1.%\") [%] <code>accountLocked</code> boolean AccountLocked locks the account Optional: {}  <code>failedLoginAttempts</code> integer FailedLoginAttempts sets failed login attempts before locking (0 = disabled) 0 Minimum: 0  <code>passwordLockTime</code> integer PasswordLockTime sets lock time in days after failed attempts (0 = permanent) 0 Minimum: 0"},{"location":"api/reference/#pvcstorageconfig","title":"PVCStorageConfig","text":"<p>PVCStorageConfig defines PVC-based storage configuration</p> <p>Appears in: - StorageConfig</p> Field Description Default Validation <code>claimName</code> string ClaimName is the name of the PersistentVolumeClaim Required: {}  <code>subPath</code> string SubPath within the PVC Optional: {}"},{"location":"api/reference/#passwordconfig","title":"PasswordConfig","text":"<p>PasswordConfig defines password generation settings</p> <p>Appears in: - DatabaseUserSpec</p> Field Description Default Validation <code>generate</code> boolean Generate enables password generation true <code>length</code> integer Length of the generated password (default: 32) 32 Maximum: 128 Minimum: 8  <code>includeSpecialChars</code> boolean IncludeSpecialChars includes special characters in the password true <code>excludeChars</code> string ExcludeChars specifies characters to exclude from the password Optional: {}  <code>secretName</code> string SecretName is the name of the generated secret Required: {}  <code>secretNamespace</code> string SecretNamespace is the namespace for the generated secret (defaults to resource namespace) Optional: {}  <code>format</code> SecretFormat Format specifies the secret format kubernetes Enum: [kubernetes vault external-secrets]  <code>secretTemplate</code> SecretTemplate SecretTemplate defines the secret template Optional: {}"},{"location":"api/reference/#passwordrotationconfig","title":"PasswordRotationConfig","text":"<p>PasswordRotationConfig defines password rotation settings</p> <p>Appears in: - DatabaseUserSpec</p> Field Description Default Validation <code>enabled</code> boolean Enabled enables automatic password rotation Optional: {}  <code>schedule</code> string Schedule is a cron expression for rotation (e.g., \"0 0 1 * *\" for monthly) Optional: {}  <code>maxAge</code> string MaxAge is the maximum age of a password before rotation (e.g., \"90d\") Optional: {}"},{"location":"api/reference/#phase","title":"Phase","text":"<p>Underlying type: string</p> <p>Phase represents the current state of a resource</p> <p>Appears in: - DatabaseBackupScheduleStatus - DatabaseBackupStatus - DatabaseGrantStatus - DatabaseInstanceStatus - DatabaseRestoreStatus - DatabaseRoleStatus - DatabaseStatus - DatabaseUserStatus</p> Field Description <code>Pending</code> <code>Creating</code> <code>Ready</code> <code>Failed</code> <code>Deleting</code> <code>Running</code> <code>Completed</code> <code>Paused</code> <code>Active</code>"},{"location":"api/reference/#postgresbackupconfig","title":"PostgresBackupConfig","text":"<p>PostgresBackupConfig defines PostgreSQL-specific backup configuration</p> <p>Appears in: - DatabaseBackupSpec</p> Field Description Default Validation <code>method</code> PostgresBackupMethod Method specifies the backup method pg_dump Enum: [pg_dump pg_basebackup]  <code>format</code> PostgresDumpFormat Format specifies the output format (for pg_dump) custom Enum: [plain custom directory tar]  <code>jobs</code> integer Jobs sets the number of parallel jobs (for directory format) 1 Minimum: 1  <code>dataOnly</code> boolean DataOnly backs up only data, not schema Optional: {}  <code>schemaOnly</code> boolean SchemaOnly backs up only schema, not data Optional: {}  <code>blobs</code> boolean Blobs includes large objects in the backup true <code>noOwner</code> boolean NoOwner omits ownership information Optional: {}  <code>noPrivileges</code> boolean NoPrivileges omits privilege (GRANT/REVOKE) information Optional: {}  <code>schemas</code> string array Schemas lists specific schemas to include (empty = all) Optional: {}  <code>excludeSchemas</code> string array ExcludeSchemas lists schemas to exclude Optional: {}  <code>tables</code> string array Tables lists specific tables to include (empty = all) Optional: {}  <code>excludeTables</code> string array ExcludeTables lists tables to exclude (format: schema.table) Optional: {}  <code>lockWaitTimeout</code> string LockWaitTimeout sets the lock wait timeout (e.g., \"60s\") 60s <code>noSync</code> boolean NoSync disables fsync after backup Optional: {}"},{"location":"api/reference/#postgresbackupmethod","title":"PostgresBackupMethod","text":"<p>Underlying type: string</p> <p>PostgresBackupMethod defines PostgreSQL backup methods</p> <p>Validation: - Enum: [pg_dump pg_basebackup]</p> <p>Appears in: - PostgresBackupConfig</p> Field Description <code>pg_dump</code> <code>pg_basebackup</code>"},{"location":"api/reference/#postgresdatabaseconfig","title":"PostgresDatabaseConfig","text":"<p>PostgresDatabaseConfig defines PostgreSQL-specific database configuration</p> <p>Appears in: - DatabaseSpec</p> Field Description Default Validation <code>encoding</code> string Encoding sets the database encoding (default: UTF8) UTF8 <code>lcCollate</code> string LCCollate sets the collation order Optional: {}  <code>lcCtype</code> string LCCtype sets the character classification Optional: {}  <code>tablespace</code> string Tablespace sets the default tablespace pg_default <code>template</code> string Template is the template database to use template0 <code>connectionLimit</code> integer ConnectionLimit sets the maximum concurrent connections (-1 = unlimited) -1 Minimum: -1  <code>isTemplate</code> boolean IsTemplate marks this as a template database Optional: {}  <code>allowConnections</code> boolean AllowConnections allows/disallows connections to this database true <code>extensions</code> PostgresExtension array Extensions to install in the database Optional: {}  <code>schemas</code> PostgresSchema array Schemas to create in the database Optional: {}  <code>defaultPrivileges</code> PostgresDefaultPrivilege array DefaultPrivileges sets default privileges for new objects Optional: {}"},{"location":"api/reference/#postgresdatabasestatus","title":"PostgresDatabaseStatus","text":"<p>PostgresDatabaseStatus contains PostgreSQL-specific database status</p> <p>Appears in: - DatabaseStatus</p> Field Description Default Validation <code>encoding</code> string Encoding is the database encoding <code>collation</code> string Collation is the database collation <code>installedExtensions</code> PostgresExtensionStatus array InstalledExtensions lists installed extensions <code>schemas</code> string array Schemas lists schemas in the database"},{"location":"api/reference/#postgresdefaultprivilege","title":"PostgresDefaultPrivilege","text":"<p>PostgresDefaultPrivilege defines default privileges for new objects</p> <p>Appears in: - PostgresDatabaseConfig</p> Field Description Default Validation <code>role</code> string Role to grant privileges to Required: {}  <code>schema</code> string Schema where the default applies Required: {}  <code>objectType</code> string ObjectType is the type of objects (tables, sequences, functions, types) Enum: [tables sequences functions types]  <code>privileges</code> string array Privileges to grant MinItems: 1"},{"location":"api/reference/#postgresdefaultprivilegegrant","title":"PostgresDefaultPrivilegeGrant","text":"<p>PostgresDefaultPrivilegeGrant defines a default privilege grant</p> <p>Appears in: - PostgresGrantConfig</p> Field Description Default Validation <code>database</code> string Database is the target database Required: {}  <code>schema</code> string Schema is the target schema Required: {}  <code>grantedBy</code> string GrantedBy is the role that creates the objects Required: {}  <code>objectType</code> string ObjectType is the type of objects (tables, sequences, functions, types) Enum: [tables sequences functions types]  <code>privileges</code> string array Privileges to grant MinItems: 1"},{"location":"api/reference/#postgresdumpformat","title":"PostgresDumpFormat","text":"<p>Underlying type: string</p> <p>PostgresDumpFormat defines pg_dump output formats</p> <p>Validation: - Enum: [plain custom directory tar]</p> <p>Appears in: - PostgresBackupConfig</p> Field Description <code>plain</code> <code>custom</code> <code>directory</code> <code>tar</code>"},{"location":"api/reference/#postgresextension","title":"PostgresExtension","text":"<p>PostgresExtension defines a PostgreSQL extension to install</p> <p>Appears in: - PostgresDatabaseConfig</p> Field Description Default Validation <code>name</code> string Name of the extension Required: {}  <code>schema</code> string Schema to install the extension in (default: public) public <code>version</code> string Version of the extension (optional, uses default if not specified) Optional: {}"},{"location":"api/reference/#postgresextensionstatus","title":"PostgresExtensionStatus","text":"<p>PostgresExtensionStatus contains extension status information</p> <p>Appears in: - PostgresDatabaseStatus</p> Field Description Default Validation <code>name</code> string Name of the extension <code>version</code> string Version of the extension"},{"location":"api/reference/#postgresgrant","title":"PostgresGrant","text":"<p>PostgresGrant defines a PostgreSQL privilege grant</p> <p>Appears in: - PostgresGrantConfig - PostgresRoleConfig</p> Field Description Default Validation <code>database</code> string Database is the target database Required: {}  <code>schema</code> string Schema is the target schema (optional, for schema-level grants) Optional: {}  <code>tables</code> string array Tables lists specific tables or \"*\" for all tables Optional: {}  <code>sequences</code> string array Sequences lists specific sequences or \"*\" for all sequences Optional: {}  <code>functions</code> string array Functions lists specific functions or \"*\" for all functions Optional: {}  <code>privileges</code> string array Privileges to grant (SELECT, INSERT, UPDATE, DELETE, TRUNCATE, REFERENCES, TRIGGER, CREATE, CONNECT, TEMPORARY, EXECUTE, USAGE) MinItems: 1  <code>withGrantOption</code> boolean WithGrantOption allows the grantee to grant these privileges to others Optional: {}"},{"location":"api/reference/#postgresgrantconfig","title":"PostgresGrantConfig","text":"<p>PostgresGrantConfig defines PostgreSQL-specific grant configuration</p> <p>Appears in: - DatabaseGrantSpec</p> Field Description Default Validation <code>roles</code> string array Roles to assign to the user Optional: {}  <code>grants</code> PostgresGrant array Grants defines direct privilege grants Optional: {}  <code>defaultPrivileges</code> PostgresDefaultPrivilegeGrant array DefaultPrivileges sets default privileges for future objects Optional: {}"},{"location":"api/reference/#postgresinstanceconfig","title":"PostgresInstanceConfig","text":"<p>PostgresInstanceConfig defines PostgreSQL-specific instance configuration</p> <p>Appears in: - DatabaseInstanceSpec</p> Field Description Default Validation <code>sslMode</code> PostgresSSLMode SSLMode specifies the SSL mode for connections prefer Enum: [disable allow prefer require verify-ca verify-full]  <code>connectTimeout</code> integer ConnectTimeout is the connection timeout in seconds 10 Minimum: 1  <code>statementTimeout</code> string StatementTimeout is the statement timeout (e.g., \"30s\") Optional: {}  <code>applicationName</code> string ApplicationName is the application name for connections db-provision-operator"},{"location":"api/reference/#postgresrestoreconfig","title":"PostgresRestoreConfig","text":"<p>PostgresRestoreConfig defines PostgreSQL-specific restore configuration</p> <p>Appears in: - DatabaseRestoreSpec</p> Field Description Default Validation <code>dropExisting</code> boolean DropExisting drops existing database before restore Optional: {}  <code>createDatabase</code> boolean CreateDatabase creates the database if it doesn't exist true <code>dataOnly</code> boolean DataOnly restores only data, not schema Optional: {}  <code>schemaOnly</code> boolean SchemaOnly restores only schema, not data Optional: {}  <code>noOwner</code> boolean NoOwner omits ownership restoration true <code>noPrivileges</code> boolean NoPrivileges omits privilege restoration Optional: {}  <code>roleMapping</code> object (keys:string, values:string) RoleMapping maps old role names to new role names Optional: {}  <code>schemas</code> string array Schemas lists specific schemas to restore (empty = all) Optional: {}  <code>tables</code> string array Tables lists specific tables to restore (empty = all) Optional: {}  <code>jobs</code> integer Jobs sets the number of parallel jobs for restore 1 Minimum: 1  <code>disableTriggers</code> boolean DisableTriggers disables triggers during restore Optional: {}  <code>analyze</code> boolean Analyze runs ANALYZE after restore true"},{"location":"api/reference/#postgresroleconfig","title":"PostgresRoleConfig","text":"<p>PostgresRoleConfig defines PostgreSQL-specific role configuration</p> <p>Appears in: - DatabaseRoleSpec</p> Field Description Default Validation <code>login</code> boolean Login enables login capability (usually false for group roles) Optional: {}  <code>inherit</code> boolean Inherit enables privilege inheritance true <code>createDB</code> boolean CreateDB allows the role to create databases Optional: {}  <code>createRole</code> boolean CreateRole allows the role to create other roles Optional: {}  <code>superuser</code> boolean Superuser grants superuser privileges Optional: {}  <code>replication</code> boolean Replication enables replication privileges Optional: {}  <code>bypassRLS</code> boolean BypassRLS allows bypassing row-level security Optional: {}  <code>inRoles</code> string array InRoles lists roles this role should inherit from Optional: {}  <code>grants</code> PostgresGrant array Grants defines the permissions this role grants Optional: {}"},{"location":"api/reference/#postgressslmode","title":"PostgresSSLMode","text":"<p>Underlying type: string</p> <p>PostgresSSLMode defines PostgreSQL SSL modes</p> <p>Validation: - Enum: [disable allow prefer require verify-ca verify-full]</p> <p>Appears in: - PostgresInstanceConfig</p> Field Description <code>disable</code> <code>allow</code> <code>prefer</code> <code>require</code> <code>verify-ca</code> <code>verify-full</code>"},{"location":"api/reference/#postgresschema","title":"PostgresSchema","text":"<p>PostgresSchema defines a schema to create</p> <p>Appears in: - PostgresDatabaseConfig</p> Field Description Default Validation <code>name</code> string Name of the schema Required: {}  <code>owner</code> string Owner of the schema (optional) Optional: {}"},{"location":"api/reference/#postgresuserconfig","title":"PostgresUserConfig","text":"<p>PostgresUserConfig defines PostgreSQL-specific user configuration</p> <p>Appears in: - DatabaseUserSpec</p> Field Description Default Validation <code>connectionLimit</code> integer ConnectionLimit sets the maximum concurrent connections (-1 = unlimited) -1 Minimum: -1  <code>validUntil</code> string ValidUntil sets the password expiration time (RFC3339 format) Optional: {}  <code>superuser</code> boolean Superuser grants superuser privileges Optional: {}  <code>createDB</code> boolean CreateDB allows the user to create databases Optional: {}  <code>createRole</code> boolean CreateRole allows the user to create roles Optional: {}  <code>inherit</code> boolean Inherit enables privilege inheritance true <code>login</code> boolean Login enables login capability true <code>replication</code> boolean Replication enables replication privileges Optional: {}  <code>bypassRLS</code> boolean BypassRLS allows bypassing row-level security Optional: {}  <code>inRoles</code> string array InRoles lists roles this user should be a member of Optional: {}  <code>configParameters</code> object (keys:string, values:string) ConfigParameters sets session parameters for this user Optional: {}"},{"location":"api/reference/#recentbackupinfo","title":"RecentBackupInfo","text":"<p>RecentBackupInfo contains information about a recent backup</p> <p>Appears in: - DatabaseBackupScheduleStatus</p> Field Description Default Validation <code>name</code> string Name of the backup <code>status</code> string Status of the backup"},{"location":"api/reference/#restoreconfirmation","title":"RestoreConfirmation","text":"<p>RestoreConfirmation contains safety confirmations</p> <p>Appears in: - DatabaseRestoreSpec</p> Field Description Default Validation <code>acknowledgeDataLoss</code> string AcknowledgeDataLoss must be set to \"I-UNDERSTAND-DATA-LOSS\" for destructive operations Optional: {}"},{"location":"api/reference/#restorefrompath","title":"RestoreFromPath","text":"<p>RestoreFromPath defines restoring from a direct path</p> <p>Appears in: - DatabaseRestoreSpec</p> Field Description Default Validation <code>storage</code> StorageConfig Storage defines where the backup is stored Required: {}  <code>backupPath</code> string BackupPath is the path to the backup file within the storage Required: {}  <code>compression</code> CompressionConfig Compression settings used for the backup Optional: {}  <code>encryption</code> EncryptionConfig Encryption settings used for the backup Optional: {}"},{"location":"api/reference/#restoreinfo","title":"RestoreInfo","text":"<p>RestoreInfo contains restore-specific information</p> <p>Appears in: - DatabaseRestoreStatus</p> Field Description Default Validation <code>sourceBackup</code> string SourceBackup is the source backup name <code>targetInstance</code> string TargetInstance is the target instance name <code>targetDatabase</code> string TargetDatabase is the target database name"},{"location":"api/reference/#restoreprogress","title":"RestoreProgress","text":"<p>RestoreProgress contains restore progress information</p> <p>Appears in: - DatabaseRestoreStatus</p> Field Description Default Validation <code>percentage</code> integer Percentage is the restore progress percentage (0-100) <code>currentPhase</code> string CurrentPhase is the current restore phase <code>tablesRestored</code> integer TablesRestored is the number of tables restored <code>tablesTotal</code> integer TablesTotal is the total number of tables to restore"},{"location":"api/reference/#restoretarget","title":"RestoreTarget","text":"<p>RestoreTarget defines where to restore the backup</p> <p>Appears in: - DatabaseRestoreSpec</p> Field Description Default Validation <code>instanceRef</code> InstanceReference InstanceRef references the target DatabaseInstance Optional: {}  <code>databaseName</code> string DatabaseName is the target database name (for restore to new database) Optional: {}  <code>inPlace</code> boolean InPlace enables in-place restore (destructive!) Optional: {}  <code>databaseRef</code> DatabaseReference DatabaseRef references the target Database for in-place restore Optional: {}"},{"location":"api/reference/#retentionpolicy","title":"RetentionPolicy","text":"<p>RetentionPolicy defines backup retention settings</p> <p>Appears in: - DatabaseBackupScheduleSpec</p> Field Description Default Validation <code>keepLast</code> integer KeepLast keeps the N most recent backups Minimum: 0 Optional: {}  <code>keepHourly</code> integer KeepHourly keeps N hourly backups Minimum: 0 Optional: {}  <code>keepDaily</code> integer KeepDaily keeps N daily backups Minimum: 0 Optional: {}  <code>keepWeekly</code> integer KeepWeekly keeps N weekly backups Minimum: 0 Optional: {}  <code>keepMonthly</code> integer KeepMonthly keeps N monthly backups Minimum: 0 Optional: {}  <code>keepYearly</code> integer KeepYearly keeps N yearly backups Minimum: 0 Optional: {}  <code>minAge</code> string MinAge is the minimum age before a backup can be deleted Optional: {}"},{"location":"api/reference/#roleinfo","title":"RoleInfo","text":"<p>RoleInfo contains role status information</p> <p>Appears in: - DatabaseRoleStatus</p> Field Description Default Validation <code>name</code> string Name is the actual role name <code>createdAt</code> Time CreatedAt is the role creation timestamp"},{"location":"api/reference/#s3secretkeys","title":"S3SecretKeys","text":"<p>S3SecretKeys defines the key names within an S3 secret</p> <p>Appears in: - S3SecretRef</p> Field Description Default Validation <code>accessKey</code> string Access key ID (default: \"AWS_ACCESS_KEY_ID\") AWS_ACCESS_KEY_ID <code>secretKey</code> string Secret access key (default: \"AWS_SECRET_ACCESS_KEY\") AWS_SECRET_ACCESS_KEY"},{"location":"api/reference/#s3secretref","title":"S3SecretRef","text":"<p>S3SecretRef references S3 credentials in a secret</p> <p>Appears in: - S3StorageConfig</p> Field Description Default Validation <code>name</code> string Name of the secret Required: {}  <code>keys</code> S3SecretKeys Keys defines the key names for S3 credentials Optional: {}"},{"location":"api/reference/#s3storageconfig","title":"S3StorageConfig","text":"<p>S3StorageConfig defines S3-compatible storage configuration</p> <p>Appears in: - StorageConfig</p> Field Description Default Validation <code>bucket</code> string Bucket name Required: {}  <code>region</code> string Region of the S3 bucket Required: {}  <code>prefix</code> string Prefix (path prefix within the bucket) Optional: {}  <code>endpoint</code> string Endpoint for S3-compatible storage (e.g., MinIO) Optional: {}  <code>secretRef</code> S3SecretRef SecretRef references a secret containing S3 credentials Required: {}  <code>forcePathStyle</code> boolean ForcePathStyle enables path-style addressing (required for MinIO) Optional: {}"},{"location":"api/reference/#scheduledbackupinfo","title":"ScheduledBackupInfo","text":"<p>ScheduledBackupInfo contains information about a scheduled backup</p> <p>Appears in: - DatabaseBackupScheduleStatus</p> Field Description Default Validation <code>name</code> string Name of the backup <code>status</code> string Status of the backup <code>startedAt</code> Time StartedAt is when the backup started <code>completedAt</code> Time CompletedAt is when the backup completed"},{"location":"api/reference/#secretformat","title":"SecretFormat","text":"<p>Underlying type: string</p> <p>SecretFormat defines the output secret format</p> <p>Validation: - Enum: [kubernetes vault external-secrets]</p> <p>Appears in: - PasswordConfig</p> Field Description <code>kubernetes</code> <code>vault</code> <code>external-secrets</code>"},{"location":"api/reference/#secretinfo","title":"SecretInfo","text":"<p>SecretInfo contains generated secret information</p> <p>Appears in: - DatabaseUserStatus</p> Field Description Default Validation <code>name</code> string Name is the secret name <code>namespace</code> string Namespace is the secret namespace <code>lastRotatedAt</code> Time LastRotatedAt is the last password rotation timestamp"},{"location":"api/reference/#secretkeyselector","title":"SecretKeySelector","text":"<p>SecretKeySelector contains a reference to a secret key</p> <p>Appears in: - EncryptionConfig - GCSStorageConfig</p> Field Description Default Validation <code>name</code> string Name of the secret Required: {}  <code>namespace</code> string Namespace of the secret (defaults to the resource namespace) Optional: {}  <code>key</code> string Key within the secret Required: {}"},{"location":"api/reference/#secretreference","title":"SecretReference","text":"<p>SecretReference contains a reference to a secret with multiple keys</p> <p>Appears in: - AzureStorageConfig</p> Field Description Default Validation <code>name</code> string Name of the secret Required: {}  <code>namespace</code> string Namespace of the secret (defaults to the resource namespace) Optional: {}"},{"location":"api/reference/#secrettemplate","title":"SecretTemplate","text":"<p>SecretTemplate defines the template for generated secrets</p> <p>Appears in: - PasswordConfig</p> Field Description Default Validation <code>type</code> SecretType Type is the secret type (default: Opaque) Opaque <code>labels</code> object (keys:string, values:string) Labels to add to the secret Optional: {}  <code>annotations</code> object (keys:string, values:string) Annotations to add to the secret Optional: {}  <code>data</code> object (keys:string, values:string) Data defines templated data keysAvailable variables: .Username, .Password, .Host, .Port, .Database, .SSLMode Optional: {}"},{"location":"api/reference/#storageconfig","title":"StorageConfig","text":"<p>StorageConfig defines backup storage configuration</p> <p>Appears in: - DatabaseBackupSpec - RestoreFromPath</p> Field Description Default Validation <code>type</code> StorageType Type of storage backend Enum: [gcs s3 azure pvc] Required: {}  <code>gcs</code> GCSStorageConfig GCS configuration (required when type is \"gcs\") Optional: {}  <code>s3</code> S3StorageConfig S3 configuration (required when type is \"s3\") Optional: {}  <code>azure</code> AzureStorageConfig Azure configuration (required when type is \"azure\") Optional: {}  <code>pvc</code> PVCStorageConfig PVC configuration (required when type is \"pvc\") Optional: {}"},{"location":"api/reference/#storagetype","title":"StorageType","text":"<p>Underlying type: string</p> <p>StorageType defines the backup storage type</p> <p>Validation: - Enum: [gcs s3 azure pvc]</p> <p>Appears in: - StorageConfig</p> Field Description <code>gcs</code> <code>s3</code> <code>azure</code> <code>pvc</code>"},{"location":"api/reference/#tlsconfig","title":"TLSConfig","text":"<p>TLSConfig defines TLS configuration for database connections</p> <p>Appears in: - DatabaseInstanceSpec</p> Field Description Default Validation <code>enabled</code> boolean Enabled enables TLS for connections Optional: {}  <code>mode</code> string Mode specifies the TLS verification mode disable Enum: [disable require verify-ca verify-full]  <code>secretRef</code> TLSSecretRef SecretRef references a secret containing TLS certificates Optional: {}"},{"location":"api/reference/#tlskeys","title":"TLSKeys","text":"<p>TLSKeys defines the key names within a TLS secret</p> <p>Appears in: - TLSSecretRef</p> Field Description Default Validation <code>ca</code> string CA certificate key (default: \"ca.crt\") ca.crt <code>cert</code> string Client certificate key for mTLS (optional) Optional: {}  <code>key</code> string Client key for mTLS (optional) Optional: {}"},{"location":"api/reference/#tlssecretref","title":"TLSSecretRef","text":"<p>TLSSecretRef references TLS certificates in a secret</p> <p>Appears in: - TLSConfig</p> Field Description Default Validation <code>name</code> string Name of the secret containing TLS certificates Required: {}  <code>keys</code> TLSKeys Keys defines the key names for TLS certificates Optional: {}"},{"location":"api/reference/#userinfo","title":"UserInfo","text":"<p>UserInfo contains user status information</p> <p>Appears in: - DatabaseUserStatus</p> Field Description Default Validation <code>username</code> string Username is the actual database username <code>createdAt</code> Time CreatedAt is the user creation timestamp"},{"location":"api/reference/#userreference","title":"UserReference","text":"<p>UserReference references a DatabaseUser</p> <p>Appears in: - DatabaseGrantSpec</p> Field Description Default Validation <code>name</code> string Name of the DatabaseUser resource Required: {}  <code>namespace</code> string Namespace of the DatabaseUser (defaults to the resource namespace) Optional: {}"},{"location":"architecture/","title":"Architecture","text":"<p>Overview of DB Provision Operator's architecture and design.</p>"},{"location":"architecture/#overview","title":"Overview","text":"<p>DB Provision Operator follows the Kubernetes Operator pattern, using Custom Resource Definitions (CRDs) to extend the Kubernetes API with database-specific resources.</p> <pre><code>graph TD\n    subgraph K8s[\"Kubernetes Cluster\"]\n        subgraph CP[\"Control Plane\"]\n            API[API Server]\n            ETCD[etcd]\n            CM[Controller Manager]\n        end\n        subgraph OP[\"DB Provision Operator\"]\n            RL[\"Reconciler Loop\"]\n            IC[Instance Ctrl]\n            DC[Database Ctrl]\n            UC[User Ctrl]\n        end\n        API &lt;--&gt; RL\n        CM --&gt; RL\n        subgraph DP[\"Data Plane\"]\n            PG[PostgreSQL Instance]\n            MY[MySQL Instance]\n            MR[MariaDB Instance]\n        end\n    end\n    OP --&gt; DP</code></pre>"},{"location":"architecture/#core-components","title":"Core Components","text":""},{"location":"architecture/#controllers","title":"Controllers","text":"<p>Each CRD has a dedicated controller:</p> Controller Responsibility DatabaseInstance Connection management, health checks Database Database lifecycle, extensions, schemas DatabaseUser User management, credential generation DatabaseRole Role management, permission grouping DatabaseGrant Permission management DatabaseBackup Backup execution DatabaseBackupSchedule Scheduled backup management DatabaseRestore Restore execution"},{"location":"architecture/#reconciliation-loop","title":"Reconciliation Loop","text":"<pre><code>graph LR\n    A[Watch Event] --&gt; B[Compare State]\n    B --&gt; C[Execute Actions]\n    C --&gt; D[Update Status]\n    D --&gt;|Requeue| A</code></pre>"},{"location":"architecture/#resource-hierarchy","title":"Resource Hierarchy","text":"<pre><code>graph TD\n    DI[DatabaseInstance] --&gt; DB[Database]\n    DI --&gt; DU[DatabaseUser]\n    DI --&gt; DR[DatabaseRole]\n    DB --&gt; BK[DatabaseBackup]\n    DB --&gt; BS[DatabaseBackupSchedule]\n    DU --&gt; DG1[DatabaseGrant]\n    DR --&gt; DG2[DatabaseGrant]</code></pre>"},{"location":"architecture/#dependencies","title":"Dependencies","text":"Resource Depends On Database DatabaseInstance DatabaseUser DatabaseInstance DatabaseRole DatabaseInstance DatabaseGrant DatabaseUser OR DatabaseRole DatabaseBackup Database DatabaseBackupSchedule Database DatabaseRestore DatabaseBackup, Database"},{"location":"architecture/#design-principles","title":"Design Principles","text":""},{"location":"architecture/#1-declarative-management","title":"1. Declarative Management","text":"<p>Resources are declared in YAML; the operator reconciles actual state to match desired state.</p>"},{"location":"architecture/#2-idempotency","title":"2. Idempotency","text":"<p>Reconciliation can run multiple times safely without side effects.</p>"},{"location":"architecture/#3-eventually-consistent","title":"3. Eventually Consistent","text":"<p>The operator continuously reconciles until desired state is achieved.</p>"},{"location":"architecture/#4-fail-safe","title":"4. Fail-Safe","text":"<p>Errors are logged and retried; resources maintain last known good state.</p>"},{"location":"architecture/#5-secure-by-default","title":"5. Secure by Default","text":"<ul> <li>Credentials are stored in Kubernetes Secrets</li> <li>TLS connections supported</li> <li>Minimum required permissions</li> </ul>"},{"location":"architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Design Decisions - Detailed design rationale</li> <li>Security - Security architecture</li> </ul>"},{"location":"architecture/design/","title":"Design Decisions","text":"<p>Key architectural decisions and rationale.</p>"},{"location":"architecture/design/#crd-design","title":"CRD Design","text":""},{"location":"architecture/design/#unified-api","title":"Unified API","text":"<p>Decision: Single API group (<code>dbops.dbprovision.io</code>) for all database engines.</p> <p>Rationale: - Consistent user experience across engines - Easier learning curve - Simplified RBAC policies - Engine-specific options in dedicated spec fields</p> <p>Alternative considered: Per-engine CRDs (PostgresDatabase, MySQLDatabase) - Rejected due to API fragmentation and maintenance burden</p>"},{"location":"architecture/design/#immutable-fields","title":"Immutable Fields","text":"<p>Decision: Certain fields (e.g., <code>username</code>, <code>name</code>) are immutable after creation.</p> <p>Rationale: - Prevents accidental data loss - Simplifies reconciliation logic - Aligns with database behavior (renaming is risky)</p> <p>Immutable fields: - <code>DatabaseInstance.spec.engine</code> - <code>Database.spec.name</code> - <code>DatabaseUser.spec.username</code> - <code>DatabaseRole.spec.roleName</code></p>"},{"location":"architecture/design/#resource-references","title":"Resource References","text":"<p>Decision: Use cross-resource references (<code>instanceRef</code>, <code>databaseRef</code>).</p> <p>Rationale: - Enables resource reuse - Supports cross-namespace scenarios - Clear ownership model</p>"},{"location":"architecture/design/#credential-management","title":"Credential Management","text":""},{"location":"architecture/design/#generated-secrets","title":"Generated Secrets","text":"<p>Decision: Auto-generate passwords and store in Kubernetes Secrets.</p> <p>Rationale: - Secure credential storage - Integration with Secret management tools - Automatic rotation support</p>"},{"location":"architecture/design/#secret-templates","title":"Secret Templates","text":"<p>Decision: Support custom Secret templates with variables.</p> <p>Rationale: - Application-specific formats (DATABASE_URL, JDBC_URL) - Reduces manual Secret creation - Single source of truth</p> <p>Template variables: <pre><code>{{ .Username }}\n{{ .Password }}\n{{ .Host }}\n{{ .Port }}\n{{ .Database }}\n{{ .SSLMode }}\n</code></pre></p>"},{"location":"architecture/design/#reconciliation-strategy","title":"Reconciliation Strategy","text":""},{"location":"architecture/design/#controller-architecture","title":"Controller Architecture","text":"<p>Decision: One controller per CRD type.</p> <p>Rationale: - Clear separation of concerns - Independent scaling - Simpler testing</p>"},{"location":"architecture/design/#requeue-strategy","title":"Requeue Strategy","text":"<p>Decision: Exponential backoff with configurable limits.</p> <p>Rationale: - Prevents API overload - Handles transient failures - Configurable for different environments</p> <pre><code>// Default requeue intervals\nconst (\n    defaultRequeueAfter = 30 * time.Second\n    maxRequeueAfter     = 5 * time.Minute\n)\n</code></pre>"},{"location":"architecture/design/#dependency-resolution","title":"Dependency Resolution","text":"<p>Decision: Wait for dependencies before proceeding.</p> <p>Rationale: - Ensures prerequisites exist - Clear error messages - Predictable behavior</p> <p>Example: Database waits for DatabaseInstance to be Ready.</p>"},{"location":"architecture/design/#health-checks","title":"Health Checks","text":""},{"location":"architecture/design/#connection-verification","title":"Connection Verification","text":"<p>Decision: Periodic health checks for DatabaseInstance.</p> <p>Rationale: - Detect connection issues early - Update status for monitoring - Enable alerting</p> <p>Implementation: <pre><code>healthCheck:\n  enabled: true\n  intervalSeconds: 30\n  timeoutSeconds: 5\n  failureThreshold: 3\n</code></pre></p>"},{"location":"architecture/design/#deletion-policies","title":"Deletion Policies","text":""},{"location":"architecture/design/#retain-by-default","title":"Retain by Default","text":"<p>Decision: Default deletion policy is <code>Retain</code>.</p> <p>Rationale: - Prevent accidental data loss - Explicit deletion requires <code>Delete</code> policy - Safe default for production</p>"},{"location":"architecture/design/#deletion-protection","title":"Deletion Protection","text":"<p>Decision: Optional <code>deletionProtection</code> field.</p> <p>Rationale: - Additional safety layer - Requires explicit removal before deletion - Production-grade protection</p>"},{"location":"architecture/design/#multi-engine-support","title":"Multi-Engine Support","text":""},{"location":"architecture/design/#engine-abstraction","title":"Engine Abstraction","text":"<p>Decision: Abstract database operations behind interfaces.</p> <pre><code>type DatabaseEngine interface {\n    CreateDatabase(ctx context.Context, db *Database) error\n    DeleteDatabase(ctx context.Context, db *Database) error\n    GetDatabase(ctx context.Context, name string) (*DatabaseInfo, error)\n}\n</code></pre> <p>Rationale: - Consistent internal API - Easy to add new engines - Testable with mocks</p>"},{"location":"architecture/design/#engine-detection","title":"Engine Detection","text":"<p>Decision: Explicit engine specification in DatabaseInstance.</p> <p>Rationale: - No ambiguity - Clear user intent - Avoid auto-detection errors</p>"},{"location":"architecture/design/#status-management","title":"Status Management","text":""},{"location":"architecture/design/#conditions","title":"Conditions","text":"<p>Decision: Use Kubernetes-style conditions.</p> <pre><code>status:\n  conditions:\n    - type: Ready\n      status: \"True\"\n      reason: DatabaseCreated\n      message: Database myapp created successfully\n      lastTransitionTime: \"2024-01-01T00:00:00Z\"\n</code></pre> <p>Rationale: - Standard Kubernetes pattern - Machine-readable status - Detailed history</p>"},{"location":"architecture/design/#phases","title":"Phases","text":"<p>Decision: Simple phase enum for quick status check.</p> <p>Rationale: - Human-readable summary - Easy filtering/sorting - Dashboard-friendly</p>"},{"location":"architecture/design/#backup-design","title":"Backup Design","text":""},{"location":"architecture/design/#backup-job-execution","title":"Backup Job Execution","text":"<p>Decision: Execute backups as Kubernetes Jobs.</p> <p>Rationale: - Native Kubernetes scheduling - Resource limits/requests - Automatic retry on failure - Clean separation from operator</p>"},{"location":"architecture/design/#storage-abstraction","title":"Storage Abstraction","text":"<p>Decision: Support multiple storage backends.</p> <pre><code>storage:\n  type: s3|gcs|azure|pvc\n</code></pre> <p>Rationale: - Cloud-agnostic - On-premises support (PVC) - Consistent interface</p>"},{"location":"architecture/design/#security-decisions","title":"Security Decisions","text":""},{"location":"architecture/design/#rbac-scope","title":"RBAC Scope","text":"<p>Decision: Minimum required permissions per resource type.</p> <p>Rationale: - Principle of least privilege - Namespace isolation - Audit-friendly</p>"},{"location":"architecture/design/#cross-namespace-references","title":"Cross-Namespace References","text":"<p>Decision: Allow cross-namespace references with RBAC checks.</p> <p>Rationale: - Shared database instances - Team isolation - Controlled access</p> <p>See Security for detailed security architecture.</p>"},{"location":"architecture/design/#performance-considerations","title":"Performance Considerations","text":""},{"location":"architecture/design/#concurrent-reconciliation","title":"Concurrent Reconciliation","text":"<p>Decision: Configurable concurrent reconciles per controller.</p> <pre><code>ctrl.Options{\n    MaxConcurrentReconciles: 10,\n}\n</code></pre> <p>Rationale: - Scale to large clusters - Configurable per deployment - Prevent resource exhaustion</p>"},{"location":"architecture/design/#caching","title":"Caching","text":"<p>Decision: Use controller-runtime's built-in caching.</p> <p>Rationale: - Reduced API server load - Faster reconciliation - Memory-efficient</p>"},{"location":"architecture/design/#connection-pooling","title":"Connection Pooling","text":"<p>Decision: Pool database connections per instance.</p> <p>Rationale: - Reduce connection overhead - Respect database limits - Efficient resource use</p>"},{"location":"architecture/design/#future-considerations","title":"Future Considerations","text":""},{"location":"architecture/design/#webhook-validation","title":"Webhook Validation","text":"<p>Planned: Admission webhooks for: - Immutable field enforcement - Cross-reference validation - Quota enforcement</p>"},{"location":"architecture/design/#metrics","title":"Metrics","text":"<p>Current: Basic reconciliation metrics Planned: Per-resource and per-engine metrics</p>"},{"location":"architecture/design/#api-versioning","title":"API Versioning","text":"<p>Current: <code>v1alpha1</code> Path to GA: <code>v1alpha1</code> \u2192 <code>v1beta1</code> \u2192 <code>v1</code></p> <p>Conversion webhooks will handle version migrations.</p>"},{"location":"architecture/overview/","title":"System Overview","text":""},{"location":"architecture/overview/#introduction","title":"Introduction","text":"<p>The db-provision-operator is a Kubernetes operator designed to provide unified database management across multiple database engines. It enables declarative management of database servers, databases, users, and access controls through Kubernetes Custom Resource Definitions (CRDs).</p>"},{"location":"architecture/overview/#project-goals","title":"Project Goals","text":"<ol> <li>Unified Database Management: Provide a consistent API for managing databases across different engines (PostgreSQL, MySQL, and future engines)</li> <li>Kubernetes-Native: Leverage Kubernetes patterns (controllers, CRDs, finalizers) for lifecycle management</li> <li>Security-First: Secure credential management with automatic password generation and secret templating</li> <li>Production-Ready: Support for TLS/mTLS, health checks, deletion protection, and graceful cleanup</li> <li>Extensibility: Adapter-based architecture for easy addition of new database engines</li> </ol>"},{"location":"architecture/overview/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>graph TD\n    subgraph K8s[\"Kubernetes Cluster\"]\n        subgraph Operator[\"db-provision-operator\"]\n            DIC[DatabaseInstance Controller]\n            DBC[Database Controller]\n            DUC[DatabaseUser Controller]\n            DIC &amp; DBC &amp; DUC --&gt; AL\n            subgraph AL[\"Adapter Layer\"]\n                PGA[PostgreSQL Adapter]\n                MYA[MySQL Adapter]\n            end\n            SM[Secret Manager] &lt;--&gt; AL\n            UL[Utility Layer] &lt;--&gt; AL\n        end\n        CRD1[DatabaseInstance CRD]\n        CRD2[Database CRD]\n        CRD3[DatabaseUser CRD]\n    end\n    AL --&gt; ExtDB\n    subgraph ExtDB[\"External Databases\"]\n        PGS[PostgreSQL Server]\n        MYS[MySQL Server]\n    end</code></pre>"},{"location":"architecture/overview/#technology-stack","title":"Technology Stack","text":"Component Technology Version Operator Framework Operator SDK v1.42.0 Kubernetes Client controller-runtime Latest PostgreSQL Driver pgx/v5 v5.x MySQL Driver go-sql-driver/mysql v1.x Go Version Go 1.21+"},{"location":"architecture/overview/#custom-resource-definitions-crds","title":"Custom Resource Definitions (CRDs)","text":""},{"location":"architecture/overview/#primary-resources","title":"Primary Resources","text":"CRD API Group Description <code>DatabaseInstance</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a database server connection <code>Database</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a database within an instance <code>DatabaseUser</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a database user/role <code>DatabaseRole</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a permission group <code>DatabaseGrant</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents fine-grained access control <code>DatabaseBackup</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a backup operation <code>DatabaseBackupSchedule</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents scheduled backups <code>DatabaseRestore</code> <code>dbops.dbprovision.io/v1alpha1</code> Represents a restore operation"},{"location":"architecture/overview/#resource-hierarchy","title":"Resource Hierarchy","text":"<pre><code>graph TD\n    DI[DatabaseInstance] --&gt; DB[Database]\n    DB --&gt; DU1[DatabaseUser]\n    DI --&gt; DU2[\"DatabaseUser (instance-level)\"]</code></pre>"},{"location":"architecture/overview/#component-architecture","title":"Component Architecture","text":""},{"location":"architecture/overview/#controllers-layer","title":"Controllers Layer","text":"<p>Controllers implement the reconciliation loop pattern, watching CRD resources and ensuring the actual state matches the desired state.</p>"},{"location":"architecture/overview/#databaseinstance-controller","title":"DatabaseInstance Controller","text":"<pre><code>Responsibilities:\n\u251c\u2500\u2500 Validate database server connectivity\n\u251c\u2500\u2500 Perform periodic health checks\n\u251c\u2500\u2500 Maintain connection status in status field\n\u2514\u2500\u2500 Handle graceful deletion (finalizer cleanup)\n</code></pre>"},{"location":"architecture/overview/#database-controller","title":"Database Controller","text":"<pre><code>Responsibilities:\n\u251c\u2500\u2500 Create databases on target instance\n\u251c\u2500\u2500 Configure database settings (encoding, collation, extensions)\n\u251c\u2500\u2500 Manage database lifecycle\n\u2514\u2500\u2500 Drop database on deletion (if policy allows)\n</code></pre>"},{"location":"architecture/overview/#databaseuser-controller","title":"DatabaseUser Controller","text":"<pre><code>Responsibilities:\n\u251c\u2500\u2500 Create database users/roles\n\u251c\u2500\u2500 Manage passwords (generate or use existing)\n\u251c\u2500\u2500 Create credentials secrets\n\u251c\u2500\u2500 Configure user attributes and grants\n\u2514\u2500\u2500 Drop user on deletion (if policy allows)\n</code></pre>"},{"location":"architecture/overview/#adapter-layer","title":"Adapter Layer","text":"<p>The adapter layer provides a unified interface for database operations across different engines.</p>"},{"location":"architecture/overview/#interface-hierarchy","title":"Interface Hierarchy","text":"<pre><code>classDiagram\n    class DatabaseAdapter {\n        +Connect(ctx) error\n        +Close() error\n        +Ping(ctx) error\n        +GetVersion(ctx) (string, error)\n    }\n    class DatabaseOperations {\n        +CreateDatabase(ctx, opts) error\n        +DropDatabase(ctx, name, opts) error\n        +UpdateDatabase(ctx, name, opts) error\n        +DatabaseExists(ctx, name) (bool, error)\n        +GetDatabaseInfo(ctx, name) (*DatabaseInfo, error)\n    }\n    class UserOperations {\n        +CreateUser(ctx, opts) error\n        +DropUser(ctx, name, opts) error\n        +UpdateUser(ctx, name, opts) error\n        +UserExists(ctx, name) (bool, error)\n        +GetUserInfo(ctx, name) (*UserInfo, error)\n    }\n    class GrantOperations {\n        +Grant(ctx, opts) error\n        +Revoke(ctx, opts) error\n        +GetGrants(ctx, user, db) ([]GrantInfo, error)\n    }\n    class BackupOperations {\n        +Backup(ctx, opts) (*BackupResult, error)\n        +GetBackupProgress(ctx, id) (int, error)\n        +CancelBackup(ctx, id) error\n    }\n    class RestoreOperations {\n        +Restore(ctx, opts) (*RestoreResult, error)\n        +GetRestoreProgress(ctx, id) (int, error)\n        +CancelRestore(ctx, id) error\n    }\n    class SchemaOperations {\n        +CreateSchema(ctx, opts) error\n        +DropSchema(ctx, name, opts) error\n        +SchemaExists(ctx, name) (bool, error)\n    }\n    DatabaseAdapter &lt;|-- DatabaseOperations\n    DatabaseAdapter &lt;|-- UserOperations\n    DatabaseAdapter &lt;|-- GrantOperations\n    DatabaseAdapter &lt;|-- BackupOperations\n    DatabaseAdapter &lt;|-- RestoreOperations\n    DatabaseAdapter &lt;|-- SchemaOperations</code></pre>"},{"location":"architecture/overview/#secret-manager","title":"Secret Manager","text":"<pre><code>Package: internal/secret\n\nResponsibilities:\n\u251c\u2500\u2500 Retrieve credentials from Kubernetes Secrets\n\u251c\u2500\u2500 Retrieve TLS certificates from Secrets\n\u251c\u2500\u2500 Generate cryptographically secure passwords\n\u251c\u2500\u2500 Create/update/delete Secrets with owner references\n\u251c\u2500\u2500 Render secret templates with database connection info\n\u2514\u2500\u2500 Support configurable key names for credentials\n</code></pre>"},{"location":"architecture/overview/#data-flow","title":"Data Flow","text":""},{"location":"architecture/overview/#resource-creation-flow","title":"Resource Creation Flow","text":"<pre><code>graph TD\n    A[User Creates CRD] --&gt; B[Controller Receives Event]\n    B --&gt; C[Fetch Resource from API Server]\n    C --&gt; D[Add Finalizer]\n    D --&gt; E[Get Referenced Resources]\n    E --&gt; F[Get Credentials from Secret]\n    F --&gt; G[Create Database Adapter]\n    G --&gt; H[Connect to Database Server]\n    H --&gt; I[Execute Database Operations]\n    I --&gt; J[Create Credentials Secret]\n    J --&gt; K[Update Resource Status]\n    K --&gt; L[Requeue for Periodic Reconciliation]</code></pre>"},{"location":"architecture/overview/#resource-deletion-flow","title":"Resource Deletion Flow","text":"<pre><code>graph TD\n    A[User Deletes CRD] --&gt; B[Controller Receives Delete Event]\n    B --&gt; C{Check Deletion Protection}\n    C --&gt;|Protected + No Force| D[Return Error, Keep Resource]\n    C --&gt;|Not Protected or Force| E{Check Deletion Policy}\n    E --&gt;|Retain| F[Remove Finalizer Only]\n    E --&gt;|Delete| G[Connect to Database]\n    G --&gt; H[\"Drop Resource (DB/User)\"]\n    H --&gt; I[Delete Credentials Secret]\n    I --&gt; J[Remove Finalizer]\n    J --&gt; K[Resource Removed from Cluster]</code></pre>"},{"location":"architecture/overview/#project-structure","title":"Project Structure","text":"<pre><code>db-provision-operator/\n\u251c\u2500\u2500 api/v1alpha1/           # CRD type definitions\n\u251c\u2500\u2500 cmd/main.go             # Operator entrypoint\n\u251c\u2500\u2500 config/                 # Kubernetes manifests\n\u2502   \u251c\u2500\u2500 crd/               # Generated CRD manifests\n\u2502   \u251c\u2500\u2500 rbac/              # RBAC configuration\n\u2502   \u2514\u2500\u2500 samples/           # Example resources\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 adapter/           # Database adapters\n\u2502   \u2502   \u251c\u2500\u2500 postgres/      # PostgreSQL implementation\n\u2502   \u2502   \u251c\u2500\u2500 mysql/         # MySQL implementation\n\u2502   \u2502   \u2514\u2500\u2500 types/         # Shared adapter types\n\u2502   \u251c\u2500\u2500 controller/        # Kubernetes controllers\n\u2502   \u251c\u2500\u2500 secret/            # Secret management\n\u2502   \u2514\u2500\u2500 util/              # Utility functions\n\u2514\u2500\u2500 docs/                  # Project documentation\n</code></pre>"},{"location":"architecture/overview/#supported-database-engines","title":"Supported Database Engines","text":""},{"location":"architecture/overview/#postgresql","title":"PostgreSQL","text":"<ul> <li>Full support for database operations (create, drop, update)</li> <li>User/role management with all PostgreSQL attributes</li> <li>Schema-level and default privileges</li> <li>Extensions management</li> <li>Backup/restore using pg_dump and pg_restore</li> </ul>"},{"location":"architecture/overview/#mysql","title":"MySQL","text":"<ul> <li>Database operations with charset/collation support</li> <li>User management with resource limits and authentication plugins</li> <li>Grant management at multiple levels (global, database, table, column, routine)</li> <li>Backup/restore using mysqldump</li> </ul>"},{"location":"architecture/security/","title":"Security","text":"<p>Security architecture and best practices.</p>"},{"location":"architecture/security/#overview","title":"Overview","text":"<p>DB Provision Operator implements multiple security layers:</p> <pre><code>graph TD\n    L1[\"1. Kubernetes RBAC \u2014 API Access Control\"]\n    L2[\"2. Namespace Isolation \u2014 Resource Boundaries\"]\n    L3[\"3. Secret Management \u2014 Credential Storage\"]\n    L4[\"4. TLS Encryption \u2014 Transport Security\"]\n    L5[\"5. Database Security \u2014 Engine-Level Controls\"]\n    L1 --&gt; L2 --&gt; L3 --&gt; L4 --&gt; L5\n    style L1 fill:#e3f2fd\n    style L2 fill:#e8f5e9\n    style L3 fill:#fff3e0\n    style L4 fill:#fce4ec\n    style L5 fill:#f3e5f5</code></pre>"},{"location":"architecture/security/#kubernetes-rbac","title":"Kubernetes RBAC","text":""},{"location":"architecture/security/#operator-service-account","title":"Operator Service Account","text":"<p>The operator runs with minimal permissions:</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: db-provision-operator\nrules:\n  # CRD management\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"*\"]\n    verbs: [\"*\"]\n  # Secret read/write for credentials\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\", \"delete\"]\n  # Events for status reporting\n  - apiGroups: [\"\"]\n    resources: [\"events\"]\n    verbs: [\"create\", \"patch\"]\n  # Jobs for backup/restore\n  - apiGroups: [\"batch\"]\n    resources: [\"jobs\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"delete\"]\n</code></pre>"},{"location":"architecture/security/#user-rbac","title":"User RBAC","text":"<p>Grant users access to specific resources:</p> <pre><code># Developer role - manage own databases\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: database-developer\n  namespace: app-namespace\nrules:\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"databases\", \"databaseusers\", \"databasegrants\"]\n    verbs: [\"get\", \"list\", \"watch\", \"create\", \"update\", \"patch\", \"delete\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"list\"]\n    resourceNames: [\"*-credentials\"]  # Only credential secrets\n</code></pre> <pre><code># Admin role - manage instances\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: database-admin\n  namespace: database-namespace\nrules:\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"*\"]\n    verbs: [\"*\"]\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"*\"]\n</code></pre>"},{"location":"architecture/security/#namespace-isolation","title":"Namespace Isolation","text":""},{"location":"architecture/security/#single-namespace-mode","title":"Single-Namespace Mode","text":"<p>Resources only access same-namespace DatabaseInstances:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp\n  namespace: app-team-a\nspec:\n  instanceRef:\n    name: postgres-primary\n    # No namespace = same namespace (app-team-a)\n</code></pre>"},{"location":"architecture/security/#cross-namespace-mode","title":"Cross-Namespace Mode","text":"<p>Reference instances in other namespaces:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp\n  namespace: app-team-a\nspec:\n  instanceRef:\n    name: shared-postgres\n    namespace: database  # Different namespace\n</code></pre> <p>Required RBAC for cross-namespace:</p> <pre><code># In database namespace\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: instance-reader\n  namespace: database\nrules:\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"databaseinstances\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n---\n# Bind to app-team-a service account\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: app-team-a-instance-reader\n  namespace: database\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: instance-reader\nsubjects:\n  - kind: ServiceAccount\n    name: default\n    namespace: app-team-a\n</code></pre>"},{"location":"architecture/security/#secret-management","title":"Secret Management","text":""},{"location":"architecture/security/#credential-storage","title":"Credential Storage","text":"<p>All database credentials are stored in Kubernetes Secrets:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: myapp-user-credentials\n  ownerReferences:\n    - apiVersion: dbops.dbprovision.io/v1alpha1\n      kind: DatabaseUser\n      name: myapp-user\ntype: Opaque\ndata:\n  username: &lt;base64&gt;\n  password: &lt;base64&gt;\n</code></pre>"},{"location":"architecture/security/#secret-best-practices","title":"Secret Best Practices","text":"<ol> <li> <p>Enable encryption at rest: <pre><code># kube-apiserver configuration\n--encryption-provider-config=/etc/kubernetes/enc/enc.yaml\n</code></pre></p> </li> <li> <p>Use external secret management:</p> </li> <li>HashiCorp Vault with External Secrets Operator</li> <li>AWS Secrets Manager</li> <li> <p>Azure Key Vault</p> </li> <li> <p>Limit Secret access: <pre><code># Only allow specific secret access\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    resourceNames: [\"postgres-admin-credentials\"]\n    verbs: [\"get\"]\n</code></pre></p> </li> </ol>"},{"location":"architecture/security/#password-generation","title":"Password Generation","text":"<p>Secure password generation:</p> <pre><code>passwordSecret:\n  generate: true\n  length: 32\n  includeSpecialChars: true\n  excludeChars: \"\\\"'\\\\`\"  # Exclude problematic characters\n</code></pre>"},{"location":"architecture/security/#tls-encryption","title":"TLS Encryption","text":""},{"location":"architecture/security/#postgresql-tls","title":"PostgreSQL TLS","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-tls\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    sslMode: verify-full\n    secretRef:\n      name: postgres-admin-credentials\n    tls:\n      secretRef:\n        name: postgres-tls-certs\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"architecture/security/#mysql-tls","title":"MySQL TLS","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-tls\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    secretRef:\n      name: mysql-admin-credentials\n    tls:\n      enabled: true\n      secretRef:\n        name: mysql-tls-certs\n</code></pre>"},{"location":"architecture/security/#certificate-management","title":"Certificate Management","text":"<p>Use cert-manager for automated certificate management:</p> <pre><code>apiVersion: cert-manager.io/v1\nkind: Certificate\nmetadata:\n  name: postgres-client-cert\nspec:\n  secretName: postgres-tls-certs\n  issuerRef:\n    name: database-ca\n    kind: ClusterIssuer\n  commonName: postgres-client\n  usages:\n    - client auth\n</code></pre>"},{"location":"architecture/security/#database-security","title":"Database Security","text":""},{"location":"architecture/security/#postgresql-security","title":"PostgreSQL Security","text":"<pre><code># User with minimum privileges\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: app-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: app_user\n  postgres:\n    login: true\n    inherit: true\n    createDB: false\n    createRole: false\n    superuser: false\n    replication: false\n    bypassRLS: false\n    connectionLimit: 20\n</code></pre>"},{"location":"architecture/security/#mysql-security","title":"MySQL Security","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: app-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: app_user\n  mysql:\n    maxUserConnections: 20\n    authPlugin: caching_sha2_password\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.%\"  # Only internal network\n</code></pre>"},{"location":"architecture/security/#backup-security","title":"Backup Security","text":""},{"location":"architecture/security/#encrypted-backups","title":"Encrypted Backups","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: secure-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: secure-backups\n      secretRef:\n        name: s3-credentials\n  encryption:\n    enabled: true\n    algorithm: aes-256-gcm\n    secretRef:\n      name: backup-encryption-key\n      key: encryption-key\n</code></pre>"},{"location":"architecture/security/#s3-security","title":"S3 Security","text":"<pre><code># S3 bucket policy for backup storage\n{\n  \"Version\": \"2012-10-17\",\n  \"Statement\": [\n    {\n      \"Effect\": \"Allow\",\n      \"Principal\": {\"AWS\": \"arn:aws:iam::ACCOUNT:role/backup-role\"},\n      \"Action\": [\"s3:PutObject\", \"s3:GetObject\", \"s3:DeleteObject\"],\n      \"Resource\": \"arn:aws:s3:::secure-backups/*\"\n    }\n  ]\n}\n</code></pre>"},{"location":"architecture/security/#network-security","title":"Network Security","text":""},{"location":"architecture/security/#network-policies","title":"Network Policies","text":"<p>Restrict operator network access:</p> <pre><code>apiVersion: networking.k8s.io/v1\nkind: NetworkPolicy\nmetadata:\n  name: db-provision-operator\n  namespace: db-provision-operator-system\nspec:\n  podSelector:\n    matchLabels:\n      app: db-provision-operator\n  policyTypes:\n    - Egress\n  egress:\n    # Allow DNS\n    - to:\n        - namespaceSelector: {}\n      ports:\n        - protocol: UDP\n          port: 53\n    # Allow database connections\n    - to:\n        - namespaceSelector:\n            matchLabels:\n              name: database\n      ports:\n        - protocol: TCP\n          port: 5432\n        - protocol: TCP\n          port: 3306\n    # Allow Kubernetes API\n    - to:\n        - ipBlock:\n            cidr: 10.0.0.1/32  # API server IP\n      ports:\n        - protocol: TCP\n          port: 443\n</code></pre>"},{"location":"architecture/security/#security-checklist","title":"Security Checklist","text":""},{"location":"architecture/security/#deployment","title":"Deployment","text":"<ul> <li> Operator runs with minimal RBAC permissions</li> <li> Pod security context configured (non-root)</li> <li> Resource limits set</li> <li> Network policies in place</li> </ul>"},{"location":"architecture/security/#secrets","title":"Secrets","text":"<ul> <li> Encryption at rest enabled</li> <li> Secret access restricted by RBAC</li> <li> Password generation uses strong defaults</li> <li> No secrets in container environment variables</li> </ul>"},{"location":"architecture/security/#connections","title":"Connections","text":"<ul> <li> TLS enabled for database connections</li> <li> SSL mode set to <code>verify-full</code> (PostgreSQL)</li> <li> Client certificates used where possible</li> </ul>"},{"location":"architecture/security/#database","title":"Database","text":"<ul> <li> Users have minimum required privileges</li> <li> Connection limits configured</li> <li> Host restrictions set (MySQL)</li> <li> Deletion protection enabled for production</li> </ul>"},{"location":"architecture/security/#backups","title":"Backups","text":"<ul> <li> Backup encryption enabled</li> <li> Storage credentials secured</li> <li> Backup retention policies configured</li> <li> Regular restore testing performed</li> </ul>"},{"location":"development/","title":"Development","text":"<p>Guides for contributing to and developing DB Provision Operator.</p>"},{"location":"development/#overview","title":"Overview","text":"<ul> <li>Contributing - How to contribute</li> <li>Testing - Testing strategies</li> <li>CI/CD - Continuous integration and deployment</li> </ul>"},{"location":"development/#quick-start","title":"Quick Start","text":""},{"location":"development/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.21+</li> <li>Docker</li> <li>kubectl</li> <li>kind or minikube</li> <li>Make</li> </ul>"},{"location":"development/#clone-and-build","title":"Clone and Build","text":"<pre><code># Clone repository\ngit clone https://github.com/panteparak/db-provision-operator.git\ncd db-provision-operator\n\n# Install dependencies\nmake install-tools\n\n# Build\nmake build\n\n# Run tests\nmake test\n</code></pre>"},{"location":"development/#local-development","title":"Local Development","text":"<pre><code># Start local cluster\nmake kind-create\n\n# Install CRDs\nmake install\n\n# Run operator locally\nmake run\n</code></pre>"},{"location":"development/#development-workflow","title":"Development Workflow","text":"<ol> <li>Create feature branch</li> <li>Make changes</li> <li>Write/update tests</li> <li>Run tests locally</li> <li>Submit pull request</li> </ol>"},{"location":"development/#project-structure","title":"Project Structure","text":"<pre><code>db-provision-operator/\n\u251c\u2500\u2500 api/                    # CRD API definitions\n\u2502   \u2514\u2500\u2500 v1alpha1/          # API version\n\u251c\u2500\u2500 cmd/                    # Main entrypoints\n\u2502   \u2514\u2500\u2500 main.go            # Operator entrypoint\n\u251c\u2500\u2500 config/                 # Kubernetes manifests\n\u2502   \u251c\u2500\u2500 crd/               # CRD definitions\n\u2502   \u251c\u2500\u2500 manager/           # Operator deployment\n\u2502   \u251c\u2500\u2500 rbac/              # RBAC rules\n\u2502   \u2514\u2500\u2500 samples/           # Sample resources\n\u251c\u2500\u2500 internal/               # Internal packages\n\u2502   \u251c\u2500\u2500 controller/        # Controllers\n\u2502   \u251c\u2500\u2500 database/          # Database adapters\n\u2502   \u2514\u2500\u2500 utils/             # Utilities\n\u251c\u2500\u2500 test/                   # Tests\n\u2502   \u251c\u2500\u2500 e2e/               # End-to-end tests\n\u2502   \u2514\u2500\u2500 fixtures/          # Test fixtures\n\u251c\u2500\u2500 charts/                 # Helm charts\n\u2502   \u2514\u2500\u2500 db-provision-operator/\n\u251c\u2500\u2500 docs/                   # Documentation\n\u251c\u2500\u2500 DOCS/                   # Additional docs and examples\n\u251c\u2500\u2500 Dockerfile             # Container image\n\u251c\u2500\u2500 Makefile               # Build automation\n\u2514\u2500\u2500 go.mod                 # Go modules\n</code></pre>"},{"location":"development/#key-technologies","title":"Key Technologies","text":"Technology Purpose Kubebuilder Operator framework controller-runtime Controller library Ginkgo Testing framework Gomega Assertion library envtest Integration testing"},{"location":"development/#makefile-targets","title":"Makefile Targets","text":"<pre><code># Development\nmake build          # Build binary\nmake run            # Run locally\nmake install        # Install CRDs\nmake uninstall      # Uninstall CRDs\n\n# Testing\nmake test           # Unit tests\nmake test-e2e       # E2E tests\nmake lint           # Run linters\n\n# Docker\nmake docker-build   # Build image\nmake docker-push    # Push image\n\n# Cluster\nmake kind-create    # Create kind cluster\nmake kind-delete    # Delete kind cluster\nmake deploy         # Deploy to cluster\n\n# Documentation\nmake docs-serve     # Serve docs locally\nmake docs-build     # Build docs\n</code></pre>"},{"location":"development/#code-generation","title":"Code Generation","text":"<p>After modifying API types:</p> <pre><code># Regenerate manifests and code\nmake generate\nmake manifests\n</code></pre>"},{"location":"development/#debugging","title":"Debugging","text":""},{"location":"development/#vs-code-launch-config","title":"VS Code Launch Config","text":"<pre><code>{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Debug Operator\",\n      \"type\": \"go\",\n      \"request\": \"launch\",\n      \"mode\": \"auto\",\n      \"program\": \"${workspaceFolder}/cmd/main.go\",\n      \"env\": {\n        \"KUBECONFIG\": \"${env:HOME}/.kube/config\"\n      }\n    }\n  ]\n}\n</code></pre>"},{"location":"development/#golandintellij","title":"GoLand/IntelliJ","text":"<ol> <li>Run &gt; Edit Configurations</li> <li>Add Go Build</li> <li>Package path: <code>./cmd</code></li> <li>Environment: <code>KUBECONFIG=$HOME/.kube/config</code></li> </ol>"},{"location":"development/#next-steps","title":"Next Steps","text":"<ul> <li>Contributing - Contribution guidelines</li> <li>Testing - Write and run tests</li> <li>CI/CD - Understanding the pipeline</li> </ul>"},{"location":"development/ci-cd/","title":"CI/CD","text":"<p>Continuous integration and deployment pipeline for the DB Provision Operator.</p>"},{"location":"development/ci-cd/#overview","title":"Overview","text":"<p>The pipeline uses two workflows:</p> <ol> <li>CI (<code>ci.yml</code>) \u2014 Runs the full test suite on every push to <code>main</code>, every PR, and every tag push (<code>v*</code>)</li> <li>Release (<code>release.yml</code>) \u2014 Triggered automatically when CI completes on a <code>v*</code> tag, or manually via <code>workflow_dispatch</code></li> </ol> <pre><code>graph LR\n    subgraph CI[\"CI Pipeline\"]\n        S0[Setup] --&gt; S1[\"8 Parallel Jobs\"]\n        S1 --&gt; S2[Gate]\n        S2 --&gt; S3[Integration Tests]\n        S3 --&gt; S4[E2E Tests]\n        S4 --&gt; S5[CI Done]\n    end\n    S5 --&gt;|\"on v* tag\"| R\n    subgraph Release[\"Release Pipeline\"]\n        R[Guard] --&gt; DR[Docker Release]\n        DR --&gt; GR[GitHub Release]\n        GR --&gt; HO[Helm OCI]\n        HO --&gt; DO[Docs]\n        DO --&gt; SM[Summary]\n    end</code></pre>"},{"location":"development/ci-cd/#triggers","title":"Triggers","text":"Event Branches/Tags What Runs Pull request <code>main</code> CI Stages 0\u20135 (Docker build without push) Push <code>main</code> CI Stages 0\u20135 + Docker push + Security scan Tag <code>v*</code> CI Stages 0\u20135 (full pipeline) \u2192 Release (automatic) Manual <code>workflow_dispatch</code> Release only (with tag input)"},{"location":"development/ci-cd/#release-flow","title":"Release Flow","text":"<pre><code>git tag v0.1.8 &amp;&amp; git push origin v0.1.8\n  \u2514\u2500\u25ba CI runs full pipeline (lint, test, envtest, integration, E2E)\n       \u2514\u2500\u25ba CI succeeds \u2192 workflow_run triggers Release\n            \u2514\u2500\u25ba Guard validates tag + Chart.yaml version match\n                 \u2514\u2500\u25ba Docker retag (sha-xxx \u2192 version + latest)\n                 \u2514\u2500\u25ba GitHub Release (install.yaml, CRDs, Helm chart, checksums, SBOMs)\n                 \u2514\u2500\u25ba Helm OCI push (oci://ghcr.io/&lt;owner&gt;/charts/db-provision-operator)\n                 \u2514\u2500\u25ba Documentation deploy (GitHub Pages)\n</code></pre>"},{"location":"development/ci-cd/#ci-workflow","title":"CI Workflow","text":""},{"location":"development/ci-cd/#stage-1-parallel-jobs","title":"Stage 1: Parallel Jobs","text":"<p>Eight jobs run concurrently after setup:</p>"},{"location":"development/ci-cd/#1-lint","title":"1. Lint","text":"<p>Runs <code>golangci-lint</code> (v2.1.0) via the official GitHub Action.</p>"},{"location":"development/ci-cd/#2-unit-tests","title":"2. Unit Tests","text":"<pre><code>make test  # go test (excludes /e2e), outputs cover.out\n</code></pre> <p>Uploads coverage to Codecov.</p>"},{"location":"development/ci-cd/#3-controller-tests-envtest","title":"3. Controller Tests (envtest)","text":"<pre><code>make test-envtest  # Runs controller + CRD validation tests with envtest\n</code></pre> <p>Uses <code>KUBEBUILDER_ASSETS</code> from <code>setup-envtest</code>. Envtest binaries (~100MB) are cached by Kubernetes version.</p>"},{"location":"development/ci-cd/#4-template-comparison","title":"4. Template Comparison","text":"<pre><code>make test-templates  # Verifies Helm \u2261 Kustomize template equivalence\n</code></pre> <p>Ensures the Helm chart and Kustomize overlays produce equivalent manifests.</p>"},{"location":"development/ci-cd/#5-docker-build","title":"5. Docker Build","text":"<p>Builds the operator image per platform (currently <code>linux/amd64</code>). Uses a multi-layer cache strategy:</p> <ul> <li>GHA cache (fast, per-platform, workflow-local)</li> <li>Registry cache (persistent fallback when GHA cache is evicted)</li> </ul> <p>On push events: Pushes by digest, uploads digest artifact for manifest merging. On PRs: Builds locally, saves as tarball artifact for E2E tests.</p>"},{"location":"development/ci-cd/#6-verify-manifests","title":"6. Verify Manifests","text":"<pre><code>make manifests  # Generates CRDs, RBAC, webhook configs\n</code></pre> <p>On <code>main</code> push: auto-commits if manifests are outdated. On PRs: fails the check so the developer runs <code>make manifests</code> locally.</p> <p>Also runs Helm chart linting, template rendering, and strict YAML validation (duplicate key detection).</p>"},{"location":"development/ci-cd/#7-verify-generated-code","title":"7. Verify Generated Code","text":"<pre><code>make generate  # Generates DeepCopy methods\n</code></pre> <p>Fails if generated code is outdated.</p>"},{"location":"development/ci-cd/#8-docs-build","title":"8. Docs Build","text":"<pre><code>mkdocs build --strict  # Builds documentation, fails on warnings\n</code></pre>"},{"location":"development/ci-cd/#stage-2-gate","title":"Stage 2: Gate","text":"<p>Waits for all Stage 1 jobs to succeed before allowing integration tests. Checks each job's result and fails with a clear error message identifying which job(s) failed.</p> <p>For PRs, <code>docker-merge</code> is skipped (no push), so the gate only checks <code>docker-build</code>.</p>"},{"location":"development/ci-cd/#stage-3-integration-tests","title":"Stage 3: Integration Tests","text":"<p>Runs after the gate passes. Uses a matrix strategy across all four database engines:</p> <pre><code>matrix:\n  database: [postgresql, mysql, mariadb, cockroachdb]\n</code></pre> <p>Each job uses testcontainers-go to manage Docker containers programmatically \u2014 no manual container setup needed. The tests run against real database instances with envtest providing the Kubernetes API.</p> <pre><code>make test-integration INTEGRATION_TEST_DATABASE=${{ matrix.database }}\n</code></pre>"},{"location":"development/ci-cd/#stage-4-e2e-tests","title":"Stage 4: E2E Tests","text":"<p>Runs after integration tests pass. Full end-to-end validation using Docker Compose + k3d + Helm.</p>"},{"location":"development/ci-cd/#pipeline-per-database-16-steps","title":"Pipeline Per Database (16 Steps)","text":"<p>Each database engine runs in parallel with this sequence:</p> # Step Description 1 Checkout Clone repository 2 Setup Go Install Go from <code>go.mod</code> version 3 Get SHA Short commit SHA for image tagging 4 Install k3d Install k3d CLI 5 Start database <code>make e2e-db-up E2E_DATABASE=&lt;engine&gt;</code> 6 Create cluster <code>make e2e-cluster-create</code> 7 Get operator image Pull from registry (push) or load from artifact (PR) 8 Load into k3d <code>make e2e-image-load E2E_IMG=&lt;image&gt;</code> 9 Install CRDs <code>make e2e-install-crds</code> 10 Install Helm Setup Helm v3.14.0 11 Deploy operator <code>helm install</code> with the chart (not Kustomize) 12 Wait for ready <code>kubectl wait --for=condition=Available</code> 13 Create instance <code>make e2e-create-db-instance E2E_DATABASE=&lt;engine&gt;</code> 14 Run tests <code>make e2e-local-run-tests E2E_DATABASE=&lt;engine&gt;</code> 15 Collect logs On failure: operator logs, pod descriptions, Docker Compose logs, CR YAML, events 16 Cleanup <code>make e2e-local-cleanup</code> (always runs)"},{"location":"development/ci-cd/#helm-deployment-not-kustomize","title":"Helm Deployment (Not Kustomize)","text":"<p>CI intentionally deploys the operator via the Helm chart (<code>charts/db-provision-operator/</code>) rather than Kustomize. This validates the Helm chart in a real cluster as part of every CI run. Local development uses <code>make e2e-deploy-operator</code> (Kustomize) for faster iteration.</p>"},{"location":"development/ci-cd/#log-collection-on-failure","title":"Log Collection on Failure","text":"<p>When any E2E step fails, CI collects:</p> <ul> <li>Operator pod logs (last 500 lines)</li> <li>Operator pod description</li> <li>Docker Compose database logs (last 100 lines)</li> <li>All database-related CR YAML dumps</li> <li>Kubernetes events (last 100)</li> <li>Pod list across all namespaces</li> </ul>"},{"location":"development/ci-cd/#stage-5-ci-success","title":"Stage 5: CI Success","text":"<p>A summary job that runs after all E2E tests pass. Confirms the full pipeline succeeded.</p>"},{"location":"development/ci-cd/#security-scan-push-events-only","title":"Security Scan (Push Events Only)","text":"<p>After <code>docker-merge</code>, Trivy scans each platform image:</p> <ol> <li>Generate CycloneDX SBOM from the container image</li> <li>Scan for vulnerabilities \u2014 outputs JSON (all severities) + table (MEDIUM+ with unfixed ignored)</li> <li>Generate SARIF report \u2014 uploaded to GitHub Security tab via CodeQL</li> <li>Upload artifacts \u2014 SBOM, vulnerability reports retained for 30 days</li> </ol>"},{"location":"development/ci-cd/#release-workflow","title":"Release Workflow","text":"<p>The release workflow uses the <code>workflow_run</code> pattern: it triggers automatically when the CI workflow completes, but only proceeds if CI succeeded and the trigger was a <code>v*</code> semver tag.</p>"},{"location":"development/ci-cd/#guard-job","title":"Guard Job","text":"<p>The guard job gates all downstream release jobs:</p> <ol> <li>Checks CI conclusion \u2014 fails immediately if CI didn't succeed</li> <li>Extracts tag \u2014 from <code>workflow_run.head_branch</code> (automatic) or <code>inputs.tag</code> (manual dispatch)</li> <li>Validates semver \u2014 skips release for non-version tags (e.g., plain push to main)</li> <li>Validates Chart.yaml \u2014 ensures chart version matches the tag version</li> <li>Computes image tag \u2014 derives the <code>sha-&lt;short&gt;</code> tag used by CI for Docker retagging</li> <li>Stores CI run ID \u2014 used for cross-workflow artifact download (SBOMs)</li> </ol>"},{"location":"development/ci-cd/#docker-release","title":"Docker Release","text":"<ul> <li>Automatic (workflow_run): Retags the CI-built <code>sha-xxx</code> image to <code>&lt;version&gt;</code> and <code>latest</code> using <code>docker buildx imagetools create</code>. This is a manifest-only operation \u2014 no rebuild, bit-for-bit identical to what CI tested.</li> <li>Manual (workflow_dispatch): Rebuilds from source as a fallback when no CI-built image exists.</li> </ul>"},{"location":"development/ci-cd/#github-release","title":"GitHub Release","text":"<p>Creates a GitHub Release with the following assets:</p> Asset Description <code>db-provision-operator-&lt;ver&gt;.yaml</code> Versioned Kustomize install manifest <code>crds-&lt;ver&gt;.tar.gz</code> CRD definitions tarball <code>db-provision-operator-&lt;ver&gt;.tgz</code> Helm chart package <code>checksums.txt</code> SHA-256 checksums for all artifacts <code>sbom.spdx.json</code> SBOM from CI (when available) <p>Tags containing <code>-rc</code>, <code>-alpha</code>, or <code>-beta</code> are marked as pre-releases.</p>"},{"location":"development/ci-cd/#helm-oci","title":"Helm OCI","text":"<p>Pushes the Helm chart as an OCI artifact to the GitHub Container Registry:</p> <pre><code># Install the operator via OCI\nhelm install db-provision-operator \\\n  oci://ghcr.io/&lt;owner&gt;/charts/db-provision-operator \\\n  --version &lt;version&gt;\n</code></pre> <p>No gh-pages Helm repository is needed \u2014 images and charts use the same container registry.</p>"},{"location":"development/ci-cd/#documentation-deploy","title":"Documentation Deploy","text":"<p>Builds documentation with mkdocs-material and deploys to GitHub Pages via <code>mkdocs gh-deploy --force</code>.</p>"},{"location":"development/ci-cd/#manual-dispatch","title":"Manual Dispatch","text":"<p>The release can be triggered manually via <code>workflow_dispatch</code> with a tag input. This bypasses the <code>workflow_run</code> trigger and rebuilds Docker images from source. Useful for re-releasing or releasing from an existing tag when CI artifacts have expired.</p> <pre><code>gh workflow run release.yml -f tag=v0.1.8\n</code></pre>"},{"location":"development/ci-cd/#docker-image-build","title":"Docker Image Build","text":""},{"location":"development/ci-cd/#multi-stage-dockerfile","title":"Multi-Stage Dockerfile","text":"<p>The operator image uses a multi-stage build:</p> <ol> <li>Builder stage: Compiles the Go binary</li> <li>Runtime stage: Alpine-based minimal image with database client tools</li> </ol>"},{"location":"development/ci-cd/#image-tags","title":"Image Tags","text":"Tag Pattern When Example <code>sha-&lt;short&gt;</code> Every build <code>sha-abc1234</code> <code>latest</code> Push to main / release <code>latest</code> <code>main</code> Push to main <code>main</code> <code>&lt;version&gt;</code> Semver tag <code>1.2.3</code> <code>&lt;major&gt;.&lt;minor&gt;</code> Semver tag <code>1.2</code>"},{"location":"development/ci-cd/#cache-strategy","title":"Cache Strategy","text":"<pre><code>GHA cache (fast, per-platform)\n  \u2514\u2500\u2500 fallback: Registry cache (persistent, cross-workflow)\n</code></pre> <p>PRs share cache from the <code>main</code> branch via registry cache, enabling fast builds even on new branches.</p>"},{"location":"development/ci-cd/#build-artifacts","title":"Build Artifacts","text":""},{"location":"development/ci-cd/#container-images","title":"Container Images","text":"<p>Published to: <code>ghcr.io/&lt;owner&gt;/db-provision-operator</code></p>"},{"location":"development/ci-cd/#helm-charts","title":"Helm Charts","text":"<p>Published as OCI artifacts to: <code>oci://ghcr.io/&lt;owner&gt;/charts/db-provision-operator</code></p>"},{"location":"development/ci-cd/#sbom","title":"SBOM","text":"<p>Generated in two formats:</p> <ul> <li>SPDX (via <code>anchore/sbom-action</code>) \u2014 uploaded as artifact, attached to GitHub releases</li> <li>CycloneDX (via Trivy) \u2014 used for vulnerability scanning</li> </ul>"},{"location":"development/ci-cd/#environment-configuration","title":"Environment Configuration","text":""},{"location":"development/ci-cd/#secrets","title":"Secrets","text":"Secret Purpose <code>GITHUB_TOKEN</code> Auto-provided \u2014 registry login, release creation <code>CODECOV_TOKEN</code> Coverage reporting"},{"location":"development/ci-cd/#global-environment","title":"Global Environment","text":"Variable Value Description <code>GO_VERSION_FILE</code> <code>go.mod</code> Go version source of truth <code>REGISTRY</code> <code>ghcr.io</code> Container registry <code>IMAGE_NAME</code> <code>${{ github.repository }}</code> Image name"},{"location":"development/ci-cd/#local-ci-simulation","title":"Local CI Simulation","text":"<p>Reproduce each CI stage locally:</p> <pre><code># Stage 1: Lint\nmake lint\n\n# Stage 1: Unit tests\nmake test\n\n# Stage 1: Controller tests (envtest)\nmake test-envtest\n\n# Stage 1: Template comparison\nmake test-templates\n\n# Stage 1: Docker build\nmake docker-build\n\n# Stage 1: Manifests\nmake manifests &amp;&amp; git diff --exit-code\n\n# Stage 1: Generated code\nmake generate &amp;&amp; git diff --exit-code\n\n# Stage 1: Docs\nmkdocs build --strict\n\n# Stage 3: Integration tests (single engine)\nmake test-integration INTEGRATION_TEST_DATABASE=postgresql\n\n# Stage 4: E2E tests (single engine)\nmake e2e-local-postgresql\n\n# Full E2E (all engines)\nmake e2e-local-all\n</code></pre>"},{"location":"development/contributing/","title":"Contributing","text":"<p>Guidelines for contributing to DB Provision Operator.</p>"},{"location":"development/contributing/#getting-started","title":"Getting Started","text":""},{"location":"development/contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Go 1.21+</li> <li>Docker</li> <li>kubectl</li> <li>kind or minikube</li> <li>Make</li> </ul>"},{"location":"development/contributing/#setup","title":"Setup","text":"<pre><code># Fork and clone\ngit clone https://github.com/YOUR_USERNAME/db-provision-operator.git\ncd db-provision-operator\n\n# Add upstream remote\ngit remote add upstream https://github.com/panteparak/db-provision-operator.git\n\n# Install tools\nmake install-tools\n\n# Verify setup\nmake test\n</code></pre>"},{"location":"development/contributing/#development-workflow","title":"Development Workflow","text":""},{"location":"development/contributing/#1-create-branch","title":"1. Create Branch","text":"<pre><code># Update main\ngit checkout main\ngit pull upstream main\n\n# Create feature branch\ngit checkout -b feature/my-feature\n</code></pre>"},{"location":"development/contributing/#2-make-changes","title":"2. Make Changes","text":"<p>Follow these guidelines:</p> <ul> <li>Code style: Follow Go conventions</li> <li>Comments: Document exported functions</li> <li>Tests: Add tests for new code</li> <li>Commits: Use conventional commits</li> </ul>"},{"location":"development/contributing/#3-test-changes","title":"3. Test Changes","text":"<pre><code># Run all tests\nmake test\n\n# Run linters\nmake lint\n\n# Run E2E tests (requires cluster)\nmake test-e2e\n</code></pre>"},{"location":"development/contributing/#4-submit-pr","title":"4. Submit PR","text":"<pre><code># Push branch\ngit push origin feature/my-feature\n</code></pre> <p>Open PR against <code>main</code> branch.</p>"},{"location":"development/contributing/#code-style","title":"Code Style","text":""},{"location":"development/contributing/#go-guidelines","title":"Go Guidelines","text":"<ul> <li>Follow Effective Go</li> <li>Run <code>gofmt</code> and <code>goimports</code></li> <li>Use meaningful variable names</li> <li>Keep functions focused and small</li> </ul>"},{"location":"development/contributing/#naming-conventions","title":"Naming Conventions","text":"Type Convention Example Files <code>snake_case.go</code> <code>database_controller.go</code> Packages <code>lowercase</code> <code>database</code> Types <code>PascalCase</code> <code>DatabaseInstance</code> Functions <code>PascalCase</code> (exported) <code>CreateDatabase</code> Variables <code>camelCase</code> <code>dbInstance</code> Constants <code>PascalCase</code> or <code>UPPER_SNAKE</code> <code>DefaultPort</code>"},{"location":"development/contributing/#error-handling","title":"Error Handling","text":"<pre><code>// Good\nif err != nil {\n    return fmt.Errorf(\"failed to create database: %w\", err)\n}\n\n// Bad\nif err != nil {\n    return err  // No context\n}\n</code></pre>"},{"location":"development/contributing/#logging","title":"Logging","text":"<pre><code>// Use structured logging\nlog.Info(\"Reconciling database\",\n    \"namespace\", db.Namespace,\n    \"name\", db.Name)\n\n// Error logging\nlog.Error(err, \"Failed to create database\",\n    \"namespace\", db.Namespace,\n    \"name\", db.Name)\n</code></pre>"},{"location":"development/contributing/#commit-messages","title":"Commit Messages","text":"<p>Use Conventional Commits:</p> <pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;description&gt;\n\n[optional body]\n\n[optional footer]\n</code></pre>"},{"location":"development/contributing/#types","title":"Types","text":"Type Description <code>feat</code> New feature <code>fix</code> Bug fix <code>docs</code> Documentation <code>style</code> Formatting (no code change) <code>refactor</code> Code refactoring <code>test</code> Tests <code>chore</code> Maintenance"},{"location":"development/contributing/#examples","title":"Examples","text":"<pre><code>feat(database): add support for PostgreSQL extensions\n\nfix(user): handle special characters in password generation\n\ndocs: update installation guide\n\ntest(e2e): add backup/restore tests\n</code></pre>"},{"location":"development/contributing/#pull-requests","title":"Pull Requests","text":""},{"location":"development/contributing/#pr-title","title":"PR Title","text":"<p>Follow conventional commit format: <pre><code>feat(database): add support for schemas\n</code></pre></p>"},{"location":"development/contributing/#pr-description","title":"PR Description","text":"<p>Use the template:</p> <pre><code>## Description\nBrief description of changes.\n\n## Type of Change\n- [ ] Bug fix\n- [ ] New feature\n- [ ] Breaking change\n- [ ] Documentation update\n\n## Testing\n- [ ] Unit tests added/updated\n- [ ] E2E tests added/updated\n- [ ] Manual testing performed\n\n## Checklist\n- [ ] Code follows style guidelines\n- [ ] Self-review completed\n- [ ] Documentation updated\n- [ ] Tests pass\n</code></pre>"},{"location":"development/contributing/#review-process","title":"Review Process","text":"<ol> <li>Automated checks must pass</li> <li>At least one maintainer approval</li> <li>All conversations resolved</li> <li>Squash and merge</li> </ol>"},{"location":"development/contributing/#adding-new-features","title":"Adding New Features","text":""},{"location":"development/contributing/#adding-a-new-crd","title":"Adding a New CRD","text":"<ol> <li> <p>Define API in <code>api/v1alpha1/</code>:    <pre><code>kubebuilder create api --group dbops --version v1alpha1 --kind NewResource\n</code></pre></p> </li> <li> <p>Implement types in <code>*_types.go</code></p> </li> <li> <p>Generate manifests:    <pre><code>make generate\nmake manifests\n</code></pre></p> </li> <li> <p>Implement controller in <code>internal/controller/</code></p> </li> <li> <p>Add tests</p> </li> <li> <p>Update documentation</p> </li> </ol>"},{"location":"development/contributing/#adding-database-engine-support","title":"Adding Database Engine Support","text":"<ol> <li> <p>Implement <code>DatabaseEngine</code> interface in <code>internal/database/</code></p> </li> <li> <p>Add engine-specific options to API types</p> </li> <li> <p>Register engine in factory</p> </li> <li> <p>Add tests for new engine</p> </li> <li> <p>Add documentation</p> </li> </ol>"},{"location":"development/contributing/#testing-guidelines","title":"Testing Guidelines","text":""},{"location":"development/contributing/#unit-tests","title":"Unit Tests","text":"<pre><code>func TestCreateDatabase(t *testing.T) {\n    // Setup\n    db := &amp;Database{...}\n\n    // Execute\n    err := createDatabase(db)\n\n    // Assert\n    assert.NoError(t, err)\n}\n</code></pre>"},{"location":"development/contributing/#integration-tests","title":"Integration Tests","text":"<pre><code>var _ = Describe(\"Database Controller\", func() {\n    Context(\"When creating Database\", func() {\n        It(\"Should create database in instance\", func() {\n            // Test code\n        })\n    })\n})\n</code></pre>"},{"location":"development/contributing/#e2e-tests","title":"E2E Tests","text":"<pre><code>var _ = Describe(\"Database E2E\", func() {\n    It(\"Should create and delete database\", func() {\n        // Create instance\n        // Create database\n        // Verify database exists\n        // Delete database\n        // Verify database removed\n    })\n})\n</code></pre>"},{"location":"development/contributing/#documentation","title":"Documentation","text":""},{"location":"development/contributing/#code-documentation","title":"Code Documentation","text":"<pre><code>// CreateDatabase creates a new database in the instance.\n// It returns an error if the database already exists or\n// if the connection to the instance fails.\nfunc CreateDatabase(ctx context.Context, db *Database) error {\n    // ...\n}\n</code></pre>"},{"location":"development/contributing/#user-documentation","title":"User Documentation","text":"<p>Update docs in <code>docs/</code> directory when: - Adding new features - Changing API - Adding new CRDs - Changing behavior</p>"},{"location":"development/contributing/#release-process","title":"Release Process","text":"<p>Releases are automated via GitHub Actions:</p> <ol> <li>Create tag: <code>git tag v1.2.3</code></li> <li>Push tag: <code>git push origin v1.2.3</code></li> <li>GitHub Actions builds and releases</li> </ol>"},{"location":"development/contributing/#getting-help","title":"Getting Help","text":"<ul> <li>Questions: Open a GitHub Discussion</li> <li>Bugs: Open a GitHub Issue</li> <li>Security: Email security@example.com</li> </ul>"},{"location":"development/contributing/#code-of-conduct","title":"Code of Conduct","text":"<p>Be respectful and inclusive. See CODE_OF_CONDUCT.md.</p>"},{"location":"development/e2e-testing/","title":"E2E Testing","text":"<p>End-to-end tests validate the full operator lifecycle against real databases and a real Kubernetes cluster.</p>"},{"location":"development/e2e-testing/#overview","title":"Overview","text":"Aspect Detail Framework Ginkgo v2 + Gomega Build tag <code>e2e</code> Engines PostgreSQL, MySQL, MariaDB, CockroachDB Cluster k3d (lightweight k3s in Docker) Databases Docker Compose on the host Operator deployment Helm chart in k3d (CI) / Kustomize (local)"},{"location":"development/e2e-testing/#architecture","title":"Architecture","text":"<p>Databases run in Docker Compose on the host machine. The operator runs inside a k3d cluster and reaches databases via <code>host.k3d.internal</code> \u2014 a DNS name that k3d automatically resolves to the Docker host IP.</p> <pre><code>graph LR\n    subgraph Host[\"Local Machine\"]\n        subgraph DC[\"Docker Compose\"]\n            PG[\"PostgreSQL\\n:15432\"]\n            MY[\"MySQL\\n:13306\"]\n            MR[\"MariaDB\\n:13307\"]\n            CR[\"CockroachDB\\n:26257\"]\n        end\n        subgraph K3D[\"k3d Cluster\"]\n            OP[\"Operator Pod\\n(db-provision-operator)\"]\n            DICR[\"DatabaseInstance CRs\\n\u2192 host.k3d.internal\"]\n        end\n        E2E[\"E2E Tests (go test)\\nconnects to 127.0.0.1\"]\n    end\n    OP --&gt;|host.k3d.internal| PG\n    OP --&gt;|host.k3d.internal| MY\n    OP --&gt;|host.k3d.internal| MR\n    OP --&gt;|host.k3d.internal| CR\n    E2E --&gt;|127.0.0.1| PG\n    E2E --&gt;|127.0.0.1| MY\n    E2E --&gt;|127.0.0.1| MR\n    E2E --&gt;|127.0.0.1| CR</code></pre>"},{"location":"development/e2e-testing/#dual-connection-model","title":"Dual-Connection Model","text":"<p>Each test connects to the database via two paths:</p> <pre><code>graph LR\n    TR[\"Test Runner\\n(go test)\"] --&gt;|\"E2E_DATABASE_HOST\\n(127.0.0.1)\"| DB[\"Database\\n(Docker Compose)\"]\n    OP[\"Operator\\n(k3d pod)\"] --&gt;|\"E2E_INSTANCE_HOST\\n(host.k3d.internal)\"| DB</code></pre> <ol> <li>Test verifier (<code>E2E_DATABASE_HOST</code>): The test process connects from the host to the database on <code>127.0.0.1</code> to verify that the operator's SQL operations (CREATE DATABASE, CREATE USER, etc.) took effect.</li> <li>Operator / CR (<code>E2E_INSTANCE_HOST</code>): The DatabaseInstance CR uses <code>host.k3d.internal</code> so the operator pod inside k3d can reach the database on the Docker host.</li> </ol>"},{"location":"development/e2e-testing/#key-assumptions","title":"Key Assumptions","text":"<ul> <li>No database pods in k3d. All databases run in Docker Compose outside the cluster.</li> <li>Tests that need to interact with database pods (e.g., restart, kill) use <code>Skip()</code>. Since pods don't exist in this mode, pod-dependent tests are skipped.</li> <li><code>host.k3d.internal</code> is provided automatically by k3d. No manual configuration needed.</li> <li>Health checks in <code>docker-compose.e2e.yml</code> ensure databases are ready before tests start.</li> <li>Init scripts in <code>test/e2e/fixtures/*-init/</code> create the admin credentials and initial setup.</li> </ul>"},{"location":"development/e2e-testing/#test-suite-architecture","title":"Test Suite Architecture","text":""},{"location":"development/e2e-testing/#suite-bootstrap-e2e_suite_testgo","title":"Suite Bootstrap (<code>e2e_suite_test.go</code>)","text":"<p>The suite creates two clients:</p> <ul> <li><code>k8sClient</code> (<code>kubernetes.Interface</code>) \u2014 for core resources (Secrets, Namespaces)</li> <li><code>dynamicClient</code> (<code>dynamic.Interface</code>) \u2014 for CRD resources (DatabaseInstance, Database, etc.)</li> </ul> <p><code>BeforeSuite</code> verifies cluster connectivity and that the operator pod is running.</p>"},{"location":"development/e2e-testing/#gvr-registry-11-crds","title":"GVR Registry (11 CRDs)","text":"GVR Variable Resource <code>databaseInstanceGVR</code> <code>databaseinstances</code> <code>databaseGVR</code> <code>databases</code> <code>databaseUserGVR</code> <code>databaseusers</code> <code>databaseRoleGVR</code> <code>databaseroles</code> <code>databaseGrantGVR</code> <code>databasegrants</code> <code>databaseBackupGVR</code> <code>databasebackups</code> <code>databaseRestoreGVR</code> <code>databaserestores</code> <code>databaseBackupScheduleGVR</code> <code>databasebackupschedules</code> <code>clusterDatabaseInstanceGVR</code> <code>clusterdatabaseinstances</code> <code>clusterDatabaseRoleGVR</code> <code>clusterdatabaseroles</code> <code>clusterDatabaseGrantGVR</code> <code>clusterdatabasegrants</code>"},{"location":"development/e2e-testing/#engine-specific-test-files","title":"Engine-Specific Test Files","text":"File Engine Label <code>postgresql_test.go</code> PostgreSQL <code>postgresql</code> <code>mysql_test.go</code> MySQL <code>mysql</code> <code>mariadb_test.go</code> MariaDB <code>mariadb</code> <code>cockroachdb_test.go</code> CockroachDB <code>cockroachdb</code> <code>clusterdatabaseinstance_test.go</code> PostgreSQL <code>clusterdatabaseinstance</code> <code>clusterdatabaserole_test.go</code> PostgreSQL <code>clusterdatabaserole</code> <code>clusterdatabasegrant_test.go</code> PostgreSQL <code>clusterdatabasegrant</code>"},{"location":"development/e2e-testing/#test-phases-ordered","title":"Test Phases (Ordered)","text":"<p>Each engine test file uses <code>Ordered</code> containers to run phases sequentially:</p> <ol> <li>Setup (<code>BeforeAll</code>): Create verifier, read admin credentials from Secret</li> <li>DatabaseInstance: Create instance CR, verify <code>Ready</code> phase</li> <li>Database: Create database CR, verify it exists in the real DB</li> <li>DatabaseUser: Create user CR, verify login works</li> <li>DatabaseRole / DatabaseGrant: Create role/grant CRs, verify permissions</li> <li>Cleanup (<code>AfterAll</code>): Delete all CRs, verify finalizers complete</li> </ol>"},{"location":"development/e2e-testing/#databaseverifier-interface","title":"DatabaseVerifier Interface","text":"<p>Each engine has a verifier in <code>test/e2e/testutil/</code> that validates actual database state:</p> Verifier Engine Key Methods <code>PostgresVerifier</code> PostgreSQL <code>DatabaseExists()</code>, <code>UserExists()</code>, <code>UserCanLogin()</code> <code>MySQLVerifier</code> MySQL / MariaDB <code>DatabaseExists()</code>, <code>UserExists()</code>, <code>UserCanLogin()</code> <code>CockroachDBVerifier</code> CockroachDB <code>DatabaseExists()</code>, <code>UserExists()</code>, <code>UserCanLogin()</code>"},{"location":"development/e2e-testing/#timeout-constants","title":"Timeout Constants","text":"Constant Value Usage <code>reconcileTimeout</code> 30s CR phase transitions, resource creation/deletion <code>pollingInterval</code> 2s <code>Eventually</code> / <code>Consistently</code> polling frequency <code>podRestartTimeout</code> 3m Infrastructure recovery (skipped in Docker Compose mode) <code>driftTimeout</code> 60s Drift detection and correction cycles <code>timeout</code> (MySQL/MariaDB) 2m General operations"},{"location":"development/e2e-testing/#skip-patterns","title":"Skip Patterns","text":"<p>Tests that require in-cluster database pods use <code>Skip()</code>:</p> <pre><code>Skip(\"Pod restart tests require in-cluster database pods\")\n</code></pre>"},{"location":"development/e2e-testing/#environment-variables","title":"Environment Variables","text":"Variable Default Description <code>E2E_DATABASE_ENGINE</code> (none) Which engine suite to run (set by Makefile) <code>E2E_DATABASE_HOST</code> <code>host.k3d.internal</code> Host for test verifier connections <code>E2E_DATABASE_PORT</code> Engine default Port for test verifier connections <code>E2E_INSTANCE_HOST</code> <code>host.k3d.internal</code> Host for the DatabaseInstance CR (what operator uses) <code>E2E_INSTANCE_PORT</code> Engine default Port for the DatabaseInstance CR <code>E2E_POSTGRES_PORT</code> <code>15432</code> PostgreSQL Docker Compose host port <code>E2E_MYSQL_PORT</code> <code>13306</code> MySQL Docker Compose host port <code>E2E_MARIADB_PORT</code> <code>13307</code> MariaDB Docker Compose host port <code>E2E_COCKROACHDB_PORT</code> <code>26257</code> CockroachDB Docker Compose host port <code>E2E_K3D_CLUSTER</code> <code>dbprov-e2e</code> k3d cluster name <code>E2E_IMG</code> <code>db-provision-operator:e2e</code> Operator Docker image name"},{"location":"development/e2e-testing/#quick-start","title":"Quick Start","text":""},{"location":"development/e2e-testing/#one-command","title":"One Command","text":"<pre><code># PostgreSQL\nmake e2e-local-postgresql\n\n# MySQL\nmake e2e-local-mysql\n\n# MariaDB\nmake e2e-local-mariadb\n\n# CockroachDB\nmake e2e-local-cockroachdb\n\n# All engines sequentially\nmake e2e-local-all\n</code></pre>"},{"location":"development/e2e-testing/#step-by-step-setup","title":"Step-by-Step Setup","text":"<p>Each step is a separate Makefile target \u2014 the same targets CI uses:</p> <pre><code># 1. Start database(s) via Docker Compose (with health checks)\nmake e2e-db-up E2E_DATABASE=postgresql\n\n# 2. Create k3d cluster (idempotent \u2014 skips if exists)\nmake e2e-cluster-create\n\n# 3. Build operator Docker image\nmake e2e-docker-build\n\n# 4. Load image into k3d\nmake e2e-image-load\n\n# 5. Install CRDs into the cluster\nmake e2e-install-crds\n\n# 6. Deploy operator (via Kustomize)\nmake e2e-deploy-operator\n\n# 7. Create DatabaseInstance CR (points to host.k3d.internal)\nmake e2e-create-db-instance E2E_DATABASE=postgresql\n\n# 8. Run E2E tests\nmake e2e-local-run-tests E2E_DATABASE=postgresql\n</code></pre>"},{"location":"development/e2e-testing/#makefile-targets-reference","title":"Makefile Targets Reference","text":""},{"location":"development/e2e-testing/#micro-step-targets","title":"Micro-Step Targets","text":"<p>These targets are called individually by CI and can be used for debugging:</p> Target Description <code>e2e-db-up</code> Start database(s) via Docker Compose (with health checks, 180s timeout) <code>e2e-db-down</code> Stop database(s) and remove volumes <code>e2e-cluster-create</code> Create k3d cluster (idempotent) <code>e2e-cluster-delete</code> Delete k3d cluster <code>e2e-docker-build</code> Build operator Docker image <code>e2e-image-load</code> Load image into k3d <code>e2e-install-crds</code> Install CRDs into cluster <code>e2e-deploy-operator</code> Deploy operator and wait for readiness <code>e2e-create-db-instance</code> Create DatabaseInstance CR pointing to Docker host <code>e2e-local-run-tests</code> Run E2E tests for a specific engine"},{"location":"development/e2e-testing/#unified-targets","title":"Unified Targets","text":"<p>These combine micro-steps into single commands:</p> Target Description <code>e2e-local-setup</code> Full setup (DB + k3d + operator). Use <code>E2E_DATABASE</code> for single engine <code>e2e-local-postgresql</code> Setup + PostgreSQL tests <code>e2e-local-mysql</code> Setup + MySQL tests <code>e2e-local-mariadb</code> Setup + MariaDB tests <code>e2e-local-cockroachdb</code> Setup + CockroachDB tests <code>e2e-local-all</code> Setup + all engine tests (sequential) <code>e2e-local-cleanup</code> Delete k3d cluster + stop databases"},{"location":"development/e2e-testing/#utility-targets","title":"Utility Targets","text":"Target Description <code>e2e-logs</code> Tail operator logs from the cluster <code>e2e-debug</code> Dump cluster state + Docker Compose logs to file"},{"location":"development/e2e-testing/#fixtures-reference","title":"Fixtures Reference","text":""},{"location":"development/e2e-testing/#init-scripts","title":"Init Scripts","text":"<p>Each engine has an init directory mounted into the Docker Compose container:</p> Directory Purpose <code>test/e2e/fixtures/postgres-init/</code> Creates admin user, sets up <code>pg_hba.conf</code> <code>test/e2e/fixtures/mysql-init/</code> Creates admin user with required privileges <code>test/e2e/fixtures/mariadb-init/</code> Creates admin user with required privileges <code>test/e2e/fixtures/cockroachdb-init/</code> Creates admin user (runs via init container)"},{"location":"development/e2e-testing/#databaseinstance-fixtures","title":"DatabaseInstance Fixtures","text":"<p>These YAML files define the <code>DatabaseInstance</code> CR pointing to <code>host.k3d.internal</code>:</p> File Engine <code>test/e2e/fixtures/postgresql-local.yaml</code> PostgreSQL <code>test/e2e/fixtures/mysql-local.yaml</code> MySQL <code>test/e2e/fixtures/mariadb-local.yaml</code> MariaDB <code>test/e2e/fixtures/cockroachdb-local.yaml</code> CockroachDB"},{"location":"development/e2e-testing/#test-data-teste2efixturestestdata","title":"Test Data (<code>test/e2e/fixtures/testdata/</code>)","text":"<p>Contains additional fixture files used by specific test cases.</p>"},{"location":"development/e2e-testing/#test-utilities-reference","title":"Test Utilities Reference","text":""},{"location":"development/e2e-testing/#verifiers-teste2etestutil","title":"Verifiers (<code>test/e2e/testutil/</code>)","text":"<p>Connect directly to the database to verify operator actions:</p> <pre><code>verifier := testutil.NewPostgresVerifier(host, port, adminUser, adminPassword)\nexists, err := verifier.DatabaseExists(\"testdb\")\ncanLogin, err := verifier.UserCanLogin(\"testuser\", \"password123\")\n</code></pre>"},{"location":"development/e2e-testing/#wait-functions-e2e_suite_testgo","title":"Wait Functions (<code>e2e_suite_test.go</code>)","text":"Function Description <code>waitForPhase()</code> Wait for a CR to reach a specific status phase <code>getResourcePhase()</code> Get current phase of a CR <code>getSecretValue()</code> Read a value from a Kubernetes Secret"},{"location":"development/e2e-testing/#common-helpers-common_testgo","title":"Common Helpers (<code>common_test.go</code>)","text":"Function Description <code>PostgreSQLTestConfig()</code> Default test configuration for PostgreSQL <code>MySQLTestConfig()</code> Default test configuration for MySQL <code>MariaDBTestConfig()</code> Default test configuration for MariaDB"},{"location":"development/e2e-testing/#debugging","title":"Debugging","text":""},{"location":"development/e2e-testing/#operator-logs","title":"Operator Logs","text":"<pre><code># Stream operator logs\nmake e2e-logs\n\n# Or directly\nkubectl logs -n db-provision-operator-system -l control-plane=controller-manager -f\n</code></pre>"},{"location":"development/e2e-testing/#database-health","title":"Database Health","text":"<pre><code># Docker Compose service status\ndocker compose -f docker-compose.e2e.yml ps\n\n# Individual database logs\ndocker compose -f docker-compose.e2e.yml logs postgres\ndocker compose -f docker-compose.e2e.yml logs mysql\ndocker compose -f docker-compose.e2e.yml logs mariadb\ndocker compose -f docker-compose.e2e.yml logs cockroachdb\n</code></pre>"},{"location":"development/e2e-testing/#direct-database-connection","title":"Direct Database Connection","text":"<pre><code># PostgreSQL\npsql -h localhost -p ${E2E_POSTGRES_PORT:-15432} -U dbprovision_admin -d postgres\n\n# MySQL\nmysql -h 127.0.0.1 -P ${E2E_MYSQL_PORT:-13306} -u root -prootpassword123\n\n# MariaDB\nmysql -h 127.0.0.1 -P ${E2E_MARIADB_PORT:-13307} -u root -prootpassword123\n\n# CockroachDB\ncockroach sql --insecure --host=localhost --port=${E2E_COCKROACHDB_PORT:-26257}\n</code></pre>"},{"location":"development/e2e-testing/#cr-inspection","title":"CR Inspection","text":"<pre><code># List all database-related CRs\nkubectl get databaseinstances,databases,databaseusers,databaseroles,databasegrants -A\n\n# Describe a specific DatabaseInstance\nkubectl describe databaseinstance postgres-e2e-instance -n default\n\n# Check recent events\nkubectl get events --sort-by='.lastTimestamp' | tail -20\n</code></pre>"},{"location":"development/e2e-testing/#k3d-to-docker-connectivity","title":"k3d-to-Docker Connectivity","text":"<pre><code># Verify host.k3d.internal resolves inside the cluster\nkubectl run test --rm -it --image=busybox -- nslookup host.k3d.internal\n\n# Test TCP connectivity to PostgreSQL\nkubectl run test --rm -it --image=busybox -- nc -zv host.k3d.internal 15432\n</code></pre>"},{"location":"development/e2e-testing/#full-debug-dump","title":"Full Debug Dump","text":"<pre><code># Saves cluster state + Docker Compose logs to e2e-debug-postgresql.log\nmake e2e-debug E2E_DATABASE=postgresql\n</code></pre>"},{"location":"development/e2e-testing/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/e2e-testing/#hostk3dinternal-not-resolving","title":"<code>host.k3d.internal</code> Not Resolving","text":"<p>This hostname is automatically configured by k3d. If it's not resolving:</p> <pre><code># Verify the cluster was created correctly\nk3d cluster list\n\n# Check k3d version (should be v5+)\nk3d version\n\n# Recreate the cluster\nmake e2e-cluster-delete\nmake e2e-cluster-create\n</code></pre>"},{"location":"development/e2e-testing/#database-connection-refused","title":"Database Connection Refused","text":"<pre><code># Check if containers are running and healthy\ndocker compose -f docker-compose.e2e.yml ps\n\n# Check container logs for errors\ndocker compose -f docker-compose.e2e.yml logs postgres\n\n# Verify the port is correct\ndocker compose -f docker-compose.e2e.yml port postgres 5432\n</code></pre>"},{"location":"development/e2e-testing/#operator-not-starting","title":"Operator Not Starting","text":"<pre><code># Check deployment status\nkubectl describe deployment -n db-provision-operator-system db-provision-operator-controller-manager\n\n# Check pod logs\nkubectl logs -n db-provision-operator-system -l control-plane=controller-manager --tail=100\n\n# Check if image was loaded into k3d\ndocker exec k3d-dbprov-e2e-server-0 crictl images | grep db-provision-operator\n</code></pre>"},{"location":"development/e2e-testing/#tests-timing-out","title":"Tests Timing Out","text":"<pre><code># Increase test timeout\ngo test ./test/e2e/... -v -tags=e2e -timeout=20m\n\n# Run a specific test\ngo test ./test/e2e/... -v -tags=e2e -ginkgo.focus=\"should create database\" -timeout=10m\n</code></pre>"},{"location":"development/e2e-testing/#port-conflicts","title":"Port Conflicts","text":"<p>The default ports use high numbers to avoid conflicts with local database instances:</p> <pre><code># Check what's using a port\nlsof -i :15432\n\n# Use different ports\nE2E_POSTGRES_PORT=25432 E2E_MYSQL_PORT=23306 make e2e-local-postgresql\n</code></pre>"},{"location":"development/e2e-testing/#cleanup","title":"Cleanup","text":"<pre><code># Full cleanup (cluster + databases)\nmake e2e-local-cleanup\n\n# Or individually\nmake e2e-cluster-delete  # Delete k3d cluster only\nmake e2e-db-down         # Stop databases only\n</code></pre>"},{"location":"development/e2e-testing/#ci-consistency","title":"CI Consistency","text":"<p>Local and CI use the exact same Makefile micro-step targets. The only difference is that CI deploys the operator via Helm (to validate the Helm chart), while local development uses Kustomize (<code>make e2e-deploy-operator</code>).</p> <pre><code># CI workflow calls the same targets:\n- run: make e2e-db-up E2E_DATABASE=${{ matrix.database }}\n- run: make e2e-cluster-create\n# CI uses a pre-built image instead of e2e-docker-build\n- run: make e2e-image-load E2E_IMG=&lt;registry-image&gt;\n- run: make e2e-install-crds\n# CI deploys via Helm (not Kustomize)\n- run: helm install db-provision-operator ./charts/db-provision-operator ...\n- run: make e2e-create-db-instance E2E_DATABASE=${{ matrix.database }}\n- run: make e2e-local-run-tests E2E_DATABASE=${{ matrix.database }}\n</code></pre>"},{"location":"development/e2e-testing/#file-structure","title":"File Structure","text":"<pre><code>db-provision-operator/\n\u251c\u2500\u2500 docker-compose.e2e.yml           # Database services (PG, MySQL, MariaDB, CockroachDB)\n\u251c\u2500\u2500 test/e2e/\n\u2502   \u251c\u2500\u2500 e2e_suite_test.go            # Suite bootstrap, GVRs, helper functions\n\u2502   \u251c\u2500\u2500 common_test.go               # Shared test configs, verifier helpers\n\u2502   \u251c\u2500\u2500 postgresql_test.go           # PostgreSQL engine tests\n\u2502   \u251c\u2500\u2500 mysql_test.go                # MySQL engine tests\n\u2502   \u251c\u2500\u2500 mariadb_test.go              # MariaDB engine tests\n\u2502   \u251c\u2500\u2500 cockroachdb_test.go          # CockroachDB engine tests\n\u2502   \u251c\u2500\u2500 clusterdatabaseinstance_test.go  # ClusterDatabaseInstance tests\n\u2502   \u251c\u2500\u2500 clusterdatabaserole_test.go      # ClusterDatabaseRole tests\n\u2502   \u251c\u2500\u2500 clusterdatabasegrant_test.go     # ClusterDatabaseGrant tests\n\u2502   \u251c\u2500\u2500 testutil/                    # Database verifiers (Postgres, MySQL, CockroachDB)\n\u2502   \u2514\u2500\u2500 fixtures/\n\u2502       \u251c\u2500\u2500 postgres-init/           # PostgreSQL init scripts\n\u2502       \u251c\u2500\u2500 mysql-init/              # MySQL init scripts\n\u2502       \u251c\u2500\u2500 mariadb-init/            # MariaDB init scripts\n\u2502       \u251c\u2500\u2500 cockroachdb-init/        # CockroachDB init scripts\n\u2502       \u251c\u2500\u2500 postgresql-local.yaml    # DatabaseInstance CR for PostgreSQL\n\u2502       \u251c\u2500\u2500 mysql-local.yaml         # DatabaseInstance CR for MySQL\n\u2502       \u251c\u2500\u2500 mariadb-local.yaml       # DatabaseInstance CR for MariaDB\n\u2502       \u251c\u2500\u2500 cockroachdb-local.yaml   # DatabaseInstance CR for CockroachDB\n\u2502       \u2514\u2500\u2500 testdata/                # Additional test fixture data\n\u2514\u2500\u2500 Makefile                         # E2E targets (micro-steps + unified)\n</code></pre>"},{"location":"development/rbac/","title":"Cross-Namespace RBAC","text":"<p>This document explains how the db-provision-operator supports cross-namespace Secret references and the RBAC configuration that enables this feature.</p>"},{"location":"development/rbac/#overview","title":"Overview","text":"<p>The db-provision-operator uses ClusterRole and ClusterRoleBinding (not namespace-scoped Role/RoleBinding) to enable cross-namespace access to Secrets. This allows:</p> <ul> <li>A <code>DatabaseInstance</code> in namespace A to reference a Secret in namespace B</li> <li>Centralized credential management in a dedicated namespace</li> <li>Separation of concerns between application teams and database administrators</li> </ul>"},{"location":"development/rbac/#architecture","title":"Architecture","text":"<pre><code>graph LR\n    subgraph AppNS[\"Namespace: app\"]\n        DI[\"DatabaseInstance\\nname: prod-db\\nsecretRef \u2192 db-secrets\"]\n    end\n    subgraph SecNS[\"Namespace: db-secrets\"]\n        S1[\"Secret: pg-credentials\\nusername: admin\"]\n        S2[\"Secret: mysql-creds\\nusername: root\"]\n    end\n    subgraph SysNS[\"db-provision-operator-system\"]\n        POD[\"controller-manager Pod\"] --&gt; SA[\"ServiceAccount\\n+ ClusterRoleBinding\\n+ ClusterRole\"]\n    end\n    DI --&gt;|refs| S1\n    POD --&gt;|watches all namespaces| DI\n    POD --&gt;|reads secrets globally| S1\n    POD --&gt;|reads secrets globally| S2</code></pre>"},{"location":"development/rbac/#rbac-configuration","title":"RBAC Configuration","text":""},{"location":"development/rbac/#clusterrole","title":"ClusterRole","text":"<p>The operator's ClusterRole (<code>config/rbac/role.yaml</code>) includes permissions to access Secrets across all namespaces:</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRole\nmetadata:\n  name: manager-role\nrules:\n  - apiGroups:\n      - \"\"\n    resources:\n      - secrets\n    verbs:\n      - get\n      - list\n      - watch\n      - create\n      - update\n      - patch\n      - delete\n</code></pre>"},{"location":"development/rbac/#clusterrolebinding","title":"ClusterRoleBinding","text":"<p>The ClusterRoleBinding (<code>config/rbac/role_binding.yaml</code>) binds the ClusterRole to the operator's ServiceAccount:</p> <pre><code>apiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: manager-rolebinding\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: manager-role\nsubjects:\n  - kind: ServiceAccount\n    name: controller-manager\n    namespace: db-provision-operator-system\n</code></pre> <p>Key Point: Using <code>ClusterRoleBinding</code> (not <code>RoleBinding</code>) grants the operator cluster-wide permissions, enabling cross-namespace Secret access.</p>"},{"location":"development/rbac/#usage-examples","title":"Usage Examples","text":""},{"location":"development/rbac/#example-1-databaseinstance-with-cross-namespace-secret","title":"Example 1: DatabaseInstance with Cross-Namespace Secret","text":"<pre><code># Secret in dedicated credentials namespace\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: db-credentials\n---\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin\n  namespace: db-credentials\ntype: Opaque\nstringData:\n  username: postgres\n  password: supersecretpassword\n\n---\n# DatabaseInstance in application namespace referencing cross-namespace Secret\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: production-postgres\n  namespace: my-app  # Different from Secret namespace\nspec:\n  engine: postgresql\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: postgres-admin\n      namespace: db-credentials  # Cross-namespace reference\n  healthCheck:\n    enabled: true\n    interval: 30s\n</code></pre>"},{"location":"development/rbac/#example-2-centralized-credential-management","title":"Example 2: Centralized Credential Management","text":"<pre><code># Central secrets namespace with all database credentials\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: database-secrets\n  labels:\n    purpose: credential-storage\n---\n# PostgreSQL credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: prod-postgresql\n  namespace: database-secrets\ntype: Opaque\nstringData:\n  username: admin\n  password: pg-secret-123\n---\n# MySQL credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: prod-mysql\n  namespace: database-secrets\ntype: Opaque\nstringData:\n  username: root\n  password: mysql-secret-456\n\n---\n# Team A's PostgreSQL instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: team-a-postgres\n  namespace: team-a\nspec:\n  engine: postgresql\n  connection:\n    host: postgres.prod.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: prod-postgresql\n      namespace: database-secrets  # Points to central namespace\n\n---\n# Team B's MySQL instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: team-b-mysql\n  namespace: team-b\nspec:\n  engine: mysql\n  connection:\n    host: mysql.prod.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: prod-mysql\n      namespace: database-secrets  # Points to central namespace\n</code></pre>"},{"location":"development/rbac/#security-considerations","title":"Security Considerations","text":""},{"location":"development/rbac/#principle-of-least-privilege","title":"Principle of Least Privilege","text":"<p>While the operator has cluster-wide Secret access, you should:</p> <ol> <li>Limit Secret creation - Use Kubernetes RBAC to control who can create Secrets in credential namespaces</li> <li>Audit Secret access - Enable Kubernetes audit logging to track Secret access</li> <li>Use dedicated namespaces - Create dedicated namespaces for database credentials with restricted access</li> </ol>"},{"location":"development/rbac/#restricting-secret-access-optional","title":"Restricting Secret Access (Optional)","text":"<p>If you want to restrict which namespaces the operator can access Secrets from, you can use multiple RoleBindings instead of ClusterRoleBinding:</p> <pre><code># Create Role in each namespace where secrets should be accessible\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: secret-reader\n  namespace: db-credentials\nrules:\n  - apiGroups: [\"\"]\n    resources: [\"secrets\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: operator-secret-access\n  namespace: db-credentials\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: secret-reader\nsubjects:\n  - kind: ServiceAccount\n    name: controller-manager\n    namespace: db-provision-operator-system\n</code></pre> <p>Trade-off: This approach requires creating RoleBindings in each namespace where Secrets should be accessible, but provides finer-grained access control.</p>"},{"location":"development/rbac/#verifying-rbac-configuration","title":"Verifying RBAC Configuration","text":""},{"location":"development/rbac/#check-clusterrolebinding","title":"Check ClusterRoleBinding","text":"<pre><code>kubectl get clusterrolebinding manager-rolebinding -o yaml\n</code></pre> <p>Expected output should show: - <code>kind: ClusterRoleBinding</code> (not RoleBinding) - <code>roleRef.kind: ClusterRole</code> - ServiceAccount reference to the operator</p>"},{"location":"development/rbac/#test-cross-namespace-access","title":"Test Cross-Namespace Access","text":"<pre><code># Create a test secret in a separate namespace\nkubectl create namespace test-secrets\nkubectl create secret generic test-creds \\\n  --from-literal=username=testuser \\\n  --from-literal=password=testpass \\\n  -n test-secrets\n\n# Create a DatabaseInstance referencing the cross-namespace secret\ncat &lt;&lt;EOF | kubectl apply -f -\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: test-cross-ns\n  namespace: default\nspec:\n  engine: postgresql\n  connection:\n    host: postgres.postgres.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: test-creds\n      namespace: test-secrets  # Different namespace\nEOF\n\n# Check if the DatabaseInstance becomes Ready\nkubectl get databaseinstance test-cross-ns -o jsonpath='{.status.phase}'\n# Expected: \"Ready\" (if database is accessible)\n\n# Cleanup\nkubectl delete databaseinstance test-cross-ns\nkubectl delete namespace test-secrets\n</code></pre>"},{"location":"development/rbac/#troubleshooting","title":"Troubleshooting","text":""},{"location":"development/rbac/#error-secrets-is-forbidden","title":"Error: \"secrets is forbidden\"","text":"<p>Symptom: Operator logs show <code>secrets \"xxx\" is forbidden: User \"system:serviceaccount:...\" cannot get resource \"secrets\" in API group \"\" in the namespace \"yyy\"</code></p> <p>Solution: 1. Verify ClusterRoleBinding exists:    <pre><code>kubectl get clusterrolebinding manager-rolebinding\n</code></pre> 2. Check the binding references the correct ServiceAccount:    <pre><code>kubectl get clusterrolebinding manager-rolebinding -o yaml\n</code></pre> 3. Reinstall RBAC:    <pre><code>make install\nmake deploy IMG=&lt;your-image&gt;\n</code></pre></p>"},{"location":"development/rbac/#databaseinstance-stuck-in-pending","title":"DatabaseInstance stuck in Pending","text":"<p>Symptom: DatabaseInstance never becomes Ready when using cross-namespace Secret</p> <p>Solution: 1. Check operator logs for errors 2. Verify the Secret exists in the referenced namespace 3. Verify the Secret has the required keys (<code>username</code>, <code>password</code>) 4. Test direct Secret access:    <pre><code>kubectl auth can-i get secrets --as=system:serviceaccount:db-provision-operator-system:controller-manager -n &lt;secret-namespace&gt;\n</code></pre></p>"},{"location":"development/roadmap/","title":"Development Roadmap","text":"<p>This document provides the development roadmap and context for the db-provision-operator.</p>"},{"location":"development/roadmap/#current-state-summary","title":"Current State Summary","text":""},{"location":"development/roadmap/#completed-phases","title":"Completed Phases","text":"Phase Component Status Notes Phase 1 DatabaseInstance CRD Complete Connection management, health checks Database CRD Complete CRUD operations, extensions, schemas DatabaseUser CRD Complete User management, password generation PostgreSQL Adapter Complete Full CRUD, grants, backup/restore MySQL Adapter Complete Full CRUD, grants, backup/restore Secret Manager Complete Credentials, TLS, templates Controllers Complete Reconciliation, finalizers, status Phase 2 DatabaseRole CRD Complete Role management for PostgreSQL/MySQL DatabaseGrant CRD Complete Fine-grained grant management DatabaseBackup CRD Complete Backup lifecycle management DatabaseRestore CRD Complete Restore from backup or path DatabaseBackupSchedule CRD Complete Cron scheduling, retention policies Retry Utility Complete Exponential backoff with jitter Phase 2.5 S3 Storage Backend Complete AWS S3 compatible with custom endpoints GCS Storage Backend Complete Google Cloud Storage Azure Blob Backend Complete Azure Blob Storage PVC Storage Backend Complete Kubernetes PVC storage Compression Complete gzip, lz4, zstd algorithms Encryption Complete AES-256-GCM encryption Prometheus Metrics Complete 25 metrics, 100% coverage ServiceMonitor Complete Auto-discovery for Prometheus PrometheusRules Complete 10+ alerting rules"},{"location":"development/roadmap/#phase-3-planned-work","title":"Phase 3 Planned Work","text":""},{"location":"development/roadmap/#31-multi-cluster-support","title":"3.1 Multi-Cluster Support","text":"<p>Concept: Manage databases across multiple clusters</p> <p>Approach Options: 1. Remote cluster kubeconfig references 2. Submariner/Skupper for cross-cluster networking 3. Hub-spoke model with agent per cluster</p>"},{"location":"development/roadmap/#32-database-migration-crd","title":"3.2 Database Migration CRD","text":"<p>Purpose: Manage database schema migrations</p> <p>Proposed Integration: - Flyway integration - Liquibase integration - Or simple SQL migration files</p>"},{"location":"development/roadmap/#33-audit-logging","title":"3.3 Audit Logging","text":"<p>Requirements: - Log all database operations - Include user, operation, timestamp - Support external audit sinks (Elasticsearch, Loki)</p>"},{"location":"development/roadmap/#34-policy-enforcement","title":"3.4 Policy Enforcement","text":"<p>Concept: OPA/Gatekeeper integration for policies</p> <p>Example Policies: - Password complexity requirements - Naming conventions - Required labels/annotations - Deletion protection rules</p>"},{"location":"development/roadmap/#development-guidelines","title":"Development Guidelines","text":""},{"location":"development/roadmap/#adding-a-new-database-engine","title":"Adding a New Database Engine","text":"<ol> <li>Create new package: <code>internal/adapter/&lt;engine&gt;/</code></li> <li>Implement <code>DatabaseAdapter</code> interface from <code>internal/adapter/types/</code></li> <li>Add engine type to <code>EngineType</code> enum in <code>api/v1alpha1/common_types.go</code></li> <li>Add engine-specific config types in <code>api/v1alpha1/&lt;engine&gt;_types.go</code></li> <li>Update <code>NewAdapter()</code> factory in <code>internal/adapter/adapter.go</code></li> <li>Add engine-specific option handling in controllers</li> </ol>"},{"location":"development/roadmap/#adding-a-new-crd","title":"Adding a New CRD","text":"<ol> <li>Create type file: <code>api/v1alpha1/&lt;resource&gt;_types.go</code></li> <li>Run <code>make generate</code> to generate DeepCopy methods</li> <li>Run <code>make manifests</code> to generate CRD YAML</li> <li>Create controller: <code>internal/controller/&lt;resource&gt;_controller.go</code></li> <li>Register controller in <code>cmd/main.go</code></li> <li>Add RBAC markers to controller</li> <li>Run <code>make manifests</code> again to update RBAC</li> </ol>"},{"location":"development/roadmap/#code-style","title":"Code Style","text":"<ul> <li>Follow standard Go conventions</li> <li>Use <code>logf.FromContext(ctx)</code> for logging</li> <li>Set status conditions for all outcomes</li> <li>Always handle errors and update status</li> <li>Use finalizers for cleanup operations</li> <li>Add kubebuilder markers for RBAC and validation</li> </ul>"},{"location":"development/roadmap/#file-locations-reference","title":"File Locations Reference","text":"<pre><code>db-provision-operator/\n\u251c\u2500\u2500 api/v1alpha1/\n\u2502   \u251c\u2500\u2500 common_types.go          # Shared types (EngineType, Phase, etc.)\n\u2502   \u251c\u2500\u2500 databaseinstance_types.go # DatabaseInstance CRD\n\u2502   \u251c\u2500\u2500 database_types.go         # Database CRD\n\u2502   \u251c\u2500\u2500 databaseuser_types.go     # DatabaseUser CRD\n\u2502   \u251c\u2500\u2500 postgres_types.go         # PostgreSQL-specific types\n\u2502   \u251c\u2500\u2500 mysql_types.go            # MySQL-specific types\n\u2502   \u2514\u2500\u2500 groupversion_info.go      # API group registration\n\u2502\n\u251c\u2500\u2500 internal/\n\u2502   \u251c\u2500\u2500 adapter/\n\u2502   \u2502   \u251c\u2500\u2500 types/types.go        # Adapter interfaces and option types\n\u2502   \u2502   \u251c\u2500\u2500 adapter.go            # Factory and helpers\n\u2502   \u2502   \u251c\u2500\u2500 postgres/             # PostgreSQL implementation\n\u2502   \u2502   \u2514\u2500\u2500 mysql/                # MySQL implementation\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 controller/\n\u2502   \u2502   \u251c\u2500\u2500 databaseinstance_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 database_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databaseuser_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databaserole_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databasegrant_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databasebackup_controller.go\n\u2502   \u2502   \u251c\u2500\u2500 databaserestore_controller.go\n\u2502   \u2502   \u2514\u2500\u2500 databasebackupschedule_controller.go\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 metrics/\n\u2502   \u2502   \u251c\u2500\u2500 metrics.go            # Prometheus metrics definitions\n\u2502   \u2502   \u2514\u2500\u2500 metrics_test.go       # Metrics tests\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 storage/\n\u2502   \u2502   \u251c\u2500\u2500 storage.go            # Storage interface\n\u2502   \u2502   \u251c\u2500\u2500 s3.go                 # AWS S3 backend\n\u2502   \u2502   \u251c\u2500\u2500 gcs.go                # Google Cloud Storage backend\n\u2502   \u2502   \u251c\u2500\u2500 azure.go              # Azure Blob Storage backend\n\u2502   \u2502   \u251c\u2500\u2500 pvc.go                # PVC storage backend\n\u2502   \u2502   \u251c\u2500\u2500 compression.go        # gzip, lz4, zstd compression\n\u2502   \u2502   \u2514\u2500\u2500 encryption.go         # AES-256-GCM encryption\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 secret/\n\u2502   \u2502   \u2514\u2500\u2500 manager.go            # Secret management\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 util/\n\u2502       \u251c\u2500\u2500 conditions.go         # Status condition helpers\n\u2502       \u251c\u2500\u2500 finalizers.go         # Finalizer constants\n\u2502       \u251c\u2500\u2500 annotations.go        # Annotation helpers\n\u2502       \u2514\u2500\u2500 retry.go              # Exponential backoff retry\n\u2502\n\u251c\u2500\u2500 config/\n\u2502   \u251c\u2500\u2500 crd/bases/                # Generated CRD manifests\n\u2502   \u251c\u2500\u2500 rbac/                     # Generated RBAC manifests\n\u2502   \u251c\u2500\u2500 prometheus/               # Prometheus monitoring\n\u2502   \u2514\u2500\u2500 samples/                  # Example resources\n\u2502\n\u251c\u2500\u2500 cmd/\n\u2502   \u2514\u2500\u2500 main.go                   # Operator entrypoint\n\u2502\n\u2514\u2500\u2500 docs/                         # Project documentation\n</code></pre>"},{"location":"development/roadmap/#quick-commands","title":"Quick Commands","text":"<pre><code># Development cycle\nmake generate           # Generate DeepCopy, etc.\nmake manifests          # Generate CRDs, RBAC\nmake build              # Build binary\nmake run                # Run locally\n\n# Testing\nmake test               # Run tests (needs envtest)\ngo build ./...          # Verify compilation\ngo vet ./...            # Static analysis\n\n# Deployment\nmake install            # Install CRDs to cluster\nmake deploy IMG=&lt;img&gt;   # Deploy operator\nmake undeploy           # Remove operator\n\n# Cleanup\nmake uninstall          # Remove CRDs\n</code></pre>"},{"location":"development/roadmap/#handoff-checklist","title":"Handoff Checklist","text":"<p>Before starting next phase:</p> <ul> <li> Review architecture documentation</li> <li> Run <code>go build ./...</code> to verify clean build</li> <li> Run <code>make generate &amp;&amp; make manifests</code> to ensure generated files are current</li> <li> Review open issues/TODOs in code</li> <li> Set up test database instances (PostgreSQL, MySQL)</li> <li> Understand the adapter interface pattern</li> <li> Review secret manager for credential handling</li> </ul>"},{"location":"development/testing/","title":"Testing","text":"<p>Test strategy and commands for the DB Provision Operator.</p>"},{"location":"development/testing/#test-pyramid","title":"Test Pyramid","text":"Level Tools Location Command Unit Go <code>testing</code>, table-driven <code>internal/**/*_test.go</code> <code>make test</code> envtest controller-runtime envtest, Ginkgo <code>internal/controller/*_test.go</code>, <code>api/v1alpha1/*_test.go</code> <code>make test-envtest</code> Integration testcontainers-go, envtest <code>internal/controller/*_test.go</code>, <code>internal/adapter/*_test.go</code> <code>make test-integration</code> E2E Ginkgo v2, k3d, Docker Compose <code>test/e2e/</code> <code>make e2e-local-postgresql</code> CRD Validation envtest, Ginkgo <code>api/v1alpha1/*_test.go</code> <code>make test-envtest</code> Template Go <code>testing</code>, Helm, Kustomize <code>test/template/</code> <code>make test-templates</code> Benchmark Go <code>testing -bench</code> <code>internal/controller/</code> <code>make test-benchmark</code>"},{"location":"development/testing/#unit-tests","title":"Unit Tests","text":"<p>Fast, isolated tests for individual functions and business logic. No external dependencies.</p> <pre><code>make test\n</code></pre> <p>Runs <code>go test</code> on all packages except <code>e2e</code>, with coverage output to <code>cover.out</code>.</p>"},{"location":"development/testing/#envtest-controller-crd-validation","title":"envtest (Controller + CRD Validation)","text":"<p>Tests controllers and CRD validation webhooks against a real Kubernetes API server (provided by envtest) without a full cluster.</p> <pre><code>make test-envtest\n</code></pre> <p>This runs two suites:</p> <ol> <li>Controller tests (<code>internal/controller/</code>) \u2014 reconciliation logic with a fake K8s API</li> <li>CRD validation tests (<code>api/v1alpha1/</code>) \u2014 webhook admission validation</li> </ol> <p>Uses <code>KUBEBUILDER_ASSETS</code> binaries. First run downloads ~100MB of binaries (cached thereafter).</p>"},{"location":"development/testing/#integration-tests","title":"Integration Tests","text":"<p>Tests the full adapter layer (SQL execution) against real database containers managed by testcontainers-go.</p> <pre><code># All engines\nmake test-integration\n\n# Single engine\nmake test-integration INTEGRATION_TEST_DATABASE=postgresql\nmake test-integration INTEGRATION_TEST_DATABASE=mysql\nmake test-integration INTEGRATION_TEST_DATABASE=cockroachdb\n</code></pre> <p>Uses <code>-tags=integration</code>. testcontainers-go starts and stops Docker containers automatically.</p>"},{"location":"development/testing/#e2e-tests","title":"E2E Tests","text":"<p>Full end-to-end tests against a real k3d cluster with databases running in Docker Compose. Validates the complete operator lifecycle: DatabaseInstance \u2192 Database \u2192 DatabaseUser \u2192 DatabaseRole \u2192 DatabaseGrant.</p> <p>See E2E Testing for the comprehensive guide covering architecture, setup, debugging, and troubleshooting.</p> <pre><code># Quick start\nmake e2e-local-postgresql\nmake e2e-local-mysql\nmake e2e-local-mariadb\nmake e2e-local-cockroachdb\nmake e2e-local-all\n</code></pre>"},{"location":"development/testing/#template-comparison","title":"Template Comparison","text":"<p>Verifies that Helm chart and Kustomize overlays produce equivalent manifests.</p> <pre><code>make test-templates\n</code></pre>"},{"location":"development/testing/#running-tests","title":"Running Tests","text":""},{"location":"development/testing/#all-levels","title":"All Levels","text":"<pre><code># Unit + envtest + integration\nmake test &amp;&amp; make test-envtest &amp;&amp; make test-integration\n\n# E2E (all engines)\nmake e2e-local-all\n</code></pre>"},{"location":"development/testing/#coverage","title":"Coverage","text":"<pre><code># Unit test coverage\nmake test\ngo tool cover -html=cover.out -o coverage.html\n\n# envtest coverage\nmake test-envtest\ngo tool cover -html=cover-envtest.out -o coverage-envtest.html\n\n# Integration coverage\nmake test-integration\ngo tool cover -html=cover-integration.out -o coverage-integration.html\n</code></pre>"},{"location":"development/testing/#debugging-tests","title":"Debugging Tests","text":""},{"location":"development/testing/#verbose-output","title":"Verbose Output","text":"<pre><code># Unit / integration\ngo test -v ./internal/controller/...\n\n# E2E with Ginkgo verbose\ngo test ./test/e2e/... -v -tags=e2e -ginkgo.v -timeout=10m\n</code></pre>"},{"location":"development/testing/#focus-a-single-test","title":"Focus a Single Test","text":"<pre><code># By test name (Go)\ngo test -v ./internal/controller/... -run TestDatabaseController\n\n# By Ginkgo label (E2E)\ngo test ./test/e2e/... -v -tags=e2e -ginkgo.focus=\"should create database\"\n</code></pre>"},{"location":"development/testing/#ginkgo-focus-in-code","title":"Ginkgo Focus in Code","text":"<pre><code>FDescribe(\"Database Controller\", func() {\n    // Only this describe block runs\n})\n\nFIt(\"Should create database\", func() {\n    // Only this test runs\n})\n</code></pre> <p>Warning</p> <p>Remove <code>F</code> prefixes before committing \u2014 they skip all other tests.</p>"},{"location":"development/testing/#envtest-debugging","title":"envtest Debugging","text":"<pre><code># Show envtest K8s version\ngo list -m -f \"{{ .Version }}\" k8s.io/api\n\n# Manually install envtest binaries\nmake setup-envtest\n</code></pre>"},{"location":"development/testing/#e2e-debugging","title":"E2E Debugging","text":"<p>See E2E Testing \u2014 Debugging for operator logs, database health, direct DB connection, and CR inspection.</p>"},{"location":"engines/","title":"Engine Guides","text":"<p>DB Provision Operator supports multiple database engines with a unified API.</p>"},{"location":"engines/#supported-engines","title":"Supported Engines","text":"Engine Status Versions PostgreSQL \u2705 Stable 12, 13, 14, 15, 16 MySQL \u2705 Stable 5.7, 8.0, 8.4 MariaDB \u2705 Stable 10.5, 10.6, 10.11, 11.x CockroachDB \u2705 Stable 22.x, 23.x, 24.x"},{"location":"engines/#engine-comparison","title":"Engine Comparison","text":"Feature PostgreSQL MySQL MariaDB CockroachDB Roles \u2705 Native \u2705 8.0+ \u2705 10.0.5+ \u2705 Native Row-Level Security \u2705 \u274c \u274c \u274c Extensions \u2705 \u274c \u274c \u274c Schemas \u2705 \u274c \u274c \u274c Default Privileges \u2705 \u274c \u274c \u274c Backup pg_dump mysqldump mariadb-dump Native BACKUP Multi-Region \u274c \u274c \u274c \u2705 Built-in Distributed \u274c \u274c \u274c \u2705 Built-in"},{"location":"engines/#choosing-an-engine","title":"Choosing an Engine","text":""},{"location":"engines/#postgresql","title":"PostgreSQL","text":"<p>Best for:</p> <ul> <li>Complex queries and analytics</li> <li>JSON/JSONB document storage</li> <li>Full-text search</li> <li>Geographic data (PostGIS)</li> <li>Strict data integrity requirements</li> </ul>"},{"location":"engines/#mysql","title":"MySQL","text":"<p>Best for:</p> <ul> <li>Web applications</li> <li>High-volume OLTP</li> <li>Wide ecosystem support</li> <li>Replication simplicity</li> </ul>"},{"location":"engines/#mariadb","title":"MariaDB","text":"<p>Best for:</p> <ul> <li>MySQL compatibility with enhancements</li> <li>Open-source focus</li> <li>Additional storage engines</li> <li>Galera cluster support</li> </ul>"},{"location":"engines/#cockroachdb","title":"CockroachDB","text":"<p>Best for:</p> <ul> <li>Distributed SQL requirements</li> <li>Multi-region deployments</li> <li>Horizontal scalability</li> <li>PostgreSQL wire compatibility</li> <li>Strong consistency guarantees</li> </ul>"},{"location":"engines/#engine-specific-features","title":"Engine-Specific Features","text":""},{"location":"engines/#postgresql-only","title":"PostgreSQL Only","text":"<pre><code>spec:\n  postgres:\n    extensions:\n      - name: uuid-ossp\n      - name: pg_stat_statements\n    schemas:\n      - name: app\n        owner: myapp_admin\n    defaultPrivileges:\n      - objectType: tables\n        privileges: [SELECT]\n</code></pre>"},{"location":"engines/#mysqlmariadb","title":"MySQL/MariaDB","text":"<pre><code>spec:\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n    authPlugin: caching_sha2_password\n    allowedHosts:\n      - \"10.0.0.%\"\n</code></pre>"},{"location":"engines/#cockroachdb_1","title":"CockroachDB","text":"<p>CockroachDB uses PostgreSQL wire protocol but has a simpler configuration:</p> <pre><code>spec:\n  engine: cockroachdb\n  connection:\n    host: cockroachdb.example.com\n    port: 26257\n    database: defaultdb\n    sslMode: verify-full  # or disable for insecure mode\n</code></pre> <p>No Extensions or Schemas</p> <p>CockroachDB does not support PostgreSQL extensions or custom schemas. Use it for distributed SQL without PostgreSQL-specific features.</p>"},{"location":"engines/#connection-configuration","title":"Connection Configuration","text":"<p>All engines use the same <code>DatabaseInstance</code> structure:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: my-database\nspec:\n  engine: postgres  # or mysql, mariadb, cockroachdb\n  connection:\n    host: database.example.com\n    port: 5432  # 3306 for MySQL/MariaDB, 26257 for CockroachDB\n    database: postgres  # mysql for MySQL/MariaDB, defaultdb for CockroachDB\n    secretRef:\n      name: admin-credentials\n</code></pre>"},{"location":"engines/#next-steps","title":"Next Steps","text":"<ul> <li>PostgreSQL Guide - PostgreSQL-specific features</li> <li>MySQL Guide - MySQL-specific features</li> <li>MariaDB Guide - MariaDB-specific features</li> <li>CockroachDB Guide - CockroachDB-specific features</li> </ul>"},{"location":"engines/cockroachdb/","title":"CockroachDB","text":"<p>Complete guide for using DB Provision Operator with CockroachDB.</p>"},{"location":"engines/cockroachdb/#supported-versions","title":"Supported Versions","text":"<ul> <li>CockroachDB 22.x</li> <li>CockroachDB 23.x</li> <li>CockroachDB 24.x</li> </ul>"},{"location":"engines/cockroachdb/#postgresql-wire-compatibility","title":"PostgreSQL Wire Compatibility","text":"<p>CockroachDB is PostgreSQL wire-compatible, meaning it uses the same protocol and SQL syntax as PostgreSQL. The operator leverages the PostgreSQL driver (pgx) to communicate with CockroachDB.</p> <p>However, CockroachDB has important differences from PostgreSQL:</p> Feature PostgreSQL CockroachDB SUPERUSER role Yes No REPLICATION role Yes No BYPASSRLS role Yes No Extensions Yes No Tablespaces Yes No Row-Level Security Yes No INHERIT/NOINHERIT Yes No Backup method pg_dump Native BACKUP Metadata schema pg_catalog crdb_internal <p>PostgreSQL Options Ignored</p> <p>PostgreSQL-specific options like <code>superuser</code>, <code>replication</code>, <code>bypassRLS</code>, <code>extensions</code>, and <code>schemas</code> are silently ignored when using CockroachDB. The operator will not raise an error, but these settings will have no effect.</p>"},{"location":"engines/cockroachdb/#admin-account-requirements","title":"Admin Account Requirements","text":"<p>The operator requires a privileged account to manage databases, users, and roles in CockroachDB.</p>"},{"location":"engines/cockroachdb/#insecure-mode-development-only","title":"Insecure Mode (Development Only)","text":"<p>Never Use Insecure Mode in Production</p> <p>CockroachDB's <code>--insecure</code> flag disables TLS and password authentication. This is only for local development and testing.</p> <p>In insecure mode, passwords are not supported. The operator will automatically detect this and create users without passwords.</p> <pre><code>-- Create the admin user (no password in insecure mode)\nCREATE USER IF NOT EXISTS dbprovision_admin;\n\n-- Grant role creation privilege\nALTER USER dbprovision_admin CREATEROLE;\n\n-- Grant admin role for full database management\nGRANT admin TO dbprovision_admin;\n</code></pre>"},{"location":"engines/cockroachdb/#secure-mode-production","title":"Secure Mode (Production)","text":"<p>For production deployments, use CockroachDB with TLS certificates:</p> <pre><code>-- =============================================================\n-- CockroachDB Secure Mode Admin Account Setup\n-- =============================================================\n\n-- 1. Create the operator admin role\nCREATE USER dbprovision_admin WITH PASSWORD 'your-secure-password';\n\n-- 2. Grant role creation and database creation privileges\nALTER USER dbprovision_admin WITH CREATEROLE CREATEDB;\n\n-- 3. Grant admin role for full management capabilities\n-- (alternative: grant only specific privileges you need)\nGRANT admin TO dbprovision_admin;\n\n-- 4. Verify the setup\nSELECT username FROM system.users WHERE username = 'dbprovision_admin';\nSHOW GRANTS FOR dbprovision_admin;\n</code></pre>"},{"location":"engines/cockroachdb/#privilege-matrix","title":"Privilege Matrix","text":"Operation Required Privileges SQL to Grant Create Database <code>CREATEDB</code> <code>ALTER USER ... WITH CREATEDB</code> Drop Database <code>CREATEDB</code> <code>ALTER USER ... WITH CREATEDB</code> Create User/Role <code>CREATEROLE</code> <code>ALTER USER ... WITH CREATEROLE</code> Drop User/Role <code>CREATEROLE</code> <code>ALTER USER ... WITH CREATEROLE</code> Alter User/Role <code>CREATEROLE</code> <code>ALTER USER ... WITH CREATEROLE</code> Grant Privileges <code>admin</code> or owner <code>GRANT admin TO ...</code> Backup Operations <code>admin</code> or <code>BACKUP</code> <code>GRANT admin TO ...</code> <p>Complete Setup Guide</p> <p>See Admin Account Setup for detailed instructions.</p>"},{"location":"engines/cockroachdb/#databaseinstance","title":"DatabaseInstance","text":""},{"location":"engines/cockroachdb/#basic-configuration-insecure-mode","title":"Basic Configuration (Insecure Mode)","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: cockroach-cluster\n  namespace: database\nspec:\n  engine: cockroachdb\n  connection:\n    host: cockroachdb.database.svc.cluster.local\n    port: 26257\n    database: defaultdb\n    sslMode: disable  # Required for insecure mode\n    secretRef:\n      name: cockroach-admin-credentials\n</code></pre>"},{"location":"engines/cockroachdb/#secure-mode-with-tls","title":"Secure Mode with TLS","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: cockroach-cluster\n  namespace: database\nspec:\n  engine: cockroachdb\n  connection:\n    host: cockroachdb.database.svc.cluster.local\n    port: 26257\n    database: defaultdb\n    sslMode: verify-full\n    secretRef:\n      name: cockroach-admin-credentials\n  tls:\n    secretRef:\n      name: cockroach-tls\n      keys:\n        ca: ca.crt\n        cert: tls.crt\n        key: tls.key\n</code></pre>"},{"location":"engines/cockroachdb/#ssl-modes","title":"SSL Modes","text":"Mode Description <code>disable</code> No SSL (insecure mode only) <code>require</code> Require SSL, no certificate verification <code>verify-ca</code> Verify server certificate chain <code>verify-full</code> Verify server certificate and hostname"},{"location":"engines/cockroachdb/#credentials-secret","title":"Credentials Secret","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: cockroach-admin-credentials\n  namespace: database\ntype: Opaque\nstringData:\n  username: dbprovision_admin\n  password: \"\"  # Empty for insecure mode\n</code></pre> <p>For secure mode:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: cockroach-admin-credentials\n  namespace: database\ntype: Opaque\nstringData:\n  username: dbprovision_admin\n  password: your-secure-password\n</code></pre>"},{"location":"engines/cockroachdb/#database","title":"Database","text":""},{"location":"engines/cockroachdb/#basic-configuration","title":"Basic Configuration","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\n  namespace: database\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  name: myapp\n</code></pre>"},{"location":"engines/cockroachdb/#database-options","title":"Database Options","text":"<p>CockroachDB databases support fewer options than PostgreSQL:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  name: myapp\n  deletionPolicy: Retain  # Retain, Delete\n  deletionProtection: true\n</code></pre> <p>No Extensions or Schemas</p> <p>CockroachDB does not support PostgreSQL extensions or custom schemas. The <code>postgres.extensions</code> and <code>postgres.schemas</code> fields are ignored.</p>"},{"location":"engines/cockroachdb/#databaseuser","title":"DatabaseUser","text":""},{"location":"engines/cockroachdb/#basic-user","title":"Basic User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\n  namespace: database\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"engines/cockroachdb/#user-with-role-membership","title":"User with Role Membership","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-admin\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  username: myapp_admin\n  passwordSecret:\n    generate: true\n    secretName: myapp-admin-credentials\n  postgres:\n    createDB: true\n    createRole: true\n    connectionLimit: 20\n    inRoles:\n      - myapp_readers\n</code></pre>"},{"location":"engines/cockroachdb/#cockroachdb-user-options","title":"CockroachDB User Options","text":"Field Type Description <code>login</code> bool Can login (default: true for users) <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>connectionLimit</code> int Max connections (-1 = unlimited) <code>inRoles</code> array Roles to inherit from <code>validUntil</code> string Password expiration <p>Unsupported Options</p> <p>The following PostgreSQL options are ignored for CockroachDB: <code>superuser</code>, <code>replication</code>, <code>bypassRLS</code>, <code>inherit</code>.</p>"},{"location":"engines/cockroachdb/#databaserole","title":"DatabaseRole","text":""},{"location":"engines/cockroachdb/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  roleName: myapp_reader\n  postgres:\n    login: false\n</code></pre>"},{"location":"engines/cockroachdb/#role-with-grants","title":"Role with Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: writer-role\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  roleName: myapp_writer\n  postgres:\n    login: false\n    inRoles: [myapp_reader]\n</code></pre>"},{"location":"engines/cockroachdb/#databasegrant","title":"DatabaseGrant","text":""},{"location":"engines/cockroachdb/#grant-database-privileges","title":"Grant Database Privileges","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    grants:\n      - database: myapp\n        privileges: [CONNECT, CREATE]\n</code></pre>"},{"location":"engines/cockroachdb/#grant-table-privileges","title":"Grant Table Privileges","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-table-grants\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/cockroachdb/#cockroachdb-privileges","title":"CockroachDB Privileges","text":"Object Privileges Database <code>ALL</code>, <code>CREATE</code>, <code>CONNECT</code> Table <code>ALL</code>, <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>DROP</code> Schema <code>ALL</code>, <code>CREATE</code>, <code>USAGE</code> Type <code>ALL</code>, <code>USAGE</code>"},{"location":"engines/cockroachdb/#backup-and-restore","title":"Backup and Restore","text":"<p>CockroachDB uses its native <code>BACKUP</code> and <code>RESTORE</code> commands instead of pg_dump/pg_restore.</p>"},{"location":"engines/cockroachdb/#native-backup","title":"Native Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      prefix: cockroach/\n      secretRef:\n        name: s3-credentials\n</code></pre>"},{"location":"engines/cockroachdb/#backup-characteristics","title":"Backup Characteristics","text":"Feature CockroachDB PostgreSQL Method SQL <code>BACKUP</code> command External pg_dump Format Native CockroachDB custom/plain/tar Parallelism Built-in distributed Jobs flag Progress SHOW JOBS Byte counting Storage S3/GCS/Azure/nodelocal S3/GCS/Azure/PVC"},{"location":"engines/cockroachdb/#restore-operation","title":"Restore Operation","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: myapp-restore\nspec:\n  backupRef:\n    name: myapp-backup\n  targetDatabaseRef:\n    name: myapp-restored\n</code></pre>"},{"location":"engines/cockroachdb/#multi-region-considerations","title":"Multi-Region Considerations","text":"<p>CockroachDB excels in multi-region deployments. When using the operator:</p> <ol> <li>Single DatabaseInstance per region: Create separate <code>DatabaseInstance</code> resources pointing to region-local SQL endpoints</li> <li>Locality-aware users: CockroachDB handles user replication automatically</li> <li>Backup locality: Backups can target region-specific storage</li> </ol> <p>Enterprise Features</p> <p>Some CockroachDB features like locality-aware queries and incremental backups require an Enterprise license.</p>"},{"location":"engines/cockroachdb/#best-practices","title":"Best Practices","text":""},{"location":"engines/cockroachdb/#security","title":"Security","text":"<ol> <li>Always use TLS in production with <code>verify-full</code></li> <li>Use certificate authentication (mTLS) when possible</li> <li>Limit connection privileges with <code>connectionLimit</code></li> <li>Use roles for permission grouping</li> <li>Enable audit logging in CockroachDB</li> </ol>"},{"location":"engines/cockroachdb/#performance","title":"Performance","text":"<ol> <li>Use connection pooling (CockroachDB supports PgBouncer)</li> <li>Set appropriate connection limits per user</li> <li>Configure statement timeouts for long-running queries</li> </ol>"},{"location":"engines/cockroachdb/#operations","title":"Operations","text":"<ol> <li>Schedule regular backups with retention policies</li> <li>Monitor via CockroachDB Console (port 8080)</li> <li>Use SHOW JOBS to track backup/restore progress</li> </ol>"},{"location":"engines/cockroachdb/#troubleshooting","title":"Troubleshooting","text":""},{"location":"engines/cockroachdb/#connection-issues","title":"Connection Issues","text":"<pre><code># Test connectivity to CockroachDB\nkubectl run cockroach-test --rm -it --image=cockroachdb/cockroach:v24.1.0 -- \\\n  sql --insecure --host=cockroachdb:26257 -e \"SELECT 1\"\n\n# For secure mode\nkubectl run cockroach-test --rm -it --image=cockroachdb/cockroach:v24.1.0 -- \\\n  sql --url=\"postgresql://user:pass@cockroachdb:26257/defaultdb?sslmode=verify-full\"\n</code></pre>"},{"location":"engines/cockroachdb/#insecure-mode-password-error","title":"Insecure Mode Password Error","text":"<p>If you see errors about passwords in insecure mode:</p> <pre><code>ERROR: password is not supported in insecure mode\n</code></pre> <p>This is expected. The operator will automatically retry user creation without a password.</p>"},{"location":"engines/cockroachdb/#permission-denied","title":"Permission Denied","text":"<pre><code>-- Check user privileges\nSHOW GRANTS FOR myuser;\n\n-- Check role memberships\nSHOW GRANTS ON ROLE FOR myuser;\n\n-- Grant missing privileges\nGRANT SELECT ON TABLE mydb.public.* TO myuser;\n</code></pre>"},{"location":"engines/cockroachdb/#backup-job-status","title":"Backup Job Status","text":"<pre><code>-- Check backup job status\nSELECT * FROM [SHOW JOBS] WHERE job_type = 'BACKUP' ORDER BY created DESC LIMIT 5;\n\n-- Check for failed jobs\nSELECT * FROM [SHOW JOBS] WHERE status = 'failed' AND job_type = 'BACKUP';\n</code></pre>"},{"location":"engines/cockroachdb/#common-errors","title":"Common Errors","text":"Error Cause Solution <code>insecure mode</code> Using password with --insecure Remove password or enable TLS <code>CREATEDB required</code> Missing CREATEDB privilege <code>ALTER USER ... WITH CREATEDB</code> <code>admin required</code> Missing admin role for grants <code>GRANT admin TO ...</code> <code>node not healthy</code> Cluster health issue Check CockroachDB logs and status"},{"location":"engines/mariadb/","title":"MariaDB","text":"<p>Complete guide for using DB Provision Operator with MariaDB.</p>"},{"location":"engines/mariadb/#supported-versions","title":"Supported Versions","text":"<ul> <li>MariaDB 10.5.x</li> <li>MariaDB 10.6.x (LTS)</li> <li>MariaDB 10.11.x (LTS)</li> <li>MariaDB 11.x</li> </ul>"},{"location":"engines/mariadb/#admin-account-requirements","title":"Admin Account Requirements","text":"<p>The operator requires a privileged database account to manage databases, users, and grants. For production security, create a dedicated least-privilege admin account instead of using <code>root</code>.</p> <p>Never Use Root or ALL PRIVILEGES</p> <p>The operator is designed to work without SUPER privilege or ALL PRIVILEGES. Using root or granting ALL PRIVILEGES violates the principle of least privilege and creates security risks.</p>"},{"location":"engines/mariadb/#key-differences-from-mysql","title":"Key Differences from MySQL","text":"Feature MariaDB MySQL 8.0+ Kill connections privilege <code>CONNECTION ADMIN</code> (with space) <code>CONNECTION_ADMIN</code> (underscore) Role management Roles are users with <code>CREATE USER</code> <code>ROLE_ADMIN</code> privilege Global grants table Not available <code>mysql.global_grants</code>"},{"location":"engines/mariadb/#privilege-matrix","title":"Privilege Matrix","text":"<p>This table shows the exact privileges required for each operator action:</p> Operation Required Privileges SQL to Grant Create Database <code>CREATE ON *.*</code> <code>GRANT CREATE ON *.* TO ...</code> Drop Database <code>DROP ON *.*</code> <code>GRANT DROP ON *.* TO ...</code> Alter Database <code>ALTER ON *.*</code> <code>GRANT ALTER ON *.* TO ...</code> Force Drop Database <code>DROP ON *.*</code>, <code>CONNECTION ADMIN ON *.*</code> See setup below Create User <code>CREATE USER ON *.*</code> <code>GRANT CREATE USER ON *.* TO ...</code> Drop User <code>CREATE USER ON *.*</code> Same grant handles both operations Alter User <code>CREATE USER ON *.*</code> Same grant handles all user operations Grant Privileges <code>WITH GRANT OPTION</code> <code>GRANT ... WITH GRANT OPTION</code> Create Role <code>CREATE USER ON *.*</code> MariaDB roles are users Grant Role <code>WITH GRANT OPTION</code> Same as grant privileges Query User Info <code>SELECT ON mysql.*</code> <code>GRANT SELECT ON mysql.user TO ...</code> Apply Changes <code>RELOAD ON *.*</code> <code>GRANT RELOAD ON *.* TO ...</code> Kill Connections <code>CONNECTION ADMIN ON *.*</code> <code>GRANT CONNECTION ADMIN ON *.* TO ...</code> View Processes <code>PROCESS ON *.*</code> <code>GRANT PROCESS ON *.* TO ...</code>"},{"location":"engines/mariadb/#understanding-each-privilege","title":"Understanding Each Privilege","text":"Privilege What It Allows What Happens Without It <code>CREATE</code> Create databases and tables <code>CREATE DATABASE</code> fails <code>DROP</code> Drop databases and tables <code>DROP DATABASE</code> fails <code>ALTER</code> Modify database/table structure <code>ALTER DATABASE</code> fails <code>CREATE USER</code> Create, drop, and alter users/roles <code>CREATE USER</code> fails <code>WITH GRANT OPTION</code> Grant/revoke privileges to others Cannot delegate privileges <code>SELECT ON mysql.*</code> Read user/grant metadata Cannot verify existing users <code>RELOAD</code> Execute FLUSH statements <code>FLUSH PRIVILEGES</code> fails <code>CONNECTION ADMIN</code> Kill user connections (10.5.2+) Force-drop fails with active connections <code>PROCESS</code> View server process list Cannot monitor connections"},{"location":"engines/mariadb/#complete-setup-script-copy-paste","title":"Complete Setup Script (Copy-Paste)","text":"<pre><code>-- =============================================================\n-- MariaDB 10.5+ Least-Privilege Admin Account Setup\n-- Compatible with: MariaDB 10.5.x, 10.6.x (LTS), 10.11.x (LTS), 11.x\n-- =============================================================\n\n-- 1. Create the operator admin user\nCREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password';\n\n-- 2. Database operations (create, drop, alter databases)\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\n\n-- 3. User management with grant delegation\n--    Note: WITH GRANT OPTION is critical for role/privilege delegation\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%' WITH GRANT OPTION;\n\n-- 4. Query user and grant metadata from system tables\n--    Note: MariaDB doesn't have mysql.global_grants\nGRANT SELECT ON mysql.user TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.db TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.tables_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.columns_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.procs_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.roles_mapping TO 'dbprovision_admin'@'%';\n\n-- 5. Administrative operations\nGRANT RELOAD ON *.* TO 'dbprovision_admin'@'%';  -- FLUSH PRIVILEGES\nGRANT PROCESS ON *.* TO 'dbprovision_admin'@'%'; -- View processes\n\n-- 6. Connection management (required for force-drop)\n--    IMPORTANT: Note the space in \"CONNECTION ADMIN\" (not underscore!)\nGRANT CONNECTION ADMIN ON *.* TO 'dbprovision_admin'@'%';\n\n-- 7. Data privileges (needed to grant these to app users)\nGRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO 'dbprovision_admin'@'%';\nGRANT SHOW VIEW, TRIGGER, LOCK TABLES ON *.* TO 'dbprovision_admin'@'%';\n\n-- 8. Apply changes\nFLUSH PRIVILEGES;\n\n-- 9. Verify setup (should NOT show ALL PRIVILEGES or SUPER)\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n\n-- Expected output should list individual privileges, NOT:\n--   GRANT ALL PRIVILEGES ON *.* TO 'dbprovision_admin'@'%'\n</code></pre>"},{"location":"engines/mariadb/#mariadb-104-and-earlier","title":"MariaDB 10.4 and Earlier","text":"<p>For MariaDB versions before 10.5, <code>CONNECTION ADMIN</code> doesn't exist:</p> <pre><code>-- MariaDB 10.4 and earlier setup\nCREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password';\n\n-- Database operations\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\n\n-- User management\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%' WITH GRANT OPTION;\n\n-- Metadata access\nGRANT SELECT ON mysql.user TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.db TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.tables_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.columns_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.procs_priv TO 'dbprovision_admin'@'%';\n\n-- Administrative\nGRANT RELOAD, PROCESS ON *.* TO 'dbprovision_admin'@'%';\n\n-- Data privileges\nGRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO 'dbprovision_admin'@'%';\nGRANT SHOW VIEW, TRIGGER, LOCK TABLES ON *.* TO 'dbprovision_admin'@'%';\n\n-- Note: MariaDB &lt; 10.5 doesn't have CONNECTION ADMIN\n-- Force-drop requires SUPER or process termination from another tool\n\nFLUSH PRIVILEGES;\n</code></pre> <p>MariaDB 10.4 Limitations</p> <ul> <li>No <code>CONNECTION ADMIN</code>: Force-drop with active connections may require SUPER</li> <li>Consider upgrading to MariaDB 10.5+ for full operator support</li> </ul> <p>MariaDB vs MySQL Differences</p> <ul> <li>MariaDB uses <code>CONNECTION ADMIN</code> (with a space) instead of MySQL's <code>CONNECTION_ADMIN</code></li> <li>MariaDB roles are implemented as users, not requiring a separate <code>ROLE_ADMIN</code> privilege</li> <li>MariaDB doesn't have <code>mysql.global_grants</code> table</li> </ul> <p>Complete Setup Guide</p> <p>See Admin Account Setup for complete SQL scripts, verification steps, and security recommendations.</p>"},{"location":"engines/mariadb/#mariadb-vs-mysql","title":"MariaDB vs MySQL","text":"<p>MariaDB is a MySQL-compatible fork with additional features:</p> Feature MariaDB MySQL Storage Engines More options (Aria, ColumnStore) InnoDB, MyISAM Replication Galera Cluster built-in Group Replication JSON JSON type (10.2+) Native JSON Window Functions 10.2+ 8.0+ Roles 10.0.5+ 8.0+"},{"location":"engines/mariadb/#databaseinstance","title":"DatabaseInstance","text":""},{"location":"engines/mariadb/#basic-configuration","title":"Basic Configuration","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mariadb-primary\nspec:\n  engine: mariadb\n  connection:\n    host: mariadb.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mariadb-admin-credentials\n</code></pre>"},{"location":"engines/mariadb/#tls-configuration","title":"TLS Configuration","text":"<pre><code>spec:\n  connection:\n    tls:\n      enabled: true\n      secretRef:\n        name: mariadb-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"engines/mariadb/#database","title":"Database","text":""},{"location":"engines/mariadb/#basic-database","title":"Basic Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mariadb-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre> <p>MySQL Configuration Block</p> <p>MariaDB uses the <code>mysql</code> configuration block due to its MySQL compatibility.</p>"},{"location":"engines/mariadb/#character-sets","title":"Character Sets","text":"Charset Description Recommended For <code>utf8mb4</code> Full Unicode Most applications <code>utf8mb3</code> 3-byte Unicode Legacy compatibility <code>latin1</code> Western European Legacy systems"},{"location":"engines/mariadb/#databaseuser","title":"DatabaseUser","text":""},{"location":"engines/mariadb/#basic-user","title":"Basic User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mariadb-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"engines/mariadb/#user-with-options","title":"User with Options","text":"<pre><code>spec:\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n  mysql:\n    maxUserConnections: 50\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.%\"\n      - \"192.168.1.%\"\n</code></pre>"},{"location":"engines/mariadb/#authentication-plugins","title":"Authentication Plugins","text":"<p>MariaDB supports multiple authentication plugins:</p> Plugin Description <code>mysql_native_password</code> Traditional (default) <code>ed25519</code> EdDSA (more secure) <code>gssapi</code> Kerberos/GSSAPI <code>pam</code> PAM authentication"},{"location":"engines/mariadb/#databaserole","title":"DatabaseRole","text":"<p>MariaDB supports roles since version 10.0.5.</p>"},{"location":"engines/mariadb/#create-role","title":"Create Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: mariadb-primary\n  roleName: readonly\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT]\n</code></pre>"},{"location":"engines/mariadb/#role-with-multiple-privileges","title":"Role with Multiple Privileges","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: developer-role\nspec:\n  instanceRef:\n    name: mariadb-primary\n  roleName: developer\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE, CREATE, ALTER, INDEX]\n</code></pre>"},{"location":"engines/mariadb/#databasegrant","title":"DatabaseGrant","text":""},{"location":"engines/mariadb/#database-level-grant","title":"Database-Level Grant","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mariadb/#table-level-grant","title":"Table-Level Grant","text":"<pre><code>spec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: table\n        database: myapp\n        table: users\n        privileges: [SELECT, INSERT, UPDATE]\n</code></pre>"},{"location":"engines/mariadb/#assign-roles","title":"Assign Roles","text":"<pre><code>spec:\n  userRef:\n    name: myapp-user\n  mysql:\n    roles:\n      - readonly\n      - developer\n</code></pre>"},{"location":"engines/mariadb/#backup-and-restore","title":"Backup and Restore","text":""},{"location":"engines/mariadb/#mariadb-dump-backup","title":"mariadb-dump Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      secretRef:\n        name: s3-credentials\n  mysql:\n    method: mysqldump  # Uses mariadb-dump internally\n    singleTransaction: true\n    routines: true\n    triggers: true\n</code></pre>"},{"location":"engines/mariadb/#complete-example","title":"Complete Example","text":""},{"location":"engines/mariadb/#application-setup","title":"Application Setup","text":"<pre><code># Admin credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mariadb-admin-credentials\ntype: Opaque\nstringData:\n  username: root\n  password: your-root-password\n---\n# Database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mariadb-primary\nspec:\n  engine: mariadb\n  connection:\n    host: mariadb.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mariadb-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n---\n# Application database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mariadb-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n---\n# Application user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mariadb-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"mysql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp\"\n---\n# User grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mariadb/#galera-cluster","title":"Galera Cluster","text":"<p>When using MariaDB Galera Cluster:</p>"},{"location":"engines/mariadb/#considerations","title":"Considerations","text":"<ol> <li>Use any node for the connection - writes are synchronous</li> <li>Configure <code>wsrep_sync_wait</code> for read-after-write consistency</li> <li>Monitor cluster status before operations</li> </ol>"},{"location":"engines/mariadb/#cluster-aware-configuration","title":"Cluster-Aware Configuration","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mariadb-galera\nspec:\n  engine: mariadb\n  connection:\n    host: mariadb-galera.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mariadb-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 15  # More frequent for cluster\n</code></pre>"},{"location":"engines/mariadb/#best-practices","title":"Best Practices","text":""},{"location":"engines/mariadb/#security","title":"Security","text":"<ol> <li>Use ed25519 authentication for better security</li> <li>Restrict host access to known IP ranges</li> <li>Enable TLS for remote connections</li> <li>Use roles for permission management</li> </ol>"},{"location":"engines/mariadb/#performance","title":"Performance","text":"<ol> <li>Use InnoDB for transactional workloads</li> <li>Configure connection pools</li> <li>Use utf8mb4 consistently</li> </ol>"},{"location":"engines/mariadb/#maintenance","title":"Maintenance","text":"<ol> <li>Use singleTransaction for backups</li> <li>Monitor Galera cluster health</li> <li>Test failover procedures</li> </ol>"},{"location":"engines/mariadb/#troubleshooting","title":"Troubleshooting","text":""},{"location":"engines/mariadb/#connection-issues","title":"Connection Issues","text":"<pre><code># Test connectivity\nkubectl run mariadb-test --rm -it --image=mariadb:10.11 -- \\\n  mariadb -h host -u user -p -e \"SELECT 1\"\n</code></pre>"},{"location":"engines/mariadb/#galera-issues","title":"Galera Issues","text":"<pre><code>-- Check cluster status\nSHOW STATUS LIKE 'wsrep_%';\n\n-- Check if node is synced\nSHOW STATUS LIKE 'wsrep_local_state_comment';\n-- Should return 'Synced'\n</code></pre>"},{"location":"engines/mariadb/#access-denied","title":"Access Denied","text":"<ul> <li>Check user exists: <code>SELECT user, host FROM mysql.user</code></li> <li>Verify host restrictions</li> <li>Check grants: <code>SHOW GRANTS FOR 'user'@'host'</code></li> </ul>"},{"location":"engines/mysql/","title":"MySQL","text":"<p>Complete guide for using DB Provision Operator with MySQL.</p>"},{"location":"engines/mysql/#supported-versions","title":"Supported Versions","text":"<ul> <li>MySQL 5.7.x</li> <li>MySQL 8.0.x</li> <li>MySQL 8.4.x</li> </ul>"},{"location":"engines/mysql/#admin-account-requirements","title":"Admin Account Requirements","text":"<p>The operator requires a privileged database account to manage databases, users, and grants. For production security, create a dedicated least-privilege admin account instead of using <code>root</code>.</p> <p>Never Use Root or ALL PRIVILEGES</p> <p>The operator is designed to work without SUPER privilege or ALL PRIVILEGES. Using root or granting ALL PRIVILEGES violates the principle of least privilege and creates security risks.</p>"},{"location":"engines/mysql/#privilege-matrix","title":"Privilege Matrix","text":"<p>This table shows the exact privileges required for each operator action:</p> Operation Required Privileges SQL to Grant Create Database <code>CREATE ON *.*</code> <code>GRANT CREATE ON *.* TO ...</code> Drop Database <code>DROP ON *.*</code> <code>GRANT DROP ON *.* TO ...</code> Alter Database <code>ALTER ON *.*</code> <code>GRANT ALTER ON *.* TO ...</code> Force Drop Database <code>DROP ON *.*</code>, <code>CONNECTION_ADMIN ON *.*</code> See setup below Create User <code>CREATE USER ON *.*</code> <code>GRANT CREATE USER ON *.* TO ...</code> Drop User <code>CREATE USER ON *.*</code> Same grant handles both operations Alter User <code>CREATE USER ON *.*</code> Same grant handles all user operations Grant Privileges <code>GRANT OPTION ON *.*</code> <code>GRANT GRANT OPTION ON *.* TO ...</code> Create Role (8.0+) <code>ROLE_ADMIN ON *.*</code> <code>GRANT ROLE_ADMIN ON *.* TO ...</code> Grant Role (8.0+) <code>ROLE_ADMIN ON *.*</code> Same grant handles role operations Query User Info <code>SELECT ON mysql.*</code> <code>GRANT SELECT ON mysql.user TO ...</code> Apply Changes <code>RELOAD ON *.*</code> <code>GRANT RELOAD ON *.* TO ...</code> Kill Connections <code>CONNECTION_ADMIN ON *.*</code> <code>GRANT CONNECTION_ADMIN ON *.* TO ...</code> View Processes <code>PROCESS ON *.*</code> <code>GRANT PROCESS ON *.* TO ...</code>"},{"location":"engines/mysql/#understanding-each-privilege","title":"Understanding Each Privilege","text":"Privilege What It Allows What Happens Without It <code>CREATE</code> Create databases and tables <code>CREATE DATABASE</code> fails <code>DROP</code> Drop databases and tables <code>DROP DATABASE</code> fails <code>ALTER</code> Modify database/table structure <code>ALTER DATABASE</code> fails <code>CREATE USER</code> Create, drop, and alter users <code>CREATE USER</code> fails <code>GRANT OPTION</code> Grant/revoke privileges to others Cannot delegate privileges to app users <code>SELECT ON mysql.*</code> Read user/grant metadata Cannot verify existing users/grants <code>RELOAD</code> Execute FLUSH statements <code>FLUSH PRIVILEGES</code> fails <code>CONNECTION_ADMIN</code> Kill user connections Force-drop fails with active connections <code>ROLE_ADMIN</code> Manage roles (MySQL 8.0+) <code>CREATE ROLE</code> fails <code>PROCESS</code> View server process list Cannot monitor connections"},{"location":"engines/mysql/#complete-setup-script-copy-paste","title":"Complete Setup Script (Copy-Paste)","text":"<pre><code>-- =============================================================\n-- MySQL 8.0+ Least-Privilege Admin Account Setup\n-- Compatible with: MySQL 8.0.x, 8.4.x\n-- =============================================================\n\n-- 1. Create the operator admin user\nCREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password';\n\n-- 2. Database operations (create, drop, alter databases)\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\n\n-- 3. User management (create, drop, alter users)\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%';\n\n-- 4. Privilege delegation (grant privileges to app users)\nGRANT GRANT OPTION ON *.* TO 'dbprovision_admin'@'%';\n\n-- 5. Query user and grant metadata from system tables\nGRANT SELECT ON mysql.user TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.db TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.tables_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.columns_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.procs_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.global_grants TO 'dbprovision_admin'@'%';\n\n-- 6. Administrative operations\nGRANT RELOAD ON *.* TO 'dbprovision_admin'@'%';  -- FLUSH PRIVILEGES\nGRANT PROCESS ON *.* TO 'dbprovision_admin'@'%'; -- View processes\n\n-- 7. Connection management (required for force-drop)\nGRANT CONNECTION_ADMIN ON *.* TO 'dbprovision_admin'@'%';\n\n-- 8. Role management (MySQL 8.0+)\nGRANT ROLE_ADMIN ON *.* TO 'dbprovision_admin'@'%';\n\n-- 9. Data privileges (needed to grant these to app users)\n--    The admin must have privileges it will grant to others\nGRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO 'dbprovision_admin'@'%';\nGRANT SHOW VIEW, TRIGGER, LOCK TABLES ON *.* TO 'dbprovision_admin'@'%';\n\n-- 10. Apply changes\nFLUSH PRIVILEGES;\n\n-- 11. Verify setup (should NOT show ALL PRIVILEGES or SUPER)\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n\n-- Expected output should list individual privileges, NOT:\n--   GRANT ALL PRIVILEGES ON *.* TO 'dbprovision_admin'@'%'\n</code></pre>"},{"location":"engines/mysql/#mysql-57-compatibility","title":"MySQL 5.7 Compatibility","text":"<p>For MySQL 5.7, some dynamic privileges don't exist. Use this alternative:</p> <pre><code>-- MySQL 5.7 setup (without dynamic privileges)\nCREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password';\n\n-- Database operations\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\n\n-- User management\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%';\nGRANT GRANT OPTION ON *.* TO 'dbprovision_admin'@'%';\n\n-- Metadata access\nGRANT SELECT ON mysql.* TO 'dbprovision_admin'@'%';\n\n-- Administrative\nGRANT RELOAD, PROCESS ON *.* TO 'dbprovision_admin'@'%';\n\n-- Data privileges (for granting to app users)\nGRANT SELECT, INSERT, UPDATE, DELETE ON *.* TO 'dbprovision_admin'@'%';\nGRANT SHOW VIEW, TRIGGER, LOCK TABLES ON *.* TO 'dbprovision_admin'@'%';\n\n-- Note: MySQL 5.7 doesn't have CONNECTION_ADMIN or ROLE_ADMIN\n-- Force-drop requires SUPER or process termination from another tool\n\nFLUSH PRIVILEGES;\n</code></pre> <p>MySQL 5.7 Limitations</p> <ul> <li>No <code>CONNECTION_ADMIN</code>: Force-drop with active connections may require SUPER</li> <li>No <code>ROLE_ADMIN</code>: Native roles require MySQL 8.0+</li> <li>No <code>mysql.global_grants</code> table</li> </ul> <p>Complete Setup Guide</p> <p>See Admin Account Setup for complete SQL scripts, verification steps, and security recommendations.</p>"},{"location":"engines/mysql/#databaseinstance","title":"DatabaseInstance","text":""},{"location":"engines/mysql/#basic-configuration","title":"Basic Configuration","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin-credentials\n</code></pre>"},{"location":"engines/mysql/#tls-configuration","title":"TLS Configuration","text":"<pre><code>spec:\n  connection:\n    tls:\n      enabled: true\n      secretRef:\n        name: mysql-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"engines/mysql/#database","title":"Database","text":""},{"location":"engines/mysql/#basic-database","title":"Basic Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre>"},{"location":"engines/mysql/#character-sets-and-collations","title":"Character Sets and Collations","text":"Charset Description Recommended Collation <code>utf8mb4</code> Full Unicode (recommended) <code>utf8mb4_unicode_ci</code> <code>utf8</code> Basic Unicode (3 bytes) <code>utf8_general_ci</code> <code>latin1</code> Western European <code>latin1_swedish_ci</code> <p>Use utf8mb4</p> <p>Always use <code>utf8mb4</code> for full Unicode support including emojis. The <code>utf8</code> charset only supports 3-byte characters.</p>"},{"location":"engines/mysql/#databaseuser","title":"DatabaseUser","text":""},{"location":"engines/mysql/#basic-user","title":"Basic User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"engines/mysql/#user-with-host-restrictions","title":"User with Host Restrictions","text":"<pre><code>spec:\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n  mysql:\n    maxUserConnections: 50\n    authPlugin: caching_sha2_password\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.%\"\n      - \"192.168.1.%\"\n      - \"localhost\"\n</code></pre>"},{"location":"engines/mysql/#mysql-user-options","title":"MySQL User Options","text":"Field Type Description <code>maxQueriesPerHour</code> int Query limit (0 = unlimited) <code>maxUpdatesPerHour</code> int Update limit <code>maxConnectionsPerHour</code> int Connection limit per hour <code>maxUserConnections</code> int Max concurrent connections <code>authPlugin</code> string Authentication plugin <code>requireSSL</code> bool Require SSL connections <code>allowedHosts</code> array Allowed connection hosts <code>accountLocked</code> bool Lock the account"},{"location":"engines/mysql/#authentication-plugins","title":"Authentication Plugins","text":"Plugin MySQL Version Description <code>mysql_native_password</code> 5.7+ Traditional password <code>caching_sha2_password</code> 8.0+ Default in 8.0 (recommended) <code>sha256_password</code> 5.7+ SHA-256"},{"location":"engines/mysql/#databaserole-mysql-80","title":"DatabaseRole (MySQL 8.0+)","text":"<p>MySQL 8.0 introduced native role support.</p>"},{"location":"engines/mysql/#create-role","title":"Create Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: mysql-primary\n  roleName: readonly\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT]\n</code></pre>"},{"location":"engines/mysql/#role-hierarchy","title":"Role Hierarchy","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readwrite-role\nspec:\n  instanceRef:\n    name: mysql-primary\n  roleName: readwrite\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mysql/#databasegrant","title":"DatabaseGrant","text":""},{"location":"engines/mysql/#database-level-grant","title":"Database-Level Grant","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mysql/#table-level-grant","title":"Table-Level Grant","text":"<pre><code>spec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: table\n        database: myapp\n        table: users\n        privileges: [SELECT, INSERT, UPDATE]\n      - level: table\n        database: myapp\n        table: audit_log\n        privileges: [SELECT]\n</code></pre>"},{"location":"engines/mysql/#global-grant","title":"Global Grant","text":"<pre><code>spec:\n  userRef:\n    name: admin-user\n  mysql:\n    grants:\n      - level: global\n        privileges: [PROCESS, REPLICATION CLIENT]\n</code></pre>"},{"location":"engines/mysql/#grant-levels","title":"Grant Levels","text":"Level Scope Example <code>global</code> All databases <code>PROCESS</code>, <code>REPLICATION CLIENT</code> <code>database</code> Single database <code>SELECT</code>, <code>INSERT</code> on <code>myapp.*</code> <code>table</code> Single table <code>SELECT</code> on <code>myapp.users</code>"},{"location":"engines/mysql/#common-privileges","title":"Common Privileges","text":"<p>Data Privileges:</p> Privilege Description <code>SELECT</code> Read data <code>INSERT</code> Insert data <code>UPDATE</code> Update data <code>DELETE</code> Delete data <p>Structure Privileges:</p> Privilege Description <code>CREATE</code> Create tables/databases <code>ALTER</code> Modify tables <code>DROP</code> Drop tables/databases <code>INDEX</code> Create/drop indexes <p>Administrative Privileges:</p> Privilege Description <code>PROCESS</code> View processes <code>RELOAD</code> Flush operations <code>REPLICATION CLIENT</code> View replication status <code>REPLICATION SLAVE</code> Read binary logs"},{"location":"engines/mysql/#backup-and-restore","title":"Backup and Restore","text":""},{"location":"engines/mysql/#mysqldump-backup","title":"mysqldump Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      secretRef:\n        name: s3-credentials\n  mysql:\n    method: mysqldump\n    singleTransaction: true\n    routines: true\n    triggers: true\n    events: false\n</code></pre>"},{"location":"engines/mysql/#backup-options","title":"Backup Options","text":"Option Description <code>singleTransaction</code> Consistent snapshot without locking <code>routines</code> Include stored procedures/functions <code>triggers</code> Include triggers <code>events</code> Include scheduled events"},{"location":"engines/mysql/#complete-example","title":"Complete Example","text":""},{"location":"engines/mysql/#application-database-setup","title":"Application Database Setup","text":"<pre><code># Admin credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-admin-credentials\ntype: Opaque\nstringData:\n  username: root\n  password: your-root-password\n---\n# Database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin-credentials\n---\n# Application database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n---\n# Application user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"mysql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp\"\n  mysql:\n    maxUserConnections: 100\n---\n# User grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/mysql/#best-practices","title":"Best Practices","text":""},{"location":"engines/mysql/#security","title":"Security","text":"<ol> <li>Use caching_sha2_password for MySQL 8.0+</li> <li>Restrict allowed hosts to known IP ranges</li> <li>Enable SSL for remote connections</li> <li>Use separate users per application</li> <li>Avoid global privileges unless necessary</li> </ol>"},{"location":"engines/mysql/#performance","title":"Performance","text":"<ol> <li>Set appropriate connection limits</li> <li>Use connection pooling</li> <li>Use utf8mb4 consistently</li> </ol>"},{"location":"engines/mysql/#maintenance","title":"Maintenance","text":"<ol> <li>Use singleTransaction for consistent backups</li> <li>Include routines and triggers in backups</li> <li>Test restores regularly</li> </ol>"},{"location":"engines/mysql/#troubleshooting","title":"Troubleshooting","text":""},{"location":"engines/mysql/#connection-issues","title":"Connection Issues","text":"<pre><code># Test connectivity\nkubectl run mysql-test --rm -it --image=mysql:8.0 -- \\\n  mysql -h host -u user -p -e \"SELECT 1\"\n</code></pre>"},{"location":"engines/mysql/#access-denied","title":"Access Denied","text":"<ul> <li>Check user exists: <code>SELECT user, host FROM mysql.user</code></li> <li>Verify host restrictions match client IP</li> <li>Check grants: <code>SHOW GRANTS FOR 'user'@'host'</code></li> </ul>"},{"location":"engines/mysql/#authentication-plugin-mismatch","title":"Authentication Plugin Mismatch","text":"<pre><code>-- Update user authentication plugin\nALTER USER 'user'@'host' IDENTIFIED WITH caching_sha2_password BY 'password';\n</code></pre>"},{"location":"engines/postgresql/","title":"PostgreSQL","text":"<p>Complete guide for using DB Provision Operator with PostgreSQL.</p>"},{"location":"engines/postgresql/#supported-versions","title":"Supported Versions","text":"<ul> <li>PostgreSQL 12.x</li> <li>PostgreSQL 13.x</li> <li>PostgreSQL 14.x</li> <li>PostgreSQL 15.x</li> <li>PostgreSQL 16.x</li> </ul>"},{"location":"engines/postgresql/#admin-account-requirements","title":"Admin Account Requirements","text":"<p>The operator requires a privileged database account to manage databases, users, and roles. For production security, create a dedicated least-privilege admin account instead of using the <code>postgres</code> superuser.</p> <p>Never Use Superuser</p> <p>The operator is designed to work without SUPERUSER privileges. Using a superuser account violates the principle of least privilege and creates security risks.</p>"},{"location":"engines/postgresql/#privilege-matrix","title":"Privilege Matrix","text":"<p>This table shows the exact privileges required for each operator action:</p> Operation Required Privileges SQL to Grant Create Database <code>CREATEDB</code> <code>ALTER ROLE ... WITH CREATEDB</code> Drop Database <code>CREATEDB</code> <code>ALTER ROLE ... WITH CREATEDB</code> Force Drop Database <code>CREATEDB</code>, <code>pg_signal_backend</code> See setup below Create User/Role <code>CREATEROLE</code> <code>ALTER ROLE ... WITH CREATEROLE</code> Drop User/Role <code>CREATEROLE</code> <code>ALTER ROLE ... WITH CREATEROLE</code> Alter User/Role <code>CREATEROLE</code> <code>ALTER ROLE ... WITH CREATEROLE</code> Grant Privileges <code>CREATEROLE</code> <code>ALTER ROLE ... WITH CREATEROLE</code> Revoke Privileges <code>CREATEROLE</code> <code>ALTER ROLE ... WITH CREATEROLE</code> Grant Role Membership <code>CREATEROLE</code> <code>ALTER ROLE ... WITH CREATEROLE</code> Terminate Connections <code>pg_signal_backend</code> <code>GRANT pg_signal_backend TO ...</code> Query Metadata <code>CONNECT</code> <code>GRANT CONNECT ON DATABASE ...</code> Backup Operations <code>pg_read_all_data</code> (PG14+) <code>GRANT pg_read_all_data TO ...</code>"},{"location":"engines/postgresql/#understanding-each-privilege","title":"Understanding Each Privilege","text":"Privilege What It Allows What Happens Without It <code>LOGIN</code> Connect to the database server Cannot authenticate <code>CREATEDB</code> Create and drop databases <code>CREATE DATABASE</code> fails with \"permission denied\" <code>CREATEROLE</code> Create, modify, and drop roles/users <code>CREATE USER</code> fails with \"permission denied\" <code>pg_signal_backend</code> Terminate other connections Force-drop fails when database has active connections <code>pg_read_all_data</code> Read all tables without explicit grants Backup operations fail (PostgreSQL 14+)"},{"location":"engines/postgresql/#complete-setup-script-copy-paste","title":"Complete Setup Script (Copy-Paste)","text":"<pre><code>-- =============================================================\n-- PostgreSQL Least-Privilege Admin Account Setup\n-- Compatible with: PostgreSQL 14+\n-- =============================================================\n\n-- 1. Create the operator admin role with minimum privileges\nCREATE ROLE dbprovision_admin WITH\n    LOGIN\n    CREATEDB\n    CREATEROLE\n    PASSWORD 'your-secure-password';\n\n-- 2. Grant connection termination capability\n--    Required for: force-drop database (terminates active connections)\nGRANT pg_signal_backend TO dbprovision_admin;\n\n-- 3. Grant read access for backup operations (PostgreSQL 14+ only)\n--    Required for: pg_dump backups\nGRANT pg_read_all_data TO dbprovision_admin;\n\n-- 4. Grant template1 access for database creation\nGRANT CONNECT ON DATABASE template1 TO dbprovision_admin;\n\n-- 5. Verify the setup (expected: f, t, t, t)\n--    f = not superuser (GOOD!)\n--    t = can create roles\n--    t = can create databases\n--    t = can login\nSELECT rolsuper, rolcreaterole, rolcreatedb, rolcanlogin\nFROM pg_roles WHERE rolname = 'dbprovision_admin';\n\n-- 6. Verify role memberships\nSELECT r.rolname AS role, m.rolname AS member_of\nFROM pg_roles r\nJOIN pg_auth_members am ON r.oid = am.roleid\nJOIN pg_roles m ON am.member = m.oid\nWHERE m.rolname = 'dbprovision_admin';\n-- Should show: pg_signal_backend, pg_read_all_data\n</code></pre>"},{"location":"engines/postgresql/#postgresql-1213-compatibility","title":"PostgreSQL 12/13 Compatibility","text":"<p>For PostgreSQL versions before 14.x, the <code>pg_read_all_data</code> role doesn't exist. Use this alternative:</p> <pre><code>-- PostgreSQL 12/13 setup (without pg_read_all_data)\nCREATE ROLE dbprovision_admin WITH\n    LOGIN\n    CREATEDB\n    CREATEROLE\n    PASSWORD 'your-secure-password';\n\nGRANT pg_signal_backend TO dbprovision_admin;\nGRANT CONNECT ON DATABASE template1 TO dbprovision_admin;\n\n-- For backups on PG12/13, grant SELECT on individual databases\n-- or use pg_dump with the database owner account\n</code></pre> <p>Complete Setup Guide</p> <p>See Admin Account Setup for complete SQL scripts, verification steps, and security recommendations.</p>"},{"location":"engines/postgresql/#databaseinstance","title":"DatabaseInstance","text":""},{"location":"engines/postgresql/#basic-configuration","title":"Basic Configuration","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: postgres-admin-credentials\n</code></pre>"},{"location":"engines/postgresql/#ssl-modes","title":"SSL Modes","text":"Mode Description <code>disable</code> No SSL <code>allow</code> Try SSL, allow non-SSL <code>prefer</code> Try SSL first (default) <code>require</code> Require SSL <code>verify-ca</code> Verify server certificate <code>verify-full</code> Verify server certificate and hostname"},{"location":"engines/postgresql/#tls-configuration","title":"TLS Configuration","text":"<pre><code>spec:\n  connection:\n    sslMode: verify-full\n    tls:\n      secretRef:\n        name: postgres-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"engines/postgresql/#database","title":"Database","text":""},{"location":"engines/postgresql/#extensions","title":"Extensions","text":"<p>PostgreSQL supports extensions for additional functionality:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  postgres:\n    encoding: UTF8\n    lcCollate: en_US.UTF-8\n    lcCtype: en_US.UTF-8\n    extensions:\n      - name: uuid-ossp\n        schema: public\n      - name: pgcrypto\n        schema: public\n      - name: pg_stat_statements\n        schema: public\n      - name: hstore\n        schema: extensions\n</code></pre>"},{"location":"engines/postgresql/#common-extensions","title":"Common Extensions","text":"Extension Purpose <code>uuid-ossp</code> UUID generation <code>pgcrypto</code> Cryptographic functions <code>pg_stat_statements</code> Query statistics <code>hstore</code> Key-value storage <code>postgis</code> Geographic objects <code>pg_trgm</code> Trigram similarity <code>btree_gin</code> GIN index for B-tree types"},{"location":"engines/postgresql/#schemas","title":"Schemas","text":"<p>Organize objects with schemas:</p> <pre><code>spec:\n  postgres:\n    schemas:\n      - name: app\n        owner: myapp_admin\n      - name: audit\n        owner: myapp_admin\n      - name: analytics\n        owner: analytics_role\n</code></pre>"},{"location":"engines/postgresql/#databaseuser","title":"DatabaseUser","text":""},{"location":"engines/postgresql/#basic-user","title":"Basic User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"engines/postgresql/#user-with-role-membership","title":"User with Role Membership","text":"<pre><code>spec:\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n  postgres:\n    connectionLimit: 20\n    inherit: true\n    inRoles:\n      - readonly_role\n      - analytics_role\n    configParameters:\n      search_path: \"app,public\"\n      statement_timeout: \"30000\"\n</code></pre>"},{"location":"engines/postgresql/#postgresql-user-options","title":"PostgreSQL User Options","text":"Field Type Description <code>login</code> bool Can login (default: true) <code>inherit</code> bool Inherit role privileges (default: true) <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>connectionLimit</code> int Max connections (-1 = unlimited) <code>inRoles</code> array Roles to inherit from <code>configParameters</code> map Session parameters"},{"location":"engines/postgresql/#databaserole","title":"DatabaseRole","text":""},{"location":"engines/postgresql/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: readonly\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"engines/postgresql/#role-hierarchy","title":"Role Hierarchy","text":"<pre><code># Base reader role\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: base-reader\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: base_reader\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n---\n# Writer role inherits from reader\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: base-writer\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: base_writer\n  postgres:\n    login: false\n    inRoles: [base_reader]\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"engines/postgresql/#databasegrant","title":"DatabaseGrant","text":""},{"location":"engines/postgresql/#direct-table-grants","title":"Direct Table Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    grants:\n      - database: myapp\n        schema: public\n        tables: [users, orders, products]\n        privileges: [SELECT, INSERT, UPDATE]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"engines/postgresql/#default-privileges","title":"Default Privileges","text":"<p>Apply privileges to future objects:</p> <pre><code>spec:\n  userRef:\n    name: myapp-user\n  postgres:\n    defaultPrivileges:\n      - database: myapp\n        schema: public\n        grantedBy: myapp_admin\n        objectType: tables\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n      - database: myapp\n        schema: public\n        grantedBy: myapp_admin\n        objectType: sequences\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"engines/postgresql/#privileges-reference","title":"Privileges Reference","text":"<p>Table Privileges:</p> Privilege Description <code>SELECT</code> Read rows <code>INSERT</code> Insert rows <code>UPDATE</code> Update rows <code>DELETE</code> Delete rows <code>TRUNCATE</code> Truncate table <code>REFERENCES</code> Create foreign keys <code>TRIGGER</code> Create triggers <p>Sequence Privileges:</p> Privilege Description <code>USAGE</code> Use currval/nextval <code>SELECT</code> Use currval <code>UPDATE</code> Use setval <p>Function Privileges:</p> Privilege Description <code>EXECUTE</code> Execute function"},{"location":"engines/postgresql/#backup-and-restore","title":"Backup and Restore","text":""},{"location":"engines/postgresql/#pg_dump-backup","title":"pg_dump Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      secretRef:\n        name: s3-credentials\n  postgres:\n    method: pg_dump\n    format: custom\n    jobs: 4\n    blobs: true\n    noOwner: false\n    noPrivileges: false\n</code></pre>"},{"location":"engines/postgresql/#backup-formats","title":"Backup Formats","text":"Format Description Parallel Restore <code>plain</code> SQL script No <code>custom</code> Compressed archive Yes <code>directory</code> Directory with files Yes <code>tar</code> Tar archive No"},{"location":"engines/postgresql/#restore-options","title":"Restore Options","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: myapp-restore\nspec:\n  backupRef:\n    name: myapp-backup\n  targetDatabaseRef:\n    name: myapp-database-restored\n  postgres:\n    dropExisting: false\n    dataOnly: false\n    schemaOnly: false\n    noOwner: true\n    jobs: 4\n    disableTriggers: true\n    analyze: true\n</code></pre>"},{"location":"engines/postgresql/#best-practices","title":"Best Practices","text":""},{"location":"engines/postgresql/#security","title":"Security","text":"<ol> <li>Use verify-full SSL mode in production</li> <li>Limit connection privileges with <code>connectionLimit</code></li> <li>Use roles for permission grouping</li> <li>Enable row-level security where appropriate</li> <li>Use separate users for different applications</li> </ol>"},{"location":"engines/postgresql/#performance","title":"Performance","text":"<ol> <li>Install pg_stat_statements for query analysis</li> <li>Set appropriate connection limits</li> <li>Use connection pooling (PgBouncer)</li> <li>Configure statement_timeout to prevent runaway queries</li> </ol>"},{"location":"engines/postgresql/#maintenance","title":"Maintenance","text":"<ol> <li>Schedule regular backups with retention</li> <li>Use ANALYZE after restores</li> <li>Monitor with pg_stat_statements</li> <li>Plan for extension upgrades</li> </ol>"},{"location":"engines/postgresql/#troubleshooting","title":"Troubleshooting","text":""},{"location":"engines/postgresql/#connection-issues","title":"Connection Issues","text":"<pre><code># Test connectivity\nkubectl run psql-test --rm -it --image=postgres:15 -- \\\n  psql \"postgresql://user:pass@host:5432/dbname?sslmode=require\"\n</code></pre>"},{"location":"engines/postgresql/#permission-denied","title":"Permission Denied","text":"<ul> <li>Verify role membership with <code>\\du</code> in psql</li> <li>Check grants with <code>\\dp tablename</code></li> <li>Ensure schema USAGE granted</li> </ul>"},{"location":"engines/postgresql/#extension-installation-failed","title":"Extension Installation Failed","text":"<ul> <li>Check PostgreSQL has the extension installed</li> <li>Verify user has CREATE EXTENSION privilege</li> <li>Some extensions require superuser</li> </ul>"},{"location":"examples/","title":"Examples","text":"<p>Ready-to-use examples for common scenarios.</p>"},{"location":"examples/#quick-links","title":"Quick Links","text":"<ul> <li>PostgreSQL Examples - Complete PostgreSQL setup</li> <li>MySQL Examples - Complete MySQL setup</li> <li>CockroachDB Examples - Complete CockroachDB setup</li> <li>Drift Detection Examples - Drift detection and correction patterns</li> <li>Advanced Examples - Cross-namespace, TLS, cloud backups</li> </ul>"},{"location":"examples/#sample-manifests","title":"Sample Manifests","text":"<p>All sample manifests are available in the repository:</p> <pre><code># Clone the repository\ngit clone https://github.com/panteparak/db-provision-operator.git\n\n# Navigate to examples\ncd db-provision-operator/DOCS/examples/\n</code></pre>"},{"location":"examples/#directory-structure","title":"Directory Structure","text":"<pre><code>DOCS/examples/\n\u251c\u2500\u2500 postgresql/\n\u2502   \u251c\u2500\u2500 01-credentials.yaml\n\u2502   \u251c\u2500\u2500 02-instance.yaml\n\u2502   \u251c\u2500\u2500 03-database.yaml\n\u2502   \u251c\u2500\u2500 04-user.yaml\n\u2502   \u251c\u2500\u2500 05-role.yaml\n\u2502   \u251c\u2500\u2500 06-grant.yaml\n\u2502   \u2514\u2500\u2500 07-backup.yaml\n\u251c\u2500\u2500 mysql/\n\u2502   \u251c\u2500\u2500 01-credentials.yaml\n\u2502   \u251c\u2500\u2500 02-instance.yaml\n\u2502   \u251c\u2500\u2500 03-database.yaml\n\u2502   \u251c\u2500\u2500 04-user.yaml\n\u2502   \u2514\u2500\u2500 05-grant.yaml\n\u251c\u2500\u2500 mariadb/\n\u2502   \u251c\u2500\u2500 01-credentials.yaml\n\u2502   \u251c\u2500\u2500 02-instance.yaml\n\u2502   \u2514\u2500\u2500 03-database.yaml\n\u251c\u2500\u2500 cockroachdb/\n\u2502   \u251c\u2500\u2500 01-credentials.yaml\n\u2502   \u251c\u2500\u2500 02-instance.yaml\n\u2502   \u251c\u2500\u2500 03-database.yaml\n\u2502   \u251c\u2500\u2500 04-user.yaml\n\u2502   \u251c\u2500\u2500 05-role.yaml\n\u2502   \u2514\u2500\u2500 06-grant.yaml\n\u2514\u2500\u2500 advanced/\n    \u251c\u2500\u2500 cross-namespace.yaml\n    \u251c\u2500\u2500 tls-connection.yaml\n    \u251c\u2500\u2500 backup-to-s3.yaml\n    \u2514\u2500\u2500 drift-detection.yaml\n</code></pre>"},{"location":"examples/#common-patterns","title":"Common Patterns","text":""},{"location":"examples/#minimal-setup","title":"Minimal Setup","text":"<p>The simplest setup requires:</p> <ol> <li>Admin credentials Secret</li> <li>DatabaseInstance</li> <li>Database</li> <li>DatabaseUser</li> </ol> <pre><code># 1. Credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: db-admin\ntype: Opaque\nstringData:\n  username: admin\n  password: secretpassword\n---\n# 2. Instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: my-db\nspec:\n  engine: postgres\n  connection:\n    host: postgres.default.svc\n    port: 5432\n    secretRef:\n      name: db-admin\n---\n# 3. Database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp\nspec:\n  instanceRef:\n    name: my-db\n---\n# 4. User\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: my-db\n  username: myapp\n  passwordSecret:\n    generate: true\n    secretName: myapp-credentials\n</code></pre>"},{"location":"examples/#production-setup","title":"Production Setup","text":"<p>Production deployments should include:</p> <ol> <li>TLS connections</li> <li>Role-based permissions</li> <li>Connection limits</li> <li>Backup schedules</li> <li>Deletion protection</li> </ol> <p>See Advanced Examples for production patterns.</p>"},{"location":"examples/#using-examples","title":"Using Examples","text":""},{"location":"examples/#apply-all-postgresql-examples","title":"Apply All PostgreSQL Examples","text":"<pre><code># Apply in order\nkubectl apply -f DOCS/examples/postgresql/01-credentials.yaml\nkubectl apply -f DOCS/examples/postgresql/02-instance.yaml\nkubectl apply -f DOCS/examples/postgresql/03-database.yaml\nkubectl apply -f DOCS/examples/postgresql/04-user.yaml\nkubectl apply -f DOCS/examples/postgresql/05-role.yaml\nkubectl apply -f DOCS/examples/postgresql/06-grant.yaml\n</code></pre>"},{"location":"examples/#verify-resources","title":"Verify Resources","text":"<pre><code># Check all resources\nkubectl get databaseinstances,databases,databaseusers,databaseroles,databasegrants\n\n# Check specific resource\nkubectl describe databaseinstance postgres-primary\n\n# Get generated credentials\nkubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d\n</code></pre>"},{"location":"examples/#clean-up","title":"Clean Up","text":"<pre><code># Delete in reverse order\nkubectl delete -f DOCS/examples/postgresql/06-grant.yaml\nkubectl delete -f DOCS/examples/postgresql/05-role.yaml\nkubectl delete -f DOCS/examples/postgresql/04-user.yaml\nkubectl delete -f DOCS/examples/postgresql/03-database.yaml\nkubectl delete -f DOCS/examples/postgresql/02-instance.yaml\nkubectl delete -f DOCS/examples/postgresql/01-credentials.yaml\n</code></pre>"},{"location":"examples/#next-steps","title":"Next Steps","text":"<ul> <li>PostgreSQL Examples - Detailed PostgreSQL setup</li> <li>MySQL Examples - Detailed MySQL setup</li> <li>CockroachDB Examples - Distributed SQL setup</li> <li>Drift Detection Examples - Configuration drift management</li> <li>Advanced Examples - Production patterns</li> </ul>"},{"location":"examples/advanced/","title":"Advanced Examples","text":"<p>Production patterns and advanced configurations.</p>"},{"location":"examples/advanced/#cross-namespace-access","title":"Cross-Namespace Access","text":""},{"location":"examples/advanced/#scenario","title":"Scenario","text":"<p>Database instance in <code>database</code> namespace, applications in <code>app-team-a</code> and <code>app-team-b</code> namespaces.</p>"},{"location":"examples/advanced/#database-namespace-setup","title":"Database Namespace Setup","text":"<pre><code># database/postgres-instance.yaml\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: shared-postgres\n  namespace: database\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: postgres-admin-credentials\n</code></pre>"},{"location":"examples/advanced/#application-namespace-resources","title":"Application Namespace Resources","text":"<pre><code># app-team-a/database.yaml\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: team-a-db\n  namespace: app-team-a\nspec:\n  instanceRef:\n    name: shared-postgres\n    namespace: database  # Cross-namespace reference\n  name: team_a\n  postgres:\n    encoding: UTF8\n---\n# app-team-a/user.yaml\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: team-a-user\n  namespace: app-team-a\nspec:\n  instanceRef:\n    name: shared-postgres\n    namespace: database\n  username: team_a_user\n  passwordSecret:\n    generate: true\n    secretName: team-a-db-credentials\n</code></pre>"},{"location":"examples/advanced/#rbac-configuration","title":"RBAC Configuration","text":"<pre><code># Allow app-team-a to reference database namespace resources\napiVersion: rbac.authorization.k8s.io/v1\nkind: Role\nmetadata:\n  name: database-reader\n  namespace: database\nrules:\n  - apiGroups: [\"dbops.dbprovision.io\"]\n    resources: [\"databaseinstances\"]\n    verbs: [\"get\", \"list\", \"watch\"]\n---\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  name: app-team-a-database-reader\n  namespace: database\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: database-reader\nsubjects:\n  - kind: ServiceAccount\n    name: default\n    namespace: app-team-a\n</code></pre>"},{"location":"examples/advanced/#tls-connections","title":"TLS Connections","text":""},{"location":"examples/advanced/#postgresql-with-tls","title":"PostgreSQL with TLS","text":"<pre><code># TLS certificates\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-tls\ntype: kubernetes.io/tls\ndata:\n  ca.crt: &lt;base64-encoded-ca-cert&gt;\n  tls.crt: &lt;base64-encoded-client-cert&gt;\n  tls.key: &lt;base64-encoded-client-key&gt;\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-tls\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: verify-full\n    secretRef:\n      name: postgres-admin-credentials\n    tls:\n      secretRef:\n        name: postgres-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"examples/advanced/#mysql-with-tls","title":"MySQL with TLS","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-tls\ntype: kubernetes.io/tls\ndata:\n  ca.crt: &lt;base64-encoded-ca-cert&gt;\n  tls.crt: &lt;base64-encoded-client-cert&gt;\n  tls.key: &lt;base64-encoded-client-key&gt;\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-tls\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin-credentials\n    tls:\n      enabled: true\n      secretRef:\n        name: mysql-tls\n        keys:\n          ca: ca.crt\n          cert: tls.crt\n          key: tls.key\n</code></pre>"},{"location":"examples/advanced/#cloud-backups","title":"Cloud Backups","text":""},{"location":"examples/advanced/#aws-s3","title":"AWS S3","text":"<pre><code># S3 credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: s3-credentials\ntype: Opaque\nstringData:\n  AWS_ACCESS_KEY_ID: AKIAIOSFODNN7EXAMPLE\n  AWS_SECRET_ACCESS_KEY: wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: production-backup\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"0 */6 * * *\"  # Every 6 hours\n  timezone: \"UTC\"\n  retention:\n    keepLast: 10\n    keepDaily: 7\n    keepWeekly: 4\n    keepMonthly: 6\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-company-db-backups\n        region: us-east-1\n        prefix: production/postgres\n        secretRef:\n          name: s3-credentials\n    compression:\n      enabled: true\n      algorithm: zstd\n    encryption:\n      enabled: true\n      algorithm: aes-256-gcm\n      secretRef:\n        name: backup-encryption-key\n</code></pre>"},{"location":"examples/advanced/#google-cloud-storage","title":"Google Cloud Storage","text":"<pre><code># GCS credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: gcs-credentials\ntype: Opaque\nstringData:\n  credentials.json: |\n    {\n      \"type\": \"service_account\",\n      \"project_id\": \"my-project\",\n      ...\n    }\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: production-backup-gcs\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"0 2 * * *\"\n  retention:\n    keepLast: 7\n  backupTemplate:\n    storage:\n      type: gcs\n      gcs:\n        bucket: my-company-db-backups\n        prefix: production/postgres\n        secretRef:\n          name: gcs-credentials\n          key: credentials.json\n    compression:\n      enabled: true\n</code></pre>"},{"location":"examples/advanced/#azure-blob-storage","title":"Azure Blob Storage","text":"<pre><code># Azure credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: azure-credentials\ntype: Opaque\nstringData:\n  AZURE_STORAGE_ACCOUNT: mystorageaccount\n  AZURE_STORAGE_KEY: &lt;storage-account-key&gt;\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: production-backup-azure\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"0 2 * * *\"\n  retention:\n    keepLast: 7\n  backupTemplate:\n    storage:\n      type: azure\n      azure:\n        container: db-backups\n        prefix: production/postgres\n        secretRef:\n          name: azure-credentials\n          keys:\n            accountName: AZURE_STORAGE_ACCOUNT\n            accountKey: AZURE_STORAGE_KEY\n    compression:\n      enabled: true\n</code></pre>"},{"location":"examples/advanced/#multi-tenant-setup","title":"Multi-Tenant Setup","text":""},{"location":"examples/advanced/#tenant-isolation-pattern","title":"Tenant Isolation Pattern","text":"<pre><code># Shared database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: multi-tenant-postgres\n  namespace: database\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-admin\n---\n# Per-tenant database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: tenant-acme\n  namespace: database\nspec:\n  instanceRef:\n    name: multi-tenant-postgres\n  name: tenant_acme\n  deletionProtection: true\n  postgres:\n    encoding: UTF8\n    schemas:\n      - name: app\n---\n# Per-tenant user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: tenant-acme-user\n  namespace: database\nspec:\n  instanceRef:\n    name: multi-tenant-postgres\n  username: tenant_acme_user\n  passwordSecret:\n    generate: true\n    secretName: tenant-acme-credentials\n  postgres:\n    connectionLimit: 20\n---\n# Per-tenant grants (isolated to their database)\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: tenant-acme-grants\n  namespace: database\nspec:\n  userRef:\n    name: tenant-acme-user\n  postgres:\n    grants:\n      - database: tenant_acme\n        schema: app\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n      - database: tenant_acme\n        schema: app\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT, UPDATE]\n</code></pre>"},{"location":"examples/advanced/#high-availability","title":"High Availability","text":""},{"location":"examples/advanced/#read-replica-configuration","title":"Read Replica Configuration","text":"<pre><code># Primary instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres-primary.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-primary-credentials\n---\n# Read replica instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-replica\nspec:\n  engine: postgres\n  connection:\n    host: postgres-replica.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-replica-credentials\n---\n# Read-only user on replica\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: reporting-user\nspec:\n  instanceRef:\n    name: postgres-replica  # Points to replica\n  username: reporting\n  passwordSecret:\n    generate: true\n    secretName: reporting-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp?sslmode=require\"\n</code></pre>"},{"location":"examples/advanced/#disaster-recovery","title":"Disaster Recovery","text":""},{"location":"examples/advanced/#point-in-time-recovery-setup","title":"Point-in-Time Recovery Setup","text":"<pre><code># Frequent backups for minimal data loss\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: pitr-backup\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"*/15 * * * *\"  # Every 15 minutes\n  retention:\n    keepLast: 96  # 24 hours of 15-minute backups\n    keepDaily: 7\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: pitr-backups\n        prefix: production\n        secretRef:\n          name: s3-credentials\n    postgres:\n      format: custom\n      jobs: 4\n---\n# Daily full backups\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: daily-full-backup\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"0 0 * * *\"  # Midnight\n  retention:\n    keepLast: 30\n    keepMonthly: 12\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: full-backups\n        prefix: production\n        secretRef:\n          name: s3-credentials\n    compression:\n      enabled: true\n      algorithm: zstd\n    encryption:\n      enabled: true\n      secretRef:\n        name: backup-encryption-key\n</code></pre>"},{"location":"examples/advanced/#migration-patterns","title":"Migration Patterns","text":""},{"location":"examples/advanced/#database-migration-from-external-source","title":"Database Migration from External Source","text":"<pre><code># Step 1: Create instance pointing to external database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: external-postgres\nspec:\n  engine: postgres\n  connection:\n    host: external-db.example.com\n    port: 5432\n    secretRef:\n      name: external-db-credentials\n---\n# Step 2: Backup from external\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: migration-backup\nspec:\n  databaseRef:\n    name: external-database  # References external\n  storage:\n    type: s3\n    s3:\n      bucket: migration-backups\n      secretRef:\n        name: s3-credentials\n---\n# Step 3: Restore to internal\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: migration-restore\nspec:\n  backupRef:\n    name: migration-backup\n  targetDatabaseRef:\n    name: internal-database  # New internal database\n  createTarget: true\n  postgres:\n    noOwner: true\n    analyze: true\n</code></pre>"},{"location":"examples/advanced/#monitoring-integration","title":"Monitoring Integration","text":""},{"location":"examples/advanced/#prometheus-servicemonitor","title":"Prometheus ServiceMonitor","text":"<pre><code># Enable metrics in operator deployment\n# Then create ServiceMonitor\napiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: db-provision-operator\n  labels:\n    app: db-provision-operator\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: db-provision-operator\n  endpoints:\n    - port: metrics\n      interval: 30s\n</code></pre>"},{"location":"examples/advanced/#custom-metrics-user","title":"Custom Metrics User","text":"<pre><code># User for Prometheus postgres_exporter\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: prometheus-exporter\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: prometheus\n  passwordSecret:\n    generate: true\n    secretName: prometheus-exporter-credentials\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: prometheus-grants\nspec:\n  userRef:\n    name: prometheus-exporter\n  postgres:\n    grants:\n      - database: postgres\n        schema: pg_catalog\n        functions: [pg_stat_statements]\n        privileges: [EXECUTE]\n</code></pre>"},{"location":"examples/cockroachdb/","title":"CockroachDB Examples","text":"<p>Complete examples for CockroachDB database provisioning.</p>"},{"location":"examples/cockroachdb/#development-setup-insecure-mode","title":"Development Setup (Insecure Mode)","text":""},{"location":"examples/cockroachdb/#step-1-admin-credentials-empty-password","title":"Step 1: Admin Credentials (Empty Password)","text":"<p>In insecure mode, CockroachDB doesn't support password authentication:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: cockroach-admin-credentials\ntype: Opaque\nstringData:\n  username: dbprovision_admin\n  password: \"\"  # Must be empty for insecure mode\n</code></pre>"},{"location":"examples/cockroachdb/#step-2-database-instance-insecure","title":"Step 2: Database Instance (Insecure)","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: cockroach-cluster\nspec:\n  engine: cockroachdb\n  connection:\n    host: cockroachdb.database.svc.cluster.local\n    port: 26257\n    database: defaultdb\n    sslMode: disable  # Required for insecure mode\n    secretRef:\n      name: cockroach-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n    timeoutSeconds: 5\n</code></pre>"},{"location":"examples/cockroachdb/#step-3-database","title":"Step 3: Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  name: myapp\n  deletionPolicy: Retain\n</code></pre>"},{"location":"examples/cockroachdb/#step-4-application-user-no-password-in-insecure-mode","title":"Step 4: Application User (No Password in Insecure Mode)","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  username: myapp_user\n  # In insecure mode, user is created without password\n  # Password secret will contain empty password\n  passwordSecret:\n    generate: false  # Cannot generate in insecure mode\n    secretName: myapp-user-credentials\n  postgres:\n    connectionLimit: 50\n</code></pre>"},{"location":"examples/cockroachdb/#production-setup-secure-mode","title":"Production Setup (Secure Mode)","text":""},{"location":"examples/cockroachdb/#step-1-tls-certificates","title":"Step 1: TLS Certificates","text":"<p>Create a secret with TLS certificates:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: cockroach-tls\ntype: kubernetes.io/tls\ndata:\n  ca.crt: &lt;base64-encoded-ca-certificate&gt;\n  tls.crt: &lt;base64-encoded-client-certificate&gt;\n  tls.key: &lt;base64-encoded-client-key&gt;\n</code></pre>"},{"location":"examples/cockroachdb/#step-2-admin-credentials","title":"Step 2: Admin Credentials","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: cockroach-admin-credentials\ntype: Opaque\nstringData:\n  username: dbprovision_admin\n  password: your-secure-admin-password\n</code></pre>"},{"location":"examples/cockroachdb/#step-3-database-instance-secure","title":"Step 3: Database Instance (Secure)","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: cockroach-cluster\nspec:\n  engine: cockroachdb\n  connection:\n    host: cockroachdb.database.svc.cluster.local\n    port: 26257\n    database: defaultdb\n    sslMode: verify-full\n    secretRef:\n      name: cockroach-admin-credentials\n  tls:\n    secretRef:\n      name: cockroach-tls\n      keys:\n        ca: ca.crt\n        cert: tls.crt\n        key: tls.key\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n</code></pre>"},{"location":"examples/cockroachdb/#step-4-production-database","title":"Step 4: Production Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: production-db\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  name: production\n  deletionProtection: true\n  deletionPolicy: Retain\n  driftPolicy:\n    mode: detect\n    interval: \"5m\"\n</code></pre>"},{"location":"examples/cockroachdb/#step-5-application-user","title":"Step 5: Application User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: app-user\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  username: app_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: app-user-credentials\n    secretTemplate:\n      labels:\n        app: myapp\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/production?sslmode=verify-full\"\n  postgres:\n    connectionLimit: 100\n</code></pre>"},{"location":"examples/cockroachdb/#role-based-access","title":"Role-Based Access","text":""},{"location":"examples/cockroachdb/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readonly\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  roleName: myapp_readonly\n  postgres:\n    login: false\n</code></pre>"},{"location":"examples/cockroachdb/#read-write-role","title":"Read-Write Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readwrite\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  roleName: myapp_readwrite\n  postgres:\n    login: false\n    inRoles: [myapp_readonly]\n</code></pre>"},{"location":"examples/cockroachdb/#grants","title":"Grants","text":"<pre><code>---\n# Read-only grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: readonly-grants\nspec:\n  roleRef:\n    name: myapp-readonly\n  postgres:\n    grants:\n      - database: production\n        privileges: [CONNECT]\n      - database: production\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n---\n# Read-write grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: readwrite-grants\nspec:\n  roleRef:\n    name: myapp-readwrite\n  postgres:\n    grants:\n      - database: production\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n---\n# Assign role to user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: user-role-assignment\nspec:\n  userRef:\n    name: app-user\n  postgres:\n    roles:\n      - myapp_readwrite\n</code></pre>"},{"location":"examples/cockroachdb/#backup-configuration","title":"Backup Configuration","text":"<p>CockroachDB uses native <code>BACKUP</code> command instead of pg_dump.</p>"},{"location":"examples/cockroachdb/#one-time-backup-to-s3","title":"One-Time Backup to S3","text":"<pre><code># S3 credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: s3-backup-credentials\ntype: Opaque\nstringData:\n  AWS_ACCESS_KEY_ID: your-access-key\n  AWS_SECRET_ACCESS_KEY: your-secret-key\n---\n# Backup\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: production-backup\nspec:\n  databaseRef:\n    name: production-db\n  storage:\n    type: s3\n    s3:\n      bucket: my-cockroach-backups\n      region: us-east-1\n      prefix: cockroach/production\n      secretRef:\n        name: s3-backup-credentials\n  ttl: \"720h\"  # 30 days\n</code></pre>"},{"location":"examples/cockroachdb/#scheduled-backups","title":"Scheduled Backups","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: production-daily\nspec:\n  databaseRef:\n    name: production-db\n  schedule: \"0 2 * * *\"  # Daily at 2 AM UTC\n  timezone: \"UTC\"\n  retention:\n    keepLast: 7\n    keepDaily: 7\n    keepWeekly: 4\n  concurrencyPolicy: Forbid\n  deletionProtection: true\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-cockroach-backups\n        region: us-east-1\n        prefix: cockroach/production/scheduled\n        secretRef:\n          name: s3-backup-credentials\n</code></pre>"},{"location":"examples/cockroachdb/#restore-from-backup","title":"Restore from Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: production-restore\nspec:\n  backupRef:\n    name: production-backup\n  targetDatabaseRef:\n    name: production-restored\n  createTarget: true\n</code></pre>"},{"location":"examples/cockroachdb/#complete-application-stack","title":"Complete Application Stack","text":"<p>Full production-ready example:</p> <pre><code>---\n# TLS certificates (create separately)\napiVersion: v1\nkind: Secret\nmetadata:\n  name: cockroach-tls\ntype: kubernetes.io/tls\ndata:\n  ca.crt: &lt;base64-ca-cert&gt;\n  tls.crt: &lt;base64-client-cert&gt;\n  tls.key: &lt;base64-client-key&gt;\n---\n# Admin credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: cockroach-admin\ntype: Opaque\nstringData:\n  username: dbprovision_admin\n  password: super-secret-admin-password\n---\n# S3 backup credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: s3-credentials\ntype: Opaque\nstringData:\n  AWS_ACCESS_KEY_ID: your-access-key\n  AWS_SECRET_ACCESS_KEY: your-secret-key\n---\n# Database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: cockroach-cluster\nspec:\n  engine: cockroachdb\n  connection:\n    host: cockroachdb.database.svc.cluster.local\n    port: 26257\n    database: defaultdb\n    sslMode: verify-full\n    secretRef:\n      name: cockroach-admin\n  tls:\n    secretRef:\n      name: cockroach-tls\n      keys:\n        ca: ca.crt\n        cert: tls.crt\n        key: tls.key\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n  driftPolicy:\n    mode: detect\n    interval: \"5m\"\n---\n# Application database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-db\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  name: myapp\n  deletionProtection: true\n  deletionPolicy: Retain\n---\n# Read-only role\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readonly\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  roleName: myapp_readonly\n  postgres:\n    login: false\n---\n# Read-write role\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readwrite\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  roleName: myapp_readwrite\n  postgres:\n    login: false\n    inRoles: [myapp_readonly]\n---\n# Role grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: readonly-grants\nspec:\n  roleRef:\n    name: myapp-readonly\n  postgres:\n    grants:\n      - database: myapp\n        privileges: [CONNECT]\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n---\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: readwrite-grants\nspec:\n  roleRef:\n    name: myapp-readwrite\n  postgres:\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n---\n# Application user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: cockroach-cluster\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp?sslmode=verify-full\"\n  postgres:\n    connectionLimit: 100\n---\n# Assign roles to user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-roles\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    roles:\n      - myapp_readwrite\n---\n# Scheduled backups\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: myapp-daily-backup\nspec:\n  databaseRef:\n    name: myapp-db\n  schedule: \"0 2 * * *\"\n  timezone: \"UTC\"\n  retention:\n    keepLast: 7\n    keepDaily: 7\n    keepWeekly: 4\n    keepMonthly: 3\n  deletionProtection: true\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: myapp-backups\n        region: us-east-1\n        prefix: cockroach/myapp\n        secretRef:\n          name: s3-credentials\n</code></pre>"},{"location":"examples/cockroachdb/#verify-setup","title":"Verify Setup","text":"<pre><code># Check instance status\nkubectl get databaseinstance cockroach-cluster\n\n# Check all resources\nkubectl get databases,databaseusers,databaseroles,databasegrants\n\n# Get connection string\nkubectl get secret myapp-credentials -o jsonpath='{.data.DATABASE_URL}' | base64 -d\n\n# Test connection (using cockroach client)\nkubectl run cockroach-test --rm -it --image=cockroachdb/cockroach:v24.1.0 -- \\\n  sql --url=\"$(kubectl get secret myapp-credentials -o jsonpath='{.data.DATABASE_URL}' | base64 -d)\"\n\n# Check CockroachDB jobs (for backups)\nkubectl exec -it cockroachdb-0 -- cockroach sql --insecure -e \"SHOW JOBS;\"\n\n# View backup status\nkubectl get databasebackup,databasebackupschedule\n</code></pre>"},{"location":"examples/cockroachdb/#troubleshooting","title":"Troubleshooting","text":""},{"location":"examples/cockroachdb/#insecure-mode-connection-issues","title":"Insecure Mode Connection Issues","text":"<pre><code># Verify instance uses sslMode: disable\nkubectl get databaseinstance cockroach-cluster -o jsonpath='{.spec.connection.sslMode}'\n\n# Verify empty password in secret\nkubectl get secret cockroach-admin-credentials -o jsonpath='{.data.password}' | base64 -d\n# Should return empty string\n\n# Test connection manually\nkubectl run cockroach-test --rm -it --image=cockroachdb/cockroach:v24.1.0 -- \\\n  sql --insecure --host=cockroachdb:26257 -e \"SELECT 1;\"\n</code></pre>"},{"location":"examples/cockroachdb/#permission-issues","title":"Permission Issues","text":"<pre><code># Check if admin has required privileges\nkubectl exec -it cockroachdb-0 -- cockroach sql --insecure -e \"SHOW GRANTS FOR dbprovision_admin;\"\n\n# Grant missing privileges\nkubectl exec -it cockroachdb-0 -- cockroach sql --insecure -e \"\n  ALTER USER dbprovision_admin WITH CREATEDB CREATEROLE;\n  GRANT admin TO dbprovision_admin;\n\"\n</code></pre>"},{"location":"examples/cockroachdb/#backup-issues","title":"Backup Issues","text":"<pre><code># Check backup job status in CockroachDB\nkubectl exec -it cockroachdb-0 -- cockroach sql --insecure -e \"\n  SELECT * FROM [SHOW JOBS] WHERE job_type = 'BACKUP' ORDER BY created DESC LIMIT 5;\n\"\n\n# Check for failed jobs\nkubectl exec -it cockroachdb-0 -- cockroach sql --insecure -e \"\n  SELECT * FROM [SHOW JOBS] WHERE status = 'failed' AND job_type = 'BACKUP';\n\"\n</code></pre>"},{"location":"examples/drift-detection/","title":"Drift Detection Examples","text":"<p>Examples demonstrating drift detection and correction configurations.</p>"},{"location":"examples/drift-detection/#basic-drift-detection","title":"Basic Drift Detection","text":""},{"location":"examples/drift-detection/#detect-only-mode","title":"Detect-Only Mode","text":"<p>Monitor for configuration drift without automatic correction:</p> <pre><code>---\n# Instance with detect mode as default\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: postgres-admin-credentials\n  driftPolicy:\n    mode: detect\n    interval: \"5m\"\n---\n# Database inherits detect mode from instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: production-db\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: production\n  deletionProtection: true\n</code></pre> <p>Check drift status:</p> <pre><code># View drift detection results\nkubectl get database production-db -o jsonpath='{.status.drift}'\n\n# Check for DriftDetected events\nkubectl get events --field-selector reason=DriftDetected\n</code></pre>"},{"location":"examples/drift-detection/#auto-correct-mode","title":"Auto-Correct Mode","text":"<p>Automatically fix configuration drift:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: dev-db\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: development\n  driftPolicy:\n    mode: correct\n    interval: \"2m\"\n</code></pre> <p>Monitor corrections:</p> <pre><code># Watch for correction events\nkubectl get events --field-selector reason=DriftCorrected -w\n</code></pre>"},{"location":"examples/drift-detection/#environment-based-policies","title":"Environment-Based Policies","text":""},{"location":"examples/drift-detection/#multi-environment-setup","title":"Multi-Environment Setup","text":"<p>Different drift policies per environment:</p> <pre><code>---\n# Development: Auto-correct everything\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: dev-db\n  labels:\n    environment: development\n  annotations:\n    # Allow destructive corrections in dev\n    dbops.dbprovision.io/allow-destructive-drift: \"true\"\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: development\n  driftPolicy:\n    mode: correct\n    interval: \"1m\"\n---\n# Staging: Auto-correct non-destructive only\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: staging-db\n  labels:\n    environment: staging\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: staging\n  deletionProtection: true\n  driftPolicy:\n    mode: correct\n    interval: \"5m\"\n---\n# Production: Detect only, alert humans\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: production-db\n  labels:\n    environment: production\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: production\n  deletionProtection: true\n  deletionPolicy: Snapshot\n  driftPolicy:\n    mode: detect\n    interval: \"5m\"\n</code></pre>"},{"location":"examples/drift-detection/#user-and-role-drift-detection","title":"User and Role Drift Detection","text":""},{"location":"examples/drift-detection/#user-configuration-drift","title":"User Configuration Drift","text":"<pre><code>---\n# User with drift detection\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: app-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: app_user\n  passwordSecret:\n    generate: true\n    secretName: app-user-credentials\n  postgres:\n    connectionLimit: 100\n  driftPolicy:\n    mode: detect\n    interval: \"10m\"\n</code></pre> <p>Simulating drift (for testing):</p> <pre><code>-- Manually change connection limit\nALTER ROLE app_user WITH CONNECTION LIMIT 50;\n</code></pre> <p>Viewing drift:</p> <pre><code>kubectl get databaseuser app-user -o jsonpath='{.status.drift}' | jq\n</code></pre> <p>Expected output:</p> <pre><code>{\n  \"detected\": true,\n  \"lastChecked\": \"2024-01-15T10:30:00Z\",\n  \"diffs\": [\n    {\n      \"field\": \"connectionLimit\",\n      \"expected\": \"100\",\n      \"actual\": \"50\",\n      \"destructive\": false,\n      \"immutable\": false\n    }\n  ]\n}\n</code></pre>"},{"location":"examples/drift-detection/#role-drift-detection","title":"Role Drift Detection","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: app_readonly\n  postgres:\n    login: false\n    inherit: true\n    inRoles:\n      - pg_read_all_data\n  driftPolicy:\n    mode: correct\n    interval: \"5m\"\n</code></pre>"},{"location":"examples/drift-detection/#grant-drift-detection","title":"Grant Drift Detection","text":""},{"location":"examples/drift-detection/#database-grants","title":"Database Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: app-grants\nspec:\n  userRef:\n    name: app-user\n  postgres:\n    grants:\n      - database: production\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n  driftPolicy:\n    mode: detect\n    interval: \"15m\"\n</code></pre> <p>Check for privilege drift:</p> <pre><code>-- View current grants\nSELECT grantee, privilege_type, table_name\nFROM information_schema.table_privileges\nWHERE grantee = 'app_user';\n</code></pre>"},{"location":"examples/drift-detection/#resource-discovery","title":"Resource Discovery","text":""},{"location":"examples/drift-detection/#enable-discovery-on-instance","title":"Enable Discovery on Instance","text":"<p>Find unmanaged database resources:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: postgres-admin-credentials\n  driftPolicy:\n    mode: detect\n    interval: \"5m\"\n  discovery:\n    enabled: true\n    interval: \"30m\"\n</code></pre> <p>View discovered resources:</p> <pre><code>kubectl get databaseinstance postgres-primary -o jsonpath='{.status.discoveredResources}' | jq\n</code></pre> <p>Expected output:</p> <pre><code>{\n  \"lastScan\": \"2024-01-15T10:00:00Z\",\n  \"databases\": [\n    {\n      \"name\": \"legacy_app\",\n      \"discovered\": \"2024-01-15T10:00:00Z\",\n      \"adopted\": false\n    }\n  ],\n  \"users\": [\n    {\n      \"name\": \"old_admin\",\n      \"discovered\": \"2024-01-15T10:00:00Z\",\n      \"adopted\": false\n    }\n  ]\n}\n</code></pre>"},{"location":"examples/drift-detection/#adopt-discovered-resources","title":"Adopt Discovered Resources","text":"<p>Bring discovered resources under management:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\n  annotations:\n    # Adopt these discovered databases\n    dbops.dbprovision.io/adopt-databases: \"legacy_app\"\n    # Adopt these discovered users\n    dbops.dbprovision.io/adopt-users: \"old_admin\"\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: postgres-admin-credentials\n  discovery:\n    enabled: true\n    interval: \"30m\"\n</code></pre> <p>Verify adoption:</p> <pre><code># Check for newly created CRs\nkubectl get databases -l dbops.dbprovision.io/adopted=true\nkubectl get databaseusers -l dbops.dbprovision.io/adopted=true\n</code></pre>"},{"location":"examples/drift-detection/#alerting-on-drift","title":"Alerting on Drift","text":""},{"location":"examples/drift-detection/#prometheus-rules","title":"Prometheus Rules","text":"<pre><code>apiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: drift-detection-alerts\nspec:\n  groups:\n    - name: drift-detection\n      rules:\n        # Alert on any drift detected in production\n        - alert: ProductionDriftDetected\n          expr: |\n            dbprovision_drift_detected{\n              namespace=\"production\"\n            } == 1\n          for: 5m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Configuration drift detected in production\"\n            description: \"{{ $labels.kind }}/{{ $labels.name }} has configuration drift\"\n\n        # Alert on drift correction failures\n        - alert: DriftCorrectionFailed\n          expr: |\n            increase(kubernetes_events_total{\n              reason=\"DriftCorrectionFailed\"\n            }[15m]) &gt; 0\n          for: 0m\n          labels:\n            severity: critical\n          annotations:\n            summary: \"Drift correction failed\"\n            description: \"Failed to correct drift for {{ $labels.name }}\"\n</code></pre>"},{"location":"examples/drift-detection/#event-based-alerting-with-event-exporter","title":"Event-Based Alerting with event-exporter","text":"<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: event-exporter-config\ndata:\n  config.yaml: |\n    route:\n      routes:\n        - match:\n            - reason: \"DriftDetected\"\n            - reason: \"DriftCorrectionFailed\"\n          receiver: \"slack-alerts\"\n    receivers:\n      - name: \"slack-alerts\"\n        slack:\n          endpoint: \"https://hooks.slack.com/services/...\"\n          channel: \"#database-alerts\"\n          message: |\n            :warning: *{{ .Reason }}*\n            Resource: {{ .InvolvedObject.Kind }}/{{ .InvolvedObject.Name }}\n            Namespace: {{ .InvolvedObject.Namespace }}\n            Message: {{ .Message }}\n</code></pre>"},{"location":"examples/drift-detection/#complete-drift-detection-setup","title":"Complete Drift Detection Setup","text":"<p>Full example with all components:</p> <pre><code>---\n# Instance with detection and discovery\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: postgres-admin\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n  driftPolicy:\n    mode: detect\n    interval: \"5m\"\n  discovery:\n    enabled: true\n    interval: \"30m\"\n---\n# Production database: detect only\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: production-db\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: production\n  deletionProtection: true\n  deletionPolicy: Snapshot\n  # Inherits detect mode from instance\n---\n# Development database: auto-correct\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: dev-db\n  annotations:\n    dbops.dbprovision.io/allow-destructive-drift: \"true\"\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: development\n  driftPolicy:\n    mode: correct\n    interval: \"1m\"\n---\n# Production user: detect drift\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: prod-app-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: prod_app\n  passwordSecret:\n    generate: true\n    secretName: prod-app-credentials\n  postgres:\n    connectionLimit: 100\n  driftPolicy:\n    mode: detect\n    interval: \"10m\"\n---\n# Production grants: detect drift\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: prod-app-grants\nspec:\n  userRef:\n    name: prod-app-user\n  postgres:\n    grants:\n      - database: production\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n  driftPolicy:\n    mode: detect\n    interval: \"15m\"\n</code></pre>"},{"location":"examples/drift-detection/#verify-drift-detection","title":"Verify Drift Detection","text":"<pre><code># Check all resources for drift\nfor resource in database databaseuser databaserole databasegrant; do\n  echo \"=== $resource ===\"\n  kubectl get $resource -o custom-columns='NAME:.metadata.name,DRIFT:.status.drift.detected,LAST_CHECK:.status.drift.lastChecked'\ndone\n\n# View drift details\nkubectl get database production-db -o jsonpath='{.status.drift.diffs}' | jq\n\n# Watch for drift events\nkubectl get events --field-selector reason=DriftDetected -w\n</code></pre>"},{"location":"examples/mysql/","title":"MySQL Examples","text":"<p>Complete examples for MySQL database provisioning.</p>"},{"location":"examples/mysql/#basic-setup","title":"Basic Setup","text":""},{"location":"examples/mysql/#step-1-admin-credentials","title":"Step 1: Admin Credentials","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-admin-credentials\ntype: Opaque\nstringData:\n  username: root\n  password: your-admin-password\n</code></pre>"},{"location":"examples/mysql/#step-2-database-instance","title":"Step 2: Database Instance","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n    timeoutSeconds: 5\n</code></pre>"},{"location":"examples/mysql/#step-3-database","title":"Step 3: Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  deletionPolicy: Retain\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre>"},{"location":"examples/mysql/#step-4-application-user","title":"Step 4: Application User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n    secretTemplate:\n      labels:\n        app: myapp\n      data:\n        DATABASE_URL: \"mysql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp\"\n        JDBC_URL: \"jdbc:mysql://{{ .Host }}:{{ .Port }}/myapp?user={{ .Username }}&amp;password={{ .Password }}\"\n</code></pre>"},{"location":"examples/mysql/#step-5-user-grants","title":"Step 5: User Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"examples/mysql/#role-based-access-mysql-80","title":"Role-Based Access (MySQL 8.0+)","text":""},{"location":"examples/mysql/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readonly\nspec:\n  instanceRef:\n    name: mysql-primary\n  roleName: myapp_readonly\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT]\n</code></pre>"},{"location":"examples/mysql/#read-write-role","title":"Read-Write Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readwrite\nspec:\n  instanceRef:\n    name: mysql-primary\n  roleName: myapp_readwrite\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"examples/mysql/#assign-role-to-user","title":"Assign Role to User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-roles\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    roles:\n      - myapp_readwrite\n</code></pre>"},{"location":"examples/mysql/#host-restricted-users","title":"Host-Restricted Users","text":""},{"location":"examples/mysql/#application-user-with-host-restrictions","title":"Application User with Host Restrictions","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: app-user-restricted\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: app_user\n  passwordSecret:\n    generate: true\n    secretName: app-user-credentials\n  mysql:\n    maxUserConnections: 100\n    authPlugin: caching_sha2_password\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.%\"      # Internal network\n      - \"192.168.1.%\"   # Secondary network\n</code></pre>"},{"location":"examples/mysql/#admin-user-for-specific-host","title":"Admin User for Specific Host","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: admin-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: admin\n  passwordSecret:\n    generate: true\n    length: 48\n    secretName: admin-credentials\n  mysql:\n    authPlugin: caching_sha2_password\n    requireSSL: true\n    allowedHosts:\n      - \"10.0.0.1\"  # Only from specific admin host\n</code></pre>"},{"location":"examples/mysql/#table-level-permissions","title":"Table-Level Permissions","text":""},{"location":"examples/mysql/#granular-table-access","title":"Granular Table Access","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: reporting-user-grants\nspec:\n  userRef:\n    name: reporting-user\n  mysql:\n    grants:\n      # Full read access to specific tables\n      - level: table\n        database: myapp\n        table: orders\n        privileges: [SELECT]\n      - level: table\n        database: myapp\n        table: customers\n        privileges: [SELECT]\n      - level: table\n        database: myapp\n        table: products\n        privileges: [SELECT]\n      # No access to sensitive tables (users, payments, etc.)\n</code></pre>"},{"location":"examples/mysql/#service-account-with-limited-write","title":"Service Account with Limited Write","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: order-service-grants\nspec:\n  userRef:\n    name: order-service\n  mysql:\n    grants:\n      # Read from reference tables\n      - level: table\n        database: myapp\n        table: products\n        privileges: [SELECT]\n      - level: table\n        database: myapp\n        table: customers\n        privileges: [SELECT]\n      # Full access to orders\n      - level: table\n        database: myapp\n        table: orders\n        privileges: [SELECT, INSERT, UPDATE]\n      # Insert only to audit\n      - level: table\n        database: myapp\n        table: order_audit\n        privileges: [INSERT]\n</code></pre>"},{"location":"examples/mysql/#backup-configuration","title":"Backup Configuration","text":""},{"location":"examples/mysql/#one-time-backup","title":"One-Time Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-manual-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-database-backups\n      region: us-east-1\n      prefix: mysql/myapp\n      secretRef:\n        name: s3-backup-credentials\n  compression:\n    enabled: true\n    algorithm: gzip\n  mysql:\n    method: mysqldump\n    singleTransaction: true\n    routines: true\n    triggers: true\n  ttl: \"720h\"\n</code></pre>"},{"location":"examples/mysql/#scheduled-backups","title":"Scheduled Backups","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: myapp-daily-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  schedule: \"0 3 * * *\"  # Daily at 3 AM\n  timezone: \"UTC\"\n  retention:\n    keepLast: 7\n    keepDaily: 7\n    keepWeekly: 4\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-database-backups\n        region: us-east-1\n        prefix: mysql/myapp/scheduled\n        secretRef:\n          name: s3-backup-credentials\n    compression:\n      enabled: true\n      algorithm: gzip\n    mysql:\n      method: mysqldump\n      singleTransaction: true\n      routines: true\n      triggers: true\n</code></pre>"},{"location":"examples/mysql/#complete-application-stack","title":"Complete Application Stack","text":""},{"location":"examples/mysql/#full-example","title":"Full Example","text":"<pre><code>---\n# Admin credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: mysql-admin\ntype: Opaque\nstringData:\n  username: root\n  password: super-secret-admin-password\n---\n# Database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    database: mysql\n    secretRef:\n      name: mysql-admin\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n---\n# Application database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-db\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  deletionPolicy: Retain\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n---\n# Application user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"mysql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp\"\n  mysql:\n    maxUserConnections: 100\n    authPlugin: caching_sha2_password\n    allowedHosts:\n      - \"10.0.0.%\"\n---\n# User grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grant\nspec:\n  userRef:\n    name: myapp-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n---\n# Read-only user for reporting\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: reporting-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: reporting\n  passwordSecret:\n    generate: true\n    secretName: reporting-credentials\n  mysql:\n    maxUserConnections: 10\n---\n# Reporting grants\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: reporting-grant\nspec:\n  userRef:\n    name: reporting-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT]\n</code></pre>"},{"location":"examples/mysql/#verify-setup","title":"Verify Setup","text":"<pre><code># Check instance status\nkubectl get databaseinstance mysql-primary\n\n# Check all resources\nkubectl get databases,databaseusers,databasegrants\n\n# Get connection info\nkubectl get secret myapp-credentials -o jsonpath='{.data.DATABASE_URL}' | base64 -d\n\n# Test connection\nkubectl run mysql-test --rm -it --image=mysql:8.0 -- \\\n  mysql -h mysql.database.svc.cluster.local -u myapp_user -p myapp\n</code></pre>"},{"location":"examples/mysql/#mariadb-compatibility","title":"MariaDB Compatibility","text":"<p>These examples work with MariaDB by changing the engine:</p> <pre><code>spec:\n  engine: mariadb  # Instead of mysql\n</code></pre> <p>All MySQL configuration options are compatible with MariaDB.</p>"},{"location":"examples/postgresql/","title":"PostgreSQL Examples","text":"<p>Complete examples for PostgreSQL database provisioning.</p>"},{"location":"examples/postgresql/#basic-setup","title":"Basic Setup","text":""},{"location":"examples/postgresql/#step-1-admin-credentials","title":"Step 1: Admin Credentials","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin-credentials\ntype: Opaque\nstringData:\n  username: postgres\n  password: your-admin-password\n</code></pre>"},{"location":"examples/postgresql/#step-2-database-instance","title":"Step 2: Database Instance","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: prefer\n    secretRef:\n      name: postgres-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n    timeoutSeconds: 5\n</code></pre>"},{"location":"examples/postgresql/#step-3-database","title":"Step 3: Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  deletionPolicy: Retain\n  postgres:\n    encoding: UTF8\n    extensions:\n      - name: uuid-ossp\n        schema: public\n      - name: pgcrypto\n        schema: public\n</code></pre>"},{"location":"examples/postgresql/#step-4-application-user","title":"Step 4: Application User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n    secretTemplate:\n      labels:\n        app: myapp\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp?sslmode=prefer\"\n</code></pre>"},{"location":"examples/postgresql/#role-based-access","title":"Role-Based Access","text":""},{"location":"examples/postgresql/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readonly\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: myapp_readonly\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"examples/postgresql/#read-write-role","title":"Read-Write Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readwrite\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: myapp_readwrite\n  postgres:\n    login: false\n    inRoles: [myapp_readonly]\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [UPDATE]\n</code></pre>"},{"location":"examples/postgresql/#assign-role-to-user","title":"Assign Role to User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-roles\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    roles:\n      - myapp_readwrite\n</code></pre>"},{"location":"examples/postgresql/#multi-schema-setup","title":"Multi-Schema Setup","text":""},{"location":"examples/postgresql/#database-with-multiple-schemas","title":"Database with Multiple Schemas","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: enterprise-app\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: enterprise\n  postgres:\n    encoding: UTF8\n    extensions:\n      - name: uuid-ossp\n      - name: pg_stat_statements\n    schemas:\n      - name: core\n        owner: enterprise_admin\n      - name: billing\n        owner: enterprise_admin\n      - name: analytics\n        owner: analytics_admin\n      - name: audit\n        owner: enterprise_admin\n</code></pre>"},{"location":"examples/postgresql/#schema-specific-grants","title":"Schema-Specific Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: billing-service-grants\nspec:\n  userRef:\n    name: billing-service\n  postgres:\n    grants:\n      # Full access to billing schema\n      - database: enterprise\n        schema: billing\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n      # Read-only on core schema\n      - database: enterprise\n        schema: core\n        tables: [\"*\"]\n        privileges: [SELECT]\n      # Write to audit\n      - database: enterprise\n        schema: audit\n        tables: [billing_audit]\n        privileges: [INSERT]\n</code></pre>"},{"location":"examples/postgresql/#backup-configuration","title":"Backup Configuration","text":""},{"location":"examples/postgresql/#one-time-backup-to-s3","title":"One-Time Backup to S3","text":"<pre><code># S3 credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: s3-backup-credentials\ntype: Opaque\nstringData:\n  AWS_ACCESS_KEY_ID: your-access-key\n  AWS_SECRET_ACCESS_KEY: your-secret-key\n---\n# Backup\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-manual-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-database-backups\n      region: us-east-1\n      prefix: postgres/myapp\n      secretRef:\n        name: s3-backup-credentials\n  compression:\n    enabled: true\n    algorithm: gzip\n  postgres:\n    format: custom\n    jobs: 4\n  ttl: \"720h\"  # 30 days\n</code></pre>"},{"location":"examples/postgresql/#scheduled-backups","title":"Scheduled Backups","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: myapp-daily-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  schedule: \"0 2 * * *\"  # Daily at 2 AM\n  timezone: \"UTC\"\n  retention:\n    keepLast: 7\n    keepDaily: 7\n    keepWeekly: 4\n    keepMonthly: 3\n  concurrencyPolicy: Forbid\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-database-backups\n        region: us-east-1\n        prefix: postgres/myapp/scheduled\n        secretRef:\n          name: s3-backup-credentials\n    compression:\n      enabled: true\n      algorithm: gzip\n    postgres:\n      format: custom\n      jobs: 4\n</code></pre>"},{"location":"examples/postgresql/#restore-from-backup","title":"Restore from Backup","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: myapp-restore\nspec:\n  backupRef:\n    name: myapp-manual-backup\n  targetDatabaseRef:\n    name: myapp-database-restored\n  createTarget: true\n  postgres:\n    noOwner: true\n    jobs: 4\n    analyze: true\n</code></pre>"},{"location":"examples/postgresql/#complete-application-stack","title":"Complete Application Stack","text":""},{"location":"examples/postgresql/#full-example","title":"Full Example","text":"<pre><code>---\n# Admin credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin\ntype: Opaque\nstringData:\n  username: postgres\n  password: super-secret-admin-password\n---\n# Database instance\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: postgres-admin\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n---\n# Application database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-db\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  deletionPolicy: Retain\n  deletionProtection: true\n  postgres:\n    encoding: UTF8\n    extensions:\n      - name: uuid-ossp\n      - name: pgcrypto\n    schemas:\n      - name: app\n---\n# Read-only role\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readonly\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: myapp_readonly\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: app\n        tables: [\"*\"]\n        privileges: [SELECT]\n---\n# Read-write role\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: myapp-readwrite\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: myapp_readwrite\n  postgres:\n    login: false\n    inRoles: [myapp_readonly]\n    grants:\n      - database: myapp\n        schema: app\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n---\n# Application user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-credentials\n    secretTemplate:\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp?sslmode=require\"\n  postgres:\n    connectionLimit: 50\n---\n# Assign role to user\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grant\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    roles:\n      - myapp_readwrite\n    defaultPrivileges:\n      - database: myapp\n        schema: app\n        grantedBy: postgres\n        objectType: tables\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"examples/postgresql/#verify-setup","title":"Verify Setup","text":"<pre><code># Check instance status\nkubectl get databaseinstance postgres-primary\n\n# Check all resources\nkubectl get databases,databaseusers,databaseroles,databasegrants\n\n# Get connection string\nkubectl get secret myapp-credentials -o jsonpath='{.data.DATABASE_URL}' | base64 -d\n\n# Test connection\nkubectl run psql --rm -it --image=postgres:15 -- \\\n  psql \"$(kubectl get secret myapp-credentials -o jsonpath='{.data.DATABASE_URL}' | base64 -d)\"\n</code></pre>"},{"location":"getting-started/","title":"Getting Started","text":"<p>Welcome to DB Provision Operator! This section will help you get up and running quickly.</p>"},{"location":"getting-started/#what-is-db-provision-operator","title":"What is DB Provision Operator?","text":"<p>DB Provision Operator is a Kubernetes operator that enables declarative management of database resources. It supports:</p> <ul> <li>PostgreSQL - Full support including extensions, schemas, and roles</li> <li>MySQL - Including authentication plugins and charset configuration</li> <li>MariaDB - MySQL-compatible with MariaDB-specific features</li> </ul>"},{"location":"getting-started/#prerequisites","title":"Prerequisites","text":"<p>Before installing DB Provision Operator, ensure you have:</p> <ul> <li>Kubernetes cluster version 1.26 or higher</li> <li>kubectl configured to communicate with your cluster</li> <li>Helm 3.x (if using Helm installation)</li> <li>Database server accessible from the cluster (PostgreSQL, MySQL, or MariaDB)</li> </ul>"},{"location":"getting-started/#installation-methods","title":"Installation Methods","text":"<p>Choose your preferred installation method:</p> Method Best For Customization Helm Production deployments Full control via values.yaml Kustomize GitOps workflows Patch-based customization"},{"location":"getting-started/#quick-links","title":"Quick Links","text":"<ul> <li>Installation Guide - Detailed installation instructions</li> <li>Quick Start Tutorial - Create your first database in 5 minutes</li> <li>Examples - Ready-to-use YAML examples</li> </ul>"},{"location":"getting-started/#architecture-overview","title":"Architecture Overview","text":"<pre><code>graph TD\n    subgraph K8s[\"Kubernetes Cluster\"]\n        subgraph Operator[\"DB Provision Operator\"]\n            IC[Instance Controller]\n            DC[Database Controller]\n            UC[User Controller]\n            BC[Backup Controller]\n        end\n        IC &amp; DC &amp; UC &amp; BC --&gt; Adapters\n        subgraph Adapters[\"Database Adapters\"]\n            PGA[PostgreSQL]\n            MYA[MySQL]\n            MRA[MariaDB]\n        end\n    end\n    Adapters --&gt; ExtDB\n    subgraph ExtDB[\"External Databases\"]\n        PG[PostgreSQL]\n        MY[MySQL]\n        ETC[...]\n    end</code></pre>"},{"location":"getting-started/#next-steps","title":"Next Steps","text":"<ol> <li>Install the operator in your cluster</li> <li>Follow the quick start to create your first database</li> <li>Explore the user guide for advanced features</li> </ol>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>This guide covers all installation methods for DB Provision Operator.</p>"},{"location":"getting-started/installation/#prerequisites","title":"Prerequisites","text":"<ul> <li>Kubernetes 1.26+</li> <li>kubectl configured</li> <li>Helm 3.x (for Helm installation)</li> <li>cluster-admin privileges (for CRD installation)</li> </ul>"},{"location":"getting-started/installation/#helm-installation","title":"Helm Installation","text":"<p>Helm is the recommended installation method for production deployments.</p>"},{"location":"getting-started/installation/#add-the-helm-repository","title":"Add the Helm Repository","text":"<pre><code>helm repo add db-provision https://panteparak.github.io/db-provision-operator/charts\nhelm repo update\n</code></pre>"},{"location":"getting-started/installation/#install-with-default-values","title":"Install with Default Values","text":"<pre><code>helm install db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system \\\n  --create-namespace\n</code></pre>"},{"location":"getting-started/installation/#install-with-custom-values","title":"Install with Custom Values","text":"<p>Create a <code>values.yaml</code> file:</p> <pre><code># values.yaml\nreplicaCount: 2\n\nresources:\n  limits:\n    cpu: 500m\n    memory: 256Mi\n  requests:\n    cpu: 100m\n    memory: 128Mi\n\nmetrics:\n  enabled: true\n\nserviceMonitor:\n  enabled: true\n</code></pre> <p>Then install:</p> <pre><code>helm install db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system \\\n  --create-namespace \\\n  -f values.yaml\n</code></pre>"},{"location":"getting-started/installation/#upgrade-an-existing-installation","title":"Upgrade an Existing Installation","text":"<pre><code>helm repo update\nhelm upgrade db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system\n</code></pre>"},{"location":"getting-started/installation/#uninstall","title":"Uninstall","text":"<pre><code>helm uninstall db-provision-operator --namespace db-provision-operator-system\n</code></pre> <p>CRDs are not removed</p> <p>Helm does not remove CRDs on uninstall to prevent data loss. To remove CRDs manually: <pre><code>kubectl delete crds -l app.kubernetes.io/name=db-provision-operator\n</code></pre></p>"},{"location":"getting-started/installation/#kustomize-installation","title":"Kustomize Installation","text":"<p>Kustomize is ideal for GitOps workflows.</p>"},{"location":"getting-started/installation/#install-latest-release","title":"Install Latest Release","text":"<pre><code>kubectl apply -f https://github.com/panteparak/db-provision-operator/releases/latest/download/install.yaml\n</code></pre>"},{"location":"getting-started/installation/#install-specific-version","title":"Install Specific Version","text":"<pre><code>VERSION=v0.1.0\nkubectl apply -f https://github.com/panteparak/db-provision-operator/releases/download/${VERSION}/db-provision-operator-${VERSION}.yaml\n</code></pre>"},{"location":"getting-started/installation/#customize-with-kustomize-overlay","title":"Customize with Kustomize Overlay","text":"<p>Create a <code>kustomization.yaml</code>:</p> <pre><code>apiVersion: kustomize.config.k8s.io/v1beta1\nkind: Kustomization\n\nresources:\n  - https://github.com/panteparak/db-provision-operator/config/default?ref=main\n\nnamespace: db-provision-operator-system\n\npatches:\n  - patch: |-\n      - op: replace\n        path: /spec/template/spec/containers/0/resources/limits/memory\n        value: 256Mi\n    target:\n      kind: Deployment\n      name: db-provision-operator-controller-manager\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -k .\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":""},{"location":"getting-started/installation/#check-the-deployment","title":"Check the Deployment","text":"<pre><code>kubectl get pods -n db-provision-operator-system\n</code></pre> <p>Expected output:</p> <pre><code>NAME                                                     READY   STATUS    RESTARTS   AGE\ndb-provision-operator-controller-manager-xxxxx-xxxxx     1/1     Running   0          1m\n</code></pre>"},{"location":"getting-started/installation/#check-crds","title":"Check CRDs","text":"<pre><code>kubectl get crds | grep dbops\n</code></pre> <p>Expected output:</p> <pre><code>databasebackups.dbops.dbprovision.io          2024-01-01T00:00:00Z\ndatabasebackupschedules.dbops.dbprovision.io  2024-01-01T00:00:00Z\ndatabasegrants.dbops.dbprovision.io           2024-01-01T00:00:00Z\ndatabaseinstances.dbops.dbprovision.io        2024-01-01T00:00:00Z\ndatabaserestores.dbops.dbprovision.io         2024-01-01T00:00:00Z\ndatabaseroles.dbops.dbprovision.io            2024-01-01T00:00:00Z\ndatabases.dbops.dbprovision.io                2024-01-01T00:00:00Z\ndatabaseusers.dbops.dbprovision.io            2024-01-01T00:00:00Z\n</code></pre>"},{"location":"getting-started/installation/#check-logs","title":"Check Logs","text":"<pre><code>kubectl logs -n db-provision-operator-system deployment/db-provision-operator-controller-manager\n</code></pre>"},{"location":"getting-started/installation/#configuration-options","title":"Configuration Options","text":""},{"location":"getting-started/installation/#helm-values-reference","title":"Helm Values Reference","text":"Parameter Description Default <code>replicaCount</code> Number of operator replicas <code>1</code> <code>image.repository</code> Container image repository <code>ghcr.io/panteparak/db-provision-operator</code> <code>image.tag</code> Container image tag Chart appVersion <code>resources.limits.cpu</code> CPU limit <code>500m</code> <code>resources.limits.memory</code> Memory limit <code>128Mi</code> <code>resources.requests.cpu</code> CPU request <code>10m</code> <code>resources.requests.memory</code> Memory request <code>64Mi</code> <code>metrics.enabled</code> Enable metrics endpoint <code>false</code> <code>serviceMonitor.enabled</code> Create ServiceMonitor <code>false</code> <code>grafanaDashboards.enabled</code> Install Grafana dashboards <code>false</code> <code>leaderElection.enabled</code> Enable leader election <code>true</code> <p>For the complete list of values, see the Helm chart values.yaml.</p>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start Tutorial - Create your first database</li> <li>User Guide - Learn about all CRDs</li> <li>Examples - Ready-to-use configurations</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>This tutorial walks you through creating a PostgreSQL database with a user in 5 minutes.</p>"},{"location":"getting-started/quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>DB Provision Operator installed in your cluster</li> <li>A PostgreSQL server accessible from your cluster</li> </ul> <p>No PostgreSQL server?</p> <p>You can deploy a test PostgreSQL server: <pre><code>kubectl apply -f https://raw.githubusercontent.com/panteparak/db-provision-operator/main/test/e2e/fixtures/testdata/postgresql.yaml\n</code></pre></p>"},{"location":"getting-started/quickstart/#step-1-create-admin-credentials","title":"Step 1: Create Admin Credentials","text":"<p>First, create a Secret with the credentials to connect to your PostgreSQL server:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin-credentials\n  namespace: default\ntype: Opaque\nstringData:\n  username: postgres\n  password: your-admin-password\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f - &lt;&lt;EOF\napiVersion: v1\nkind: Secret\nmetadata:\n  name: postgres-admin-credentials\n  namespace: default\ntype: Opaque\nstringData:\n  username: postgres\n  password: postgres\nEOF\n</code></pre>"},{"location":"getting-started/quickstart/#step-2-create-a-databaseinstance","title":"Step 2: Create a DatabaseInstance","text":"<p>A <code>DatabaseInstance</code> represents the connection to your database server:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\n  namespace: default\nspec:\n  engine: postgres\n  connection:\n    host: postgresql.default.svc.cluster.local  # Adjust to your server\n    port: 5432\n    database: postgres\n    secretRef:\n      name: postgres-admin-credentials\n  healthCheck:\n    enabled: true\n    intervalSeconds: 30\n</code></pre> <p>Apply and verify:</p> <pre><code>kubectl apply -f instance.yaml\n\n# Check status\nkubectl get databaseinstance postgres-primary\n</code></pre> <p>Wait for the instance to become <code>Ready</code>:</p> <pre><code>NAME               ENGINE     PHASE   HOST                                      PORT   AGE\npostgres-primary   postgres   Ready   postgresql.default.svc.cluster.local      5432   30s\n</code></pre>"},{"location":"getting-started/quickstart/#step-3-create-a-database","title":"Step 3: Create a Database","text":"<p>Now create a database within the instance:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\n  namespace: default\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  deletionPolicy: Retain\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f database.yaml\n\n# Verify\nkubectl get database myapp-database\n</code></pre>"},{"location":"getting-started/quickstart/#step-4-create-a-user","title":"Step 4: Create a User","text":"<p>Create a user with an auto-generated password:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\n  namespace: default\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 24\n    secretName: myapp-user-credentials\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f user.yaml\n\n# Check the generated credentials\nkubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d\n</code></pre>"},{"location":"getting-started/quickstart/#step-5-grant-permissions","title":"Step 5: Grant Permissions","text":"<p>Grant the user access to the database:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\n  namespace: default\nspec:\n  userRef:\n    name: myapp-user\n  databaseRef:\n    name: myapp-database\n  postgres:\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre> <p>Apply:</p> <pre><code>kubectl apply -f grant.yaml\n</code></pre>"},{"location":"getting-started/quickstart/#verify-everything","title":"Verify Everything","text":"<p>Check all resources:</p> <pre><code>kubectl get databaseinstance,database,databaseuser,databasegrant\n</code></pre> <p>Expected output:</p> <pre><code>NAME                                               ENGINE     PHASE   AGE\ndatabaseinstance.dbops.dbprovision.io/postgres-primary   postgres   Ready   5m\n\nNAME                                        ENGINE     PHASE   DATABASE   AGE\ndatabase.dbops.dbprovision.io/myapp-database   postgres   Ready   myapp      4m\n\nNAME                                         ENGINE     PHASE   USERNAME     AGE\ndatabaseuser.dbops.dbprovision.io/myapp-user   postgres   Ready   myapp_user   3m\n\nNAME                                               PHASE   AGE\ndatabasegrant.dbops.dbprovision.io/myapp-user-grants   Ready   2m\n</code></pre>"},{"location":"getting-started/quickstart/#connect-to-the-database","title":"Connect to the Database","text":"<p>Use the generated credentials to connect:</p> <pre><code># Get credentials\nexport PGHOST=postgresql.default.svc.cluster.local\nexport PGPORT=5432\nexport PGDATABASE=myapp\nexport PGUSER=myapp_user\nexport PGPASSWORD=$(kubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d)\n\n# Connect (from a pod with psql)\nkubectl run -it --rm psql --image=postgres:16 --restart=Never -- psql\n</code></pre>"},{"location":"getting-started/quickstart/#clean-up","title":"Clean Up","text":"<p>To remove all resources:</p> <pre><code>kubectl delete databasegrant myapp-user-grants\nkubectl delete databaseuser myapp-user\nkubectl delete database myapp-database\nkubectl delete databaseinstance postgres-primary\nkubectl delete secret postgres-admin-credentials myapp-user-credentials\n</code></pre>"},{"location":"getting-started/quickstart/#next-steps","title":"Next Steps","text":"<ul> <li>User Guide - Deep dive into each CRD</li> <li>Examples - More complex scenarios</li> <li>Engine Guides - PostgreSQL, MySQL, MariaDB specifics</li> </ul>"},{"location":"operations/","title":"Operations","text":"<p>Operational guides for running DB Provision Operator in production.</p>"},{"location":"operations/#overview","title":"Overview","text":"<p>This section covers:</p> <ul> <li>Admin Account Setup - Set up least-privilege database admin accounts</li> <li>Monitoring - Prometheus metrics, Grafana dashboards, alerting</li> <li>Events - Event reference and alerting integration</li> <li>Troubleshooting - Common issues and solutions</li> </ul>"},{"location":"operations/#operational-tasks","title":"Operational Tasks","text":""},{"location":"operations/#checking-status","title":"Checking Status","text":"<pre><code># All resources across namespaces\nkubectl get databaseinstances,databases,databaseusers,databaseroles,databasegrants -A\n\n# Specific namespace\nkubectl get all -l app.kubernetes.io/managed-by=db-provision-operator -n myapp\n\n# Detailed status\nkubectl describe databaseinstance postgres-primary\n</code></pre>"},{"location":"operations/#health-verification","title":"Health Verification","text":"<pre><code># Check operator health\nkubectl get pods -n db-provision-operator-system\n\n# Check operator logs\nkubectl logs -n db-provision-operator-system deployment/db-provision-operator -f\n\n# Check specific resource events\nkubectl get events --field-selector involvedObject.name=myapp-database\n</code></pre>"},{"location":"operations/#credential-management","title":"Credential Management","text":"<pre><code># Get generated credentials\nkubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d\n\n# Rotate password (delete secret, operator regenerates)\nkubectl delete secret myapp-user-credentials\n\n# Or use annotation\nkubectl annotate databaseuser myapp-user dbops.dbprovision.io/rotate-password=true\n</code></pre>"},{"location":"operations/#backup-operations","title":"Backup Operations","text":"<pre><code># List backups\nkubectl get databasebackups\n\n# Check backup status\nkubectl describe databasebackup myapp-backup\n\n# Trigger manual backup from schedule\nkubectl create job --from=cronjob/myapp-backup-schedule manual-backup-$(date +%s)\n\n# List scheduled backups\nkubectl get databasebackupschedules\n</code></pre>"},{"location":"operations/#restore-operations","title":"Restore Operations","text":"<pre><code># Create restore\nkubectl apply -f restore.yaml\n\n# Monitor restore progress\nkubectl get databaserestore myapp-restore -w\n\n# Check restore logs\nkubectl logs job/myapp-restore-job\n</code></pre>"},{"location":"operations/#resource-lifecycle","title":"Resource Lifecycle","text":""},{"location":"operations/#creation-order","title":"Creation Order","text":"<p>For new deployments, create resources in this order:</p> <ol> <li>Secrets (admin credentials)</li> <li>DatabaseInstance</li> <li>Database</li> <li>DatabaseRole (optional)</li> <li>DatabaseUser</li> <li>DatabaseGrant</li> <li>DatabaseBackupSchedule (optional)</li> </ol>"},{"location":"operations/#deletion-order","title":"Deletion Order","text":"<p>For cleanup, delete in reverse order:</p> <ol> <li>DatabaseBackupSchedule</li> <li>DatabaseGrant</li> <li>DatabaseUser</li> <li>DatabaseRole</li> <li>Database</li> <li>DatabaseInstance</li> <li>Secrets</li> </ol>"},{"location":"operations/#finalizers","title":"Finalizers","text":"<p>Resources use finalizers to ensure cleanup:</p> <pre><code># Check finalizers\nkubectl get database myapp -o jsonpath='{.metadata.finalizers}'\n\n# Force delete (use with caution!)\nkubectl patch database myapp -p '{\"metadata\":{\"finalizers\":null}}' --type=merge\n</code></pre>"},{"location":"operations/#scaling","title":"Scaling","text":""},{"location":"operations/#operator-scaling","title":"Operator Scaling","text":"<pre><code># Increase replicas for HA\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: db-provision-operator\nspec:\n  replicas: 3\n</code></pre>"},{"location":"operations/#concurrent-reconciliation","title":"Concurrent Reconciliation","text":"<p>Configure via Helm values:</p> <pre><code>controller:\n  maxConcurrentReconciles: 20\n</code></pre>"},{"location":"operations/#upgrades","title":"Upgrades","text":""},{"location":"operations/#operator-upgrade","title":"Operator Upgrade","text":"<pre><code># Helm upgrade\nhelm upgrade db-provision-operator db-provision/db-provision-operator \\\n  --namespace db-provision-operator-system \\\n  --version X.Y.Z\n\n# Verify upgrade\nkubectl rollout status deployment/db-provision-operator -n db-provision-operator-system\n</code></pre>"},{"location":"operations/#crd-upgrade","title":"CRD Upgrade","text":"<p>CRDs are upgraded automatically with Helm. For manual upgrade:</p> <pre><code>kubectl apply -f https://github.com/panteparak/db-provision-operator/releases/latest/download/crds.yaml\n</code></pre>"},{"location":"operations/#maintenance-windows","title":"Maintenance Windows","text":""},{"location":"operations/#planned-maintenance","title":"Planned Maintenance","text":"<ol> <li> <p>Scale down operator:    <pre><code>kubectl scale deployment/db-provision-operator --replicas=0 -n db-provision-operator-system\n</code></pre></p> </li> <li> <p>Perform maintenance</p> </li> <li> <p>Scale up operator:    <pre><code>kubectl scale deployment/db-provision-operator --replicas=1 -n db-provision-operator-system\n</code></pre></p> </li> </ol>"},{"location":"operations/#emergency-procedures","title":"Emergency Procedures","text":"<p>Pause all reconciliation: <pre><code>kubectl scale deployment/db-provision-operator --replicas=0 -n db-provision-operator-system\n</code></pre></p> <p>Resume: <pre><code>kubectl scale deployment/db-provision-operator --replicas=1 -n db-provision-operator-system\n</code></pre></p>"},{"location":"operations/#disaster-recovery","title":"Disaster Recovery","text":""},{"location":"operations/#backup-strategy","title":"Backup Strategy","text":"<ol> <li>Database backups - Managed by DatabaseBackupSchedule</li> <li>Kubernetes resources - Export CRDs for recovery</li> <li>Secrets - Backup encryption keys separately</li> </ol>"},{"location":"operations/#export-resources","title":"Export Resources","text":"<pre><code># Export all DB Provision resources\nkubectl get databaseinstances,databases,databaseusers,databaseroles,databasegrants,databasebackups,databasebackupschedules \\\n  -A -o yaml &gt; db-provision-backup.yaml\n</code></pre>"},{"location":"operations/#recovery-steps","title":"Recovery Steps","text":"<ol> <li>Deploy operator</li> <li>Apply Secrets</li> <li>Apply DatabaseInstance (wait for Ready)</li> <li>Apply remaining resources</li> <li>Restore from DatabaseBackup if needed</li> </ol>"},{"location":"operations/#next-steps","title":"Next Steps","text":"<ul> <li>Monitoring - Set up monitoring and alerting</li> <li>Troubleshooting - Solve common problems</li> </ul>"},{"location":"operations/admin-account-setup/","title":"Admin Account Setup","text":"<p>This guide explains how to create a dedicated least-privilege admin account for the DB Provision Operator. Using a least-privilege account instead of superuser/root is a security best practice for production environments.</p>"},{"location":"operations/admin-account-setup/#overview","title":"Overview","text":"<p>The operator needs an admin account with sufficient privileges to:</p> <ul> <li>Create and drop databases</li> <li>Create and manage users/roles</li> <li>Grant and revoke privileges</li> <li>Terminate connections (for force-drop operations)</li> <li>Perform backup operations (SELECT access)</li> </ul> <p>Each database engine has a different privilege model. This guide provides complete SQL scripts for PostgreSQL, MySQL, MariaDB, and CockroachDB.</p> <p>Do Not Use Superuser/Root</p> <p>While superuser accounts work, they pose unnecessary security risks. A compromised operator could affect all databases on the server. Always use a dedicated least-privilege account.</p>"},{"location":"operations/admin-account-setup/#postgresql","title":"PostgreSQL","text":""},{"location":"operations/admin-account-setup/#required-privileges","title":"Required Privileges","text":"Privilege/Attribute Purpose <code>LOGIN</code> Connect to the database <code>CREATEDB</code> Create and drop databases <code>CREATEROLE</code> Create and manage users/roles <code>pg_signal_backend</code> Terminate connections (force-drop) <code>pg_read_all_data</code> (PG14+) Backup operations <code>CONNECT ON template1</code> Create databases from template"},{"location":"operations/admin-account-setup/#sql-script","title":"SQL Script","text":"<p>Connect as a PostgreSQL superuser (e.g., <code>postgres</code>) and execute:</p> <pre><code>-- ============================================\n-- PostgreSQL Admin Account for DB Provision Operator\n-- ============================================\n\n-- Step 1: Create the operator admin role\nCREATE ROLE dbprovision_admin WITH\n    LOGIN\n    CREATEDB\n    CREATEROLE\n    PASSWORD 'your-secure-password-here';\n\n-- Step 2: Grant connection termination capability\n-- Required for force-dropping databases with active connections\nGRANT pg_signal_backend TO dbprovision_admin;\n\n-- Step 3: Grant read access for backup operations (PostgreSQL 14+)\n-- For PostgreSQL 12/13, grant SELECT on specific databases instead\nGRANT pg_read_all_data TO dbprovision_admin;\n\n-- Step 4: Grant template1 access for database creation\nGRANT CONNECT ON DATABASE template1 TO dbprovision_admin;\n\n-- Step 5: (Optional) Allow creating extensions in new databases\n-- Note: Some extensions require superuser; pre-install them if needed\n-- GRANT CREATE ON DATABASE template1 TO dbprovision_admin;\n\n-- Verify the setup\n\\du dbprovision_admin\n</code></pre>"},{"location":"operations/admin-account-setup/#postgresql-1213-without-pg_read_all_data","title":"PostgreSQL 12/13 (Without pg_read_all_data)","text":"<p>For older PostgreSQL versions, grant SELECT explicitly:</p> <pre><code>-- After creating each database managed by the operator:\nGRANT SELECT ON ALL TABLES IN SCHEMA public TO dbprovision_admin;\nGRANT SELECT ON ALL SEQUENCES IN SCHEMA public TO dbprovision_admin;\n\n-- For future tables (run as database owner):\nALTER DEFAULT PRIVILEGES IN SCHEMA public\n    GRANT SELECT ON TABLES TO dbprovision_admin;\nALTER DEFAULT PRIVILEGES IN SCHEMA public\n    GRANT SELECT ON SEQUENCES TO dbprovision_admin;\n</code></pre>"},{"location":"operations/admin-account-setup/#extension-considerations","title":"Extension Considerations","text":"<p>Some PostgreSQL extensions require superuser to install:</p> Extension Requires Superuser Solution <code>pg_stat_statements</code> Yes Pre-install by DBA <code>uuid-ossp</code> Yes Pre-install by DBA <code>pgcrypto</code> No Operator can install <code>hstore</code> No Operator can install <code>pg_trgm</code> No Operator can install <p>For extensions requiring superuser, pre-install them in <code>template1</code>:</p> <pre><code>-- Run as superuser in template1\n\\c template1\nCREATE EXTENSION IF NOT EXISTS pg_stat_statements;\nCREATE EXTENSION IF NOT EXISTS \"uuid-ossp\";\n</code></pre>"},{"location":"operations/admin-account-setup/#verification","title":"Verification","text":"<pre><code>-- Check role attributes\nSELECT rolname, rolsuper, rolcreaterole, rolcreatedb, rolcanlogin\nFROM pg_roles\nWHERE rolname = 'dbprovision_admin';\n\n-- Expected output:\n--      rolname       | rolsuper | rolcreaterole | rolcreatedb | rolcanlogin\n-- -------------------+----------+---------------+-------------+-------------\n--  dbprovision_admin | f        | t             | t           | t\n\n-- Check role memberships\nSELECT r.rolname AS role, m.rolname AS member\nFROM pg_auth_members am\nJOIN pg_roles r ON am.roleid = r.oid\nJOIN pg_roles m ON am.member = m.oid\nWHERE m.rolname = 'dbprovision_admin';\n\n-- Expected: pg_signal_backend, pg_read_all_data\n</code></pre>"},{"location":"operations/admin-account-setup/#mysql","title":"MySQL","text":""},{"location":"operations/admin-account-setup/#required-privileges_1","title":"Required Privileges","text":"Privilege Purpose <code>CREATE, DROP, ALTER ON *.*</code> Database operations <code>CREATE USER ON *.*</code> User management <code>GRANT OPTION ON *.*</code> Delegate privileges to users <code>SELECT ON mysql.*</code> Query user/grant metadata <code>RELOAD ON *.*</code> FLUSH PRIVILEGES <code>CONNECTION_ADMIN ON *.*</code> Kill connections (force-drop) <code>ROLE_ADMIN ON *.*</code> Role management (MySQL 8.0+) <code>SELECT, SHOW VIEW, TRIGGER, LOCK TABLES ON *.*</code> Backup operations"},{"location":"operations/admin-account-setup/#sql-script_1","title":"SQL Script","text":"<p>Connect as MySQL root and execute:</p> <pre><code>-- ============================================\n-- MySQL Admin Account for DB Provision Operator\n-- ============================================\n\n-- Step 1: Create the operator admin user\nCREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password-here';\n\n-- Step 2: Grant database operations\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 3: Grant user management\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%';\nGRANT GRANT OPTION ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 4: Grant system table access for metadata queries\nGRANT SELECT ON mysql.user TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.db TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.tables_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.columns_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.procs_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.global_grants TO 'dbprovision_admin'@'%';\n\n-- Step 5: Grant administrative operations\nGRANT RELOAD ON *.* TO 'dbprovision_admin'@'%';\nGRANT CONNECTION_ADMIN ON *.* TO 'dbprovision_admin'@'%';\nGRANT PROCESS ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 6: Grant role management (MySQL 8.0+)\nGRANT ROLE_ADMIN ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 7: Grant data operations for managed databases and backup operations\n-- INSERT, UPDATE, DELETE are needed to grant these privileges to application users\nGRANT SELECT, INSERT, UPDATE, DELETE, SHOW VIEW, TRIGGER, LOCK TABLES ON *.* TO 'dbprovision_admin'@'%';\n-- Note: information_schema access is automatic based on privileges on actual database objects\n\n-- Step 8: Apply changes\nFLUSH PRIVILEGES;\n\n-- Verify the setup\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n</code></pre>"},{"location":"operations/admin-account-setup/#restricted-network-access-recommended","title":"Restricted Network Access (Recommended)","text":"<p>For production, restrict the admin account to specific hosts:</p> <pre><code>-- Create user accessible only from Kubernetes pod network\nCREATE USER 'dbprovision_admin'@'10.0.0.0/255.0.0.0'\n    IDENTIFIED BY 'your-secure-password-here';\n\n-- Or specific namespace CIDR\nCREATE USER 'dbprovision_admin'@'10.244.%.%'\n    IDENTIFIED BY 'your-secure-password-here';\n\n-- Grant same privileges as above to this restricted user\n</code></pre>"},{"location":"operations/admin-account-setup/#verification_1","title":"Verification","text":"<pre><code>-- Check user exists\nSELECT User, Host FROM mysql.user WHERE User = 'dbprovision_admin';\n\n-- Check grants (should NOT show ALL PRIVILEGES or SUPER)\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n\n-- Expected grants (partial list):\n-- GRANT SELECT, RELOAD, CREATE USER, PROCESS,\n--       CREATE, DROP, ALTER, LOCK TABLES, SHOW VIEW, TRIGGER,\n--       CONNECTION_ADMIN, ROLE_ADMIN\n-- ON *.* TO 'dbprovision_admin'@'%' WITH GRANT OPTION\n</code></pre>"},{"location":"operations/admin-account-setup/#mariadb","title":"MariaDB","text":"<p>MariaDB is MySQL-compatible but has some differences in privilege handling.</p>"},{"location":"operations/admin-account-setup/#differences-from-mysql","title":"Differences from MySQL","text":"Feature MySQL 8.0 MariaDB Role system <code>CREATE ROLE</code> statement Roles are users (same as older MySQL) Role admin <code>ROLE_ADMIN</code> privilege <code>CREATE USER</code> + <code>WITH GRANT OPTION</code> Default auth <code>caching_sha2_password</code> <code>mysql_native_password</code> Global grants table <code>mysql.global_grants</code> Not available"},{"location":"operations/admin-account-setup/#sql-script_2","title":"SQL Script","text":"<p>Connect as MariaDB root and execute:</p> <pre><code>-- ============================================\n-- MariaDB Admin Account for DB Provision Operator\n-- ============================================\n\n-- Step 1: Create the operator admin user\nCREATE USER 'dbprovision_admin'@'%' IDENTIFIED BY 'your-secure-password-here';\n\n-- Step 2: Grant database operations\nGRANT CREATE, DROP, ALTER ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 3: Grant user management with grant option for role delegation\nGRANT CREATE USER ON *.* TO 'dbprovision_admin'@'%' WITH GRANT OPTION;\n\n-- Step 4: Grant system table access for metadata queries\nGRANT SELECT ON mysql.user TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.db TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.tables_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.columns_priv TO 'dbprovision_admin'@'%';\nGRANT SELECT ON mysql.procs_priv TO 'dbprovision_admin'@'%';\n\n-- Step 5: Grant administrative operations\nGRANT RELOAD ON *.* TO 'dbprovision_admin'@'%';\nGRANT PROCESS ON *.* TO 'dbprovision_admin'@'%';\n\n-- Note: MariaDB uses SUPER or CONNECTION ADMIN for killing connections\n-- CONNECTION ADMIN was added in MariaDB 10.5.2\nGRANT CONNECTION ADMIN ON *.* TO 'dbprovision_admin'@'%';\n\n-- Step 6: Grant data operations for managed databases and backup operations\n-- INSERT, UPDATE, DELETE are needed to grant these privileges to application users\nGRANT SELECT, INSERT, UPDATE, DELETE, SHOW VIEW, TRIGGER, LOCK TABLES ON *.* TO 'dbprovision_admin'@'%';\n-- Note: information_schema access is automatic based on privileges on actual database objects\n\n-- Step 7: Apply changes\nFLUSH PRIVILEGES;\n\n-- Verify the setup\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n</code></pre>"},{"location":"operations/admin-account-setup/#mariadb-104-and-earlier","title":"MariaDB 10.4 and Earlier","text":"<p>For older MariaDB versions without <code>CONNECTION ADMIN</code>:</p> <pre><code>-- Use SUPER for connection termination (less ideal but necessary)\n-- WARNING: SUPER is a very broad privilege\n-- Consider upgrading to MariaDB 10.5+ instead\nGRANT SUPER ON *.* TO 'dbprovision_admin'@'%';\n</code></pre>"},{"location":"operations/admin-account-setup/#verification_2","title":"Verification","text":"<pre><code>-- Check user exists\nSELECT User, Host FROM mysql.user WHERE User = 'dbprovision_admin';\n\n-- Check grants\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n\n-- Verify role capabilities (create a test role)\nCREATE ROLE IF NOT EXISTS test_role_check;\nDROP ROLE IF EXISTS test_role_check;\n</code></pre>"},{"location":"operations/admin-account-setup/#cockroachdb","title":"CockroachDB","text":"<p>CockroachDB uses PostgreSQL wire protocol but has a simpler privilege model without true superuser accounts.</p>"},{"location":"operations/admin-account-setup/#insecure-mode-vs-secure-mode","title":"Insecure Mode vs Secure Mode","text":"Mode When to Use Password Support Insecure Development, testing only No passwords Secure Production Passwords required <p>Never Use Insecure Mode in Production</p> <p>CockroachDB's <code>--insecure</code> flag disables TLS and password authentication. This is only for local development and testing.</p>"},{"location":"operations/admin-account-setup/#required-privileges_2","title":"Required Privileges","text":"Privilege Purpose <code>CREATEDB</code> Create and drop databases <code>CREATEROLE</code> Create and manage users/roles <code>admin</code> role membership Full management capabilities, grant delegation"},{"location":"operations/admin-account-setup/#sql-script-insecure-mode","title":"SQL Script (Insecure Mode)","text":"<p>For development environments with <code>--insecure</code>:</p> <pre><code>-- ============================================\n-- CockroachDB Admin Account (Insecure Mode)\n-- ============================================\n\n-- Step 1: Create the operator admin user (no password in insecure mode)\nCREATE USER IF NOT EXISTS dbprovision_admin;\n\n-- Step 2: Grant database creation privilege\nALTER USER dbprovision_admin WITH CREATEDB;\n\n-- Step 3: Grant role creation privilege\nALTER USER dbprovision_admin WITH CREATEROLE;\n\n-- Step 4: Grant admin role for full management capabilities\nGRANT admin TO dbprovision_admin;\n\n-- Verify the setup\nSELECT username FROM system.users WHERE username = 'dbprovision_admin';\nSHOW GRANTS FOR dbprovision_admin;\n</code></pre>"},{"location":"operations/admin-account-setup/#sql-script-secure-mode","title":"SQL Script (Secure Mode)","text":"<p>For production environments with TLS certificates:</p> <pre><code>-- ============================================\n-- CockroachDB Admin Account (Secure Mode)\n-- ============================================\n\n-- Step 1: Create the operator admin user with password\nCREATE USER dbprovision_admin WITH PASSWORD 'your-secure-password-here';\n\n-- Step 2: Grant database creation privilege\nALTER USER dbprovision_admin WITH CREATEDB;\n\n-- Step 3: Grant role creation privilege\nALTER USER dbprovision_admin WITH CREATEROLE;\n\n-- Step 4: Grant admin role for full management capabilities\n-- Note: admin role is required for granting privileges to other users\nGRANT admin TO dbprovision_admin;\n\n-- Verify the setup\nSELECT username FROM system.users WHERE username = 'dbprovision_admin';\nSHOW GRANTS FOR dbprovision_admin;\nSHOW GRANTS ON ROLE FOR dbprovision_admin;\n</code></pre>"},{"location":"operations/admin-account-setup/#differences-from-postgresql","title":"Differences from PostgreSQL","text":"<p>CockroachDB does not support these PostgreSQL features:</p> PostgreSQL CockroachDB <code>SUPERUSER</code> Not available (use <code>admin</code> role) <code>REPLICATION</code> Not available <code>BYPASSRLS</code> Not available (no RLS support) <code>INHERIT</code>/<code>NOINHERIT</code> Not available <code>pg_signal_backend</code> Not available <code>pg_read_all_data</code> Use explicit grants"},{"location":"operations/admin-account-setup/#verification_3","title":"Verification","text":"<pre><code>-- Check user exists\nSELECT username FROM system.users WHERE username = 'dbprovision_admin';\n\n-- Check user options\nSHOW USERS;\n\n-- Check role memberships\nSHOW GRANTS ON ROLE FOR dbprovision_admin;\n\n-- Test database creation\nCREATE DATABASE IF NOT EXISTS test_db_creation;\nDROP DATABASE IF EXISTS test_db_creation;\n\n-- Test user creation\nCREATE USER IF NOT EXISTS test_user_creation;\nDROP USER IF EXISTS test_user_creation;\n</code></pre>"},{"location":"operations/admin-account-setup/#tls-configuration","title":"TLS Configuration","text":"<p>For secure mode, you need TLS certificates. See the CockroachDB guide for complete TLS configuration.</p>"},{"location":"operations/admin-account-setup/#kubernetes-secret","title":"Kubernetes Secret","text":"<p>After creating the admin account, create a Kubernetes Secret:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: db-admin-credentials\n  namespace: db-provision-operator-system\ntype: Opaque\nstringData:\n  username: dbprovision_admin\n  password: your-secure-password-here\n</code></pre> <p>Or create it with kubectl:</p> <pre><code>kubectl create secret generic db-admin-credentials \\\n  --namespace=db-provision-operator-system \\\n  --from-literal=username=dbprovision_admin \\\n  --from-literal=password='your-secure-password-here'\n</code></pre>"},{"location":"operations/admin-account-setup/#password-generation","title":"Password Generation","text":"<p>Generate a secure random password:</p> <pre><code># Using openssl (recommended)\nopenssl rand -base64 32\n\n# Using /dev/urandom\nhead -c 32 /dev/urandom | base64\n\n# Using pwgen\npwgen -s 32 1\n</code></pre>"},{"location":"operations/admin-account-setup/#databaseinstance-configuration","title":"DatabaseInstance Configuration","text":"<p>Reference the admin credentials in your DatabaseInstance:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    sslMode: require\n    secretRef:\n      name: db-admin-credentials\n</code></pre>"},{"location":"operations/admin-account-setup/#security-recommendations","title":"Security Recommendations","text":""},{"location":"operations/admin-account-setup/#1-password-rotation","title":"1. Password Rotation","text":"<p>Regularly rotate the admin account password:</p> <pre><code># 1. Generate new password\nNEW_PASSWORD=$(openssl rand -base64 32)\n\n# 2. Update in database (run appropriate SQL)\n# PostgreSQL: ALTER ROLE dbprovision_admin WITH PASSWORD 'new-password';\n# MySQL/MariaDB: ALTER USER 'dbprovision_admin'@'%' IDENTIFIED BY 'new-password';\n\n# 3. Update Kubernetes secret\nkubectl create secret generic db-admin-credentials \\\n  --namespace=db-provision-operator-system \\\n  --from-literal=username=dbprovision_admin \\\n  --from-literal=password=\"$NEW_PASSWORD\" \\\n  --dry-run=client -o yaml | kubectl apply -f -\n\n# 4. Restart operator to pick up new credentials\nkubectl rollout restart deployment/db-provision-operator-controller-manager \\\n  -n db-provision-operator-system\n</code></pre>"},{"location":"operations/admin-account-setup/#2-network-restrictions","title":"2. Network Restrictions","text":"<ul> <li>Use Kubernetes NetworkPolicies to restrict operator-to-database traffic</li> <li>Configure database firewall rules (pg_hba.conf for PostgreSQL)</li> <li>Use host restrictions in MySQL/MariaDB user definitions</li> </ul>"},{"location":"operations/admin-account-setup/#3-tls-encryption","title":"3. TLS Encryption","text":"<p>Always enable TLS for production:</p> <pre><code>spec:\n  connection:\n    sslMode: verify-full\n    tls:\n      secretRef:\n        name: db-tls-certs\n</code></pre>"},{"location":"operations/admin-account-setup/#4-audit-logging","title":"4. Audit Logging","text":"<p>Enable database audit logging for the admin account:</p> <p>PostgreSQL (pgaudit): <pre><code>ALTER ROLE dbprovision_admin SET pgaudit.log = 'ddl,role';\n</code></pre></p> <p>MySQL: <pre><code>SET GLOBAL audit_log_include_accounts = 'dbprovision_admin@%';\n</code></pre></p>"},{"location":"operations/admin-account-setup/#5-least-privilege-verification","title":"5. Least Privilege Verification","text":"<p>Periodically verify the account doesn't have superuser:</p> <pre><code># PostgreSQL\npsql -U dbprovision_admin -c \"SELECT rolsuper FROM pg_roles WHERE rolname = current_user;\"\n# Should return: f (false)\n\n# MySQL\nmysql -u dbprovision_admin -e \"SELECT SUPER_PRIV FROM mysql.user WHERE User = 'dbprovision_admin';\"\n# Should return: N (No)\n</code></pre>"},{"location":"operations/admin-account-setup/#troubleshooting","title":"Troubleshooting","text":""},{"location":"operations/admin-account-setup/#permission-denied-errors","title":"Permission Denied Errors","text":"<p>If the operator logs show permission errors:</p> <ol> <li>Check the admin account has all required privileges</li> <li>Verify the secret contains correct credentials</li> <li>Test connectivity manually:</li> </ol> <pre><code># PostgreSQL\nkubectl run psql-test --rm -it --image=postgres:16 -- \\\n  psql \"postgresql://dbprovision_admin:password@host:5432/postgres?sslmode=require\"\n\n# MySQL/MariaDB\nkubectl run mysql-test --rm -it --image=mysql:8 -- \\\n  mysql -h host -u dbprovision_admin -ppassword -e \"SHOW GRANTS;\"\n</code></pre>"},{"location":"operations/admin-account-setup/#cannot-create-database","title":"Cannot Create Database","text":"<p>PostgreSQL: <pre><code>-- Check CREATEDB attribute\nSELECT rolcreatedb FROM pg_roles WHERE rolname = 'dbprovision_admin';\n-- If false, grant it:\nALTER ROLE dbprovision_admin WITH CREATEDB;\n</code></pre></p> <p>MySQL/MariaDB: <pre><code>-- Check CREATE privilege\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n-- If missing, grant it:\nGRANT CREATE ON *.* TO 'dbprovision_admin'@'%';\n</code></pre></p>"},{"location":"operations/admin-account-setup/#cannot-terminate-connections","title":"Cannot Terminate Connections","text":"<p>PostgreSQL: <pre><code>-- Check pg_signal_backend membership\nSELECT pg_has_role('dbprovision_admin', 'pg_signal_backend', 'MEMBER');\n-- If false:\nGRANT pg_signal_backend TO dbprovision_admin;\n</code></pre></p> <p>MySQL/MariaDB: <pre><code>-- Check CONNECTION_ADMIN or SUPER\nSHOW GRANTS FOR 'dbprovision_admin'@'%';\n-- If missing:\nGRANT CONNECTION_ADMIN ON *.* TO 'dbprovision_admin'@'%';\n</code></pre></p>"},{"location":"operations/admin-account-setup/#next-steps","title":"Next Steps","text":"<ul> <li>PostgreSQL Guide - PostgreSQL-specific features</li> <li>MySQL Guide - MySQL-specific features</li> <li>MariaDB Guide - MariaDB-specific features</li> <li>CockroachDB Guide - CockroachDB-specific features</li> <li>Monitoring - Set up monitoring and alerting</li> </ul>"},{"location":"operations/events/","title":"Events Reference","text":"<p>DB Provision Operator emits Kubernetes events to provide visibility into resource lifecycle and operational status. Events are useful for monitoring, alerting, and debugging.</p>"},{"location":"operations/events/#viewing-events","title":"Viewing Events","text":""},{"location":"operations/events/#using-kubectl-describe","title":"Using kubectl describe","text":"<pre><code># View events for a specific resource\nkubectl describe database my-database\n\n# View events for all resources of a type\nkubectl describe databases\n</code></pre>"},{"location":"operations/events/#using-kubectl-get-events","title":"Using kubectl get events","text":"<pre><code># All events in a namespace\nkubectl get events -n my-namespace\n\n# Filter by resource\nkubectl get events --field-selector involvedObject.name=my-database\n\n# Filter by reason\nkubectl get events --field-selector reason=DriftDetected\n\n# Sort by timestamp\nkubectl get events --sort-by='.lastTimestamp'\n\n# Watch events in real-time\nkubectl get events -w\n</code></pre>"},{"location":"operations/events/#using-json-output-for-automation","title":"Using JSON output for automation","text":"<pre><code># Export events as JSON\nkubectl get events -o json | jq '.items[] | select(.reason | contains(\"Drift\"))'\n\n# Get events for a specific resource type\nkubectl get events -o json | jq '.items[] | select(.involvedObject.kind == \"Database\")'\n</code></pre>"},{"location":"operations/events/#events-by-resource-type","title":"Events by Resource Type","text":""},{"location":"operations/events/#databaseinstance","title":"DatabaseInstance","text":"Event Type Description <code>Connected</code> Normal Successfully connected to the database server <code>ConnectionFailed</code> Warning Failed to establish connection to the database server <code>HealthCheckPassed</code> Normal Health check succeeded <code>HealthCheckFailed</code> Warning Health check failed <code>DeletionBlocked</code> Warning Deletion blocked by deletion protection <code>ReconcileFailed</code> Warning Reconciliation loop encountered an error"},{"location":"operations/events/#database","title":"Database","text":"Event Type Description <code>Created</code> Normal Database was successfully created <code>Deleted</code> Normal Database was successfully deleted <code>CreateFailed</code> Warning Failed to create the database <code>DeleteFailed</code> Warning Failed to delete the database <code>DeletionBlocked</code> Warning Deletion blocked by deletion protection <code>DriftDetected</code> Warning Configuration drift was detected <code>DriftCorrected</code> Normal Drift was automatically corrected <code>DriftCorrectionFailed</code> Warning Failed to correct detected drift <code>ReconcileFailed</code> Warning Reconciliation loop encountered an error"},{"location":"operations/events/#databaseuser","title":"DatabaseUser","text":"Event Type Description <code>Created</code> Normal User was successfully created <code>Deleted</code> Normal User was successfully deleted <code>CreateFailed</code> Warning Failed to create the user <code>DeleteFailed</code> Warning Failed to delete the user <code>DeletionBlocked</code> Warning Deletion blocked by deletion protection <code>PasswordRotated</code> Normal User password was rotated <code>SecretCreated</code> Normal Credentials secret was created <code>SecretUpdated</code> Normal Credentials secret was updated <code>DriftDetected</code> Warning Configuration drift was detected <code>DriftCorrected</code> Normal Drift was automatically corrected <code>DriftCorrectionFailed</code> Warning Failed to correct detected drift <code>ReconcileFailed</code> Warning Reconciliation loop encountered an error"},{"location":"operations/events/#databaserole","title":"DatabaseRole","text":"Event Type Description <code>Created</code> Normal Role was successfully created <code>Deleted</code> Normal Role was successfully deleted <code>CreateFailed</code> Warning Failed to create the role <code>DeleteFailed</code> Warning Failed to delete the role <code>DeletionBlocked</code> Warning Deletion blocked by deletion protection <code>DriftDetected</code> Warning Configuration drift was detected <code>DriftCorrected</code> Normal Drift was automatically corrected <code>DriftCorrectionFailed</code> Warning Failed to correct detected drift <code>ReconcileFailed</code> Warning Reconciliation loop encountered an error"},{"location":"operations/events/#databasegrant","title":"DatabaseGrant","text":"Event Type Description <code>Applied</code> Normal Grants were successfully applied <code>Revoked</code> Normal Grants were successfully revoked <code>ApplyFailed</code> Warning Failed to apply grants <code>RevokeFailed</code> Warning Failed to revoke grants <code>DeletionBlocked</code> Warning Deletion blocked by deletion protection <code>DriftDetected</code> Warning Configuration drift was detected <code>DriftCorrected</code> Normal Drift was automatically corrected <code>DriftCorrectionFailed</code> Warning Failed to correct detected drift <code>ReconcileFailed</code> Warning Reconciliation loop encountered an error"},{"location":"operations/events/#databasebackup","title":"DatabaseBackup","text":"Event Type Description <code>Started</code> Normal Backup operation started <code>Completed</code> Normal Backup completed successfully <code>Failed</code> Warning Backup operation failed <code>ProgressUpdated</code> Normal Backup progress was updated <code>ReconcileFailed</code> Warning Reconciliation loop encountered an error"},{"location":"operations/events/#databaserestore","title":"DatabaseRestore","text":"Event Type Description <code>Started</code> Normal Restore operation started <code>Completed</code> Normal Restore completed successfully <code>Failed</code> Warning Restore operation failed <code>DeadlineExceeded</code> Warning Restore exceeded the configured timeout <code>ValidationFailed</code> Warning Restore validation failed <code>ProgressUpdated</code> Normal Restore progress was updated <code>ReconcileFailed</code> Warning Reconciliation loop encountered an error"},{"location":"operations/events/#databasebackupschedule","title":"DatabaseBackupSchedule","text":"Event Type Description <code>BackupTriggered</code> Normal Scheduled backup was triggered <code>Paused</code> Normal Backup schedule was paused <code>Resumed</code> Normal Backup schedule was resumed <code>DeletionBlocked</code> Warning Deletion blocked by deletion protection <code>RetentionApplied</code> Normal Retention policy was applied, old backups deleted <code>ReconcileFailed</code> Warning Reconciliation loop encountered an error"},{"location":"operations/events/#event-categories","title":"Event Categories","text":""},{"location":"operations/events/#lifecycle-events","title":"Lifecycle Events","text":"<p>Events related to resource creation and deletion:</p> <ul> <li><code>Created</code>, <code>Deleted</code> - Successful operations</li> <li><code>CreateFailed</code>, <code>DeleteFailed</code> - Failed operations</li> <li><code>DeletionBlocked</code> - Deletion protection active</li> </ul>"},{"location":"operations/events/#drift-events","title":"Drift Events","text":"<p>Events related to configuration drift detection and correction:</p> <ul> <li><code>DriftDetected</code> - Drift found between spec and actual state</li> <li><code>DriftCorrected</code> - Drift was automatically fixed</li> <li><code>DriftCorrectionFailed</code> - Auto-correction failed</li> </ul>"},{"location":"operations/events/#backuprestore-events","title":"Backup/Restore Events","text":"<p>Events related to backup and restore operations:</p> <ul> <li><code>Started</code>, <code>Completed</code>, <code>Failed</code> - Operation lifecycle</li> <li><code>ProgressUpdated</code> - Progress tracking</li> <li><code>DeadlineExceeded</code> - Timeout exceeded</li> <li><code>ValidationFailed</code> - Pre-restore validation failed</li> </ul>"},{"location":"operations/events/#connection-events","title":"Connection Events","text":"<p>Events related to database connectivity:</p> <ul> <li><code>Connected</code>, <code>ConnectionFailed</code> - Connection status</li> <li><code>HealthCheckPassed</code>, <code>HealthCheckFailed</code> - Health monitoring</li> </ul>"},{"location":"operations/events/#alerting-integration","title":"Alerting Integration","text":""},{"location":"operations/events/#prometheus-alertmanager","title":"Prometheus AlertManager","text":"<p>Use kube-state-metrics to convert events to metrics for alerting:</p> <pre><code># PrometheusRule for critical events\napiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: db-provision-alerts\nspec:\n  groups:\n    - name: db-provision-operator\n      rules:\n        - alert: DatabaseConnectionFailed\n          expr: |\n            increase(kubernetes_events_total{\n              reason=\"ConnectionFailed\",\n              involved_object_kind=\"DatabaseInstance\"\n            }[5m]) &gt; 0\n          for: 1m\n          labels:\n            severity: critical\n          annotations:\n            summary: \"Database connection failed\"\n            description: \"DatabaseInstance {{ $labels.involved_object_name }} failed to connect\"\n\n        - alert: DatabaseDriftDetected\n          expr: |\n            increase(kubernetes_events_total{\n              reason=\"DriftDetected\"\n            }[15m]) &gt; 0\n          for: 5m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Configuration drift detected\"\n            description: \"{{ $labels.involved_object_kind }}/{{ $labels.involved_object_name }} has configuration drift\"\n\n        - alert: BackupFailed\n          expr: |\n            increase(kubernetes_events_total{\n              reason=\"Failed\",\n              involved_object_kind=\"DatabaseBackup\"\n            }[1h]) &gt; 0\n          for: 0m\n          labels:\n            severity: critical\n          annotations:\n            summary: \"Database backup failed\"\n            description: \"Backup {{ $labels.involved_object_name }} failed\"\n</code></pre>"},{"location":"operations/events/#event-exporter","title":"Event Exporter","text":"<p>Use tools like kubernetes-event-exporter to forward events to external systems:</p> <pre><code># Event exporter configuration\napiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: event-exporter-config\ndata:\n  config.yaml: |\n    route:\n      routes:\n        - match:\n            - receiver: \"slack\"\n          drop:\n            - type: \"Normal\"  # Only alert on Warning events\n    receivers:\n      - name: \"slack\"\n        slack:\n          endpoint: \"https://hooks.slack.com/services/...\"\n          channel: \"#db-alerts\"\n          message: |\n            {{ .InvolvedObject.Kind }}/{{ .InvolvedObject.Name }}: {{ .Reason }}\n            {{ .Message }}\n</code></pre>"},{"location":"operations/events/#lokigrafana","title":"Loki/Grafana","text":"<p>Query events in Grafana using Loki:</p> <pre><code># All warning events from db-provision-operator\n{namespace=\"db-provision-operator-system\"} |= \"Warning\"\n\n# Drift detection events\n{namespace=\"default\"} | json | reason=\"DriftDetected\"\n\n# Failed backup events\n{namespace=\"default\"} | json | involvedObject_kind=\"DatabaseBackup\" | reason=\"Failed\"\n</code></pre>"},{"location":"operations/events/#best-practices","title":"Best Practices","text":""},{"location":"operations/events/#event-retention","title":"Event Retention","text":"<p>Kubernetes events have a default TTL of 1 hour. For longer retention:</p> <ol> <li> <p>Increase cluster event TTL (kube-apiserver flag):    <pre><code>--event-ttl=24h\n</code></pre></p> </li> <li> <p>Export events to external storage using event exporters</p> </li> <li> <p>Use the operator's metrics for long-term monitoring:    <pre><code>dbprovision_reconcile_errors_total\ndbprovision_drift_detected\n</code></pre></p> </li> </ol>"},{"location":"operations/events/#monitoring-strategy","title":"Monitoring Strategy","text":"Use Case Approach Real-time debugging <code>kubectl get events -w</code> Historical analysis Event exporter + log storage Alerting Prometheus rules on event metrics Dashboards Grafana with Loki or event-derived metrics"},{"location":"operations/events/#event-filtering","title":"Event Filtering","text":"<p>Focus on actionable events:</p> <pre><code># Only warning events (exclude Normal)\nkubectl get events --field-selector type=Warning\n\n# Specific reasons to watch\nkubectl get events --field-selector reason=ConnectionFailed\nkubectl get events --field-selector reason=DriftDetected\nkubectl get events --field-selector reason=BackupFailed\n</code></pre>"},{"location":"operations/events/#troubleshooting-with-events","title":"Troubleshooting with Events","text":""},{"location":"operations/events/#database-not-ready","title":"Database Not Ready","text":"<pre><code># Check for connection issues\nkubectl get events --field-selector involvedObject.name=my-instance,reason=ConnectionFailed\n\n# Check for creation failures\nkubectl get events --field-selector involvedObject.name=my-database,reason=CreateFailed\n</code></pre>"},{"location":"operations/events/#drift-not-being-corrected","title":"Drift Not Being Corrected","text":"<pre><code># Check for drift correction failures\nkubectl get events --field-selector reason=DriftCorrectionFailed\n\n# Verify drift is being detected\nkubectl get events --field-selector reason=DriftDetected\n</code></pre>"},{"location":"operations/events/#backup-issues","title":"Backup Issues","text":"<pre><code># Check backup lifecycle\nkubectl get events --field-selector involvedObject.kind=DatabaseBackup --sort-by='.lastTimestamp'\n\n# Check for failures\nkubectl get events --field-selector involvedObject.kind=DatabaseBackup,reason=Failed\n</code></pre>"},{"location":"operations/events/#deletion-blocked","title":"Deletion Blocked","text":"<pre><code># Find resources with deletion protection blocking\nkubectl get events --field-selector reason=DeletionBlocked\n</code></pre>"},{"location":"operations/monitoring/","title":"Monitoring","text":"<p>Set up monitoring, metrics, and alerting for DB Provision Operator.</p>"},{"location":"operations/monitoring/#prometheus-metrics","title":"Prometheus Metrics","text":""},{"location":"operations/monitoring/#enable-metrics","title":"Enable Metrics","text":"<p>Metrics are enabled by default. Configure via Helm:</p> <pre><code># values.yaml\nmetrics:\n  enabled: true\n  port: 8080\n  serviceMonitor:\n    enabled: true\n    interval: 30s\n</code></pre>"},{"location":"operations/monitoring/#metrics-namespace","title":"Metrics Namespace","text":"<p>Correct Metric Prefix</p> <p>All metrics use the <code>dbops_</code> namespace prefix. Do not use <code>db_provision_</code> - that prefix is incorrect.</p>"},{"location":"operations/monitoring/#available-metrics-27-total","title":"Available Metrics (27 total)","text":"<p>All metrics use the <code>dbops_</code> namespace prefix.</p>"},{"location":"operations/monitoring/#connection-metrics","title":"Connection Metrics","text":"Metric Type Labels Description <code>dbops_connection_attempts_total</code> Counter instance, engine, status, namespace Total connection attempts (status: success/failure) <code>dbops_connection_latency_seconds</code> Histogram instance, engine, namespace Connection latency distribution (buckets: 1ms to 10s)"},{"location":"operations/monitoring/#instance-health-metrics","title":"Instance Health Metrics","text":"Metric Type Labels Description <code>dbops_instance_healthy</code> Gauge instance, engine, namespace Instance health (1=healthy, 0=unhealthy) <code>dbops_instance_last_health_check_timestamp_seconds</code> Gauge instance, engine, namespace Unix timestamp of last health check"},{"location":"operations/monitoring/#database-operation-metrics","title":"Database Operation Metrics","text":"Metric Type Labels Description <code>dbops_database_operations_total</code> Counter operation, engine, status, namespace Total database operations (create/update/delete) <code>dbops_database_operation_duration_seconds</code> Histogram operation, engine, namespace Operation duration distribution <code>dbops_database_size_bytes</code> Gauge database, instance, engine, namespace Database size in bytes"},{"location":"operations/monitoring/#userrolegrant-operation-metrics","title":"User/Role/Grant Operation Metrics","text":"Metric Type Labels Description <code>dbops_user_operations_total</code> Counter operation, engine, status, namespace Total user operations <code>dbops_role_operations_total</code> Counter operation, engine, status, namespace Total role operations <code>dbops_grant_operations_total</code> Counter operation, engine, status, namespace Total grant operations"},{"location":"operations/monitoring/#backup-metrics","title":"Backup Metrics","text":"Metric Type Labels Description <code>dbops_backup_operations_total</code> Counter engine, status, namespace Total backup operations <code>dbops_backup_duration_seconds</code> Histogram engine, namespace Backup duration (buckets: 1s to 1h) <code>dbops_backup_size_bytes</code> Gauge database, engine, namespace Backup size in bytes <code>dbops_backup_last_success_timestamp_seconds</code> Gauge database, engine, namespace Last successful backup Unix timestamp"},{"location":"operations/monitoring/#restore-metrics","title":"Restore Metrics","text":"Metric Type Labels Description <code>dbops_restore_operations_total</code> Counter engine, status, namespace Total restore operations <code>dbops_restore_duration_seconds</code> Histogram engine, namespace Restore duration distribution"},{"location":"operations/monitoring/#schedule-metrics","title":"Schedule Metrics","text":"Metric Type Labels Description <code>dbops_scheduled_backups_total</code> Counter status, namespace Total scheduled backup triggers <code>dbops_schedule_next_backup_timestamp_seconds</code> Gauge database, namespace Next scheduled backup Unix timestamp"},{"location":"operations/monitoring/#resource-metrics","title":"Resource Metrics","text":"Metric Type Labels Description <code>dbops_resource_count</code> Gauge resource_type, phase, namespace Count of resources by type and phase"},{"location":"operations/monitoring/#info-metrics-for-grafana-tables","title":"Info Metrics (for Grafana Tables)","text":"<p>Info metrics expose resource metadata as labels. The value is always <code>1</code>, following the kube-state-metrics pattern.</p> Metric Type Labels Description <code>dbops_instance_info</code> Gauge instance, namespace, engine, version, host, port, phase Instance metadata <code>dbops_database_info</code> Gauge database, namespace, instance_ref, db_name, phase Database metadata <code>dbops_user_info</code> Gauge user, namespace, instance_ref, username, phase User metadata <code>dbops_role_info</code> Gauge role, namespace, instance_ref, role_name, phase Role metadata <code>dbops_grant_info</code> Gauge grant, namespace, user_ref, database_ref, privileges, phase Grant metadata <code>dbops_backup_info</code> Gauge backup, namespace, database_ref, storage_type, phase Backup metadata <code>dbops_schedule_info</code> Gauge schedule, namespace, database_ref, cron, paused Schedule metadata <code>dbops_restore_info</code> Gauge restore, namespace, backup_ref, target_instance, phase Restore metadata"},{"location":"operations/monitoring/#label-values","title":"Label Values","text":"Label Possible Values <code>status</code> <code>success</code>, <code>failure</code> <code>operation</code> <code>create</code>, <code>update</code>, <code>delete</code>, <code>connect</code>, <code>backup</code>, <code>restore</code> <code>engine</code> <code>postgres</code>, <code>mysql</code>, <code>mariadb</code> <code>phase</code> <code>Pending</code>, <code>Ready</code>, <code>Failed</code>, <code>Deleting</code>"},{"location":"operations/monitoring/#servicemonitor","title":"ServiceMonitor","text":"<pre><code>apiVersion: monitoring.coreos.com/v1\nkind: ServiceMonitor\nmetadata:\n  name: db-provision-operator\n  namespace: db-provision-operator-system\n  labels:\n    app: db-provision-operator\nspec:\n  selector:\n    matchLabels:\n      app.kubernetes.io/name: db-provision-operator\n  endpoints:\n    - port: metrics\n      interval: 30s\n      path: /metrics\n</code></pre>"},{"location":"operations/monitoring/#grafana-dashboards","title":"Grafana Dashboards","text":"<p>The operator provides 9 pre-built Grafana dashboards in the <code>dashboards/</code> directory.</p>"},{"location":"operations/monitoring/#dashboard-overview","title":"Dashboard Overview","text":"Dashboard File Purpose Overview <code>overview.json</code> High-level summary of all resources Instances <code>instances.json</code> Database instance health and connections Databases <code>databases.json</code> Database operations and sizes Users <code>users.json</code> User management operations Roles <code>roles.json</code> Role management operations Grants <code>grants.json</code> Grant operations and permissions Backups <code>backups.json</code> Backup operations, sizes, and success rates Schedules <code>schedules.json</code> Backup schedule status and timing Restores <code>restores.json</code> Restore operations and durations"},{"location":"operations/monitoring/#dashboard-details","title":"Dashboard Details","text":""},{"location":"operations/monitoring/#1-overview-dashboard-overviewjson","title":"1. Overview Dashboard (<code>overview.json</code>)","text":"<p>The main entry point showing:</p> <ul> <li>Resource Summary: Count of instances, databases, users, roles, grants</li> <li>Health Status: Healthy vs unhealthy instances</li> <li>Operation Rates: Create/update/delete operations per minute</li> <li>Error Rates: Failed operations across all resource types</li> <li>Recent Activity: Timeline of resource changes</li> </ul> <p>Key metrics used: - <code>dbops_resource_count</code> - <code>dbops_instance_healthy</code> - <code>dbops_*_operations_total</code></p>"},{"location":"operations/monitoring/#2-instances-dashboard-instancesjson","title":"2. Instances Dashboard (<code>instances.json</code>)","text":"<p>Detailed instance monitoring:</p> <ul> <li>Instance Table: List all instances with engine, host, port, phase</li> <li>Connection Status: Health status per instance</li> <li>Connection Latency: P50, P90, P99 latency percentiles</li> <li>Connection Attempts: Success/failure rates over time</li> <li>Health Check History: Timeline of health check results</li> </ul> <p>Key metrics used: - <code>dbops_instance_info</code> - <code>dbops_instance_healthy</code> - <code>dbops_connection_latency_seconds</code> - <code>dbops_connection_attempts_total</code></p>"},{"location":"operations/monitoring/#3-databases-dashboard-databasesjson","title":"3. Databases Dashboard (<code>databases.json</code>)","text":"<p>Database operations and sizes:</p> <ul> <li>Database Table: List databases with instance, name, phase</li> <li>Database Sizes: Size per database over time</li> <li>Operation Counts: Create/update/delete operations</li> <li>Operation Duration: P50, P90, P99 duration percentiles</li> </ul> <p>Key metrics used: - <code>dbops_database_info</code> - <code>dbops_database_size_bytes</code> - <code>dbops_database_operations_total</code> - <code>dbops_database_operation_duration_seconds</code></p>"},{"location":"operations/monitoring/#4-users-dashboard-usersjson","title":"4. Users Dashboard (<code>users.json</code>)","text":"<p>User management:</p> <ul> <li>User Table: List users with instance, username, phase</li> <li>Operation Counts: User create/update/delete operations</li> <li>Operation Status: Success vs failure rates</li> </ul> <p>Key metrics used: - <code>dbops_user_info</code> - <code>dbops_user_operations_total</code></p>"},{"location":"operations/monitoring/#5-roles-dashboard-rolesjson","title":"5. Roles Dashboard (<code>roles.json</code>)","text":"<p>Role management:</p> <ul> <li>Role Table: List roles with instance, role name, phase</li> <li>Operation Counts: Role operations over time</li> </ul> <p>Key metrics used: - <code>dbops_role_info</code> - <code>dbops_role_operations_total</code></p>"},{"location":"operations/monitoring/#6-grants-dashboard-grantsjson","title":"6. Grants Dashboard (<code>grants.json</code>)","text":"<p>Permission grants:</p> <ul> <li>Grant Table: List grants with user, database, privileges, phase</li> <li>Operation Counts: Grant operations over time</li> </ul> <p>Key metrics used: - <code>dbops_grant_info</code> - <code>dbops_grant_operations_total</code></p>"},{"location":"operations/monitoring/#7-backups-dashboard-backupsjson","title":"7. Backups Dashboard (<code>backups.json</code>)","text":"<p>Backup monitoring:</p> <ul> <li>Backup Table: List backups with database, storage type, phase</li> <li>Backup Success Rate: Success vs failure over time</li> <li>Backup Sizes: Size per backup</li> <li>Backup Duration: Duration histogram</li> <li>Last Success Age: Time since last successful backup</li> </ul> <p>Key metrics used: - <code>dbops_backup_info</code> - <code>dbops_backup_operations_total</code> - <code>dbops_backup_size_bytes</code> - <code>dbops_backup_duration_seconds</code> - <code>dbops_backup_last_success_timestamp_seconds</code></p>"},{"location":"operations/monitoring/#8-schedules-dashboard-schedulesjson","title":"8. Schedules Dashboard (<code>schedules.json</code>)","text":"<p>Backup scheduling:</p> <ul> <li>Schedule Table: List schedules with database, cron, paused status</li> <li>Scheduled Backup Counts: Triggered backups over time</li> <li>Next Backup Times: Upcoming scheduled backups</li> <li>Schedule Status: Active vs paused schedules</li> </ul> <p>Key metrics used: - <code>dbops_schedule_info</code> - <code>dbops_scheduled_backups_total</code> - <code>dbops_schedule_next_backup_timestamp_seconds</code></p>"},{"location":"operations/monitoring/#9-restores-dashboard-restoresjson","title":"9. Restores Dashboard (<code>restores.json</code>)","text":"<p>Restore operations:</p> <ul> <li>Restore Table: List restores with backup, target instance, phase</li> <li>Restore Counts: Operations over time</li> <li>Restore Duration: Duration histogram</li> </ul> <p>Key metrics used: - <code>dbops_restore_info</code> - <code>dbops_restore_operations_total</code> - <code>dbops_restore_duration_seconds</code></p>"},{"location":"operations/monitoring/#installing-dashboards","title":"Installing Dashboards","text":""},{"location":"operations/monitoring/#via-helm-recommended","title":"Via Helm (Recommended)","text":"<pre><code># values.yaml\ngrafana:\n  dashboards:\n    enabled: true\n    provider:\n      name: db-provision-operator\n      folder: DB Provision\n</code></pre>"},{"location":"operations/monitoring/#manual-import-all-dashboards","title":"Manual Import (All Dashboards)","text":"<pre><code># Import all dashboards\nfor dashboard in dashboards/*.json; do\n  curl -X POST http://admin:admin@localhost:3000/api/dashboards/db/import \\\n    -H \"Content-Type: application/json\" \\\n    -d \"{\\\"dashboard\\\": $(cat $dashboard), \\\"overwrite\\\": true}\"\ndone\n</code></pre>"},{"location":"operations/monitoring/#via-configmap-kubernetes","title":"Via ConfigMap (Kubernetes)","text":"<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: grafana-dashboards-dbops\n  labels:\n    grafana_dashboard: \"1\"\ndata:\n  overview.json: |\n    &lt;dashboard JSON content&gt;\n</code></pre>"},{"location":"operations/monitoring/#custom-queries","title":"Custom Queries","text":"<p>Instance health status: <pre><code>dbops_instance_healthy{engine=\"postgres\"}\n</code></pre></p> <p>Connection error rate: <pre><code>rate(dbops_connection_attempts_total{status=\"failure\"}[5m])\n/ rate(dbops_connection_attempts_total[5m])\n</code></pre></p> <p>Database operations by type: <pre><code>sum by (operation, status) (rate(dbops_database_operations_total[5m]))\n</code></pre></p> <p>Backup age (seconds since last success): <pre><code>time() - dbops_backup_last_success_timestamp_seconds\n</code></pre></p> <p>Resource counts by phase: <pre><code>sum by (resource_type, phase) (dbops_resource_count)\n</code></pre></p> <p>Connection latency P99: <pre><code>histogram_quantile(0.99, rate(dbops_connection_latency_seconds_bucket[5m]))\n</code></pre></p> <p>Backup duration P95: <pre><code>histogram_quantile(0.95, rate(dbops_backup_duration_seconds_bucket[5m]))\n</code></pre></p>"},{"location":"operations/monitoring/#alerting","title":"Alerting","text":""},{"location":"operations/monitoring/#prometheusrule","title":"PrometheusRule","text":"<pre><code>apiVersion: monitoring.coreos.com/v1\nkind: PrometheusRule\nmetadata:\n  name: db-provision-alerts\n  namespace: db-provision-operator-system\nspec:\n  groups:\n    - name: db-provision-operator\n      rules:\n        # Instance connectivity\n        - alert: DatabaseInstanceUnhealthy\n          expr: dbops_instance_healthy == 0\n          for: 5m\n          labels:\n            severity: critical\n          annotations:\n            summary: \"Database instance {{ $labels.instance }} is unhealthy\"\n            description: \"Instance {{ $labels.instance }} ({{ $labels.engine }}) has been unhealthy for more than 5 minutes\"\n\n        # High connection error rate\n        - alert: HighConnectionErrorRate\n          expr: |\n            rate(dbops_connection_attempts_total{status=\"failure\"}[5m])\n            / rate(dbops_connection_attempts_total[5m]) &gt; 0.1\n          for: 10m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"High connection error rate for {{ $labels.instance }}\"\n            description: \"More than 10% of connection attempts are failing\"\n\n        # High operation error rate\n        - alert: HighDatabaseOperationErrorRate\n          expr: |\n            rate(dbops_database_operations_total{status=\"failure\"}[5m])\n            / rate(dbops_database_operations_total[5m]) &gt; 0.1\n          for: 10m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"High database operation error rate\"\n            description: \"More than 10% of database operations are failing\"\n\n        # Backup alerts\n        - alert: BackupFailed\n          expr: |\n            increase(dbops_backup_operations_total{status=\"failure\"}[1h]) &gt; 0\n          for: 1m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Backup failed for {{ $labels.engine }}\"\n            description: \"A backup operation failed in the last hour\"\n\n        - alert: BackupOverdue\n          expr: |\n            time() - dbops_backup_last_success_timestamp_seconds &gt; 86400\n          for: 1h\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Backup overdue for {{ $labels.database }}\"\n            description: \"No successful backup in the last 24 hours\"\n\n        # Resource stuck in pending\n        - alert: ResourceStuckPending\n          expr: |\n            dbops_resource_count{phase=\"Pending\"} &gt; 0\n          for: 30m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"Resources stuck in Pending state\"\n            description: \"{{ $value }} {{ $labels.resource_type }} resources have been Pending for more than 30 minutes\"\n\n        # Connection latency\n        - alert: HighConnectionLatency\n          expr: |\n            histogram_quantile(0.95, rate(dbops_connection_latency_seconds_bucket[5m])) &gt; 1\n          for: 10m\n          labels:\n            severity: warning\n          annotations:\n            summary: \"High connection latency for {{ $labels.instance }}\"\n            description: \"P95 connection latency is above 1 second\"\n\n        # Restore failures\n        - alert: RestoreFailed\n          expr: |\n            increase(dbops_restore_operations_total{status=\"failure\"}[1h]) &gt; 0\n          for: 1m\n          labels:\n            severity: critical\n          annotations:\n            summary: \"Database restore failed\"\n            description: \"A restore operation failed in the last hour\"\n</code></pre>"},{"location":"operations/monitoring/#alert-severity-guidelines","title":"Alert Severity Guidelines","text":"Severity Response Examples <code>critical</code> Immediate Instance unhealthy, operator down <code>warning</code> Within hours Backup failed, high error rate <code>info</code> Next business day Resource stuck, minor issues"},{"location":"operations/monitoring/#logging","title":"Logging","text":""},{"location":"operations/monitoring/#log-levels","title":"Log Levels","text":"<p>Configure log level via Helm:</p> <pre><code>logging:\n  level: info  # debug, info, warn, error\n  format: json  # json, text\n</code></pre>"},{"location":"operations/monitoring/#log-format","title":"Log Format","text":"<p>JSON logs for aggregation:</p> <pre><code>{\n  \"level\": \"info\",\n  \"ts\": \"2024-01-01T00:00:00.000Z\",\n  \"logger\": \"controller.database\",\n  \"msg\": \"Reconciling Database\",\n  \"namespace\": \"default\",\n  \"name\": \"myapp-database\",\n  \"generation\": 1\n}\n</code></pre>"},{"location":"operations/monitoring/#log-queries","title":"Log Queries","text":"<p>Loki/Grafana: <pre><code>{namespace=\"db-provision-operator-system\"} |= \"error\"\n</code></pre></p> <p>Elasticsearch: <pre><code>{\n  \"query\": {\n    \"bool\": {\n      \"must\": [\n        {\"match\": {\"kubernetes.namespace\": \"db-provision-operator-system\"}},\n        {\"match\": {\"level\": \"error\"}}\n      ]\n    }\n  }\n}\n</code></pre></p>"},{"location":"operations/monitoring/#health-endpoints","title":"Health Endpoints","text":""},{"location":"operations/monitoring/#operator-health","title":"Operator Health","text":"<pre><code># Readiness probe\ncurl http://operator:8081/readyz\n\n# Liveness probe\ncurl http://operator:8081/healthz\n\n# Metrics endpoint\ncurl http://operator:8080/metrics\n</code></pre>"},{"location":"operations/monitoring/#database-instance-health","title":"Database Instance Health","text":"<p>Check via status:</p> <pre><code>kubectl get databaseinstance postgres-primary -o jsonpath='{.status.conditions[?(@.type==\"Healthy\")].status}'\n</code></pre>"},{"location":"operations/monitoring/#tracing-optional","title":"Tracing (Optional)","text":"<p>Enable OpenTelemetry tracing:</p> <pre><code># values.yaml\ntracing:\n  enabled: true\n  endpoint: \"http://jaeger-collector:14268/api/traces\"\n  samplingRate: 0.1\n</code></pre>"},{"location":"operations/monitoring/#resource-monitoring","title":"Resource Monitoring","text":""},{"location":"operations/monitoring/#watch-resource-changes","title":"Watch Resource Changes","text":"<pre><code># Watch all DB Provision resources\nkubectl get databaseinstances,databases,databaseusers -A -w\n</code></pre>"},{"location":"operations/monitoring/#status-summary-script","title":"Status Summary Script","text":"<pre><code>#!/bin/bash\necho \"=== DB Provision Operator Status ===\"\necho \"\"\necho \"Instances:\"\nkubectl get databaseinstances -A -o custom-columns=\\\n'NAMESPACE:.metadata.namespace,NAME:.metadata.name,ENGINE:.spec.engine,PHASE:.status.phase'\necho \"\"\necho \"Databases:\"\nkubectl get databases -A -o custom-columns=\\\n'NAMESPACE:.metadata.namespace,NAME:.metadata.name,INSTANCE:.spec.instanceRef.name,PHASE:.status.phase'\necho \"\"\necho \"Users:\"\nkubectl get databaseusers -A -o custom-columns=\\\n'NAMESPACE:.metadata.namespace,NAME:.metadata.name,USERNAME:.spec.username,PHASE:.status.phase'\necho \"\"\necho \"Backups:\"\nkubectl get databasebackups -A -o custom-columns=\\\n'NAMESPACE:.metadata.namespace,NAME:.metadata.name,PHASE:.status.phase,SIZE:.status.backupSize'\n</code></pre>"},{"location":"operations/monitoring/#best-practices","title":"Best Practices","text":"<ol> <li>Set up alerts before going to production</li> <li>Monitor backup success - set up alerts for backup failures</li> <li>Track reconciliation errors - investigate spikes in error rate</li> <li>Dashboard review - regularly review dashboards for anomalies</li> <li>Log retention - keep logs for debugging production issues</li> </ol>"},{"location":"operations/troubleshooting/","title":"Troubleshooting","text":"<p>Common issues and solutions for DB Provision Operator.</p>"},{"location":"operations/troubleshooting/#diagnostic-commands","title":"Diagnostic Commands","text":""},{"location":"operations/troubleshooting/#quick-health-check","title":"Quick Health Check","text":"<pre><code># Operator status\nkubectl get pods -n db-provision-operator-system\n\n# Resource status\nkubectl get databaseinstances,databases,databaseusers -A\n\n# Recent events\nkubectl get events -n db-provision-operator-system --sort-by='.lastTimestamp' | tail -20\n</code></pre>"},{"location":"operations/troubleshooting/#detailed-debugging","title":"Detailed Debugging","text":"<pre><code># Operator logs\nkubectl logs -n db-provision-operator-system deployment/db-provision-operator -f\n\n# Specific resource details\nkubectl describe databaseinstance postgres-primary\n\n# Resource YAML\nkubectl get databaseinstance postgres-primary -o yaml\n</code></pre>"},{"location":"operations/troubleshooting/#common-issues","title":"Common Issues","text":""},{"location":"operations/troubleshooting/#databaseinstance-issues","title":"DatabaseInstance Issues","text":""},{"location":"operations/troubleshooting/#instance-stuck-in-pending","title":"Instance Stuck in Pending","text":"<p>Symptoms: <pre><code>NAME              ENGINE    PHASE\npostgres-primary  postgres  Pending\n</code></pre></p> <p>Causes and Solutions:</p> <ol> <li> <p>Cannot connect to database: <pre><code># Check connectivity\nkubectl run psql-test --rm -it --image=postgres:15 -- \\\n  psql \"postgresql://user:pass@host:5432/postgres?sslmode=disable\" -c \"SELECT 1\"\n</code></pre></p> </li> <li> <p>Invalid credentials: <pre><code># Verify secret exists and has correct keys\nkubectl get secret postgres-admin-credentials -o yaml\n</code></pre></p> </li> <li> <p>DNS resolution: <pre><code># Test DNS from within cluster\nkubectl run dns-test --rm -it --image=busybox -- nslookup postgres.database.svc.cluster.local\n</code></pre></p> </li> </ol>"},{"location":"operations/troubleshooting/#instance-shows-failed","title":"Instance Shows Failed","text":"<p>Check events: <pre><code>kubectl describe databaseinstance postgres-primary | grep -A10 \"Events:\"\n</code></pre></p> <p>Common errors:</p> Error Solution <code>connection refused</code> Check database is running, correct port <code>authentication failed</code> Verify credentials in Secret <code>SSL required</code> Add <code>sslMode: require</code> to spec <code>unknown host</code> Check hostname and DNS"},{"location":"operations/troubleshooting/#database-issues","title":"Database Issues","text":""},{"location":"operations/troubleshooting/#database-not-created","title":"Database Not Created","text":"<p>Check dependencies: <pre><code># Instance must be Ready\nkubectl get databaseinstance postgres-primary -o jsonpath='{.status.phase}'\n</code></pre></p> <p>Check logs: <pre><code>kubectl logs -n db-provision-operator-system deployment/db-provision-operator | grep \"myapp-database\"\n</code></pre></p>"},{"location":"operations/troubleshooting/#extension-installation-failed","title":"Extension Installation Failed","text":"<p>Common causes:</p> <ol> <li> <p>Extension not available:    <pre><code>-- Check available extensions in database\nSELECT * FROM pg_available_extensions;\n</code></pre></p> </li> <li> <p>Insufficient permissions:    <pre><code>-- Admin user needs CREATE permission\nGRANT CREATE ON DATABASE myapp TO admin_user;\n</code></pre></p> </li> </ol>"},{"location":"operations/troubleshooting/#user-issues","title":"User Issues","text":""},{"location":"operations/troubleshooting/#user-not-created","title":"User Not Created","text":"<p>Check instance status: <pre><code>kubectl get databaseinstance -o jsonpath='{.status.phase}'\n# Must be \"Ready\"\n</code></pre></p> <p>Verify username is valid: - PostgreSQL: alphanumeric and underscores - MySQL: max 32 characters</p>"},{"location":"operations/troubleshooting/#password-not-generated","title":"Password Not Generated","text":"<p>Check secret: <pre><code>kubectl get secret myapp-user-credentials\n</code></pre></p> <p>If missing: 1. Verify <code>passwordSecret.generate: true</code> in spec 2. Check <code>passwordSecret.secretName</code> is specified 3. Look for errors in operator logs</p>"},{"location":"operations/troubleshooting/#cannot-connect-with-generated-password","title":"Cannot Connect with Generated Password","text":"<p>Verify credentials: <pre><code># Get password\nkubectl get secret myapp-user-credentials -o jsonpath='{.data.password}' | base64 -d\n\n# Test connection\nkubectl run psql-test --rm -it --image=postgres:15 -- \\\n  psql \"postgresql://myapp_user:PASSWORD@postgres:5432/myapp\"\n</code></pre></p>"},{"location":"operations/troubleshooting/#grant-issues","title":"Grant Issues","text":""},{"location":"operations/troubleshooting/#grants-not-applied","title":"Grants Not Applied","text":"<p>Prerequisites: 1. User/Role must exist and be Ready 2. Database must exist 3. Tables/schemas must exist</p> <p>Check user status: <pre><code>kubectl get databaseuser myapp-user -o jsonpath='{.status.phase}'\n</code></pre></p> <p>Verify grants in database: <pre><code>-- PostgreSQL\n\\dp tablename\n-- or\nSELECT * FROM information_schema.table_privileges WHERE grantee = 'myapp_user';\n</code></pre></p>"},{"location":"operations/troubleshooting/#backup-issues","title":"Backup Issues","text":""},{"location":"operations/troubleshooting/#backup-stuck-in-running","title":"Backup Stuck in Running","text":"<p>Check backup job: <pre><code>kubectl get jobs -l backup-name=myapp-backup\nkubectl logs job/myapp-backup-job\n</code></pre></p> <p>Common causes: - Large database taking long time - Network issues to storage - Insufficient resources</p>"},{"location":"operations/troubleshooting/#backup-failed","title":"Backup Failed","text":"<p>Check job logs: <pre><code>kubectl logs job/myapp-backup-job\n</code></pre></p> <p>Storage issues: <pre><code># Verify storage credentials\nkubectl get secret s3-credentials -o yaml\n\n# Test S3 connectivity\nkubectl run aws-cli --rm -it --image=amazon/aws-cli -- s3 ls s3://my-bucket/\n</code></pre></p>"},{"location":"operations/troubleshooting/#schedule-not-triggering","title":"Schedule Not Triggering","text":"<p>Verify schedule: <pre><code>kubectl get databasebackupschedule myapp-backup -o yaml | grep schedule\n</code></pre></p> <p>Check timezone: <pre><code># Schedule uses UTC by default\nkubectl get databasebackupschedule myapp-backup -o jsonpath='{.spec.timezone}'\n</code></pre></p>"},{"location":"operations/troubleshooting/#restore-issues","title":"Restore Issues","text":""},{"location":"operations/troubleshooting/#restore-failed","title":"Restore Failed","text":"<p>Check restore job: <pre><code>kubectl logs job/myapp-restore-job\n</code></pre></p> <p>Common errors:</p> Error Solution <code>database exists</code> Set <code>dropExisting: true</code> or delete database <code>backup not found</code> Verify backup exists and path is correct <code>permission denied</code> Check storage credentials"},{"location":"operations/troubleshooting/#drift-detection-issues","title":"Drift Detection Issues","text":""},{"location":"operations/troubleshooting/#drift-not-detected","title":"Drift Not Detected","text":"<p>Check drift mode: <pre><code>kubectl get database myapp -o jsonpath='{.spec.driftPolicy.mode}'\n# Must be \"detect\" or \"correct\", not \"ignore\"\n</code></pre></p> <p>Check last drift check time: <pre><code>kubectl get database myapp -o jsonpath='{.status.drift.lastChecked}'\n</code></pre></p> <p>Verify interval has passed: <pre><code># Default is 5m, check configured interval\nkubectl get database myapp -o jsonpath='{.spec.driftPolicy.interval}'\n</code></pre></p> <p>Check operator logs: <pre><code>kubectl logs -n db-provision-operator-system deployment/db-provision-operator | grep -i drift\n</code></pre></p>"},{"location":"operations/troubleshooting/#drift-detected-but-not-corrected","title":"Drift Detected But Not Corrected","text":"<p>Check drift mode: <pre><code># Mode must be \"correct\", not \"detect\"\nkubectl get database myapp -o jsonpath='{.spec.driftPolicy.mode}'\n</code></pre></p> <p>Check if field is immutable: <pre><code>kubectl get database myapp -o jsonpath='{.status.drift.diffs}' | jq '.[] | select(.immutable==true)'\n</code></pre></p> <p>Check if correction is destructive: <pre><code>kubectl get database myapp -o jsonpath='{.status.drift.diffs}' | jq '.[] | select(.destructive==true)'\n</code></pre></p> <p>Allow destructive corrections (use with caution): <pre><code>kubectl annotate database myapp dbops.dbprovision.io/allow-destructive-drift=\"true\"\n</code></pre></p>"},{"location":"operations/troubleshooting/#drift-correction-failed","title":"Drift Correction Failed","text":"<p>Check events: <pre><code>kubectl get events --field-selector reason=DriftCorrectionFailed,involvedObject.name=myapp\n</code></pre></p> <p>Common causes:</p> Cause Solution Insufficient privileges Check admin account permissions Field is immutable Cannot auto-correct, update spec to match Database object locked Check for active transactions or locks"},{"location":"operations/troubleshooting/#drift-keeps-reappearing","title":"Drift Keeps Reappearing","text":"<p>Possible causes:</p> <ol> <li>External processes making changes:</li> <li> <p>Check for migration scripts, other operators, or manual changes</p> </li> <li> <p>Application creating/modifying objects:</p> </li> <li> <p>Review application database connection and permissions</p> </li> <li> <p>Spec doesn't match intended state:</p> </li> <li>Update CR spec to match desired configuration</li> </ol>"},{"location":"operations/troubleshooting/#deletion-protection-issues","title":"Deletion Protection Issues","text":""},{"location":"operations/troubleshooting/#cannot-delete-protected-resource","title":"Cannot Delete Protected Resource","text":"<p>Check if deletion protection is enabled: <pre><code>kubectl get database myapp -o jsonpath='{.spec.deletionProtection}'\n</code></pre></p> <p>Method 1: Disable protection in spec: <pre><code>kubectl patch database myapp -p '{\"spec\":{\"deletionProtection\":false}}'\nkubectl delete database myapp\n</code></pre></p> <p>Method 2: Force delete annotation: <pre><code>kubectl annotate database myapp dbops.dbprovision.io/force-delete=\"true\"\n# Resource will be deleted on next reconciliation\n</code></pre></p> <p>Method 3: One-liner: <pre><code>kubectl patch database myapp -p '{\"spec\":{\"deletionProtection\":false}}' &amp;&amp; kubectl delete database myapp\n</code></pre></p>"},{"location":"operations/troubleshooting/#resource-stuck-in-terminating","title":"Resource Stuck in Terminating","text":"<p>Check for DeletionBlocked events: <pre><code>kubectl describe database myapp | grep -A5 \"Events:\"\n</code></pre></p> <p>Check finalizers: <pre><code>kubectl get database myapp -o jsonpath='{.metadata.finalizers}'\n</code></pre></p> <p>If operator is running, disable protection: <pre><code>kubectl patch database myapp -p '{\"spec\":{\"deletionProtection\":false}}'\n</code></pre></p> <p>If operator is down (emergency only): <pre><code># WARNING: Bypasses cleanup logic, may leave orphaned database objects\nkubectl patch database myapp -p '{\"metadata\":{\"finalizers\":null}}' --type=merge\n</code></pre></p>"},{"location":"operations/troubleshooting/#namespace-stuck-deleting","title":"Namespace Stuck Deleting","text":"<p>Find protected resources blocking deletion: <pre><code>kubectl get databases,databaseusers,databaseroles,databasegrants -n my-namespace \\\n  -o jsonpath='{range .items[?(@.spec.deletionProtection==true)]}{.kind}/{.metadata.name}{\"\\n\"}{end}'\n</code></pre></p> <p>Force delete all protected resources: <pre><code>for kind in database databaseuser databaserole databasegrant databasebackupschedule; do\n  for name in $(kubectl get $kind -n my-namespace -o name 2&gt;/dev/null); do\n    kubectl annotate $name -n my-namespace dbops.dbprovision.io/force-delete=\"true\" --overwrite\n  done\ndone\n</code></pre></p>"},{"location":"operations/troubleshooting/#cockroachdb-issues","title":"CockroachDB Issues","text":""},{"location":"operations/troubleshooting/#connection-failed-in-insecure-mode","title":"Connection Failed in Insecure Mode","text":"<p>Error: <code>password authentication failed</code></p> <p>Cause: CockroachDB insecure mode doesn't support passwords.</p> <p>Solution: Use empty password in secret: <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: cockroach-admin-credentials\ntype: Opaque\nstringData:\n  username: dbprovision_admin\n  password: \"\"  # Must be empty\n</code></pre></p> <p>Verify insecure mode: <pre><code>kubectl exec -it cockroachdb-0 -- cockroach sql --insecure -e \"SHOW CLUSTER SETTING server.host_based_authentication.enabled;\"\n</code></pre></p>"},{"location":"operations/troubleshooting/#cannot-create-user-with-password","title":"Cannot Create User with Password","text":"<p>Error: <code>password is not supported in insecure mode</code></p> <p>Cause: Attempting to create user with password on insecure cluster.</p> <p>Solution: The operator automatically handles this. Users are created without passwords in insecure mode.</p>"},{"location":"operations/troubleshooting/#permission-denied-for-grants","title":"Permission Denied for Grants","text":"<p>Error: <code>must be admin or owner</code></p> <p>Cause: Admin user doesn't have <code>admin</code> role membership.</p> <p>Solution: <pre><code>-- Connect to CockroachDB as root\nGRANT admin TO dbprovision_admin;\n</code></pre></p>"},{"location":"operations/troubleshooting/#cannot-create-database","title":"Cannot Create Database","text":"<p>Error: <code>user does not have CREATEDB privilege</code></p> <p>Solution: <pre><code>ALTER USER dbprovision_admin WITH CREATEDB;\n</code></pre></p>"},{"location":"operations/troubleshooting/#tls-certificate-errors","title":"TLS Certificate Errors","text":"<p>Error: <code>certificate signed by unknown authority</code></p> <p>Check TLS configuration: <pre><code>kubectl get databaseinstance cockroach-cluster -o jsonpath='{.spec.tls}'\n</code></pre></p> <p>Verify certificates: <pre><code># Check secret contains required keys\nkubectl get secret cockroach-tls -o jsonpath='{.data}' | jq -r 'keys'\n# Should include: ca.crt, tls.crt, tls.key\n</code></pre></p> <p>Test connection manually: <pre><code>kubectl run cockroach-test --rm -it --image=cockroachdb/cockroach:v24.1.0 -- \\\n  sql --url=\"postgresql://user:pass@cockroachdb:26257/defaultdb?sslmode=verify-full&amp;sslrootcert=/certs/ca.crt\"\n</code></pre></p>"},{"location":"operations/troubleshooting/#backup-failed_1","title":"Backup Failed","text":"<p>Error: <code>BACKUP requires admin role</code></p> <p>Solution: <pre><code>GRANT admin TO dbprovision_admin;\n</code></pre></p> <p>Check backup job in CockroachDB: <pre><code>SELECT * FROM [SHOW JOBS] WHERE job_type = 'BACKUP' ORDER BY created DESC LIMIT 5;\n</code></pre></p>"},{"location":"operations/troubleshooting/#operator-issues","title":"Operator Issues","text":""},{"location":"operations/troubleshooting/#operator-not-starting","title":"Operator Not Starting","text":"<p>Check pod status: <pre><code>kubectl describe pod -n db-provision-operator-system -l app=db-provision-operator\n</code></pre></p> <p>Common issues:</p> <ol> <li> <p>Image pull error: <pre><code>kubectl get events -n db-provision-operator-system | grep \"Failed\"\n</code></pre></p> </li> <li> <p>RBAC issues: <pre><code>kubectl auth can-i --as=system:serviceaccount:db-provision-operator-system:db-provision-operator \\\n  create secrets -n default\n</code></pre></p> </li> </ol>"},{"location":"operations/troubleshooting/#high-memory-usage","title":"High Memory Usage","text":"<p>Check resource usage: <pre><code>kubectl top pod -n db-provision-operator-system\n</code></pre></p> <p>Solutions: 1. Increase memory limits 2. Reduce concurrent reconciles 3. Check for resource leaks in logs</p>"},{"location":"operations/troubleshooting/#reconciliation-loops","title":"Reconciliation Loops","text":"<p>Symptoms: Constant reconciliation, high CPU</p> <p>Debug: <pre><code># Watch reconciliation\nkubectl logs -n db-provision-operator-system deployment/db-provision-operator -f | grep \"Reconciling\"\n</code></pre></p> <p>Causes: - Status updates triggering reconciles - External changes to managed resources - Conflicting controllers</p>"},{"location":"operations/troubleshooting/#recovery-procedures","title":"Recovery Procedures","text":""},{"location":"operations/troubleshooting/#force-delete-stuck-resource","title":"Force Delete Stuck Resource","text":"<pre><code># Remove finalizers (use with caution!)\nkubectl patch database myapp-database -p '{\"metadata\":{\"finalizers\":null}}' --type=merge\nkubectl delete database myapp-database\n</code></pre>"},{"location":"operations/troubleshooting/#reset-resource-state","title":"Reset Resource State","text":"<pre><code># Delete and recreate\nkubectl delete database myapp-database\nkubectl apply -f database.yaml\n</code></pre>"},{"location":"operations/troubleshooting/#operator-recovery","title":"Operator Recovery","text":"<pre><code># Restart operator\nkubectl rollout restart deployment/db-provision-operator -n db-provision-operator-system\n\n# Watch rollout\nkubectl rollout status deployment/db-provision-operator -n db-provision-operator-system\n</code></pre>"},{"location":"operations/troubleshooting/#debug-mode","title":"Debug Mode","text":""},{"location":"operations/troubleshooting/#enable-debug-logging","title":"Enable Debug Logging","text":"<pre><code># Helm values\nlogging:\n  level: debug\n</code></pre> <p>Or patch deployment: <pre><code>kubectl set env deployment/db-provision-operator LOG_LEVEL=debug -n db-provision-operator-system\n</code></pre></p>"},{"location":"operations/troubleshooting/#trace-specific-resource","title":"Trace Specific Resource","text":"<pre><code>kubectl logs -n db-provision-operator-system deployment/db-provision-operator | \\\n  grep \"myapp-database\"\n</code></pre>"},{"location":"operations/troubleshooting/#getting-help","title":"Getting Help","text":""},{"location":"operations/troubleshooting/#collect-debug-information","title":"Collect Debug Information","text":"<pre><code>#!/bin/bash\n# debug-bundle.sh\n\necho \"=== Operator Pods ===\" &gt; debug.txt\nkubectl get pods -n db-provision-operator-system -o wide &gt;&gt; debug.txt\n\necho \"=== Operator Logs ===\" &gt;&gt; debug.txt\nkubectl logs -n db-provision-operator-system deployment/db-provision-operator --tail=500 &gt;&gt; debug.txt\n\necho \"=== All Resources ===\" &gt;&gt; debug.txt\nkubectl get databaseinstances,databases,databaseusers,databaseroles,databasegrants,databasebackups -A &gt;&gt; debug.txt\n\necho \"=== Events ===\" &gt;&gt; debug.txt\nkubectl get events -n db-provision-operator-system &gt;&gt; debug.txt\n\necho \"Debug bundle saved to debug.txt\"\n</code></pre>"},{"location":"operations/troubleshooting/#report-issues","title":"Report Issues","text":"<p>Open an issue at: https://github.com/panteparak/db-provision-operator/issues</p> <p>Include: 1. Operator version 2. Kubernetes version 3. Database engine and version 4. Resource YAML (redact secrets) 5. Operator logs 6. Steps to reproduce</p>"},{"location":"user-guide/","title":"User Guide","text":"<p>This guide covers all Custom Resource Definitions (CRDs) provided by DB Provision Operator.</p>"},{"location":"user-guide/#resource-hierarchy","title":"Resource Hierarchy","text":"<pre><code>graph TD\n    DI[DatabaseInstance] --&gt; DB[Database]\n    DI --&gt; DU[DatabaseUser]\n    DI --&gt; DR[DatabaseRole]\n    DB --&gt; DBB[DatabaseBackup]\n    DB --&gt; DBS[DatabaseBackupSchedule]\n    DBB --&gt; DBR[DatabaseRestore]\n    DU --&gt; DG[DatabaseGrant]\n    DR --&gt; DG</code></pre>"},{"location":"user-guide/#crd-overview","title":"CRD Overview","text":"CRD Description Depends On DatabaseInstance Connection to a database server - Database Logical database DatabaseInstance DatabaseUser Database user with credentials DatabaseInstance DatabaseRole Group role for permissions DatabaseInstance DatabaseGrant Permission assignments DatabaseUser, DatabaseRole DatabaseBackup One-time backup Database DatabaseBackupSchedule Scheduled backups Database DatabaseRestore Restore from backup DatabaseBackup"},{"location":"user-guide/#common-patterns","title":"Common Patterns","text":""},{"location":"user-guide/#resource-naming","title":"Resource Naming","text":"<p>All resources support a <code>name</code> field in the spec that defines the actual database object name (e.g., database name, username). If not specified, the Kubernetes resource name is used.</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: my-k8s-resource-name  # Kubernetes resource name\nspec:\n  name: actual_database_name  # Database name (optional, defaults to metadata.name)\n</code></pre>"},{"location":"user-guide/#instance-references","title":"Instance References","text":"<p>Child resources reference their parent <code>DatabaseInstance</code>:</p> <pre><code>spec:\n  instanceRef:\n    name: postgres-primary\n    namespace: default  # Optional, defaults to same namespace\n</code></pre>"},{"location":"user-guide/#deletion-policies","title":"Deletion Policies","text":"<p>Resources that create external database objects support deletion policies:</p> Policy Behavior <code>Retain</code> Keep the database object when CR is deleted <code>Delete</code> Delete the database object when CR is deleted <code>Snapshot</code> Create a backup before deletion (backup-capable resources)"},{"location":"user-guide/#deletion-protection","title":"Deletion Protection","text":"<p>Enable deletion protection to prevent accidental deletion:</p> <pre><code>spec:\n  deletionProtection: true\n</code></pre>"},{"location":"user-guide/#skip-reconcile","title":"Skip Reconcile","text":"<p>Temporarily pause reconciliation:</p> <pre><code>metadata:\n  annotations:\n    dbops.dbprovision.io/skip-reconcile: \"true\"\n</code></pre>"},{"location":"user-guide/#status-phases","title":"Status Phases","text":"<p>All resources report their status through a <code>phase</code> field:</p> Phase Description <code>Pending</code> Waiting for dependencies (e.g., instance not ready) <code>Creating</code> Resource is being created <code>Ready</code> Resource is successfully created and healthy <code>Updating</code> Resource is being updated <code>Deleting</code> Resource is being deleted <code>Failed</code> An error occurred"},{"location":"user-guide/#conditions","title":"Conditions","text":"<p>Resources also expose detailed conditions:</p> <pre><code>status:\n  conditions:\n    - type: Ready\n      status: \"True\"\n      reason: ReconcileSuccess\n      message: \"Database created successfully\"\n      lastTransitionTime: \"2024-01-01T00:00:00Z\"\n</code></pre>"},{"location":"user-guide/#advanced-features","title":"Advanced Features","text":"<ul> <li>Drift Detection - Detect and correct configuration drift</li> <li>Deletion Protection - Prevent accidental resource deletion</li> </ul>"},{"location":"user-guide/#next-steps","title":"Next Steps","text":"<ul> <li>DatabaseInstance - Start by connecting to your database server</li> <li>Database - Create databases</li> <li>DatabaseUser - Manage users</li> <li>Examples - Ready-to-use configurations</li> </ul>"},{"location":"user-guide/backups/","title":"Backups and Restores","text":"<p>DB Provision Operator supports automated backups with multiple storage backends.</p>"},{"location":"user-guide/backups/#resources","title":"Resources","text":"Resource Description <code>DatabaseBackup</code> One-time backup operation <code>DatabaseBackupSchedule</code> Scheduled backups with retention <code>DatabaseRestore</code> Restore from a backup"},{"location":"user-guide/backups/#databasebackup","title":"DatabaseBackup","text":""},{"location":"user-guide/backups/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      region: us-east-1\n      secretRef:\n        name: s3-credentials\n</code></pre>"},{"location":"user-guide/backups/#storage-types","title":"Storage Types","text":""},{"location":"user-guide/backups/#s3-awsminio","title":"S3 (AWS/MinIO)","text":"<pre><code>storage:\n  type: s3\n  s3:\n    bucket: my-backups\n    region: us-east-1\n    prefix: db-backups/postgres\n    endpoint: \"\"  # Optional: for MinIO\n    secretRef:\n      name: s3-credentials\n      keys:\n        accessKey: AWS_ACCESS_KEY_ID\n        secretKey: AWS_SECRET_ACCESS_KEY\n</code></pre>"},{"location":"user-guide/backups/#google-cloud-storage-gcs","title":"Google Cloud Storage (GCS)","text":"<pre><code>storage:\n  type: gcs\n  gcs:\n    bucket: my-backups\n    prefix: db-backups/postgres\n    secretRef:\n      name: gcs-credentials\n      key: credentials.json\n</code></pre>"},{"location":"user-guide/backups/#azure-blob-storage","title":"Azure Blob Storage","text":"<pre><code>storage:\n  type: azure\n  azure:\n    container: my-backups\n    prefix: db-backups/postgres\n    secretRef:\n      name: azure-credentials\n      keys:\n        accountName: AZURE_STORAGE_ACCOUNT\n        accountKey: AZURE_STORAGE_KEY\n</code></pre>"},{"location":"user-guide/backups/#persistentvolumeclaim-pvc","title":"PersistentVolumeClaim (PVC)","text":"<pre><code>storage:\n  type: pvc\n  pvc:\n    claimName: backup-storage\n    subPath: postgres-backups\n</code></pre>"},{"location":"user-guide/backups/#compression","title":"Compression","text":"<pre><code>compression:\n  enabled: true\n  algorithm: gzip  # gzip, lz4, zstd\n  level: 6         # 1-9 for gzip\n</code></pre>"},{"location":"user-guide/backups/#encryption","title":"Encryption","text":"<pre><code>encryption:\n  enabled: true\n  algorithm: aes-256-gcm\n  secretRef:\n    name: backup-encryption-key\n    key: encryption-key\n</code></pre>"},{"location":"user-guide/backups/#postgresql-options","title":"PostgreSQL Options","text":"<pre><code>postgres:\n  method: pg_dump\n  format: custom  # plain, custom, directory, tar\n  jobs: 4         # Parallel jobs (directory format)\n  blobs: true     # Include large objects\n  noOwner: false\n  noPrivileges: false\n  schemas: []     # Specific schemas (empty = all)\n  excludeSchemas: [pg_catalog, information_schema]\n</code></pre>"},{"location":"user-guide/backups/#mysql-options","title":"MySQL Options","text":"<pre><code>mysql:\n  method: mysqldump\n  singleTransaction: true\n  routines: true\n  triggers: true\n  events: false\n</code></pre>"},{"location":"user-guide/backups/#databasebackupschedule","title":"DatabaseBackupSchedule","text":""},{"location":"user-guide/backups/#overview_1","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: daily-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  schedule: \"0 2 * * *\"  # Daily at 2 AM\n  retention:\n    keepLast: 7\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-backups\n        secretRef:\n          name: s3-credentials\n</code></pre>"},{"location":"user-guide/backups/#schedule-format","title":"Schedule Format","text":"<p>Standard cron format: <code>minute hour day-of-month month day-of-week</code></p> Example Description <code>0 2 * * *</code> Daily at 2:00 AM <code>0 */6 * * *</code> Every 6 hours <code>0 2 * * 0</code> Weekly on Sunday at 2:00 AM <code>0 2 1 * *</code> Monthly on the 1<sup>st</sup> at 2:00 AM"},{"location":"user-guide/backups/#retention-policy","title":"Retention Policy","text":"<pre><code>retention:\n  keepLast: 7        # Keep last 7 backups\n  keepDaily: 7       # Keep daily backups for 7 days\n  keepWeekly: 4      # Keep weekly backups for 4 weeks\n  keepMonthly: 3     # Keep monthly backups for 3 months\n</code></pre>"},{"location":"user-guide/backups/#concurrency-policy","title":"Concurrency Policy","text":"<pre><code>concurrencyPolicy: Forbid  # Allow, Forbid, Replace\n</code></pre> Policy Description <code>Allow</code> Run concurrent backups <code>Forbid</code> Skip if previous backup is running <code>Replace</code> Cancel running backup and start new"},{"location":"user-guide/backups/#databaserestore","title":"DatabaseRestore","text":""},{"location":"user-guide/backups/#overview_2","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: myapp-restore\nspec:\n  backupRef:\n    name: myapp-backup\n  targetDatabaseRef:\n    name: myapp-database-restored\n</code></pre>"},{"location":"user-guide/backups/#restore-options","title":"Restore Options","text":"<pre><code>spec:\n  backupRef:\n    name: myapp-backup\n  targetDatabaseRef:\n    name: myapp-database-restored\n  createTarget: true  # Create database if not exists\n  postgres:\n    dropExisting: false\n    dataOnly: false\n    schemaOnly: false\n    noOwner: true\n    jobs: 4\n    disableTriggers: true\n    analyze: true  # Run ANALYZE after restore\n</code></pre>"},{"location":"user-guide/backups/#complete-example","title":"Complete Example","text":""},{"location":"user-guide/backups/#daily-backup-to-s3-with-encryption","title":"Daily Backup to S3 with Encryption","text":"<pre><code># Storage credentials\napiVersion: v1\nkind: Secret\nmetadata:\n  name: s3-backup-credentials\ntype: Opaque\nstringData:\n  AWS_ACCESS_KEY_ID: your-access-key\n  AWS_SECRET_ACCESS_KEY: your-secret-key\n---\n# Encryption key\napiVersion: v1\nkind: Secret\nmetadata:\n  name: backup-encryption-key\ntype: Opaque\nstringData:\n  encryption-key: your-32-character-encryption-key\n---\n# Backup schedule\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackupSchedule\nmetadata:\n  name: myapp-daily-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  schedule: \"0 2 * * *\"\n  timezone: \"UTC\"\n  retention:\n    keepLast: 7\n    keepDaily: 7\n    keepWeekly: 4\n  backupTemplate:\n    storage:\n      type: s3\n      s3:\n        bucket: my-backups\n        region: us-east-1\n        prefix: myapp/postgres\n        secretRef:\n          name: s3-backup-credentials\n    compression:\n      enabled: true\n      algorithm: gzip\n    encryption:\n      enabled: true\n      secretRef:\n        name: backup-encryption-key\n    postgres:\n      format: custom\n      jobs: 4\n</code></pre>"},{"location":"user-guide/backups/#manual-backup-and-restore","title":"Manual Backup and Restore","text":"<pre><code># Create manual backup\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseBackup\nmetadata:\n  name: myapp-manual-backup\nspec:\n  databaseRef:\n    name: myapp-database\n  storage:\n    type: s3\n    s3:\n      bucket: my-backups\n      secretRef:\n        name: s3-credentials\n  ttl: \"168h\"  # 7 days\n---\n# Restore to new database\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRestore\nmetadata:\n  name: myapp-restore\nspec:\n  backupRef:\n    name: myapp-manual-backup\n  targetDatabaseRef:\n    name: myapp-database-copy\n  createTarget: true\n</code></pre>"},{"location":"user-guide/backups/#status-monitoring","title":"Status Monitoring","text":""},{"location":"user-guide/backups/#backup-status","title":"Backup Status","text":"<pre><code>kubectl get databasebackup myapp-backup -o yaml\n</code></pre> <pre><code>status:\n  phase: Completed\n  startTime: \"2024-01-01T02:00:00Z\"\n  completionTime: \"2024-01-01T02:05:00Z\"\n  backupSize: \"1.2GB\"\n  backupPath: \"s3://my-backups/myapp/postgres/myapp-backup-20240101020000.dump\"\n</code></pre>"},{"location":"user-guide/backups/#schedule-status","title":"Schedule Status","text":"<pre><code>kubectl get databasebackupschedule daily-backup -o yaml\n</code></pre> <pre><code>status:\n  lastBackupTime: \"2024-01-01T02:00:00Z\"\n  lastBackupName: \"daily-backup-20240101020000\"\n  nextBackupTime: \"2024-01-02T02:00:00Z\"\n  activeBackups: 7\n</code></pre>"},{"location":"user-guide/backups/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/backups/#backup-failed","title":"Backup failed","text":"<ul> <li>Check storage credentials are correct</li> <li>Verify bucket/container exists and is accessible</li> <li>Review backup pod logs</li> <li>Check database connectivity</li> </ul>"},{"location":"user-guide/backups/#restore-failed","title":"Restore failed","text":"<ul> <li>Verify backup exists and is accessible</li> <li>Check target database doesn't exist (or <code>dropExisting: true</code>)</li> <li>Review restore pod logs</li> <li>Ensure sufficient disk space</li> </ul>"},{"location":"user-guide/database-instances/","title":"DatabaseInstance","text":"<p>A <code>DatabaseInstance</code> represents a connection to a database server. It's the foundational resource that all other resources depend on.</p>"},{"location":"user-guide/database-instances/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    database: postgres\n    secretRef:\n      name: postgres-admin-credentials\n</code></pre>"},{"location":"user-guide/database-instances/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/database-instances/#engine-required","title":"engine (required)","text":"<p>The database engine type. Immutable after creation.</p> Value Description <code>postgres</code> PostgreSQL database <code>mysql</code> MySQL or MariaDB database"},{"location":"user-guide/database-instances/#connection-required","title":"connection (required)","text":"<p>Connection configuration for the database server.</p> Field Type Required Description <code>host</code> string Yes Database server hostname or IP <code>port</code> int Yes Database server port <code>database</code> string No Initial database to connect to <code>secretRef</code> object Yes Reference to credentials Secret"},{"location":"user-guide/database-instances/#secretref","title":"secretRef","text":"Field Type Required Description <code>name</code> string Yes Name of the Secret <code>namespace</code> string No Namespace of the Secret (default: same as resource) <code>keys.username</code> string No Key containing username (default: <code>username</code>) <code>keys.password</code> string No Key containing password (default: <code>password</code>)"},{"location":"user-guide/database-instances/#tls-optional","title":"tls (optional)","text":"<p>TLS configuration for secure connections.</p> Field Type Required Description <code>enabled</code> bool No Enable TLS (default: false) <code>mode</code> string No TLS mode (see below) <code>secretRef</code> object No Reference to TLS certificates Secret <p>TLS Modes:</p> Mode Description <code>disable</code> No TLS <code>require</code> TLS required, no certificate verification <code>verify-ca</code> Verify server certificate against CA <code>verify-full</code> Verify server certificate and hostname"},{"location":"user-guide/database-instances/#healthcheck-optional","title":"healthCheck (optional)","text":"<p>Health check configuration.</p> Field Type Required Description <code>enabled</code> bool No Enable health checks (default: true) <code>intervalSeconds</code> int No Check interval (default: 30) <code>timeoutSeconds</code> int No Check timeout (default: 5)"},{"location":"user-guide/database-instances/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific configuration.</p> Field Type Description <code>sslMode</code> string SSL mode (disable, require, verify-ca, verify-full) <code>connectTimeout</code> int Connection timeout in seconds <code>applicationName</code> string Application name for connection identification"},{"location":"user-guide/database-instances/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL-specific configuration.</p> Field Type Description <code>charset</code> string Default charset (e.g., utf8mb4) <code>collation</code> string Default collation <code>timeout</code> string Connection timeout (e.g., \"10s\") <code>tls</code> string TLS mode (disabled, preferred, required)"},{"location":"user-guide/database-instances/#status","title":"Status","text":"Field Description <code>phase</code> Current phase (Pending, Ready, Failed) <code>conditions</code> Detailed conditions <code>observedGeneration</code> Last observed generation <code>lastHealthCheck</code> Last health check timestamp"},{"location":"user-guide/database-instances/#examples","title":"Examples","text":""},{"location":"user-guide/database-instances/#basic-postgresql-instance","title":"Basic PostgreSQL Instance","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-admin-credentials\n</code></pre>"},{"location":"user-guide/database-instances/#postgresql-with-tls","title":"PostgreSQL with TLS","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-secure\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-admin-credentials\n  tls:\n    enabled: true\n    mode: verify-ca\n    secretRef:\n      name: postgres-tls-certs\n      keys:\n        ca: ca.crt\n        cert: tls.crt\n        key: tls.key\n  postgres:\n    sslMode: verify-ca\n</code></pre>"},{"location":"user-guide/database-instances/#mysql-instance","title":"MySQL Instance","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: mysql-primary\nspec:\n  engine: mysql\n  connection:\n    host: mysql.database.svc.cluster.local\n    port: 3306\n    secretRef:\n      name: mysql-admin-credentials\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre>"},{"location":"user-guide/database-instances/#cross-namespace-secret-reference","title":"Cross-Namespace Secret Reference","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-with-shared-creds\n  namespace: app-namespace\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: shared-postgres-credentials\n      namespace: secrets-namespace\n</code></pre> <p>RBAC for Cross-Namespace</p> <p>Cross-namespace secret access requires additional RBAC configuration. See Security - Cross-Namespace Mode.</p>"},{"location":"user-guide/database-instances/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/database-instances/#instance-stuck-in-pending","title":"Instance stuck in Pending","text":"<ul> <li>Verify the credentials Secret exists and has correct keys</li> <li>Check that the database server is reachable from the cluster</li> <li>Review operator logs for connection errors</li> </ul>"},{"location":"user-guide/database-instances/#connection-refused","title":"Connection refused","text":"<ul> <li>Verify the host and port are correct</li> <li>Check network policies allow traffic to the database</li> <li>Ensure the database server is accepting connections</li> </ul>"},{"location":"user-guide/database-instances/#authentication-failed","title":"Authentication failed","text":"<ul> <li>Verify the credentials in the Secret are correct</li> <li>Check the user has appropriate permissions</li> <li>For PostgreSQL, ensure <code>pg_hba.conf</code> allows the connection</li> </ul>"},{"location":"user-guide/databases/","title":"Database","text":"<p>A <code>Database</code> represents a logical database within a <code>DatabaseInstance</code>.</p>"},{"location":"user-guide/databases/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n</code></pre>"},{"location":"user-guide/databases/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/databases/#instanceref-required","title":"instanceRef (required)","text":"<p>Reference to the parent <code>DatabaseInstance</code>.</p> Field Type Required Description <code>name</code> string Yes Name of the DatabaseInstance <code>namespace</code> string No Namespace (default: same as resource)"},{"location":"user-guide/databases/#name-optional","title":"name (optional)","text":"<p>The actual database name in the database server. Immutable after creation.</p> <ul> <li>Default: Kubernetes resource name (<code>metadata.name</code>)</li> <li>Must follow database naming rules for the target engine</li> </ul>"},{"location":"user-guide/databases/#deletionpolicy-optional","title":"deletionPolicy (optional)","text":"<p>What happens to the database when the CR is deleted.</p> Value Description <code>Retain</code> Keep the database (default) <code>Delete</code> Delete the database <code>Snapshot</code> Create a backup before deletion"},{"location":"user-guide/databases/#deletionprotection-optional","title":"deletionProtection (optional)","text":"<p>Prevent accidental deletion. Default: <code>false</code></p>"},{"location":"user-guide/databases/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific configuration.</p> Field Type Description <code>encoding</code> string Character encoding (default: UTF8) <code>lcCollate</code> string Collation order <code>lcCtype</code> string Character classification <code>tablespace</code> string Default tablespace <code>template</code> string Template database (default: template0) <code>connectionLimit</code> int Max connections (-1 = unlimited) <code>extensions</code> array Extensions to install <code>schemas</code> array Schemas to create"},{"location":"user-guide/databases/#extensions","title":"extensions","text":"Field Type Description <code>name</code> string Extension name <code>schema</code> string Schema to install into"},{"location":"user-guide/databases/#schemas","title":"schemas","text":"Field Type Description <code>name</code> string Schema name <code>owner</code> string Schema owner"},{"location":"user-guide/databases/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL-specific configuration.</p> Field Type Description <code>charset</code> string Default charset (default: utf8mb4) <code>collation</code> string Default collation (default: utf8mb4_unicode_ci) <code>defaultStorageEngine</code> string Default storage engine"},{"location":"user-guide/databases/#status","title":"Status","text":"Field Description <code>phase</code> Current phase <code>conditions</code> Detailed conditions <code>observedGeneration</code> Last observed generation"},{"location":"user-guide/databases/#examples","title":"Examples","text":""},{"location":"user-guide/databases/#basic-database","title":"Basic Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp\nspec:\n  instanceRef:\n    name: postgres-primary\n</code></pre>"},{"location":"user-guide/databases/#postgresql-with-extensions","title":"PostgreSQL with Extensions","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: myapp\n  deletionPolicy: Retain\n  deletionProtection: true\n  postgres:\n    encoding: UTF8\n    lcCollate: en_US.UTF-8\n    lcCtype: en_US.UTF-8\n    connectionLimit: 100\n    extensions:\n      - name: uuid-ossp\n        schema: public\n      - name: pgcrypto\n        schema: public\n      - name: hstore\n        schema: extensions\n    schemas:\n      - name: app\n        owner: myapp_admin\n      - name: audit\n        owner: myapp_admin\n</code></pre>"},{"location":"user-guide/databases/#mysql-database","title":"MySQL Database","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: myapp-mysql\nspec:\n  instanceRef:\n    name: mysql-primary\n  name: myapp\n  mysql:\n    charset: utf8mb4\n    collation: utf8mb4_unicode_ci\n</code></pre>"},{"location":"user-guide/databases/#database-with-delete-policy","title":"Database with Delete Policy","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: temp-database\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: tempdb\n  deletionPolicy: Delete  # Database will be dropped when CR is deleted\n</code></pre>"},{"location":"user-guide/databases/#lifecycle","title":"Lifecycle","text":""},{"location":"user-guide/databases/#creation","title":"Creation","text":"<ol> <li>Operator validates the spec</li> <li>Checks if instance is Ready</li> <li>Creates the database in the server</li> <li>Installs extensions (PostgreSQL)</li> <li>Creates schemas (PostgreSQL)</li> <li>Updates status to Ready</li> </ol>"},{"location":"user-guide/databases/#deletion","title":"Deletion","text":"<p>Based on <code>deletionPolicy</code>:</p> <ul> <li>Retain: CR is deleted, database remains</li> <li>Delete: Database is dropped, then CR is deleted</li> <li>Snapshot: Backup is created, database is dropped, CR is deleted</li> </ul>"},{"location":"user-guide/databases/#updates","title":"Updates","text":"<p>Most fields are immutable after creation. Supported updates:</p> <ul> <li><code>deletionPolicy</code></li> <li><code>deletionProtection</code></li> <li><code>postgres.connectionLimit</code></li> <li>Adding new extensions/schemas</li> </ul>"},{"location":"user-guide/databases/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/databases/#database-stuck-in-pending","title":"Database stuck in Pending","text":"<ul> <li>Verify the DatabaseInstance is in Ready state</li> <li>Check operator logs for errors</li> </ul>"},{"location":"user-guide/databases/#extension-installation-failed","title":"Extension installation failed","text":"<ul> <li>Verify the extension is available in the PostgreSQL installation</li> <li>Check the user has CREATE EXTENSION permission</li> <li>Review operator logs for specific errors</li> </ul>"},{"location":"user-guide/databases/#cannot-delete-database","title":"Cannot delete database","text":"<ul> <li>Check if <code>deletionProtection</code> is enabled</li> <li>Verify no active connections to the database</li> <li>For PostgreSQL, ensure no other databases depend on it</li> </ul>"},{"location":"user-guide/deletion-protection/","title":"Deletion Protection","text":"<p>Deletion protection prevents accidental deletion of critical database resources. When enabled, attempting to delete the Kubernetes resource will fail until protection is explicitly disabled or a force-delete annotation is added.</p>"},{"location":"user-guide/deletion-protection/#overview","title":"Overview","text":"<p>Production databases and their associated users, roles, and grants are critical infrastructure. Accidental deletion can cause:</p> <ul> <li>Application downtime</li> <li>Data loss (depending on deletion policy)</li> <li>Service disruptions</li> <li>Compliance violations</li> </ul> <p>Deletion protection provides a safety net against:</p> <ul> <li>Accidental <code>kubectl delete</code> commands</li> <li>GitOps automation errors</li> <li>Misconfigured cleanup jobs</li> <li>Namespace deletion cascades</li> </ul>"},{"location":"user-guide/deletion-protection/#enabling-deletion-protection","title":"Enabling Deletion Protection","text":"<p>Add <code>deletionProtection: true</code> to any supported resource:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: production-db\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: production\n  deletionProtection: true  # Prevents accidental deletion\n</code></pre>"},{"location":"user-guide/deletion-protection/#supported-resources","title":"Supported Resources","text":"Resource deletionProtection Notes DatabaseInstance Yes Blocks deletion of the instance connection Database Yes Blocks deletion of the logical database DatabaseUser Yes Blocks deletion of the database user DatabaseRole Yes Blocks deletion of the database role DatabaseGrant Yes Blocks deletion of permission grants DatabaseBackupSchedule Yes Blocks deletion of the backup schedule DatabaseBackup No Backups are typically transient DatabaseRestore No Restores are one-time operations"},{"location":"user-guide/deletion-protection/#behavior-when-protected","title":"Behavior When Protected","text":"<p>When you attempt to delete a protected resource:</p> <ol> <li>The Kubernetes API accepts the delete request</li> <li>The resource is marked for deletion (finalizer prevents immediate removal)</li> <li>The operator detects deletion and checks for protection</li> <li>Deletion is blocked with a <code>DeletionBlocked</code> event</li> <li>Resource remains in <code>Failed</code> phase with protection message</li> </ol> <pre><code>$ kubectl delete database production-db\ndatabase.dbops.dbprovision.io \"production-db\" deleted\n\n$ kubectl get database production-db\nNAME            PHASE   MESSAGE\nproduction-db   Failed  Deletion blocked by deletion protection\n</code></pre>"},{"location":"user-guide/deletion-protection/#viewing-protected-resources","title":"Viewing Protected Resources","text":"<p>Check which resources have deletion protection:</p> <pre><code># All databases with deletion protection\nkubectl get databases -o jsonpath='{range .items[?(@.spec.deletionProtection==true)]}{.metadata.name}{\"\\n\"}{end}'\n\n# Using labels (if you label protected resources)\nkubectl get databases -l protected=true\n</code></pre>"},{"location":"user-guide/deletion-protection/#disabling-deletion-protection","title":"Disabling Deletion Protection","text":""},{"location":"user-guide/deletion-protection/#method-1-update-the-spec","title":"Method 1: Update the Spec","text":"<p>Remove or disable the protection:</p> <pre><code>spec:\n  deletionProtection: false\n</code></pre> <p>Then delete normally:</p> <pre><code>kubectl apply -f database.yaml\nkubectl delete database production-db\n</code></pre>"},{"location":"user-guide/deletion-protection/#method-2-force-delete-annotation","title":"Method 2: Force Delete Annotation","text":"<p>For emergency situations, add the force-delete annotation:</p> <pre><code>kubectl annotate database production-db \\\n  dbops.dbprovision.io/force-delete=\"true\"\n</code></pre> <p>The resource will be deleted on the next reconciliation loop.</p> <p>Force Delete is Immediate</p> <p>The force-delete annotation bypasses all safety checks. Use only when you're certain the deletion is intentional.</p>"},{"location":"user-guide/deletion-protection/#method-3-edit-and-delete","title":"Method 3: Edit and Delete","text":"<p>Quick one-liner to disable and delete:</p> <pre><code>kubectl patch database production-db -p '{\"spec\":{\"deletionProtection\":false}}' &amp;&amp; \\\nkubectl delete database production-db\n</code></pre>"},{"location":"user-guide/deletion-protection/#deletion-policies","title":"Deletion Policies","text":"<p>Deletion protection is separate from deletion policy. The deletion policy controls what happens when a resource is deleted; deletion protection controls whether it can be deleted.</p> Setting Behavior <code>deletionProtection: true</code> Cannot delete the CR <code>deletionPolicy: Retain</code> CR deleted, database object kept <code>deletionPolicy: Delete</code> CR deleted, database object deleted <code>deletionPolicy: Snapshot</code> CR deleted after backup created"},{"location":"user-guide/deletion-protection/#combined-example","title":"Combined Example","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: production-db\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: production\n  deletionProtection: true   # Can't delete CR accidentally\n  deletionPolicy: Retain     # Even if deleted, keep the actual database\n</code></pre>"},{"location":"user-guide/deletion-protection/#events","title":"Events","text":"Event Type Description <code>DeletionBlocked</code> Warning Deletion was attempted but blocked by protection <p>View events:</p> <pre><code>kubectl describe database production-db\n# Look for Events section\n\nkubectl get events --field-selector reason=DeletionBlocked\n</code></pre>"},{"location":"user-guide/deletion-protection/#best-practices","title":"Best Practices","text":""},{"location":"user-guide/deletion-protection/#production-resources","title":"Production Resources","text":"<p>Always enable deletion protection for production databases:</p> <pre><code>spec:\n  deletionProtection: true\n  deletionPolicy: Snapshot  # Additional safety: backup before delete\n</code></pre>"},{"location":"user-guide/deletion-protection/#gitops-workflows","title":"GitOps Workflows","text":"<p>In GitOps (ArgoCD, Flux), deletion protection prevents drift corrections from accidentally deleting resources:</p> <pre><code># argocd Application\nspec:\n  syncPolicy:\n    automated:\n      prune: true  # Would delete resources not in Git\n    # But deletion protection prevents actual deletion\n</code></pre>"},{"location":"user-guide/deletion-protection/#multi-environment-strategy","title":"Multi-Environment Strategy","text":"Environment deletionProtection deletionPolicy Development <code>false</code> <code>Delete</code> Staging <code>true</code> <code>Delete</code> Production <code>true</code> <code>Retain</code> or <code>Snapshot</code>"},{"location":"user-guide/deletion-protection/#namespace-deletion","title":"Namespace Deletion","text":"<p>When a namespace is deleted, all resources in it are deleted. Deletion protection still applies:</p> <pre><code># This will hang waiting for protected resources\nkubectl delete namespace production\n\n# Check which resources are blocking\nkubectl get databases,users,roles -n production \\\n  -o jsonpath='{range .items[?(@.spec.deletionProtection==true)]}{.kind}/{.metadata.name}{\"\\n\"}{end}'\n</code></pre> <p>To delete the namespace, first remove protection or force-delete each resource.</p>"},{"location":"user-guide/deletion-protection/#force-delete-script","title":"Force Delete Script","text":"<p>For emergency cleanup of multiple protected resources:</p> <pre><code>#!/bin/bash\n# force-delete-all.sh - USE WITH EXTREME CAUTION\n\nNAMESPACE=${1:-default}\n\nfor kind in database databaseuser databaserole databasegrant databasebackupschedule; do\n  for name in $(kubectl get $kind -n $NAMESPACE -o name); do\n    echo \"Force deleting $name...\"\n    kubectl annotate $name -n $NAMESPACE \\\n      dbops.dbprovision.io/force-delete=\"true\" --overwrite\n  done\ndone\n\necho \"Resources will be deleted on next reconciliation\"\n</code></pre> <p>Audit Force Deletes</p> <p>Always document why force-delete was used. Consider alerting on force-delete annotations:</p> <pre><code># Alert when force-delete annotation is added\nkube_resource_annotations{annotation_dbops_dbprovision_io_force_delete=\"true\"}\n</code></pre>"},{"location":"user-guide/deletion-protection/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/deletion-protection/#resource-stuck-in-terminating","title":"Resource Stuck in Terminating","text":"<p>If a protected resource shows <code>Terminating</code>:</p> <pre><code># Check events for DeletionBlocked\nkubectl describe database my-db\n\n# Check if finalizer is still present\nkubectl get database my-db -o jsonpath='{.metadata.finalizers}'\n\n# Option 1: Disable protection via spec\nkubectl patch database my-db -p '{\"spec\":{\"deletionProtection\":false}}'\n\n# Option 2: Force delete\nkubectl annotate database my-db dbops.dbprovision.io/force-delete=\"true\"\n</code></pre>"},{"location":"user-guide/deletion-protection/#protection-not-working","title":"Protection Not Working","text":"<p>If resources are deleted despite protection:</p> <ol> <li>Verify <code>deletionProtection: true</code> is in the spec</li> <li>Check operator logs for errors</li> <li>Ensure the operator has proper RBAC permissions</li> <li>Verify the finalizer is being added</li> </ol> <pre><code># Check finalizer\nkubectl get database my-db -o jsonpath='{.metadata.finalizers}'\n# Should include: dbops.dbprovision.io/database\n</code></pre>"},{"location":"user-guide/deletion-protection/#operator-not-running","title":"Operator Not Running","text":"<p>If the operator is down, protected resources cannot be deleted (finalizers block deletion). To recover:</p> <pre><code># Option 1: Restart the operator\nkubectl rollout restart deployment db-provision-operator-controller-manager \\\n  -n db-provision-operator-system\n\n# Option 2: Emergency - remove finalizer directly (DANGEROUS)\nkubectl patch database my-db -p '{\"metadata\":{\"finalizers\":null}}' --type=merge\n</code></pre> <p>Removing Finalizers</p> <p>Removing finalizers bypasses all cleanup logic. The database object in the actual database will NOT be deleted, potentially leaving orphaned resources.</p>"},{"location":"user-guide/drift-detection/","title":"Drift Detection","text":"<p>Drift detection monitors the actual state of database resources and compares them to the desired state defined in your Custom Resources. When differences (drift) are found, the operator can report or automatically correct them.</p>"},{"location":"user-guide/drift-detection/#overview","title":"Overview","text":"<p>Configuration drift occurs when the actual database state no longer matches what's defined in Kubernetes. This can happen due to:</p> <ul> <li>Manual changes via SQL clients</li> <li>Scripts or applications modifying database objects</li> <li>Other operators or tools managing the same resources</li> <li>Database migrations that modify schema</li> </ul> <p>Without drift detection, these changes can lead to:</p> <ul> <li>Security misconfigurations (e.g., excessive privileges)</li> <li>Inconsistent environments between staging and production</li> <li>Deployment failures when expected state differs from actual state</li> <li>Audit compliance issues</li> </ul>"},{"location":"user-guide/drift-detection/#drift-modes","title":"Drift Modes","text":"<p>The operator supports three drift detection modes:</p> Mode Behavior <code>ignore</code> No drift detection. Changes outside Kubernetes are not tracked. <code>detect</code> Detects drift and reports it in status/events. Does not auto-correct. <code>correct</code> Detects drift and automatically corrects it to match the CR spec."},{"location":"user-guide/drift-detection/#configuration","title":"Configuration","text":""},{"location":"user-guide/drift-detection/#instance-level-policy-default","title":"Instance-Level Policy (Default)","text":"<p>Set a default drift policy on <code>DatabaseInstance</code> that applies to all child resources:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-credentials\n  driftPolicy:\n    mode: detect  # Default for all databases/users/roles\n    interval: \"5m\"\n</code></pre>"},{"location":"user-guide/drift-detection/#resource-level-override","title":"Resource-Level Override","text":"<p>Individual resources can override the instance's default policy:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: production-db\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: production\n  driftPolicy:\n    mode: correct  # Override: auto-correct for this database\n    interval: \"2m\"\n</code></pre>"},{"location":"user-guide/drift-detection/#policy-fields","title":"Policy Fields","text":"Field Type Default Description <code>mode</code> string <code>detect</code> <code>ignore</code>, <code>detect</code>, or <code>correct</code> <code>interval</code> string <code>5m</code> How often to check for drift (Go duration)"},{"location":"user-guide/drift-detection/#status-fields","title":"Status Fields","text":"<p>When drift is detected, the status shows details:</p> <pre><code>status:\n  phase: Ready\n  drift:\n    detected: true\n    lastChecked: \"2024-01-15T10:30:00Z\"\n    diffs:\n      - field: \"encoding\"\n        expected: \"UTF8\"\n        actual: \"LATIN1\"\n        destructive: true\n        immutable: false\n      - field: \"connectionLimit\"\n        expected: \"100\"\n        actual: \"50\"\n        destructive: false\n        immutable: false\n</code></pre>"},{"location":"user-guide/drift-detection/#diff-fields","title":"Diff Fields","text":"Field Description <code>field</code> The name of the field that differs <code>expected</code> The value defined in the CR spec <code>actual</code> The current value in the database <code>destructive</code> If correcting this would cause data loss <code>immutable</code> If this field cannot be changed after creation"},{"location":"user-guide/drift-detection/#events","title":"Events","text":"<p>The operator emits events for drift-related activities:</p> Event Type Description <code>DriftDetected</code> Warning Drift was detected in one or more fields <code>DriftCorrected</code> Normal Drift was successfully corrected <code>DriftCorrectionFailed</code> Warning Attempted to correct drift but failed <p>View events with:</p> <pre><code>kubectl describe database production-db\n# or\nkubectl get events --field-selector involvedObject.name=production-db\n</code></pre>"},{"location":"user-guide/drift-detection/#destructive-drift-corrections","title":"Destructive Drift Corrections","text":"<p>Some drift corrections are potentially destructive (e.g., changing encoding requires recreating the database). By default, the operator skips destructive corrections even in <code>correct</code> mode.</p>"},{"location":"user-guide/drift-detection/#allowing-destructive-corrections","title":"Allowing Destructive Corrections","text":"<p>To allow destructive corrections, add an annotation:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: dev-db\n  annotations:\n    dbops.dbprovision.io/allow-destructive-drift: \"true\"\nspec:\n  instanceRef:\n    name: postgres-primary\n  driftPolicy:\n    mode: correct\n</code></pre> <p>Use with Caution</p> <p>Destructive corrections may cause data loss. Only enable this for:</p> <ul> <li>Development/test environments</li> <li>Resources where data loss is acceptable</li> <li>After verifying the current state and having backups</li> </ul>"},{"location":"user-guide/drift-detection/#destructive-vs-non-destructive-changes","title":"Destructive vs Non-Destructive Changes","text":"Resource Non-Destructive Destructive Database Owner, connection limit Encoding, collation, template User Password, connection limit, roles Username Role Privileges, role membership Role name Grant Adding privileges Revoking privileges"},{"location":"user-guide/drift-detection/#immutable-fields","title":"Immutable Fields","text":"<p>Some fields cannot be changed after resource creation:</p> Resource Immutable Fields Database Template (PostgreSQL) User Username (in most cases) DatabaseInstance Engine type <p>When drift is detected in immutable fields, the operator reports it but cannot correct it automatically.</p>"},{"location":"user-guide/drift-detection/#resource-discovery","title":"Resource Discovery","text":"<p>The operator can discover database resources that exist but are not managed by Kubernetes CRs.</p>"},{"location":"user-guide/drift-detection/#enabling-discovery","title":"Enabling Discovery","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  discovery:\n    enabled: true\n    interval: \"30m\"\n</code></pre>"},{"location":"user-guide/drift-detection/#discovered-resources-status","title":"Discovered Resources Status","text":"<pre><code>status:\n  discoveredResources:\n    lastScan: \"2024-01-15T10:00:00Z\"\n    databases:\n      - name: legacy_app\n        discovered: \"2024-01-15T10:00:00Z\"\n        adopted: false\n      - name: temp_data\n        discovered: \"2024-01-15T10:00:00Z\"\n        adopted: false\n    users:\n      - name: old_admin\n        discovered: \"2024-01-15T10:00:00Z\"\n        adopted: false\n</code></pre>"},{"location":"user-guide/drift-detection/#adopting-discovered-resources","title":"Adopting Discovered Resources","text":"<p>To bring a discovered resource under management, use adoption annotations:</p> <pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\n  annotations:\n    dbops.dbprovision.io/adopt-databases: \"legacy_app,temp_data\"\n    dbops.dbprovision.io/adopt-users: \"old_admin\"\n</code></pre> <p>When adopted:</p> <ol> <li>The operator creates a CR for the discovered resource</li> <li>The CR is labeled with <code>dbops.dbprovision.io/adopted: \"true\"</code></li> <li>Future changes are managed through the CR</li> </ol>"},{"location":"user-guide/drift-detection/#metrics","title":"Metrics","text":"<p>The operator exposes drift-related metrics:</p> Metric Description <code>dbprovision_drift_detected</code> Gauge: 1 if drift detected, 0 otherwise <code>dbprovision_drift_corrections_total</code> Counter of drift corrections <p>Example Prometheus query to alert on drift:</p> <pre><code>dbprovision_drift_detected{resource_type=\"database\"} == 1\n</code></pre>"},{"location":"user-guide/drift-detection/#best-practices","title":"Best Practices","text":""},{"location":"user-guide/drift-detection/#development-environments","title":"Development Environments","text":"<p>Use <code>correct</code> mode to keep environments consistent:</p> <pre><code>driftPolicy:\n  mode: correct\n  interval: \"1m\"\n</code></pre>"},{"location":"user-guide/drift-detection/#production-environments","title":"Production Environments","text":"<p>Use <code>detect</code> mode with alerts:</p> <pre><code>driftPolicy:\n  mode: detect\n  interval: \"5m\"\n</code></pre> <p>Set up alerts for <code>DriftDetected</code> events:</p> <pre><code># Example Prometheus alert rule\n- alert: DatabaseDriftDetected\n  expr: dbprovision_drift_detected == 1\n  for: 5m\n  labels:\n    severity: warning\n  annotations:\n    summary: \"Configuration drift detected\"\n    description: \"{{ $labels.name }} has configuration drift\"\n</code></pre>"},{"location":"user-guide/drift-detection/#audit-trails","title":"Audit Trails","text":"<p>For compliance, combine with event logging:</p> <pre><code># Export events to external logging system\nkubectl get events -o json | jq '.items[] | select(.reason | contains(\"Drift\"))'\n</code></pre>"},{"location":"user-guide/drift-detection/#supported-resources","title":"Supported Resources","text":"Resource Drift Detection Auto-Correction Database Yes Yes DatabaseUser Yes Yes DatabaseRole Yes Yes DatabaseGrant Yes Yes DatabaseBackup No No DatabaseRestore No No DatabaseBackupSchedule No No"},{"location":"user-guide/drift-detection/#example-full-drift-detection-setup","title":"Example: Full Drift Detection Setup","text":"<pre><code>---\n# Instance with detect-only default\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseInstance\nmetadata:\n  name: postgres-primary\nspec:\n  engine: postgres\n  connection:\n    host: postgres.database.svc.cluster.local\n    port: 5432\n    secretRef:\n      name: postgres-credentials\n  driftPolicy:\n    mode: detect\n    interval: \"5m\"\n  discovery:\n    enabled: true\n    interval: \"30m\"\n---\n# Production database: detect only, alert on drift\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: production-db\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: production\n  # Uses instance default (detect mode)\n---\n# Dev database: auto-correct drift\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: Database\nmetadata:\n  name: dev-db\n  annotations:\n    dbops.dbprovision.io/allow-destructive-drift: \"true\"\nspec:\n  instanceRef:\n    name: postgres-primary\n  name: development\n  driftPolicy:\n    mode: correct\n    interval: \"1m\"\n</code></pre>"},{"location":"user-guide/drift-detection/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/drift-detection/#drift-not-detected","title":"Drift Not Detected","text":"<ol> <li>Check drift mode is not <code>ignore</code></li> <li>Verify the interval has passed since last check</li> <li>Check controller logs for errors</li> </ol> <pre><code>kubectl logs -l app.kubernetes.io/name=db-provision-operator -n db-provision-operator-system | grep -i drift\n</code></pre>"},{"location":"user-guide/drift-detection/#drift-correction-failing","title":"Drift Correction Failing","text":"<ol> <li>Check if the field is marked as <code>immutable</code></li> <li>Check if destructive corrections need the annotation</li> <li>Verify database permissions</li> </ol>"},{"location":"user-guide/drift-detection/#drift-detected-but-expected","title":"Drift Detected but Expected","text":"<p>For known differences that should be ignored, consider:</p> <ol> <li>Updating the CR spec to match actual state</li> <li>Setting <code>mode: ignore</code> for that resource</li> <li>Using the skip-reconcile annotation temporarily</li> </ol>"},{"location":"user-guide/grants/","title":"DatabaseGrant","text":"<p>A <code>DatabaseGrant</code> manages fine-grained permissions for users and roles.</p>"},{"location":"user-guide/grants/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-grants\nspec:\n  userRef:\n    name: myapp-user\n  databaseRef:\n    name: myapp-database\n  postgres:\n    roles:\n      - readonly\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE]\n</code></pre>"},{"location":"user-guide/grants/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/grants/#userref-conditionally-required","title":"userRef (conditionally required)","text":"<p>Reference to a <code>DatabaseUser</code>. Required if <code>roleRef</code> is not specified.</p> Field Type Description <code>name</code> string DatabaseUser name <code>namespace</code> string Namespace (optional)"},{"location":"user-guide/grants/#roleref-conditionally-required","title":"roleRef (conditionally required)","text":"<p>Reference to a <code>DatabaseRole</code>. Required if <code>userRef</code> is not specified.</p> Field Type Description <code>name</code> string DatabaseRole name <code>namespace</code> string Namespace (optional)"},{"location":"user-guide/grants/#databaseref-optional","title":"databaseRef (optional)","text":"<p>Reference to a <code>Database</code> for context.</p> Field Type Description <code>name</code> string Database name <code>namespace</code> string Namespace (optional)"},{"location":"user-guide/grants/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific grant configuration.</p> Field Type Description <code>roles</code> array Roles to assign to the user <code>grants</code> array Direct permission grants <code>defaultPrivileges</code> array Default privileges for future objects"},{"location":"user-guide/grants/#grants","title":"grants","text":"Field Type Required Description <code>database</code> string Yes Target database <code>schema</code> string No Target schema <code>tables</code> array No Tables or <code>[\"*\"]</code> for all <code>sequences</code> array No Sequences or <code>[\"*\"]</code> for all <code>functions</code> array No Functions <code>privileges</code> array Yes Privileges to grant <code>withGrantOption</code> bool No Allow grantee to grant to others <p>Table privileges: <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>TRUNCATE</code>, <code>REFERENCES</code>, <code>TRIGGER</code></p> <p>Sequence privileges: <code>USAGE</code>, <code>SELECT</code>, <code>UPDATE</code></p> <p>Function privileges: <code>EXECUTE</code></p>"},{"location":"user-guide/grants/#defaultprivileges","title":"defaultPrivileges","text":"<p>Apply privileges automatically to future objects:</p> Field Type Description <code>database</code> string Target database <code>schema</code> string Target schema <code>grantedBy</code> string Role that creates objects <code>objectType</code> string <code>tables</code>, <code>sequences</code>, <code>functions</code> <code>privileges</code> array Privileges to grant"},{"location":"user-guide/grants/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL-specific grant configuration.</p> Field Type Description <code>roles</code> array MySQL 8.0+ roles to assign <code>grants</code> array Permission grants"},{"location":"user-guide/grants/#mysql-grants","title":"mysql grants","text":"Field Type Description <code>level</code> string <code>global</code>, <code>database</code>, <code>table</code> <code>database</code> string Database name (for database/table level) <code>table</code> string Table name (for table level) <code>privileges</code> array Privileges to grant <p>MySQL privileges: <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>CREATE</code>, <code>DROP</code>, <code>INDEX</code>, <code>ALTER</code>, <code>EXECUTE</code>, <code>CREATE VIEW</code>, <code>SHOW VIEW</code>, etc.</p>"},{"location":"user-guide/grants/#status","title":"Status","text":"Field Description <code>phase</code> Current phase <code>conditions</code> Detailed conditions"},{"location":"user-guide/grants/#examples","title":"Examples","text":""},{"location":"user-guide/grants/#assign-roles-to-user","title":"Assign Roles to User","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-roles\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    roles:\n      - readonly\n      - analytics\n</code></pre>"},{"location":"user-guide/grants/#direct-table-grants","title":"Direct Table Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-table-grants\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    grants:\n      - database: myapp\n        schema: public\n        tables: [users, orders, products]\n        privileges: [SELECT, INSERT, UPDATE]\n      - database: myapp\n        schema: public\n        tables: [audit_log]\n        privileges: [SELECT]  # Read-only on audit\n</code></pre>"},{"location":"user-guide/grants/#grant-all-tables-in-schema","title":"Grant All Tables in Schema","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-all-tables\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    grants:\n      - database: myapp\n        schema: app\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"user-guide/grants/#default-privileges-for-future-tables","title":"Default Privileges for Future Tables","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-default-privileges\nspec:\n  userRef:\n    name: myapp-user\n  postgres:\n    defaultPrivileges:\n      - database: myapp\n        schema: public\n        grantedBy: myapp_admin\n        objectType: tables\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n      - database: myapp\n        schema: public\n        grantedBy: myapp_admin\n        objectType: sequences\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"user-guide/grants/#combined-roles-and-grants","title":"Combined Roles and Grants","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-user-full-access\nspec:\n  userRef:\n    name: myapp-user\n  databaseRef:\n    name: myapp-database\n  postgres:\n    roles:\n      - readonly_base  # Inherit basic read\n    grants:\n      - database: myapp\n        schema: app\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]  # Add write\n    defaultPrivileges:\n      - database: myapp\n        schema: app\n        grantedBy: app_admin\n        objectType: tables\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"user-guide/grants/#mysql-database-level-grant","title":"MySQL Database-Level Grant","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-mysql-grants\nspec:\n  userRef:\n    name: myapp-mysql-user\n  mysql:\n    grants:\n      - level: database\n        database: myapp\n        privileges: [SELECT, INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"user-guide/grants/#mysql-table-level-grant","title":"MySQL Table-Level Grant","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseGrant\nmetadata:\n  name: myapp-mysql-table-grants\nspec:\n  userRef:\n    name: myapp-mysql-user\n  mysql:\n    grants:\n      - level: table\n        database: myapp\n        table: users\n        privileges: [SELECT, INSERT]\n      - level: table\n        database: myapp\n        table: audit_log\n        privileges: [SELECT]\n</code></pre>"},{"location":"user-guide/grants/#grant-vs-role","title":"Grant vs Role","text":"Approach Pros Cons Roles Reusable, hierarchical, easier to maintain Additional indirection Direct Grants Simple, explicit Harder to maintain at scale <p>Recommendation: Use roles for common permission sets, direct grants for specific exceptions.</p>"},{"location":"user-guide/grants/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/grants/#grants-not-applied","title":"Grants not applied","text":"<ul> <li>Verify the user/role exists and is Ready</li> <li>Check the database, schema, and tables exist</li> <li>Ensure proper privileges are specified</li> <li>Review operator logs</li> </ul>"},{"location":"user-guide/grants/#default-privileges-not-working","title":"Default privileges not working","text":"<ul> <li>Verify <code>grantedBy</code> role exists and creates objects</li> <li>Check the schema exists</li> <li>Ensure the user has USAGE on the schema</li> </ul>"},{"location":"user-guide/roles/","title":"DatabaseRole","text":"<p>A <code>DatabaseRole</code> creates group roles for permission management. Roles are primarily used in PostgreSQL for grouping permissions that can be inherited by users.</p>"},{"location":"user-guide/roles/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: readonly\n  postgres:\n    login: false\n</code></pre>"},{"location":"user-guide/roles/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/roles/#instanceref-required","title":"instanceRef (required)","text":"<p>Reference to the parent <code>DatabaseInstance</code>.</p>"},{"location":"user-guide/roles/#rolename-required","title":"roleName (required)","text":"<p>The role name in the database. Immutable after creation.</p>"},{"location":"user-guide/roles/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific role configuration.</p> Field Type Description <code>login</code> bool Can login (default: false for roles) <code>inherit</code> bool Inherit privileges (default: true) <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>connectionLimit</code> int Max connections (-1 = unlimited) <code>inRoles</code> array Roles to inherit from <code>grants</code> array Permissions to grant"},{"location":"user-guide/roles/#grants","title":"grants","text":"Field Type Description <code>database</code> string Database name <code>schema</code> string Schema name <code>tables</code> array Table names or <code>[\"*\"]</code> for all <code>sequences</code> array Sequence names or <code>[\"*\"]</code> for all <code>functions</code> array Function names <code>privileges</code> array Privileges to grant <p>Available privileges:</p> <ul> <li>Tables: <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>TRUNCATE</code>, <code>REFERENCES</code>, <code>TRIGGER</code></li> <li>Sequences: <code>USAGE</code>, <code>SELECT</code>, <code>UPDATE</code></li> <li>Functions: <code>EXECUTE</code></li> </ul>"},{"location":"user-guide/roles/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL role configuration (MySQL 8.0+ only).</p> Field Type Description <code>grants</code> array Permissions to grant"},{"location":"user-guide/roles/#status","title":"Status","text":"Field Description <code>phase</code> Current phase <code>conditions</code> Detailed conditions"},{"location":"user-guide/roles/#examples","title":"Examples","text":""},{"location":"user-guide/roles/#read-only-role","title":"Read-Only Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readonly-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: readonly\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT]\n</code></pre>"},{"location":"user-guide/roles/#read-write-role","title":"Read-Write Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: readwrite-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: readwrite\n  postgres:\n    login: false\n    inRoles:\n      - readonly  # Inherit read permissions\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE, DELETE]\n</code></pre>"},{"location":"user-guide/roles/#admin-role","title":"Admin Role","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: admin-role\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: app_admin\n  postgres:\n    login: false\n    createDB: false\n    createRole: true\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT, INSERT, UPDATE, DELETE, TRUNCATE]\n      - database: myapp\n        schema: public\n        sequences: [\"*\"]\n        privileges: [USAGE, SELECT, UPDATE]\n</code></pre>"},{"location":"user-guide/roles/#role-hierarchy","title":"Role Hierarchy","text":"<p>Create a hierarchy of roles for complex permission models:</p> <pre><code># Level 1: Basic read access\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: l1-reader\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: l1_reader\n  postgres:\n    login: false\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [SELECT]\n---\n# Level 2: Read + Write\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: l2-writer\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: l2_writer\n  postgres:\n    login: false\n    inRoles: [l1_reader]\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [INSERT, UPDATE]\n---\n# Level 3: Full access\napiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseRole\nmetadata:\n  name: l3-admin\nspec:\n  instanceRef:\n    name: postgres-primary\n  roleName: l3_admin\n  postgres:\n    login: false\n    inRoles: [l2_writer]\n    grants:\n      - database: myapp\n        schema: public\n        tables: [\"*\"]\n        privileges: [DELETE, TRUNCATE]\n</code></pre>"},{"location":"user-guide/roles/#best-practices","title":"Best Practices","text":"<ol> <li>Use roles for grouping - Create roles for permission sets, then assign roles to users</li> <li>Keep roles non-login - Roles should not have login capability; users should</li> <li>Use inheritance - Build role hierarchies with <code>inRoles</code> for maintainability</li> <li>Principle of least privilege - Grant only necessary permissions</li> </ol>"},{"location":"user-guide/roles/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/roles/#role-not-created","title":"Role not created","text":"<ul> <li>Verify the DatabaseInstance is Ready</li> <li>Check the admin user has CREATE ROLE permission</li> <li>Review operator logs for errors</li> </ul>"},{"location":"user-guide/roles/#grants-not-applied","title":"Grants not applied","text":"<ul> <li>Ensure the database and schema exist</li> <li>Verify the tables/sequences exist</li> <li>Check for syntax errors in privilege names</li> </ul>"},{"location":"user-guide/users/","title":"DatabaseUser","text":"<p>A <code>DatabaseUser</code> creates and manages database users with automatic credential management.</p>"},{"location":"user-guide/users/#overview","title":"Overview","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"user-guide/users/#spec-fields","title":"Spec Fields","text":""},{"location":"user-guide/users/#instanceref-required","title":"instanceRef (required)","text":"<p>Reference to the parent <code>DatabaseInstance</code>.</p>"},{"location":"user-guide/users/#username-required","title":"username (required)","text":"<p>The username in the database. Immutable after creation.</p>"},{"location":"user-guide/users/#passwordsecret-optional","title":"passwordSecret (optional)","text":"<p>Configuration for password management.</p> Field Type Description <code>generate</code> bool Auto-generate a secure password <code>length</code> int Password length (default: 24) <code>includeSpecialChars</code> bool Include special characters (default: true) <code>excludeChars</code> string Characters to exclude <code>secretName</code> string Name for the generated Secret <code>secretTemplate</code> object Custom Secret template"},{"location":"user-guide/users/#secrettemplate","title":"secretTemplate","text":"<p>Customize the generated Secret:</p> Field Type Description <code>labels</code> map Additional labels <code>annotations</code> map Additional annotations <code>data</code> map Additional data fields with templates <p>Template variables:</p> <ul> <li><code>{{ .Username }}</code> - The username</li> <li><code>{{ .Password }}</code> - The password</li> <li><code>{{ .Host }}</code> - Database host</li> <li><code>{{ .Port }}</code> - Database port</li> <li><code>{{ .Database }}</code> - Database name</li> <li><code>{{ .SSLMode }}</code> - SSL mode (PostgreSQL)</li> </ul>"},{"location":"user-guide/users/#existingpasswordsecret-optional","title":"existingPasswordSecret (optional)","text":"<p>Use an existing password instead of generating one.</p> Field Type Description <code>name</code> string Secret name <code>key</code> string Key containing the password"},{"location":"user-guide/users/#postgres-optional","title":"postgres (optional)","text":"<p>PostgreSQL-specific user configuration.</p> Field Type Description <code>connectionLimit</code> int Max concurrent connections <code>inherit</code> bool Inherit role privileges (default: true) <code>login</code> bool Can login (default: true) <code>createDB</code> bool Can create databases <code>createRole</code> bool Can create roles <code>superuser</code> bool Is superuser <code>replication</code> bool Can replicate <code>bypassRLS</code> bool Bypass row-level security <code>inRoles</code> array Roles to inherit from <code>configParameters</code> map Session parameters"},{"location":"user-guide/users/#mysql-optional","title":"mysql (optional)","text":"<p>MySQL-specific user configuration.</p> Field Type Description <code>maxQueriesPerHour</code> int Query limit (0 = unlimited) <code>maxUpdatesPerHour</code> int Update limit <code>maxConnectionsPerHour</code> int Connection limit per hour <code>maxUserConnections</code> int Max concurrent connections <code>authPlugin</code> string Authentication plugin <code>requireSSL</code> bool Require SSL connections <code>allowedHosts</code> array Allowed connection hosts <code>accountLocked</code> bool Lock the account"},{"location":"user-guide/users/#status","title":"Status","text":"Field Description <code>phase</code> Current phase <code>conditions</code> Detailed conditions <code>credentialsSecretRef</code> Reference to the credentials Secret"},{"location":"user-guide/users/#examples","title":"Examples","text":""},{"location":"user-guide/users/#basic-user-with-generated-password","title":"Basic User with Generated Password","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n</code></pre>"},{"location":"user-guide/users/#user-with-custom-secret-template","title":"User with Custom Secret Template","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    length: 32\n    secretName: myapp-user-credentials\n    secretTemplate:\n      labels:\n        app: myapp\n      data:\n        DATABASE_URL: \"postgresql://{{ .Username }}:{{ .Password }}@{{ .Host }}:{{ .Port }}/myapp?sslmode={{ .SSLMode }}\"\n        JDBC_URL: \"jdbc:postgresql://{{ .Host }}:{{ .Port }}/myapp?user={{ .Username }}&amp;password={{ .Password }}\"\n</code></pre>"},{"location":"user-guide/users/#user-with-existing-password","title":"User with Existing Password","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  existingPasswordSecret:\n    name: my-existing-password\n    key: password\n</code></pre>"},{"location":"user-guide/users/#postgresql-user-with-role-membership","title":"PostgreSQL User with Role Membership","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-user\nspec:\n  instanceRef:\n    name: postgres-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-user-credentials\n  postgres:\n    connectionLimit: 20\n    inRoles:\n      - readonly_role\n      - analytics_role\n    configParameters:\n      search_path: \"app,public\"\n      statement_timeout: \"30000\"\n</code></pre>"},{"location":"user-guide/users/#mysql-user-with-host-restrictions","title":"MySQL User with Host Restrictions","text":"<pre><code>apiVersion: dbops.dbprovision.io/v1alpha1\nkind: DatabaseUser\nmetadata:\n  name: myapp-mysql-user\nspec:\n  instanceRef:\n    name: mysql-primary\n  username: myapp_user\n  passwordSecret:\n    generate: true\n    secretName: myapp-mysql-credentials\n  mysql:\n    maxUserConnections: 50\n    authPlugin: caching_sha2_password\n    allowedHosts:\n      - \"10.0.0.%\"\n      - \"192.168.1.%\"\n</code></pre>"},{"location":"user-guide/users/#generated-secret-structure","title":"Generated Secret Structure","text":"<p>When <code>passwordSecret.generate: true</code>, the operator creates a Secret:</p> <pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: myapp-user-credentials\n  ownerReferences:\n    - apiVersion: dbops.dbprovision.io/v1alpha1\n      kind: DatabaseUser\n      name: myapp-user\ntype: Opaque\ndata:\n  username: &lt;base64&gt;\n  password: &lt;base64&gt;\n  # Plus any custom fields from secretTemplate\n</code></pre>"},{"location":"user-guide/users/#password-rotation","title":"Password Rotation","text":"<p>To rotate a password:</p> <ol> <li>Delete the existing credentials Secret</li> <li>The operator will detect the missing Secret and regenerate</li> </ol> <p>Or use the annotation:</p> <pre><code>metadata:\n  annotations:\n    dbops.dbprovision.io/rotate-password: \"true\"\n</code></pre>"},{"location":"user-guide/users/#troubleshooting","title":"Troubleshooting","text":""},{"location":"user-guide/users/#user-stuck-in-pending","title":"User stuck in Pending","text":"<ul> <li>Verify the DatabaseInstance is Ready</li> <li>Check the credentials Secret exists (if using existing)</li> </ul>"},{"location":"user-guide/users/#password-not-generated","title":"Password not generated","text":"<ul> <li>Check if <code>passwordSecret.generate: true</code> is set</li> <li>Verify <code>secretName</code> is specified</li> <li>Check for errors in operator logs</li> </ul>"},{"location":"user-guide/users/#cannot-connect-with-generated-password","title":"Cannot connect with generated password","text":"<ul> <li>Verify the Secret contains the correct password</li> <li>Check the user was created in the database</li> <li>For PostgreSQL, verify pg_hba.conf allows the connection</li> </ul>"}]}